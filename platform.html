<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="20251128204757">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire FGA - Intelligence Platform</title>
<!-- ADD FAVICON CODE HERE -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/favicon-64x64.png">
    <link rel="apple-touch-icon" sizes="256x256" href="/favicon-256x256.png">
    <meta name="theme-color" content="#000000">
    <!-- END FAVICON CODE -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        * { font-family: 'Inter', sans-serif; }
        
        .gradient-text {
            background: linear-gradient(to right, #60a5fa, #22d3ee, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .tab-button {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            color: #60a5fa;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(to right, #60a5fa, #22d3ee);
            border-radius: 3px 3px 0 0;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.05) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.2);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(to right, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            color: #94a3b8;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 8px;
        }
        
        .player-card {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.1) 0%, rgba(17, 24, 39, 0.8) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .player-card:hover {
            border-color: #60a5fa;
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(59, 130, 246, 0.3);
        }
        
        .player-card.selected {
            border-color: #22d3ee;
            background: linear-gradient(135deg, rgba(34, 211, 238, 0.15) 0%, rgba(17, 24, 39, 0.9) 100%);
            box-shadow: 0 0 20px rgba(34, 211, 238, 0.4);
        }
        
        .filter-pill {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            background-color: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #60a5fa;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .filter-pill:hover, .filter-pill.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .pagination-btn {
            background-color: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #60a5fa;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 4px;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background-color: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .pagination-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .pagination-btn.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .search-input {
            background-color: #1e293b;
            border: 1px solid #334155;
            color: #e2e8f0;
            border-radius: 0.375rem;
            padding: 10px 16px;
            width: 100%;
            transition: all 0.2s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .database-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .database-table th {
            background-color: rgba(30, 58, 138, 0.3);
            color: #93c5fd;
            text-align: left;
            font-weight: 600;
            padding: 12px 15px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            cursor: pointer;
            user-select: none;
        }
        
        .database-table th:hover {
            background-color: rgba(30, 58, 138, 0.5);
        }
        
        .database-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .database-table tbody tr:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .database-table a {
            color: #60a5fa;
            text-decoration: none;
            font-weight: 500;
        }
        
        .database-table a:hover {
            text-decoration: underline;
        }
        
        .value-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
        }
        
        .value-badge.undervalued {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.4);
            color: #22c55e;
        }
        
        .heatmap-cell {
            cursor: pointer;
            transition: all 0.2s;
            display: inline-block;
            padding: 8px 12px;
            border-radius: 8px;
            min-width: 50px;
            font-weight: 700;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.1);
        }
        
        .pitch-background {
            background: linear-gradient(180deg, #0f5132 0%, #0a3622 100%);
            position: relative;
            border: 3px solid white;
            border-radius: 8px;
        }
        
        .pitch-position {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(59, 130, 246, 0.3);
            border: 2px solid #60a5fa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            flex-direction: column;
            text-align: center;
            padding: 4px;
        }
        
        .pitch-position:hover {
            transform: scale(1.05);
            background: rgba(59, 130, 246, 0.5);
        }
        
        .pitch-position.filled {
            background: rgba(34, 197, 94, 0.6);
            border-color: #22c55e;
        }
        
        .formation-selector {
            display: inline-block;
            padding: 10px 20px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 8px 8px 0;
        }
        
        .formation-selector:hover, .formation-selector.active {
            border-color: #60a5fa;
            background: rgba(59, 130, 246, 0.1);
        }
        
        /* ==========================================
           PLAYER AVATAR STYLES FOR TABLE
           ========================================== */
        .player-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(59, 130, 246, 0.5);
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            transition: all 0.3s ease;
            display: inline-block;
            vertical-align: middle;
        }

        .player-avatar-small:hover {
            transform: scale(1.1);
            border-color: rgba(59, 130, 246, 1);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .player-avatar-placeholder {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            border: 2px solid rgba(100, 116, 139, 0.5);
            font-weight: bold;
            font-size: 0.875rem;
            vertical-align: middle;
        }

        tbody tr:hover {
            background-color: rgba(30, 41, 59, 0.5) !important;
        }
        
        .player-name-cell {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
    </style>
</head>
<body class="bg-slate-950 text-white">

    

    <!-- Client Login Modal -->
    <div id="clientLoginModal" class="login-overlay" style="display:none;">
        <div class="login-modal">
            <button onclick="closeClientLogin()" class="absolute top-4 right-4 text-slate-400 hover:text-white text-2xl">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="text-center mb-8">
                <img src="https://media.licdn.com/dms/image/v2/D4E12AQEjuDAF0uOTrw/article-cover_image-shrink_720_1280/B4EZiOwG01GwAI-/0/1754741632806?e=2147483647&v=beta&t=L9ct0jEaWdSp7vfTI0urIqPPig0MspEd-6RtzxaQzzQ" 
                     alt="Empire FGA" 
                     class="h-16 w-auto mx-auto mb-4">
                <h1 class="text-3xl font-bold gradient-text mb-2">Client Portal</h1>
                <p class="text-slate-400">Premium Access for Valued Clients</p>
            </div>
            
            <div id="clientLoginError" class="login-error">
                <i class="fas fa-exclamation-circle"></i> Invalid credentials. Please contact <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="70030500001f020430151d001902151617115e131f1d">[email&#160;protected]</a>
            </div>
            
            <form id="clientLoginForm" onsubmit="handleClientLogin(event)">
                <div class="mb-4">
                    <label class="block text-slate-300 mb-2 font-semibold">
                        <i class="fas fa-building"></i> Club Name or Email
                    </label>
                    <input 
                        type="text" 
                        id="clientUsername" 
                        class="login-input" 
                        placeholder="Enter club name or email" 
                        required
                        autocomplete="username">
                </div>
                
                <div class="mb-6">
                    <label class="block text-slate-300 mb-2 font-semibold">
                        <i class="fas fa-key"></i> Access Code
                    </label>
                    <input 
                        type="password" 
                        id="clientPassword" 
                        class="login-input" 
                        placeholder="Enter your access code" 
                        required
                        autocomplete="current-password">
                </div>
                
                <button type="submit" class="login-button">
                    <i class="fas fa-sign-in-alt"></i> Access Client Portal
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-slate-400 text-sm mb-4">
                    <i class="fas fa-info-circle"></i> Client Portal Features:
                </p>
                <div class="grid grid-cols-2 gap-2 text-xs text-slate-500">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-check text-green-400"></i> Player Database Access
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fas fa-check text-green-400"></i> Comparison Tool
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fas fa-check text-green-400"></i> Market Intelligence
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fas fa-check text-green-400"></i> Export Reports
                    </div>
                </div>
            </div>
            
            <div class="mt-6 text-center text-slate-500 text-sm border-t border-slate-700 pt-4">
                <p class="mb-2">Don't have access yet?</p>
                <a href="https://www.empirescoutingnetwork.com/demo" target="_blank" class="text-blue-400 hover:text-blue-300 font-semibold">
                    <i class="fas fa-calendar"></i> Request a Demo
                </a>
            </div>
        </div>
    </div>

    <!-- Platform Content (Hidden until authenticated) -->
    <div id="platformContent" class="platform-content">

    <!-- Navigation -->
    <nav class="sticky top-0 w-full bg-slate-950/90 backdrop-blur-md z-50 border-b border-blue-500/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <img src="https://media.licdn.com/dms/image/v2/D4E12AQEjuDAF0uOTrw/article-cover_image-shrink_720_1280/B4EZiOwG01GwAI-/0/1754741632806?e=2147483647&v=beta&t=L9ct0jEaWdSp7vfTI0urIqPPig0MspEd-6RtzxaQzzQ" 
                         alt="Empire Scouting Network" 
                         class="h-10 w-auto">
                    <span class="text-xl font-bold gradient-text">Empire FGA Platform</span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button onclick="exportToPDF()" class="text-yellow-400 hover:text-yellow-300 px-4 py-2 rounded-lg font-semibold transition border border-yellow-500 hover:bg-yellow-500/10 flex items-center gap-2">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                    <a href="client_login.html" class="text-blue-400 hover:text-blue-300 px-4 py-2 rounded-lg font-semibold transition border border-blue-500 hover:bg-blue-500/10 flex items-center gap-2">
                        <i class="fas fa-user"></i> <span id="clientLoginText">Client Login</span>
                    </a>
                    <a href="https://www.empirescoutingnetwork.com/demo" target="_blank" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg font-semibold transition flex items-center gap-2">
                        <i class="fas fa-calendar"></i> Request Demo
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Tab Navigation -->
    <div class="bg-slate-900/50 border-b border-blue-500/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex space-x-8 overflow-x-auto">
                <button class="tab-button active py-4 px-2 font-semibold whitespace-nowrap" onclick="switchTab('database')">
                    <i class="fas fa-database"></i> Player Database
                </button>
                <button class="tab-button py-4 px-2 font-semibold whitespace-nowrap" onclick="switchTab('comparison')">
                    <i class="fas fa-balance-scale"></i> Player Comparison
                </button>
                <button class="tab-button py-4 px-2 font-semibold whitespace-nowrap" onclick="switchTab('market')">
                    <i class="fas fa-chart-line"></i> Market Intelligence
                </button>
                <button class="tab-button py-4 px-2 font-semibold whitespace-nowrap" onclick="switchTab('philosophy')">
                    <i class="fas fa-brain"></i> Philosophy Heatmap
                </button>
                <button class="tab-button py-4 px-2 font-semibold whitespace-nowrap" onclick="switchTab('squad')">
                    <i class="fas fa-users"></i> Squad Builder
                </button>
                <button class="tab-button py-4 px-2 font-semibold whitespace-nowrap" onclick="switchTab('agents')">
                    <i class="fas fa-binoculars"></i> Scouting Tool
                </button>
                <button class="tab-button py-4 px-2 font-semibold whitespace-nowrap" onclick="switchTab('rated-players')">
                    <i class="fas fa-star"></i> Rated Players
                </button>
                <button class="tab-button py-4 px-2 font-semibold whitespace-nowrap" onclick="switchTab('rate-new')">
                    <i class="fas fa-user-plus"></i> Rate New Player
                </button>
            </div>
        </div>
    </div>

    <main class="pt-8 pb-20 px-4">
        <div class="max-w-7xl mx-auto">
            
            <!-- DATABASE TAB -->
            <div id="database-tab" class="tab-content active">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold mb-4 gradient-text">Player Database</h1>
                    <p class="text-xl text-slate-300">Search 25000 players analyzed with 779 metrics and 60 tactical philosophies</p>
                </div>

                <!-- Stats Dashboard -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                    <div class="stat-card">
                        <div id="stat-total" class="stat-value">521</div>
                        <div class="stat-label">Total Players</div>
                    </div>
                    <div class="stat-card">
                        <div id="stat-avg-fga" class="stat-value">0.0</div>
                        <div class="stat-label">Avg FGA</div>
                    </div>
                    <div class="stat-card">
                        <div id="stat-legends" class="stat-value">0</div>
                        <div class="stat-label">Legends (90+)</div>
                    </div>
                    <div class="stat-card">
                        <div id="stat-elite" class="stat-value">0</div>
                        <div class="stat-label">Elite (85+)</div>
                    </div>
                    <div class="stat-card">
                        <div id="stat-showing" class="stat-value">0</div>
                        <div class="stat-label">Showing</div>
                    </div>
                </div>

                <!-- Quick Filters -->
                <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6 mb-8">
                    <h3 class="text-lg font-bold mb-3 text-blue-300">Quick Filters</h3>
                    <div class="flex flex-wrap gap-2">
                        <!-- Core Filters -->
                        <span class="filter-pill active" onclick="quickFilter('all')">All Players</span>
                        <span class="filter-pill" onclick="quickFilter('legends')">Legends (90+)</span>
                        <span class="filter-pill" onclick="quickFilter('elite')">Elite (85-90)</span>
                        <span class="filter-pill" onclick="quickFilter('prospects')">Prospects (U21)</span>
                        <span class="filter-pill" onclick="quickFilter('active')">Active Players</span>
                        
                        <!-- Position Filters -->
                        <span class="filter-pill" onclick="quickFilter('strikers')">Strikers</span>
                        <span class="filter-pill" onclick="quickFilter('midfielders')">Midfielders</span>
                        <span class="filter-pill" onclick="quickFilter('defenders')">Defenders</span>
                        <span class="filter-pill" onclick="quickFilter('goalkeepers')">Goalkeepers</span>
                        
                        <!-- League Filters -->
                        <span class="filter-pill" onclick="quickFilter('premier-league')">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Premier League</span>
                        <span class="filter-pill" onclick="quickFilter('la-liga')">üá™üá∏ La Liga</span>
                        <span class="filter-pill" onclick="quickFilter('bundesliga')">üá©üá™ Bundesliga</span>
                        <span class="filter-pill" onclick="quickFilter('serie-a')">üáÆüáπ Serie A</span>
                        <span class="filter-pill" onclick="quickFilter('ligue-1')">üá´üá∑ Ligue 1</span>
                        
                        <!-- Agency Filters -->
                        <span class="filter-pill" onclick="quickFilter('prosport')">üìã Prosport Management</span>
                        <span class="filter-pill" onclick="quickFilter('vulpes')">üìã Vulpes-vna</span>
                        <span class="filter-pill" onclick="quickFilter('bks')">üìã BKS Management</span>
                    </div></div>
                </div>

                <!-- Search -->
                <div class="mb-6">
                    <input type="text" 
                           id="search-name" 
                           placeholder="Search player by name..." 
                           class="search-input"
                           oninput="filterAndRender()">
                </div>

                <!-- Advanced Search -->
                <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6 mb-8">
                    <h3 class="text-lg font-bold mb-4 text-blue-300">Advanced Search</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- Age Range -->
                        <div>
                            <label class="block text-sm font-semibold text-slate-300 mb-2">Age Range</label>
                            <div class="flex gap-2 items-center">
                                <input type="number" id="age-min" placeholder="Min" min="15" max="45" 
                                       class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-sm"
                                       oninput="filterAndRender()">
                                <span class="text-slate-500">-</span>
                                <input type="number" id="age-max" placeholder="Max" min="15" max="45" 
                                       class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-sm"
                                       oninput="filterAndRender()">
                            </div>
                        </div>

                        <!-- FGA Rating Range -->
                        <div>
                            <label class="block text-sm font-semibold text-slate-300 mb-2">FGA Rating</label>
                            <div class="flex gap-2 items-center">
                                <input type="number" id="fga-min" placeholder="Min" min="0" max="100" step="0.1"
                                       class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-sm"
                                       oninput="filterAndRender()">
                                <span class="text-slate-500">-</span>
                                <input type="number" id="fga-max" placeholder="Max" min="0" max="100" step="0.1"
                                       class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-sm"
                                       oninput="filterAndRender()">
                            </div>
                        </div>

                        <!-- Nationality -->
                        <div>
                            <label class="block text-sm font-semibold text-slate-300 mb-2">Nationality</label>
                            <select id="nationality-filter" 
                                    class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-sm"
                                    onchange="filterAndRender()">
                                <option value="">All Countries</option>
                            </select>
                        </div>

                        <!-- Agency -->
                        <div>
                            <label class="block text-sm font-semibold text-slate-300 mb-2">Agency</label>
                            <select id="agency-filter" 
                                    class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-sm"
                                    onchange="filterAndRender()">
                                <option value="">All Agencies</option>
                                <option value="Prosport Management">Prosport Management</option>
                                <option value="Vulpes-vna">Vulpes-vna</option>
                                <option value="BKS Management">BKS Management</option>
                            </select>
                        </div>
                    </div>

                    <!-- Reset Button -->
                    <div class="mt-4">
                        <button onclick="resetAdvancedSearch()" 
                                class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-sm transition">
                            üîÑ Reset All Filters
                        </button>
                    </div>
                </div>

                <!-- Export Tools -->
                <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-4 mb-8 flex flex-wrap gap-3 items-center justify-between">
                    <div class="flex gap-3">
                        <button onclick="exportToCSV()" 
                                class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded text-sm font-semibold transition flex items-center gap-2">
                            üìä Export to CSV
                        </button>
                        <button onclick="exportFilteredPDFs()" 
                                class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded text-sm font-semibold transition flex items-center gap-2">
                            üìÑ Bulk PDF Export
                        </button>
                    </div>
                    <div class="text-sm text-slate-400">
                        Showing <span id="export-count" class="font-bold text-blue-400">0</span> players
                        <span class="ml-4">
                            (<span id="fga-rated-count" class="text-green-400 font-semibold">0</span> üèÜ FGA-Rated, 
                            <span id="profile-only-count" class="text-slate-400 font-semibold">0</span> üìã Profile)
                        </span>
                    </div>
                </div>

                <!-- Player Table -->
                <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl overflow-hidden mb-6">
                    <div class="overflow-x-auto">
                        <table class="database-table">
                            <thead>
                                <tr>
                                    <th onclick="sortTable('name')">Player Name ‚áÖ</th>
                                    <th onclick="sortTable('position')">Position ‚áÖ</th>
                                    <th onclick="sortTable('age')">Age ‚áÖ</th>
                                    <th onclick="sortTable('currentClub')">Current Club ‚áÖ</th>
                                    <th onclick="sortTable('nationality')">Nationality ‚áÖ</th>
                                    <th onclick="sortTable('fga')">FGA Rating ‚áÖ</th>
                                    <th onclick="sortTable('bestPhilosophy')">Top Philosophy ‚áÖ</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="database-table-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pagination -->
                <div id="pagination-container" class="flex justify-center items-center gap-2 flex-wrap">
                    <!-- Pagination populated by JavaScript -->
                </div>
            </div>

            <!-- COMPARISON TAB -->
            <div id="comparison-tab" class="tab-content">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold mb-4 gradient-text">Player Comparison Tool</h1>
                    <p class="text-xl text-slate-300">Compare players across FGA ratings, positions, age profiles, and tactical philosophies</p>
                </div>

                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4 text-blue-300">Search & Select Players</h3>
                        <input type="text" 
                               id="comparison-search" 
                               placeholder="Search players to compare..." 
                               class="search-input mb-4"
                               oninput="searchForComparison(this.value)">
                        <div id="comparison-search-results" class="space-y-2 max-h-96 overflow-y-auto">
                            <p class="text-slate-400 text-sm">Start typing to search players...</p>
                        </div>
                    </div>

                    <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4 text-blue-300">Selected Players (<span id="selected-count">0</span>/4)</h3>
                        <div id="selected-players" class="space-y-2 mb-4">
                            <p class="text-slate-400 text-sm">Select players from the search results to compare</p>
                        </div>
                        <button onclick="generateComparison()" 
                                class="w-full bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-semibold transition">
                            Generate Comparison
                        </button>
                    </div>
                </div>

                <div id="comparison-results" class="hidden">
                    <!-- Comparison results will appear here -->
                </div>
            </div>

            <!-- MARKET INTELLIGENCE TAB -->
            <div id="market-tab" class="tab-content">
                <!-- HERO SECTION -->
                <div class="text-center mb-8">
                    <h1 class="text-5xl font-bold mb-4 gradient-text">üíé Market Intelligence Dashboard</h1>
                    <p class="text-2xl text-slate-300 mb-2">The ONLY platform that tells you WHO IS SIGNABLE</p>
                    <p class="text-sm text-slate-400">Performance Data + Financial Intelligence + Deal Feasibility = Smart Scouting</p>
                </div>

                <!-- QUICK STATS OVERVIEW -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                    <div class="stat-card">
                        <div class="text-3xl mb-2">üéØ</div>
                        <div class="stat-value">9</div>
                        <div class="stat-label">Data Sources</div>
                    </div>
                    <div class="stat-card">
                        <div class="text-3xl mb-2">üí∞</div>
                        <div class="stat-value">‚Ç¨3.5B</div>
                        <div class="stat-label">Annual Transfer Volume</div>
                    </div>
                    <div class="stat-card">
                        <div class="text-3xl mb-2">üìä</div>
                        <div class="stat-value">120+</div>
                        <div class="stat-label">Leagues Covered</div>
                    </div>
                    <div class="stat-card">
                        <div class="text-3xl mb-2">üî•</div>
                        <div class="stat-value">76%</div>
                        <div class="stat-label">Prediction Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <div class="text-3xl mb-2">‚ö°</div>
                        <div class="stat-value">5</div>
                        <div class="stat-label">Smart Features</div>
                    </div>
                </div>

                <!-- NAVIGATION TABS -->
                <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
                    <button onclick="showMarketSection('data-sources', this)" class="market-sub-tab active bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition">
                        üìä Data Sources
                    </button>
                    <button onclick="showMarketSection('feasibility', this)" class="market-sub-tab bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition">
                        üéØ Feasibility Filter
                    </button>
                    <button onclick="showMarketSection('work-permit', this)" class="market-sub-tab bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition">
                        üõÇ Work Permit (GBE)
                    </button>
                    <button onclick="showMarketSection('league-conversion', this)" class="market-sub-tab bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition">
                        üåç League Conversion
                    </button>
                    <button onclick="showMarketSection('agent-network', this)" class="market-sub-tab bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition">
                        ü§ù Agent Network
                    </button>
                    <button onclick="showMarketSection('replacement', this)" class="market-sub-tab bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition">
                        üîÑ Replacement Engine
                    </button>
                    <button onclick="showMarketSection('analysis', this)" class="market-sub-tab bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition">
                        üíé Market Analysis
                    </button>
                </div>

                <!-- SECTION 1: DATA SOURCES -->
                <div id="market-data-sources" class="market-section">
                    <div class="bg-gradient-to-r from-blue-900/30 to-slate-900/30 border border-blue-500/30 rounded-xl p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-4 text-blue-300">üìä Our 9 Data Sources - The Foundation</h2>
                        <p class="text-slate-300 mb-6">We integrate data from the world's leading providers to give you the complete picture</p>
                        
                        <!-- PERFORMANCE DATA -->
                        <div class="mb-8">
                            <h3 class="text-xl font-bold mb-4 text-cyan-400">‚öΩ Performance & Event Data</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <!-- StatsBomb -->
                                <div class="bg-slate-800/50 rounded-lg p-5 border border-blue-500/20 hover:border-blue-500/40 transition">
                                    <div class="flex items-start justify-between mb-3">
                                        <div>
                                            <h4 class="text-lg font-bold text-white">StatsBomb (Hudl)</h4>
                                            <p class="text-xs text-blue-400">Gold Standard - Most Granular Data</p>
                                        </div>
                                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-bold">ACTIVE</span>
                                    </div>
                                    <ul class="text-sm space-y-2 text-slate-300 mb-4">
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> 3,400+ events per match</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> 360¬∞ player tracking included</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> 170+ competitions</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Pressure data, freeze frames</li>
                                    </ul>
                                    <div class="flex items-center justify-between">
                                        <span class="text-xs text-slate-400">Coverage: 40+ leagues</span>
                                        <span class="text-xs font-bold text-yellow-400">‚Ç¨50K-100K/yr</span>
                                    </div>
                                </div>

                                <!-- Wyscout -->
                                <div class="bg-slate-800/50 rounded-lg p-5 border border-blue-500/20 hover:border-blue-500/40 transition">
                                    <div class="flex items-start justify-between mb-3">
                                        <div>
                                            <h4 class="text-lg font-bold text-white">Wyscout (Hudl)</h4>
                                            <p class="text-xs text-blue-400">Video + Data Linkage</p>
                                        </div>
                                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-bold">ACTIVE</span>
                                    </div>
                                    <ul class="text-sm space-y-2 text-slate-300 mb-4">
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> 2,000 games/week</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Video clips linked to data</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> 300+ competitions</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Youth tournament coverage</li>
                                    </ul>
                                    <div class="flex items-center justify-between">
                                        <span class="text-xs text-slate-400">Unique: Video integration</span>
                                        <span class="text-xs font-bold text-yellow-400">‚Ç¨30K-60K/yr</span>
                                    </div>
                                </div>

                                <!-- Opta -->
                                <div class="bg-slate-800/50 rounded-lg p-5 border border-slate-700/20 hover:border-slate-500/40 transition">
                                    <div class="flex items-start justify-between mb-3">
                                        <div>
                                            <h4 class="text-lg font-bold text-white">Opta (Stats Perform)</h4>
                                            <p class="text-xs text-slate-400">Broadest Global Coverage</p>
                                        </div>
                                        <span class="bg-slate-600 text-slate-300 px-2 py-1 rounded text-xs font-bold">OPTIONAL</span>
                                    </div>
                                    <ul class="text-sm space-y-2 text-slate-300 mb-4">
                                        <li class="flex items-center gap-2"><i class="fas fa-info-circle text-slate-400"></i> 80+ competitions</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-info-circle text-slate-400"></i> Historical data (2000s+)</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-info-circle text-slate-400"></i> Opta Vision tracking</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-info-circle text-slate-400"></i> ProVision platform</li>
                                    </ul>
                                    <div class="flex items-center justify-between">
                                        <span class="text-xs text-slate-400">Most expensive option</span>
                                        <span class="text-xs font-bold text-red-400">‚Ç¨80K-150K/yr</span>
                                    </div>
                                </div>

                                <!-- Impect -->
                                <div class="bg-slate-800/50 rounded-lg p-5 border border-purple-500/20 hover:border-purple-500/40 transition">
                                    <div class="flex items-start justify-between mb-3">
                                        <div>
                                            <h4 class="text-lg font-bold text-white">Impect (Catapult)</h4>
                                            <p class="text-xs text-purple-400">Revolutionary Packing Data</p>
                                        </div>
                                        <span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded text-xs font-bold">PREMIUM</span>
                                    </div>
                                    <ul class="text-sm space-y-2 text-slate-300 mb-4">
                                        <li class="flex items-center gap-2"><i class="fas fa-star text-purple-400"></i> Packing¬Æ metric</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-star text-purple-400"></i> 70+ competitions</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-star text-purple-400"></i> 9+ Bundesliga clubs use it</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-star text-purple-400"></i> Highest predictive power</li>
                                    </ul>
                                    <div class="flex items-center justify-between">
                                        <span class="text-xs text-slate-400">Used by Tuchel, Klopp</span>
                                        <span class="text-xs font-bold text-yellow-400">‚Ç¨20K-40K/yr</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- FINANCIAL DATA -->
                        <div class="mb-8">
                            <h3 class="text-xl font-bold mb-4 text-green-400">üí∞ Market & Financial Intelligence</h3>
                            <div class="grid md:grid-cols-3 gap-4">
                                <!-- Transfermarkt -->
                                <div class="bg-slate-800/50 rounded-lg p-5 border border-green-500/20 hover:border-green-500/40 transition">
                                    <div class="flex items-start justify-between mb-3">
                                        <div>
                                            <h4 class="text-lg font-bold text-white">Transfermarkt</h4>
                                            <p class="text-xs text-green-400">Market Values & Contracts</p>
                                        </div>
                                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-bold">FREE</span>
                                    </div>
                                    <ul class="text-sm space-y-2 text-slate-300 mb-4">
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Market values</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Contract expiry dates</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Agent information</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Injury records</li>
                                    </ul>
                                    <div class="text-xs text-slate-400">Via web scraping (worldfootballR)</div>
                                </div>

                                <!-- Capology -->
                                <div class="bg-slate-800/50 rounded-lg p-5 border border-green-500/20 hover:border-green-500/40 transition">
                                    <div class="flex items-start justify-between mb-3">
                                        <div>
                                            <h4 class="text-lg font-bold text-white">Capology</h4>
                                            <p class="text-xs text-green-400">Salary & Payroll Data</p>
                                        </div>
                                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-bold">ACTIVE</span>
                                    </div>
                                    <ul class="text-sm space-y-2 text-slate-300 mb-4">
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Player salaries (gross/net)</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Club wage bills</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> 15+ European leagues</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Tax-adjusted estimates</li>
                                    </ul>
                                    <div class="flex items-center justify-between">
                                        <span class="text-xs text-slate-400">Best salary source</span>
                                        <span class="text-xs font-bold text-yellow-400">‚Ç¨5K-15K/yr</span>
                                    </div>
                                </div>

                                <!-- Off The Pitch -->
                                <div class="bg-slate-800/50 rounded-lg p-5 border border-green-500/20 hover:border-green-500/40 transition">
                                    <div class="flex items-start justify-between mb-3">
                                        <div>
                                            <h4 class="text-lg font-bold text-white">Off The Pitch</h4>
                                            <p class="text-xs text-green-400">Club Financial Health</p>
                                        </div>
                                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-bold">ACTIVE</span>
                                    </div>
                                    <ul class="text-sm space-y-2 text-slate-300 mb-4">
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> P&L statements</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Debt levels</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> 25 European leagues</li>
                                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Motivated sellers ID</li>
                                    </ul>
                                    <div class="flex items-center justify-between">
                                        <span class="text-xs text-slate-400">Predict who MUST sell</span>
                                        <span class="text-xs font-bold text-yellow-400">‚Ç¨10K-25K/yr</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- PHYSICAL DATA -->
                        <div>
                            <h3 class="text-xl font-bold mb-4 text-cyan-400">üèÉ Physical & Tracking Data</h3>
                            <div class="bg-slate-800/50 rounded-lg p-5 border border-cyan-500/20 hover:border-cyan-500/40 transition max-w-2xl">
                                <div class="flex items-start justify-between mb-3">
                                    <div>
                                        <h4 class="text-lg font-bold text-white">SkillCorner</h4>
                                        <p class="text-xs text-cyan-400">AI Broadcast Tracking (No GPS Needed!)</p>
                                    </div>
                                    <span class="bg-cyan-500/20 text-cyan-400 px-2 py-1 rounded text-xs font-bold">ACTIVE</span>
                                </div>
                                <ul class="text-sm space-y-2 text-slate-300 mb-4">
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-cyan-400"></i> Full 90-min tracking (all 22 players)</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-cyan-400"></i> Off-camera extrapolation (AI-powered)</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-cyan-400"></i> Speed, distance, work rate metrics</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-cyan-400"></i> 120+ competitions worldwide</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-star text-yellow-400"></i> Scout players in ANY league with TV coverage</li>
                                </ul>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-slate-400">230+ clubs use it</span>
                                    <span class="text-xs font-bold text-yellow-400">‚Ç¨15K-30K/yr</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TOTAL INVESTMENT -->
                    <div class="bg-gradient-to-r from-yellow-900/30 to-slate-900/30 border border-yellow-500/30 rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4 text-yellow-400">üí∞ Total Annual Investment</h3>
                        <div class="grid md:grid-cols-3 gap-6">
                            <div class="bg-slate-800/50 rounded-lg p-6 text-center border border-green-500/20">
                                <div class="text-sm text-slate-400 mb-2">MINIMUM SETUP</div>
                                <div class="text-3xl font-bold text-green-400 mb-2">‚Ç¨310K</div>
                                <div class="text-xs text-slate-400">StatsBomb + Wyscout + Financial sources</div>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-6 text-center border border-blue-500/20">
                                <div class="text-sm text-slate-400 mb-2">RECOMMENDED</div>
                                <div class="text-3xl font-bold text-blue-400 mb-2">‚Ç¨465K</div>
                                <div class="text-xs text-slate-400">+ Impect Packing + SkillCorner</div>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-6 text-center border border-purple-500/20">
                                <div class="text-sm text-slate-400 mb-2">ENTERPRISE</div>
                                <div class="text-3xl font-bold text-purple-400 mb-2">‚Ç¨621K</div>
                                <div class="text-xs text-slate-400">+ Opta for maximum coverage</div>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <p class="text-sm text-slate-300">üí° <strong>ROI:</strong> Each prevented ‚Ç¨50M+ transfer disaster pays for the entire system</p>
                            <p class="text-xs text-slate-400 mt-2">Example: Avoiding an "Antony-type" mistake (‚Ç¨60M loss) = 10x ROI in Year 1</p>
                        </div>
                    </div>
                </div>

                <!-- SECTION 2: FEASIBILITY FILTER -->
                <div id="market-feasibility" class="market-section hidden">
                    <div class="bg-gradient-to-r from-green-900/30 to-slate-900/30 border border-green-500/30 rounded-xl p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-4 text-green-300">üéØ Feasibility Filter - WHO IS SIGNABLE?</h2>
                        <p class="text-slate-300 mb-6">Most platforms show you good players. We show you good players YOU CAN ACTUALLY SIGN.</p>
                        
                        <!-- EXPLANATION -->
                        <div class="bg-slate-800/50 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-bold mb-4 text-white">How It Works: 3-Factor Deal Probability Score</h3>
                            <div class="grid md:grid-cols-3 gap-4">
                                <div class="bg-slate-900/50 rounded-lg p-4 border border-green-500/20">
                                    <div class="text-3xl mb-2">üìÖ</div>
                                    <h4 class="font-bold mb-2">1. Contract Context</h4>
                                    <p class="text-sm text-slate-300 mb-3">Time remaining on current contract</p>
                                    <ul class="text-xs space-y-1 text-slate-400">
                                        <li>‚Ä¢ <12 months = <span class="text-green-400 font-bold">HIGH</span> (40% weight)</li>
                                        <li>‚Ä¢ 1-2 years = <span class="text-yellow-400 font-bold">MEDIUM</span></li>
                                        <li>‚Ä¢ 3+ years = <span class="text-red-400 font-bold">LOW</span></li>
                                    </ul>
                                </div>
                                <div class="bg-slate-900/50 rounded-lg p-4 border border-green-500/20">
                                    <div class="text-3xl mb-2">üí∏</div>
                                    <h4 class="font-bold mb-2">2. Club Financial Health</h4>
                                    <p class="text-sm text-slate-300 mb-3">Selling club's financial status</p>
                                    <ul class="text-xs space-y-1 text-slate-400">
                                        <li>‚Ä¢ Negative cash flow = <span class="text-green-400 font-bold">MOTIVATED</span> (35% weight)</li>
                                        <li>‚Ä¢ Missing UCL = <span class="text-yellow-400 font-bold">NEED FUNDS</span></li>
                                        <li>‚Ä¢ Debt > Revenue = <span class="text-green-400 font-bold">DISCOUNT</span></li>
                                    </ul>
                                </div>
                                <div class="bg-slate-900/50 rounded-lg p-4 border border-green-500/20">
                                    <div class="text-3xl mb-2">üìä</div>
                                    <h4 class="font-bold mb-2">3. Hierarchy Status</h4>
                                    <p class="text-sm text-slate-300 mb-3">Player's role in current squad</p>
                                    <ul class="text-xs space-y-1 text-slate-400">
                                        <li>‚Ä¢ Bench (<25% mins) = <span class="text-green-400 font-bold">AVAILABLE</span> (25% weight)</li>
                                        <li>‚Ä¢ Rotation (25-75%) = <span class="text-yellow-400 font-bold">MEDIUM</span></li>
                                        <li>‚Ä¢ Starter (>75%) = <span class="text-red-400 font-bold">HARD</span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- INTERACTIVE CALCULATOR -->
                        <div class="bg-slate-800/50 rounded-lg p-6">
                            <h3 class="text-xl font-bold mb-4">Calculate Deal Probability</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Select Player</label>
                                        <select id="feasibilityPlayer" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                            <option value="">Choose player...</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Contract Remaining (months)</label>
                                        <input type="number" id="feasibilityContract" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="e.g., 18" min="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Selling Club Financial Status</label>
                                        <select id="feasibilityFinance" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                            <option value="distressed">Distressed (negative cash flow)</option>
                                            <option value="pressured">Pressured (no UCL)</option>
                                            <option value="stable" selected>Stable</option>
                                            <option value="strong">Strong (UCL club)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Minutes Played (% of season)</label>
                                        <input type="number" id="feasibilityMinutes" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="e.g., 65" min="0" max="100">
                                    </div>
                                    <button onclick="calculateFeasibility()" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 px-6 py-3 rounded-lg font-bold transition">
                                        Calculate Deal Probability
                                    </button>
                                </div>
                                <div id="feasibilityResults" class="hidden">
                                    <div class="bg-slate-900/50 rounded-lg p-6 border-2" id="feasibilityCard">
                                        <div class="text-center mb-6">
                                            <div class="text-sm text-slate-400 mb-2">DEAL PROBABILITY</div>
                                            <div id="feasibilityScore" class="text-6xl font-bold mb-2">0%</div>
                                            <div id="feasibilityLabel" class="text-lg font-semibold"></div>
                                        </div>
                                        <div class="space-y-3">
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="text-slate-400">Contract Factor:</span>
                                                <span id="contractFactor" class="font-bold"></span>
                                            </div>
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="text-slate-400">Financial Factor:</span>
                                                <span id="financialFactor" class="font-bold"></span>
                                            </div>
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="text-slate-400">Hierarchy Factor:</span>
                                                <span id="hierarchyFactor" class="font-bold"></span>
                                            </div>
                                        </div>
                                        <div class="mt-6 p-4 bg-slate-800/50 rounded-lg">
                                            <div class="text-sm font-semibold mb-2">Recommendation:</div>
                                            <p id="feasibilityRecommendation" class="text-sm text-slate-300"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- EXAMPLES -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="text-3xl">‚úÖ</div>
                                <div>
                                    <h4 class="font-bold text-green-400">HIGH Probability Example</h4>
                                    <p class="text-xs text-slate-400">Score: 78% - STRONG TARGET</p>
                                </div>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between"><span class="text-slate-400">Contract:</span><span class="text-green-400 font-bold">8 months left</span></div>
                                <div class="flex justify-between"><span class="text-slate-400">Club:</span><span class="text-green-400 font-bold">Relegated, ‚Ç¨50M debt</span></div>
                                <div class="flex justify-between"><span class="text-slate-400">Role:</span><span class="text-green-400 font-bold">Bench player (15% mins)</span></div>
                                <div class="mt-3 p-3 bg-green-500/20 rounded text-xs">
                                    <strong>Action:</strong> Immediate approach recommended. Club is motivated seller.
                                </div>
                            </div>
                        </div>
                        <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="text-3xl">‚ùå</div>
                                <div>
                                    <h4 class="font-bold text-red-400">LOW Probability Example</h4>
                                    <p class="text-xs text-slate-400">Score: 12% - AVOID</p>
                                </div>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between"><span class="text-slate-400">Contract:</span><span class="text-red-400 font-bold">4 years left</span></div>
                                <div class="flex justify-between"><span class="text-slate-400">Club:</span><span class="text-red-400 font-bold">UCL qualified, ‚Ç¨200M revenue</span></div>
                                <div class="flex justify-between"><span class="text-slate-400">Role:</span><span class="text-red-400 font-bold">Key starter (92% mins)</span></div>
                                <div class="mt-3 p-3 bg-red-500/20 rounded text-xs">
                                    <strong>Action:</strong> Club has no reason to sell. Extremely difficult and expensive.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION 3: WORK PERMIT CALCULATOR -->
                <div id="market-work-permit" class="market-section hidden">
                    <div class="bg-gradient-to-r from-blue-900/30 to-slate-900/30 border border-blue-500/30 rounded-xl p-6">
                        <h2 class="text-2xl font-bold mb-4 text-blue-300">üõÇ GBE Calculator - Post-Brexit Work Permits</h2>
                        <p class="text-slate-300 mb-6">Automated work permit checks for UK Premier League signings (15+ points = GRANTED)</p>
                        
                        <!-- UK SYSTEM EXPLANATION -->
                        <div class="bg-slate-800/50 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-bold mb-4">How the UK Points System Works</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-semibold mb-3 text-cyan-400">International Appearances</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="bg-slate-900/50 rounded p-3">
                                            <div class="flex justify-between mb-1">
                                                <span>75%+ caps (Top 50 FIFA)</span>
                                                <span class="font-bold text-green-400">15 pts</span>
                                            </div>
                                            <div class="text-xs text-slate-400">Automatic approval</div>
                                        </div>
                                        <div class="bg-slate-900/50 rounded p-3">
                                            <div class="flex justify-between mb-1">
                                                <span>50-74% caps</span>
                                                <span class="font-bold text-yellow-400">10 pts</span>
                                            </div>
                                            <div class="text-xs text-slate-400">Strong candidate</div>
                                        </div>
                                        <div class="bg-slate-900/50 rounded p-3">
                                            <div class="flex justify-between mb-1">
                                                <span>30-49% caps</span>
                                                <span class="font-bold text-orange-400">5 pts</span>
                                            </div>
                                            <div class="text-xs text-slate-400">Needs club minutes</div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-3 text-cyan-400">Club Competition Points</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="bg-slate-900/50 rounded p-3">
                                            <div class="flex justify-between mb-1">
                                                <span>Champions League</span>
                                                <span class="font-bold text-purple-400">+4 pts/match</span>
                                            </div>
                                            <div class="text-xs text-slate-400">Per match played</div>
                                        </div>
                                        <div class="bg-slate-900/50 rounded p-3">
                                            <div class="flex justify-between mb-1">
                                                <span>Europa/Conference</span>
                                                <span class="font-bold text-blue-400">+2 pts/match</span>
                                            </div>
                                            <div class="text-xs text-slate-400">Per match played</div>
                                        </div>
                                        <div class="bg-slate-900/50 rounded p-3">
                                            <div class="flex justify-between mb-1">
                                                <span>Top Domestic League</span>
                                                <span class="font-bold text-green-400">0-6 pts</span>
                                            </div>
                                            <div class="text-xs text-slate-400">Based on league tier</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 p-4 bg-green-500/20 rounded-lg border border-green-500/30">
                                <div class="font-bold text-green-400 mb-2">‚úÖ Approval Threshold: 15+ Points</div>
                                <p class="text-sm text-slate-300">Players with 15 or more points automatically qualify for a GBE (Governing Body Endorsement)</p>
                            </div>
                        </div>

                        <!-- INTERACTIVE CALCULATOR -->
                        <div class="bg-slate-800/50 rounded-lg p-6">
                            <h3 class="text-xl font-bold mb-4">Calculate GBE Points</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Player Name</label>
                                        <input type="text" id="gbePlayerName" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="Enter player name">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">National Team (FIFA Ranking)</label>
                                        <select id="gbeFifaRank" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                            <option value="50">Top 50 (e.g., Brazil, Spain, Germany)</option>
                                            <option value="70">51-70 (e.g., Serbia, Ukraine)</option>
                                            <option value="100">71-100</option>
                                            <option value="150">100+</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">International Caps (% in last 2 years)</label>
                                        <input type="number" id="gbeIntCaps" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="e.g., 75" min="0" max="100">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Champions League Matches Played</label>
                                        <input type="number" id="gbeUclMatches" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="e.g., 6" min="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Europa/Conference Matches</label>
                                        <input type="number" id="gbeEuropaMatches" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="e.g., 10" min="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Current League Quality</label>
                                        <select id="gbeLeagueQuality" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                            <option value="6">Tier 1: PL, La Liga, Serie A, Bundesliga, Ligue 1</option>
                                            <option value="4">Tier 2: Eredivisie, Liga NOS, Pro League</option>
                                            <option value="2">Tier 3: Championship, Liga MX</option>
                                            <option value="0">Tier 4: Other leagues</option>
                                        </select>
                                    </div>
                                    <button onclick="calculateGBE()" class="w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 px-6 py-3 rounded-lg font-bold transition">
                                        Calculate GBE Points
                                    </button>
                                </div>
                                <div id="gbeResults" class="hidden">
                                    <div class="bg-slate-900/50 rounded-lg p-6 border-2" id="gbeCard">
                                        <div class="text-center mb-6">
                                            <div id="gbeIcon" class="text-6xl mb-4"></div>
                                            <div class="text-sm text-slate-400 mb-2">TOTAL GBE POINTS</div>
                                            <div id="gbeScore" class="text-6xl font-bold mb-2">0</div>
                                            <div id="gbeStatus" class="text-lg font-semibold"></div>
                                        </div>
                                        <div class="space-y-3 mb-6">
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="text-slate-400">International:</span>
                                                <span id="gbeIntPoints" class="font-bold"></span>
                                            </div>
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="text-slate-400">Champions League:</span>
                                                <span id="gbeUclPoints" class="font-bold"></span>
                                            </div>
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="text-slate-400">Europa/Conference:</span>
                                                <span id="gbeEuropaPoints" class="font-bold"></span>
                                            </div>
                                            <div class="flex items-center justify-between text-sm">
                                                <span class="text-slate-400">League Quality:</span>
                                                <span id="gbeLeaguePoints" class="font-bold"></span>
                                            </div>
                                        </div>
                                        <div class="p-4 bg-slate-800/50 rounded-lg">
                                            <div class="text-sm font-semibold mb-2">Recommendation:</div>
                                            <p id="gbeRecommendation" class="text-sm text-slate-300"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION 4: LEAGUE CONVERSION -->
                <div id="market-league-conversion" class="market-section hidden">
                    <div class="bg-gradient-to-r from-purple-900/30 to-slate-900/30 border border-purple-500/30 rounded-xl p-6">
                        <h2 class="text-2xl font-bold mb-4 text-purple-300">üåç League Conversion Translator</h2>
                        <p class="text-slate-300 mb-6">20 goals in Austrian Bundesliga ‚â† 20 goals in Premier League. Adjust expectations by league difficulty.</p>
                        
                        <!-- CONVERSION TABLE -->
                        <div class="bg-slate-800/50 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-bold mb-4">League Difficulty Coefficients</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead class="bg-slate-900">
                                        <tr>
                                            <th class="px-4 py-3 text-left">League</th>
                                            <th class="px-4 py-3 text-center">Coefficient</th>
                                            <th class="px-4 py-3 text-center">Example Conversion</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-700">
                                        <tr class="hover:bg-slate-700/30">
                                            <td class="px-4 py-3 font-semibold text-blue-400">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Premier League</td>
                                            <td class="px-4 py-3 text-center font-bold">1.00</td>
                                            <td class="px-4 py-3 text-center text-slate-400">Baseline</td>
                                        </tr>
                                        <tr class="hover:bg-slate-700/30">
                                            <td class="px-4 py-3">üá™üá∏ La Liga</td>
                                            <td class="px-4 py-3 text-center font-bold">0.95</td>
                                            <td class="px-4 py-3 text-center">20 goals ‚Üí <span class="text-green-400 font-bold">21 PL goals</span></td>
                                        </tr>
                                        <tr class="hover:bg-slate-700/30">
                                            <td class="px-4 py-3">üá©üá™ Bundesliga</td>
                                            <td class="px-4 py-3 text-center font-bold">0.92</td>
                                            <td class="px-4 py-3 text-center">20 goals ‚Üí <span class="text-green-400 font-bold">18 PL goals</span></td>
                                        </tr>
                                        <tr class="hover:bg-slate-700/30">
                                            <td class="px-4 py-3">üáÆüáπ Serie A</td>
                                            <td class="px-4 py-3 text-center font-bold">0.90</td>
                                            <td class="px-4 py-3 text-center">20 goals ‚Üí <span class="text-green-400 font-bold">18 PL goals</span></td>
                                        </tr>
                                        <tr class="hover:bg-slate-700/30">
                                            <td class="px-4 py-3">üá´üá∑ Ligue 1</td>
                                            <td class="px-4 py-3 text-center font-bold">0.87</td>
                                            <td class="px-4 py-3 text-center">20 goals ‚Üí <span class="text-yellow-400 font-bold">17 PL goals</span></td>
                                        </tr>
                                        <tr class="hover:bg-slate-700/30">
                                            <td class="px-4 py-3">üá≥üá± Eredivisie</td>
                                            <td class="px-4 py-3 text-center font-bold">0.78</td>
                                            <td class="px-4 py-3 text-center">20 goals ‚Üí <span class="text-yellow-400 font-bold">16 PL goals</span></td>
                                        </tr>
                                        <tr class="hover:bg-slate-700/30">
                                            <td class="px-4 py-3">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Championship</td>
                                            <td class="px-4 py-3 text-center font-bold">0.75</td>
                                            <td class="px-4 py-3 text-center">20 goals ‚Üí <span class="text-yellow-400 font-bold">15 PL goals</span></td>
                                        </tr>
                                        <tr class="hover:bg-slate-700/30">
                                            <td class="px-4 py-3">üá¶üáπ Austrian Bundesliga</td>
                                            <td class="px-4 py-3 text-center font-bold">0.65</td>
                                            <td class="px-4 py-3 text-center">20 goals ‚Üí <span class="text-red-400 font-bold">13 PL goals</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- CALCULATOR -->
                        <div class="bg-slate-800/50 rounded-lg p-6">
                            <h3 class="text-xl font-bold mb-4">Calculate Premier League Equivalent</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Current League</label>
                                        <select id="conversionCurrentLeague" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                            <option value="1.00">Premier League</option>
                                            <option value="0.95">La Liga</option>
                                            <option value="0.92">Bundesliga</option>
                                            <option value="0.90">Serie A</option>
                                            <option value="0.87">Ligue 1</option>
                                            <option value="0.78">Eredivisie</option>
                                            <option value="0.75">Championship</option>
                                            <option value="0.65">Austrian Bundesliga</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Stat Type</label>
                                        <select id="conversionStatType" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                            <option value="goals">Goals</option>
                                            <option value="assists">Assists</option>
                                            <option value="g+a">Goals + Assists</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Current Season Performance</label>
                                        <input type="number" id="conversionValue" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="e.g., 20" min="0">
                                    </div>
                                    <button onclick="calculateConversion()" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-6 py-3 rounded-lg font-bold transition">
                                        Calculate PL Equivalent
                                    </button>
                                </div>
                                <div id="conversionResults" class="hidden">
                                    <div class="bg-slate-900/50 rounded-lg p-6 border-2 border-purple-500">
                                        <div class="text-center mb-6">
                                            <div class="text-sm text-slate-400 mb-2">PREMIER LEAGUE EQUIVALENT</div>
                                            <div id="conversionEquivalent" class="text-6xl font-bold text-purple-400 mb-2">0</div>
                                            <div id="conversionStatLabel" class="text-lg text-slate-300"></div>
                                        </div>
                                        <div class="space-y-4">
                                            <div class="bg-slate-800/50 rounded-lg p-4">
                                                <div class="flex justify-between items-center mb-2">
                                                    <span class="text-sm text-slate-400">Current League:</span>
                                                    <span id="conversionCurrentLeagueLabel" class="font-bold"></span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-slate-400">Current Stats:</span>
                                                    <span id="conversionCurrentValue" class="font-bold text-white"></span>
                                                </div>
                                            </div>
                                            <div class="p-4 bg-purple-500/20 rounded-lg border border-purple-500/30">
                                                <div class="text-sm font-semibold mb-2 text-purple-300">Reality Check:</div>
                                                <p id="conversionExplanation" class="text-sm text-slate-300"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION 5: AGENT NETWORK -->
                <div id="market-agent-network" class="market-section hidden">
                    <div class="bg-gradient-to-r from-orange-900/30 to-slate-900/30 border border-orange-500/30 rounded-xl p-6">
                        <h2 class="text-2xl font-bold mb-4 text-orange-300">ü§ù Agent Network Mapping</h2>
                        <p class="text-slate-300 mb-6">If you want Player X, which agent represents him? Who else do they represent? Package deals and relationship leverage.</p>
                        
                        <!-- VISUAL GRAPH REPRESENTATION -->
                        <div class="bg-slate-800/50 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-bold mb-4">How Agent Networks Work</h3>
                            <div class="grid md:grid-cols-3 gap-6">
                                <div class="bg-slate-900/50 rounded-lg p-5 border border-orange-500/20">
                                    <div class="text-3xl mb-3 text-center">üë§</div>
                                    <h4 class="font-bold text-center mb-3">Target Player</h4>
                                    <p class="text-sm text-slate-300 text-center mb-4">The player you want to sign</p>
                                    <div class="bg-blue-500/20 rounded p-3 text-center">
                                        <div class="font-bold text-blue-400">Example:</div>
                                        <div class="text-sm">Player A (CB, age 23)</div>
                                    </div>
                                </div>
                                <div class="bg-slate-900/50 rounded-lg p-5 border border-orange-500/20">
                                    <div class="text-3xl mb-3 text-center">ü§µ</div>
                                    <h4 class="font-bold text-center mb-3">Agent/Agency</h4>
                                    <p class="text-sm text-slate-300 text-center mb-4">Who represents them</p>
                                    <div class="bg-orange-500/20 rounded p-3 text-center">
                                        <div class="font-bold text-orange-400">Example:</div>
                                        <div class="text-sm">Jorge Mendes (GestiFute)</div>
                                        <div class="text-xs text-slate-400 mt-1">Represents 50+ players</div>
                                    </div>
                                </div>
                                <div class="bg-slate-900/50 rounded-lg p-5 border border-orange-500/20">
                                    <div class="text-3xl mb-3 text-center">üë•</div>
                                    <h4 class="font-bold text-center mb-3">Other Clients</h4>
                                    <p class="text-sm text-slate-300 text-center mb-4">Package deal opportunities</p>
                                    <div class="bg-green-500/20 rounded p-3 text-center">
                                        <div class="font-bold text-green-400">Example:</div>
                                        <div class="text-sm">Player B (ST), Player C (GK)</div>
                                        <div class="text-xs text-slate-400 mt-1">Also available</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AGENT DATABASE -->
                        <div class="bg-slate-800/50 rounded-lg p-6 mb-6">
                            <h3 class="text-xl font-bold mb-4">Top Agents in Our Database</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="bg-slate-900/50 rounded-lg p-4 border border-orange-500/20">
                                    <div class="flex items-start justify-between mb-3">
                                        <div>
                                            <h4 class="font-bold">Jorge Mendes</h4>
                                            <p class="text-xs text-slate-400">GestiFute Agency</p>
                                        </div>
                                        <span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded text-xs">VIP</span>
                                    </div>
                                    <div class="text-sm text-slate-300 mb-3">
                                        <div class="flex justify-between"><span>Total Clients:</span><span class="font-bold">50+</span></div>
                                        <div class="flex justify-between"><span>Combined Value:</span><span class="font-bold">‚Ç¨2.5B+</span></div>
                                        <div class="flex justify-between"><span>Notable:</span><span class="text-xs">Ronaldo, F√©lix, Dias</span></div>
                                    </div>
                                    <button class="w-full bg-orange-600 hover:bg-orange-700 px-3 py-2 rounded text-sm font-semibold transition">
                                        View Full Network
                                    </button>
                                </div>

                                <div class="bg-slate-900/50 rounded-lg p-4 border border-orange-500/20">
                                    <div class="flex items-start justify-between mb-3">
                                        <div>
                                            <h4 class="font-bold">Mino Raiola Estate</h4>
                                            <p class="text-xs text-slate-400">Raiola Agency</p>
                                        </div>
                                        <span class="bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs">TOP</span>
                                    </div>
                                    <div class="text-sm text-slate-300 mb-3">
                                        <div class="flex justify-between"><span>Total Clients:</span><span class="font-bold">40+</span></div>
                                        <div class="flex justify-between"><span>Combined Value:</span><span class="font-bold">‚Ç¨1.8B+</span></div>
                                        <div class="flex justify-between"><span>Notable:</span><span class="text-xs">Haaland, De Ligt</span></div>
                                    </div>
                                    <button class="w-full bg-orange-600 hover:bg-orange-700 px-3 py-2 rounded text-sm font-semibold transition">
                                        View Full Network
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- SEARCH FUNCTIONALITY -->
                        <div class="bg-slate-800/50 rounded-lg p-6">
                            <h3 class="text-xl font-bold mb-4">Search Agent Network</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Search Query</label>
                                        <input type="text" id="agentSearch" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="e.g., Show me all RBs in Ligue 1 represented by agencies we've worked with">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Position Filter</label>
                                        <select id="agentPosition" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                            <option value="">All Positions</option>
                                            <option value="GK">Goalkeeper</option>
                                            <option value="CB">Center Back</option>
                                            <option value="FB">Full Back</option>
                                            <option value="CM">Central Midfielder</option>
                                            <option value="WG">Winger</option>
                                            <option value="ST">Striker</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">League Filter</label>
                                        <select id="agentLeague" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                            <option value="">All Leagues</option>
                                            <option value="Premier League">Premier League</option>
                                            <option value="La Liga">La Liga</option>
                                            <option value="Serie A">Serie A</option>
                                            <option value="Bundesliga">Bundesliga</option>
                                            <option value="Ligue 1">Ligue 1</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Relationship Status</label>
                                        <select id="agentRelationship" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                            <option value="all">All Agents</option>
                                            <option value="worked">Agencies We've Worked With</option>
                                            <option value="good">Good Relationship</option>
                                            <option value="new">New Contacts</option>
                                        </select>
                                    </div>
                                    <button onclick="searchAgentNetwork()" class="w-full bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 px-6 py-3 rounded-lg font-bold transition">
                                        Search Network
                                    </button>
                                </div>
                                <div id="agentResults" class="hidden">
                                    <div class="bg-slate-900/50 rounded-lg p-6 border border-orange-500/30">
                                        <h4 class="font-bold mb-4">Search Results</h4>
                                        <div id="agentResultsList" class="space-y-3">
                                            <!-- Results will appear here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION 6: REPLACEMENT ENGINE -->
                <div id="market-replacement" class="market-section hidden">
                    <div class="bg-gradient-to-r from-cyan-900/30 to-slate-900/30 border border-cyan-500/30 rounded-xl p-6">
                        <h2 class="text-2xl font-bold mb-4 text-cyan-300">üîÑ Replacement Engine</h2>
                        <p class="text-slate-300 mb-6">Selling Player X for ‚Ç¨60M? Find 5 similar players at 25% of the cost. Smart squad building.</p>
                        
                        <!-- HOW IT WORKS -->
                        <div class="bg-slate-800/50 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-bold mb-4">How the Replacement Engine Works</h3>
                            <div class="grid md:grid-cols-4 gap-4">
                                <div class="bg-slate-900/50 rounded-lg p-4 text-center">
                                    <div class="text-3xl mb-2">üìä</div>
                                    <h4 class="font-semibold mb-2 text-sm">1. Analyze Player</h4>
                                    <p class="text-xs text-slate-400">Extract all 779 metrics + playing style</p>
                                </div>
                                <div class="bg-slate-900/50 rounded-lg p-4 text-center">
                                    <div class="text-3xl mb-2">üîç</div>
                                    <h4 class="font-semibold mb-2 text-sm">2. Search Database</h4>
                                    <p class="text-xs text-slate-400">Cosine similarity across all players</p>
                                </div>
                                <div class="bg-slate-900/50 rounded-lg p-4 text-center">
                                    <div class="text-3xl mb-2">üí∞</div>
                                    <h4 class="font-semibold mb-2 text-sm">3. Filter by Budget</h4>
                                    <p class="text-xs text-slate-400">Only show affordable alternatives</p>
                                </div>
                                <div class="bg-slate-900/50 rounded-lg p-4 text-center">
                                    <div class="text-3xl mb-2">‚≠ê</div>
                                    <h4 class="font-semibold mb-2 text-sm">4. Rank Results</h4>
                                    <p class="text-xs text-slate-400">95%+ similarity matches</p>
                                </div>
                            </div>
                        </div>

                        <!-- CALCULATOR -->
                        <div class="bg-slate-800/50 rounded-lg p-6">
                            <h3 class="text-xl font-bold mb-4">Find Replacements</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div class="bg-blue-500/20 rounded-lg p-4 border border-blue-500/30 mb-4">
                                        <h4 class="font-bold mb-2 text-blue-300">Scenario: Player Sale</h4>
                                        <p class="text-sm text-slate-300">You're selling a key player. Find affordable replacements with similar attributes.</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Player Being Sold</label>
                                        <select id="replacementPlayer" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                            <option value="">Select player...</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Sale Price (‚Ç¨M)</label>
                                        <input type="number" id="replacementSalePrice" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="e.g., 60" min="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Replacement Budget (% of sale)</label>
                                        <div class="flex gap-2">
                                            <input type="range" id="replacementBudgetSlider" class="flex-1" min="10" max="100" value="25" oninput="updateReplacementBudget()">
                                            <span id="replacementBudgetValue" class="text-white font-bold w-16 text-right">25%</span>
                                        </div>
                                        <div class="text-xs text-slate-400 mt-1">Budget: <span id="replacementBudgetAmount" class="text-white font-bold">‚Ç¨0M</span></div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Max Weekly Wage (‚Ç¨K)</label>
                                        <input type="number" id="replacementMaxWage" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="e.g., 50" min="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Minimum Similarity Score</label>
                                        <select id="replacementSimilarity" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                            <option value="95">95%+ (Very Similar)</option>
                                            <option value="90">90%+ (Similar)</option>
                                            <option value="85">85%+ (Somewhat Similar)</option>
                                        </select>
                                    </div>
                                    <button onclick="findReplacements()" class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 px-6 py-3 rounded-lg font-bold transition">
                                        Find Replacements
                                    </button>
                                </div>
                                <div id="replacementResults" class="hidden">
                                    <div class="bg-slate-900/50 rounded-lg p-6 border border-cyan-500/30">
                                        <h4 class="font-bold mb-4">Replacement Options</h4>
                                        <div id="replacementsList" class="space-y-3">
                                            <!-- Results will appear here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- EXAMPLE CASE STUDY -->
                        <div class="mt-6 bg-green-900/20 border border-green-500/30 rounded-lg p-5">
                            <h4 class="font-bold text-green-400 mb-3">‚úÖ Success Story: Liverpool FC</h4>
                            <div class="grid md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <div class="text-slate-400 mb-1">Player Sold:</div>
                                    <div class="font-bold">Philippe Coutinho</div>
                                    <div class="text-xs text-slate-400">To Barcelona for ‚Ç¨142M</div>
                                </div>
                                <div>
                                    <div class="text-slate-400 mb-1">Replacements:</div>
                                    <div class="font-bold">Salah + Man√© + Firmino</div>
                                    <div class="text-xs text-slate-400">Combined: ~‚Ç¨80M</div>
                                </div>
                                <div>
                                    <div class="text-slate-400 mb-1">Outcome:</div>
                                    <div class="font-bold text-green-400">Champions League Win</div>
                                    <div class="text-xs text-slate-400">Better squad, lower cost</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- COMPETITIVE ADVANTAGE SUMMARY -->
                <div class="mt-8 bg-gradient-to-r from-blue-900/30 to-purple-900/30 border border-blue-500/30 rounded-xl p-8">
                    <h2 class="text-3xl font-bold mb-6 text-center gradient-text">üèÜ Your Competitive Advantage</h2>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-slate-800/50 rounded-lg p-6 text-center">
                            <div class="text-4xl mb-4">‚ö°</div>
                            <h3 class="font-bold mb-3 text-xl">Speed</h3>
                            <p class="text-sm text-slate-300">Get deal probability, work permit status, and league-adjusted expectations in <strong class="text-blue-400">under 60 seconds</strong></p>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg p-6 text-center">
                            <div class="text-4xl mb-4">üéØ</div>
                            <h3 class="font-bold mb-3 text-xl">Accuracy</h3>
                            <p class="text-sm text-slate-300"><strong class="text-green-400">76% prediction accuracy</strong> on transfer success vs. 54% industry failure rate</p>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg p-6 text-center">
                            <div class="text-4xl mb-4">üí∞</div>
                            <h3 class="font-bold mb-3 text-xl">ROI</h3>
                            <p class="text-sm text-slate-300">One prevented ‚Ç¨60M disaster pays for <strong class="text-yellow-400">10 years</strong> of the system</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION 7: MARKET ANALYSIS -->
            <div id="market-analysis" class="market-section hidden">
                <div class="bg-gradient-to-r from-green-900/30 to-slate-900/30 border border-green-500/30 rounded-xl p-6 mb-6">
                    <h2 class="text-2xl font-bold mb-4 text-green-300">üíé Market Analysis - Real-Time Insights</h2>
                    
                    <!-- Undervalued Players -->
                    <div class="mb-8">
                        <h3 class="text-xl font-bold mb-4 text-cyan-400">üìâ Top Undervalued Players</h3>
                        <p class="text-slate-400 mb-4">Players trading below 70% of their peak value</p>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-slate-800">
                                    <tr>
                                        <th class="px-4 py-3 text-left">Player</th>
                                        <th class="px-4 py-3 text-left">Position</th>
                                        <th class="px-4 py-3">Age</th>
                                        <th class="px-4 py-3">Current Value</th>
                                        <th class="px-4 py-3">Peak Value</th>
                                        <th class="px-4 py-3">Discount %</th>
                                    </tr>
                                </thead>
                                <tbody id="undervalued-players">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Rising Stars -->
                    <div class="mb-8">
                        <h3 class="text-xl font-bold mb-4 text-yellow-400">‚≠ê Rising Stars (U23)</h3>
                        <p class="text-slate-400 mb-4">High-value young players with elite potential</p>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-slate-800">
                                    <tr>
                                        <th class="px-4 py-3 text-left">Player</th>
                                        <th class="px-4 py-3 text-left">Position</th>
                                        <th class="px-4 py-3">Age</th>
                                        <th class="px-4 py-3">Value</th>
                                        <th class="px-4 py-3">Goals</th>
                                        <th class="px-4 py-3">Assists</th>
                                    </tr>
                                </thead>
                                <tbody id="rising-stars">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Injury Risks -->
                    <div class="mb-8">
                        <h3 class="text-xl font-bold mb-4 text-red-400">‚ö†Ô∏è Injury Risk Assessment</h3>
                        <p class="text-slate-400 mb-4">Players with significant injury history (90+ days)</p>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-slate-800">
                                    <tr>
                                        <th class="px-4 py-3 text-left">Player</th>
                                        <th class="px-4 py-3 text-left">Position</th>
                                        <th class="px-4 py-3">Age</th>
                                        <th class="px-4 py-3">Days Injured</th>
                                        <th class="px-4 py-3">Games Missed</th>
                                        <th class="px-4 py-3">Value</th>
                                    </tr>
                                </thead>
                                <tbody id="injury-risks">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="philosophy-tab" class="tab-content">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold mb-4 gradient-text">60-Philosophy Framework Heatmap</h1>
                    <p class="text-xl text-slate-300">Explore tactical DNA distribution across legendary coaching philosophies</p>
                </div>

                <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6 mb-8">
                    <h3 class="text-lg font-bold mb-4 text-blue-300">Philosophy Distribution</h3>
                    <div id="philosophy-heatmap">
                        <!-- Heatmap will be rendered here -->
                    </div>
                </div>
            </div>

            <!-- SQUAD BUILDER TAB -->
            <div id="squad-tab" class="tab-content">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold mb-4 gradient-text">Interactive Squad Builder</h1>
                    <p class="text-xl text-slate-300">Build your lineup and analyze tactical chemistry</p>
                </div>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="md:col-span-2">
                        <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6 mb-4">
                            <h3 class="text-lg font-bold mb-4 text-blue-300">Select Formation</h3>
                            <div class="flex flex-wrap gap-2">
                                <div class="formation-selector active" onclick="selectFormation('4-3-3')">4-3-3</div>
                                <div class="formation-selector" onclick="selectFormation('4-4-2')">4-4-2</div>
                                <div class="formation-selector" onclick="selectFormation('3-5-2')">3-5-2</div>
                                <div class="formation-selector" onclick="selectFormation('4-2-3-1')">4-2-3-1</div>
                                <div class="formation-selector" onclick="selectFormation('3-4-3')">3-4-3</div>
                            </div>
                        </div>

                        <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6">
                            <div class="pitch-background" style="height: 600px; position: relative;" id="pitch">
                                <div class="absolute top-4 left-1/2 transform -translate-x-1/2 text-white font-bold text-sm">
                                    OPPONENT
                                </div>
                                <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white font-bold text-sm">
                                    YOUR TEAM
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6 mb-4">
                            <h3 class="text-lg font-bold mb-4 text-blue-300">Squad Statistics</h3>
                            <div class="space-y-3">
                                <div>
                                    <div class="text-sm text-slate-400 mb-1">Average FGA</div>
                                    <div class="text-2xl font-bold text-blue-400" id="squad-avg-fga">--</div>
                                </div>
                                <div>
                                    <div class="text-sm text-slate-400 mb-1">Team Chemistry</div>
                                    <div class="text-2xl font-bold text-green-400" id="squad-chemistry">--</div>
                                </div>
                                <div>
                                    <div class="text-sm text-slate-400 mb-1">Players Selected</div>
                                    <div class="text-2xl font-bold text-yellow-400"><span id="squad-count">0</span>/11</div>
                                </div>
                            </div>
                            <button onclick="clearSquad()" class="mt-4 w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-semibold transition text-sm">
                                Clear Squad
                            </button>
                        </div>

                        <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6">
                            <h3 class="text-lg font-bold mb-4 text-blue-300">Search Players</h3>
                            <input type="text" 
                                   id="squad-search" 
                                   placeholder="Search to add players..." 
                                   class="search-input mb-4"
                                   oninput="searchForSquad(this.value)">
                            <div id="squad-search-results" class="space-y-2 max-h-96 overflow-y-auto">
                                <p class="text-slate-400 text-sm">Search for players to add to your squad</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- VIDEO LIBRARY TAB -->
            <div id="agents-tab" class="tab-content">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold mb-4 gradient-text"><i class="fas fa-binoculars"></i> Empire FGA Scouting Tool</h1>
                    <p class="text-xl text-slate-300">Professional scouting infrastructure: Video Library ‚Ä¢ AI Analysis ‚Ä¢ Data Collection ‚Ä¢ Intelligence Reports</p>
                </div>

                <!-- SCOUTING TOOL NAVIGATION -->
                <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
                    <button onclick="showScoutingTool('video-library', this)" class="scouting-sub-tab active bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition">
                        üé¨ Video Library
                    </button>
                    <button onclick="showScoutingTool('ai-integration', this)" class="scouting-sub-tab bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition">
                        ü§ñ AI Integration
                    </button>
                    <button onclick="showScoutingTool('data-collection', this)" class="scouting-sub-tab bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition">
                        üìã Data Collection
                    </button>
                    <button onclick="showScoutingTool('intelligence-report', this)" class="scouting-sub-tab bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition">
                        üìä Intelligence Report
                    </button>
                </div>

                <!-- TOOL 1: VIDEO LIBRARY -->
                <div id="scouting-video-library" class="scouting-section">
               <!-- EMPIRE SCOUTING NETWORK - VIDEO LIBRARY WIDGET -->
<div id="esn-library-root">

        <div class>
            <img src="https://media.licdn.com/dms/image/v2/D4E12AQEjuDAF0uOTrw/article-cover_image-shrink_720_1280/B4EZiOwG01GwAI-/0/1754741632806?e=2147483647&v=beta&t=L9ct0jEaWdSp7vfTI0urIqPPig0MspEd-6RtzxaQzzQ"
                alt="Empire Scouting Network"width="190" height="100">

    <!-- HEADER / SEARCH SECTION -->
    <div class="esn-header">
        <div class="esn-title-group">
            <h2 class="esn-main-title">VIDEO LIBRARY</h2>
            <p class="esn-subtitle">Global Scouting Database</p>
        </div>
        <div class="esn-search-wrapper">
            <input type="text" id="esn-search" placeholder="Find Country (e.g. Brazil, France)..." onkeyup="filterCountries()">
            <span class="search-icon">üîç</span>
        </div>
    </div>

    <!-- MAIN GRID CONTAINER -->
    <div id="esn-grid-container">
        <!-- Countries injected via JavaScript -->
    </div>

    <!-- POPUP MODAL (VIDEO LIST) -->
    <div id="esn-modal" class="esn-modal">
        <div class="esn-modal-content">
            <div class="esn-modal-header">
                <h3 id="modal-country-name">Country Name</h3>
                <span class="esn-close" onclick="closeModal()">&times;</span>
            </div>
            <div id="modal-leagues-list" class="esn-link-list">
                <!-- Links appear here -->
            </div>
        </div>

            <!-- RATED PLAYERS TAB -->
            <div id="rated-players-tab" class="tab-content">
                <div class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 gradient-text">üë• Empire FGA Rated Players Database</h1>
                    <p class="text-xl text-slate-300"><span id="rated-total-count" class="text-blue-400 font-bold">399</span> Players with REAL FGA Ratings (0-100)</p>
                    <p class="text-sm text-slate-400 mt-2">From Maradona (99.5) to current stars like Duk (77.8)</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                    <div class="bg-gradient-to-br from-yellow-500/20 to-yellow-600/20 border border-yellow-500/30 rounded-xl p-4 text-center">
                        <div class="text-3xl font-bold text-yellow-400" id="rated-stat-legendary">80</div>
                        <div class="text-xs text-slate-300 mt-1">üèÜ LEGENDARY</div>
                        <div class="text-xs text-slate-500">(95-100)</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 rounded-xl p-4 text-center">
                        <div class="text-3xl font-bold text-blue-400" id="rated-stat-elite">107</div>
                        <div class="text-xs text-slate-300 mt-1">‚≠ê ELITE</div>
                        <div class="text-xs text-slate-500">(90-95)</div>
                    </div>
                    <div class="bg-gradient-to-br from-cyan-500/20 to-cyan-600/20 border border-cyan-500/30 rounded-xl p-4 text-center">
                        <div class="text-3xl font-bold text-cyan-400" id="rated-stat-excellent">110</div>
                        <div class="text-xs text-slate-300 mt-1">üíé EXCELLENT</div>
                        <div class="text-xs text-slate-500">(80-90)</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-500/20 to-green-600/20 border border-green-500/30 rounded-xl p-4 text-center">
                        <div class="text-3xl font-bold text-green-400" id="rated-stat-verygood">81</div>
                        <div class="text-xs text-slate-300 mt-1">‚ö° VERY GOOD</div>
                        <div class="text-xs text-slate-500">(70-80)</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/20 border border-purple-500/30 rounded-xl p-4 text-center">
                        <div class="text-3xl font-bold text-purple-400" id="rated-stat-good">19</div>
                        <div class="text-xs text-slate-300 mt-1">‚úÖ GOOD</div>
                        <div class="text-xs text-slate-500">(60-70)</div>
                    </div>
                </div>

                <!-- Search Interface -->
                <div class="bg-slate-900/50 border border-blue-500/30 rounded-xl p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-300 mb-2">‚öΩ POSITION</label>
                            <select id="rated-position" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                                <option value="">All Positions</option>
                                <option value="ST">ST - Strikers</option>
                                <option value="AM">AM - Attacking Mid</option>
                                <option value="CM">CM - Central Mid</option>
                                <option value="WG">WG - Wingers</option>
                                <option value="CB">CB - Center Backs</option>
                                <option value="FB">FB - Fullbacks</option>
                                <option value="DM">DM - Defensive Mid</option>
                                <option value="GK">GK - Goalkeepers</option>
                                <option value="FW">FW - Forwards</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-300 mb-2">üèÜ FGA TIER</label>
                            <select id="rated-tier" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                                <option value="">All Tiers</option>
                                <option value="legendary">üèÜ Legendary (95-100)</option>
                                <option value="elite">‚≠ê Elite (90-95)</option>
                                <option value="excellent">üíé Excellent (80-90)</option>
                                <option value="verygood">‚ö° Very Good (70-80)</option>
                                <option value="good">‚úÖ Good (60-70)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-300 mb-2">‚≠ê MIN FGA</label>
                            <input type="number" id="rated-fga-min" value="0" min="0" max="100" step="0.1"
                                   class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-300 mb-2">üîç PLAYER NAME</label>
                            <input type="text" id="rated-search-name" placeholder="Search..."
                                   class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                        </div>
                        <div class="flex items-end">
                            <button onclick="searchRatedPlayers()" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 rounded font-bold text-white transition">
                                üîç SEARCH
                            </button>
                        </div>
                    </div>

                    <!-- Quick Filters -->
                    <div class="flex flex-wrap gap-2">
                        <button onclick="quickFilterRated('legends')" class="px-3 py-1 bg-yellow-600/20 hover:bg-yellow-600/40 border border-yellow-500/30 rounded text-xs transition">
                            üèÜ All Legends (95+)
                        </button>
                        <button onclick="quickFilterRated('strikers')" class="px-3 py-1 bg-blue-600/20 hover:bg-blue-600/40 border border-blue-500/30 rounded text-xs transition">
                            ‚öΩ Top Strikers (90+)
                        </button>
                        <button onclick="quickFilterRated('argentines')" class="px-3 py-1 bg-blue-600/20 hover:bg-blue-600/40 border border-blue-500/30 rounded text-xs transition">
                            üá¶üá∑ Argentine Legends
                        </button>
                    </div>
                </div>

                <!-- Results Count -->
                <div id="rated-results-count" class="text-center mb-4 p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg">
                    <span class="text-3xl font-bold text-blue-400">399</span>
                    <span class="text-slate-300 ml-2">players match your criteria</span>
                </div>

                <!-- Results Table -->
                <div class="overflow-x-auto bg-slate-900/50 rounded-xl border border-blue-500/20">
                    <table class="w-full border-collapse">
                        <thead class="bg-slate-800">
                            <tr>
                                <th class="px-4 py-3 text-left text-blue-300 font-bold">#</th>
                                <th class="px-4 py-3 text-left text-blue-300 font-bold">Player</th>
                                <th class="px-4 py-3 text-center text-blue-300 font-bold">Age</th>
                                <th class="px-4 py-3 text-center text-blue-300 font-bold">Pos</th>
                                <th class="px-4 py-3 text-center text-blue-300 font-bold">Nation</th>
                                <th class="px-4 py-3 text-center text-green-300 font-bold">FGA Rating</th>
                                <th class="px-4 py-3 text-left text-purple-300 font-bold">Philosophy</th>
                                <th class="px-4 py-3 text-center text-blue-300 font-bold">Profile</th>
                            </tr>
                        </thead>
                        <tbody id="rated-results-body" class="text-slate-300">
                            <tr>
                                <td colspan="8" class="px-4 py-12 text-center text-slate-400">
                                    Loading rated players...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <script>
                    // Embedded 399 rated players data
                    let ratedPlayersData = [{"name": "Diego Maradona", "profile_html": "Diego_Maradona.html", "position": "AM", "age": 64, "nationality": "Argentina", "fga_rating": 99.5, "best_philosophy": "Menotti Artistry"}, {"name": "Pel√É¬©", "profile_html": "Pele.html", "position": "ST", "age": 84, "nationality": "Brazil", "fga_rating": 99.5, "best_philosophy": "Santana JogoBonito"}, {"name": "Johan Cruyff", "profile_html": "Johan_Cruyff.html", "position": "ST", "age": 78, "nationality": "Netherlands", "fga_rating": 99.5, "best_philosophy": "Cruyff Intelligence"}, {"name": "Lionel Messi", "profile_html": "Lionel_Messi.html", "position": "AM", "age": 38, "nationality": "Argentina", "fga_rating": 99.0, "best_philosophy": "Guardiola Positional"}, {"name": "Gianluigi Buffon", "profile_html": "Gianluigi_Buffon.html", "position": "GK", "age": 47, "nationality": "Italy", "fga_rating": 99.0, "best_philosophy": "Buffon Presence"}, {"name": "Zico", "profile_html": "Zico.html", "position": "CM", "age": 72, "nationality": "Brazil", "fga_rating": 99.0, "best_philosophy": "Platini Elegance"}, {"name": "Cristiano Ronaldo", "profile_html": "Cristiano_Ronaldo.html", "position": "ST", "age": 40, "nationality": "Portugal", "fga_rating": 98.5, "best_philosophy": "Ferguson Mental"}, {"name": "Alfredo Di St√É¬©fano", "profile_html": "Alfredo_Di_Stefano.html", "position": "ST", "age": 99, "nationality": "Argentina", "fga_rating": 98.5, "best_philosophy": "Santana JogoBonito"}, {"name": "Ferenc Pusk√É¬°s", "profile_html": "Ferenc_Puskas.html", "position": "ST", "age": 98, "nationality": "Hungary", "fga_rating": 98.5, "best_philosophy": "Sebes Revolutionary"}, {"name": "Eusebio", "profile_html": "Eusebio.html", "position": "ST", "age": 83, "nationality": "Portugal", "fga_rating": 98.5, "best_philosophy": "Fontaine Attack"}, {"name": "Bobby Moore", "profile_html": "Bobby_Moore.html", "position": "CB", "age": 84, "nationality": "England", "fga_rating": 98.5, "best_philosophy": "Cruyff Intelligence"}, {"name": "Frank Lampard", "profile_html": "Frank_Lampard.html", "position": "CM", "age": 47, "nationality": "England", "fga_rating": 98.5, "best_philosophy": "Ferguson Mental"}, {"name": "Peter Schmeichel", "profile_html": "Peter_Schmeichel.html", "position": "GK", "age": 62, "nationality": "Denmark", "fga_rating": 98.5, "best_philosophy": "Yashin Revolution"}, {"name": "Gheorghe Hagi", "profile_html": "Gheorghe_Hagi.html", "position": "AM", "age": 60, "nationality": "Romania", "fga_rating": 98.5, "best_philosophy": "Menotti Artistry"}, {"name": "Raymond Kopa", "profile_html": "Raymond_Kopa.html", "position": "AM", "age": 94, "nationality": "France", "fga_rating": 98.5, "best_philosophy": "Platini Elegance"}, {"name": "Dennis Bergkamp", "profile_html": "Dennis_Bergkamp.html", "position": "ST", "age": 56, "nationality": "Netherlands", "fga_rating": 98.5, "best_philosophy": "Cruyff Intelligence"}, {"name": "Alessandro Del Piero", "profile_html": "Alessandro_Del_Piero.html", "position": "ST", "age": 51, "nationality": "Italy", "fga_rating": 98.5, "best_philosophy": "Platini Elegance"}, {"name": "Kenny Dalglish", "profile_html": "Kenny_Dalglish.html", "position": "ST", "age": 74, "nationality": "Scotland", "fga_rating": 98.5, "best_philosophy": "Philosophy_01_Cruyff_Intelligence"}, {"name": "Lothar Matth√É¬§us", "profile_html": "Lothar_Matthaus.html", "position": "CM", "age": 64, "nationality": "Germany", "fga_rating": 98.5, "best_philosophy": "Lampard/Gerrard Box-to-Box"}, {"name": "Ruud Gullit", "profile_html": "Ruud_Gullit.html", "position": "ST", "age": 63, "nationality": "Netherlands", "fga_rating": 98.5, "best_philosophy": "Philosophy_02_Michels_Total"}, {"name": "Zinedine Zidane", "profile_html": "Zinedine_Zidane.html", "position": "AM", "age": 53, "nationality": "France", "fga_rating": 98.0, "best_philosophy": "Platini Elegance"}, {"name": "Franz Beckenbauer", "profile_html": "Franz_Beckenbauer.html", "position": "CB", "age": 80, "nationality": "Germany", "fga_rating": 98.0, "best_philosophy": "Cruyff Intelligence"}, {"name": "Ronaldo Naz√É¬°rio", "profile_html": "Ronaldo_Nazario.html", "position": "ST", "age": 49, "nationality": "Brazil", "fga_rating": 98.0, "best_philosophy": "Santana JogoBonito"}, {"name": "Garrincha", "profile_html": "Garrincha.html", "position": "WG", "age": 92, "nationality": "Brazil", "fga_rating": 98.0, "best_philosophy": "Menotti Artistry"}, {"name": "Lev Yashin", "profile_html": "Lev_Yashin.html", "position": "GK", "age": 96, "nationality": "Soviet Union", "fga_rating": 98.0, "best_philosophy": "Yashin Revolution"}, {"name": "Ronald Koeman", "profile_html": "Ronald_Koeman.html", "position": "CB", "age": 62, "nationality": "Netherlands", "fga_rating": 98.0, "best_philosophy": "Cruyff Intelligence"}, {"name": "Johan Neeskens", "profile_html": "Johan_Neeskens.html", "position": "CM", "age": 74, "nationality": "Netherlands", "fga_rating": 98.0, "best_philosophy": "Philosophy_02_Michels_Total"}, {"name": "Karl-Heinz Rummenigge", "profile_html": "KarlHeinz_Rumenigge.html", "position": "ST", "age": 70, "nationality": "West Germany", "fga_rating": 98.0, "best_philosophy": "Ronaldo (R9) Power"}, {"name": "N√É¬≠lton Santos", "profile_html": "Nilton_Santos.html", "position": "FB", "age": 100, "nationality": "Brazil", "fga_rating": 98.0, "best_philosophy": "Maldini Defense"}, {"name": "Ra√É¬∫l Gonz√É¬°lez", "profile_html": "Raul_Gonzalez.html", "position": "ST", "age": 48, "nationality": "Spain", "fga_rating": 98.0, "best_philosophy": "Inzaghi Poacher"}, {"name": "Sir Stanley Matthews", "profile_html": "Stanley_Matthews.html", "position": "WG", "age": 110, "nationality": "England", "fga_rating": 98.0, "best_philosophy": "Menotti Artistry"}, {"name": "Ronaldinho Ga√É¬∫cho", "profile_html": "JRonaldinho.html", "position": "AM", "age": 45, "nationality": "Brazil", "fga_rating": 97.5, "best_philosophy": "Menotti Artistry"}, {"name": "Gerd M√É¬ºller", "profile_html": "Gerd_Muller.html", "position": "ST", "age": 80, "nationality": "West Germany", "fga_rating": 97.5, "best_philosophy": "Gerd M√É¬ºller Finisher"}, {"name": "Paolo Maldini", "profile_html": "Paolo_Maldini.html", "position": "FB", "age": 57, "nationality": "Italy", "fga_rating": 97.5, "best_philosophy": "Sacchi Pressing"}, {"name": "Jude Bellingham", "profile_html": "Jude_Bellingham.html", "position": "CM", "age": 22, "nationality": "England", "fga_rating": 97.5, "best_philosophy": "Ferguson Mental"}, {"name": "Michel Platini", "profile_html": "Michel_Platini.html", "position": "AM", "age": 70, "nationality": "France", "fga_rating": 97.0, "best_philosophy": "Platini Elegance"}, {"name": "Marco van Basten", "profile_html": "Marco_van_Basten.html", "position": "ST", "age": 61, "nationality": "Netherlands", "fga_rating": 97.0, "best_philosophy": "Michels Total"}, {"name": "Franco Baresi", "profile_html": "Franco_Baresi.html", "position": "CB", "age": 65, "nationality": "Italy", "fga_rating": 97.0, "best_philosophy": "Sacchi Pressing"}, {"name": "Rivaldo", "profile_html": "Rivaldo.html", "position": "AM", "age": 53, "nationality": "Brazil", "fga_rating": 97.0, "best_philosophy": "Santana JogoBonito"}, {"name": "Paolo Rossi", "profile_html": "Paolo_Rossi.html", "position": "ST", "age": 69, "nationality": "Italy", "fga_rating": 97.0, "best_philosophy": "Inzaghi Poacher"}, {"name": "Erling Haaland", "profile_html": "Erling_Haaland.html", "position": "ST", "age": 25, "nationality": "Norway", "fga_rating": 97.0, "best_philosophy": "Fontaine Attack"}, {"name": "Xavi Hern√É¬°ndez", "profile_html": "Xavi_Hernandez.html", "position": "CM", "age": 45, "nationality": "Spain", "fga_rating": 96.5, "best_philosophy": "Guardiola Positional"}, {"name": "Rom√É¬°rio", "profile_html": "Romario.html", "position": "ST", "age": 59, "nationality": "Brazil", "fga_rating": 96.5, "best_philosophy": "Santana JogoBonito"}, {"name": "Andr√É¬©s Iniesta", "profile_html": "Andres_Iniesta.html", "position": "CM", "age": 41, "nationality": "Spain", "fga_rating": 96.0, "best_philosophy": "Guardiola Positional"}, {"name": "Carlos Alberto", "profile_html": "Carlos_Alberto.html", "position": "FB", "age": 81, "nationality": "Brazil", "fga_rating": 96.0, "best_philosophy": "Michels Total"}, {"name": "George Best", "profile_html": "George_Best.html", "position": "ST", "age": 79, "nationality": "Northern Ireland", "fga_rating": 96.0, "best_philosophy": "Menotti Artistry"}, {"name": "H√É¬©ctor Scarone", "profile_html": "Hector_Scarone.html", "position": "ST", "age": 76, "nationality": "Uruguay", "fga_rating": 96.0, "best_philosophy": "Menotti Artistry"}, {"name": "Tom√É¬°s Carlovich", "profile_html": "Tomas_Carlovich.html", "position": "AM", "age": 75, "nationality": "Argentina", "fga_rating": 96.0, "best_philosophy": "Riquelme-ism (Artist)"}, {"name": "Josef Bican", "profile_html": "Josef_Bican.html", "position": "ST", "age": 88, "nationality": "Austria/Czech", "fga_rating": 96.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Giuseppe Meazza", "profile_html": "Giuseppe_Meazza.html", "position": "ST", "age": 69, "nationality": "Italy", "fga_rating": 96.0, "best_philosophy": "Ferguson Mental"}, {"name": "Thierry Henry", "profile_html": "Thierry_Henry.html", "position": "ST", "age": 48, "nationality": "France", "fga_rating": 95.5, "best_philosophy": "Wenger Development"}, {"name": "Roberto Baggio", "profile_html": "Roberto_Baggio.html", "position": "ST", "age": 58, "nationality": "Italy", "fga_rating": 95.5, "best_philosophy": "Platini Elegance"}, {"name": "Luka Modri√Ñ‚Ä°", "profile_html": "Luka_Modric.html", "position": "CM", "age": 40, "nationality": "Croatia", "fga_rating": 95.5, "best_philosophy": "Guardiola Positional"}, {"name": "Adolfo Pedernera", "profile_html": "Adolfo_Pedernera.html", "position": "ST", "age": 77, "nationality": "Argentina", "fga_rating": 95.5, "best_philosophy": "Michels Total Football"}, {"name": "Did√É¬≠ (Waldyr Pereira)", "profile_html": "Didi.html", "position": "CM", "age": 73, "nationality": "Brazil", "fga_rating": 95.5, "best_philosophy": "Guardiola Positional"}, {"name": "Jos√É¬© Manuel Moreno", "profile_html": "Jose_Manuel_Moreno.html", "position": "ST", "age": 62, "nationality": "Argentina", "fga_rating": 95.5, "best_philosophy": "Michels Total Football"}, {"name": "Daniel Passarella", "profile_html": "Daniel_Passarella.html", "position": "CB", "age": 72, "nationality": "Argentina", "fga_rating": 95.5, "best_philosophy": "Simeone Cholismo"}, {"name": "Sergio Busquets", "profile_html": "Sergio_Busquets.html", "position": "DM", "age": 37, "nationality": "Spain", "fga_rating": 95.5, "best_philosophy": "Guardiola Positional"}, {"name": "Fritz Walter", "profile_html": "Fritz_Walter.html", "position": "ST", "age": 82, "nationality": "West Germany", "fga_rating": 95.5, "best_philosophy": "Ferguson Mental"}, {"name": "Ladislao Kubala", "profile_html": "Ladislao_Kubala.html", "position": "ST", "age": 75, "nationality": "Hungary/Czech/Spain", "fga_rating": 95.5, "best_philosophy": "Cruyff Intelligence"}, {"name": "Michael Laudrup", "profile_html": "Michael_Laudrup.html", "position": "AM", "age": 61, "nationality": "Denmark", "fga_rating": 95.5, "best_philosophy": "Guardiola Positional"}, {"name": "S√É¬°ndor Kocsis", "profile_html": "Sandor_Kocsis.html", "position": "ST", "age": 50, "nationality": "Hungary", "fga_rating": 95.5, "best_philosophy": "Ferguson Mental"}, {"name": "Zlatan Ibrahimovi√Ñ‚Ä°", "profile_html": "Zlatan_Ibrahimovic.html", "position": "ST", "age": 44, "nationality": "Sweden", "fga_rating": 95.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Kak√É¬°", "profile_html": "Kaka.html", "position": "AM", "age": 43, "nationality": "Brazil", "fga_rating": 95.0, "best_philosophy": "Ancelotti Balance"}, {"name": "Mario Kempes", "profile_html": "Mario_Kempes.html", "position": "ST", "age": 71, "nationality": "Argentina", "fga_rating": 95.0, "best_philosophy": "Menotti Artistry"}, {"name": "Denis Law", "profile_html": "Denis_Law.html", "position": "ST", "age": 85, "nationality": "Scotland", "fga_rating": 95.0, "best_philosophy": "Fontaine Attack"}, {"name": "Arthur Friedenreich", "profile_html": "Arthur_Friedenreich.html", "position": "ST", "age": 77, "nationality": "Brazil", "fga_rating": 95.0, "best_philosophy": "Santana JogoBonito"}, {"name": "Juan Alberto Schiaffino", "profile_html": "Juan_Schiaffino.html", "position": "ST", "age": 77, "nationality": "Uruguay", "fga_rating": 95.0, "best_philosophy": "Cruyff Intelligence"}, {"name": "Le√É¬¥nidas da Silva", "profile_html": "Leonidas.html", "position": "ST", "age": 91, "nationality": "Brazil", "fga_rating": 95.0, "best_philosophy": "Santana JogoBonito"}, {"name": "Zizinho", "profile_html": "Zizinho.html", "position": "AM", "age": 81, "nationality": "Brazil", "fga_rating": 95.0, "best_philosophy": "Michels Total Football"}, {"name": "Pedro Virgilio Rocha", "profile_html": "Pedro_Virgilio_Rocha.html", "position": "ST", "age": 71, "nationality": "Uruguay", "fga_rating": 95.0, "best_philosophy": "Menotti Artistry"}, {"name": "Ademir Marques Menezes", "profile_html": "Ademir_Marques.html", "position": "ST", "age": 74, "nationality": "Brazil", "fga_rating": 95.0, "best_philosophy": "Mourinho Tactical"}, {"name": "√É¬Ångel Labruna", "profile_html": "Angel_Labruna.html", "position": "ST", "age": 65, "nationality": "Argentina", "fga_rating": 95.0, "best_philosophy": "Cruyff Intelligence"}, {"name": "Paulo Roberto Falc√É¬£o", "profile_html": "Paulo_Falcao.html", "position": "CM", "age": 72, "nationality": "Brazil", "fga_rating": 95.0, "best_philosophy": "Guardiola Positional"}, {"name": "Domingos da Guia", "profile_html": "Domingos_Da_Guia.html", "position": "CB", "age": 88, "nationality": "Brazil", "fga_rating": 95.0, "best_philosophy": "Beckenbauer Libero"}, {"name": "Giacinto Facchetti", "profile_html": "Giacinto_Facchetti.html", "position": "FB", "age": 64, "nationality": "Italy", "fga_rating": 95.0, "best_philosophy": "Herrera Catenaccio"}, {"name": "Gianni Rivera", "profile_html": "Gianni_Rivera.html", "position": "AM", "age": 82, "nationality": "Italy", "fga_rating": 95.0, "best_philosophy": "Riquelme-ism (Artist)"}, {"name": "Matthias Sindelar", "profile_html": "Mathias_Sindelar.html", "position": "ST", "age": 36, "nationality": "Austria", "fga_rating": 95.0, "best_philosophy": "Guardiola Positional"}, {"name": "Silvio Piola", "profile_html": "Silvio_Piola.html", "position": "ST", "age": 83, "nationality": "Italy", "fga_rating": 95.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Uwe Seeler", "profile_html": "Uwe_Seeler.html", "position": "ST", "age": 86, "nationality": "West Germany", "fga_rating": 95.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Neymar Jr.", "profile_html": "Neymar_Jr.html", "position": "WG", "age": 33, "nationality": "Brazil", "fga_rating": 94.5, "best_philosophy": "Guardiola Positional"}, {"name": "George Weah", "profile_html": "George_Weah.html", "position": "ST", "age": 59, "nationality": "Liberia", "fga_rating": 94.5, "best_philosophy": "Sacchi Pressing"}, {"name": "Roberto Carlos", "profile_html": "Roberto_Carlos.html", "position": "FB", "age": 52, "nationality": "Brazil", "fga_rating": 94.5, "best_philosophy": "Zidane Elegance"}, {"name": "Lu√É¬≠sito Su√É¬°rez", "profile_html": "Luis_Suarez_Miramontes.html", "position": "CM", "age": 90, "nationality": "Spain", "fga_rating": 94.5, "best_philosophy": "Platini Elegance"}, {"name": "Sergio Ramos", "profile_html": "Sergio_Ramos.html", "position": "CB", "age": 39, "nationality": "Spain", "fga_rating": 94.5, "best_philosophy": "Ferguson Mental"}, {"name": "El√É¬≠as Figueroa", "profile_html": "Elias_Figueroa.html", "position": "CB", "age": 79, "nationality": "Chile", "fga_rating": 94.5, "best_philosophy": "Beckenbauer Libero"}, {"name": "El√É¬≠as Figueroa", "profile_html": "Elias_Figueroa.html", "position": "CB", "age": 79, "nationality": "Chile", "fga_rating": 94.5, "best_philosophy": "Beckenbauer Libero"}, {"name": "Alberto Spencer", "profile_html": "Alberto_Spencer.html", "position": "ST", "age": 69, "nationality": "Ecuador", "fga_rating": 94.5, "best_philosophy": "Ferguson Mental"}, {"name": "Omar S√É¬≠vori", "profile_html": "Omar_Sivori.html", "position": "ST", "age": 70, "nationality": "Argentina/Italy", "fga_rating": 94.5, "best_philosophy": "Menotti Artistry"}, {"name": "Tost√É¬£o", "profile_html": "Tost√É¬£o.html", "position": "ST", "age": 78, "nationality": "Brazil", "fga_rating": 94.5, "best_philosophy": "Guardiola Positional"}, {"name": "Pedro Cea", "profile_html": "Pedro_Cea.html", "position": "ST", "age": 70, "nationality": "Uruguay", "fga_rating": 94.5, "best_philosophy": "Ferguson Mental"}, {"name": "Kevin Keegan", "profile_html": "Kevin_Keegan.html", "position": "ST", "age": 74, "nationality": "England", "fga_rating": 94.5, "best_philosophy": "Klopp Intensity"}, {"name": "Oleg Blokhin", "profile_html": "Oleg_Blokhin.html", "position": "ST", "age": 73, "nationality": "Soviet Union/Ukraine", "fga_rating": 94.5, "best_philosophy": "Mourinho Tactical"}, {"name": "Wayne Rooney", "profile_html": "Wayne_Rooney.html", "position": "ST", "age": 40, "nationality": "England", "fga_rating": 94.5, "best_philosophy": "Ferguson Mental"}, {"name": "Samuel Eto'o", "profile_html": "Samuel_Etoo.html", "position": "ST", "age": 44, "nationality": "Cameroon", "fga_rating": 94.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Cafu", "profile_html": "Cafu.html", "position": "FB", "age": 55, "nationality": "Brazil", "fga_rating": 94.0, "best_philosophy": "Michels Total"}, {"name": "Jimmy Greaves", "profile_html": "Jimmy_Greaves.html", "position": "ST", "age": 85, "nationality": "England", "fga_rating": 94.0, "best_philosophy": "Fontaine Attack"}, {"name": "Jos√É¬© Nasazzi", "profile_html": "Jose_Nasazzi.html", "position": "CB", "age": 124, "nationality": "Uruguay", "fga_rating": 94.0, "best_philosophy": "Herrera Defensive"}, {"name": "Arsenio Erico", "profile_html": "Arsenio_Erico.html", "position": "ST", "age": 110, "nationality": "Paraguay", "fga_rating": 94.0, "best_philosophy": "Haaland Power"}, {"name": "Obdulio Varela", "profile_html": "Obdulio_Varela.html", "position": "CM", "age": 79, "nationality": "Uruguay", "fga_rating": 94.0, "best_philosophy": "Simeone Cholismo"}, {"name": "H√É¬©ctor Chumpitaz", "profile_html": "Hector_Chumpitaz.html", "position": "CB", "age": 82, "nationality": "Peru", "fga_rating": 94.0, "best_philosophy": "Beckenbauer Libero"}, {"name": "Raimundo Orsi", "profile_html": "Raimundo_Orsi.html", "position": "WG", "age": 85, "nationality": "Argentina/Italy", "fga_rating": 94.0, "best_philosophy": "Menotti Artistry"}, {"name": "Josef Masopust", "profile_html": "Josef_Masopust.html", "position": "AM", "age": 84, "nationality": "Czechoslovakia", "fga_rating": 94.0, "best_philosophy": "Cruyff Intelligence"}, {"name": "Sandro Mazzola", "profile_html": "Sandro_Mazzola.html", "position": "ST", "age": 83, "nationality": "Italy", "fga_rating": 94.0, "best_philosophy": "Herrera Catenaccio"}, {"name": "Gabriel Batistuta", "profile_html": "Gabriel_Batistuta.html", "position": "ST", "age": 56, "nationality": "Argentina", "fga_rating": 93.8, "best_philosophy": "Ferguson Mental"}, {"name": "Didier Drogba", "profile_html": "Didier_Drogba.html", "position": "ST", "age": 47, "nationality": "Ivory Coast", "fga_rating": 93.5, "best_philosophy": "Mourinho Tactical"}, {"name": "Dino Zoff", "profile_html": "Dino_Zoff.html", "position": "GK", "age": 82, "nationality": "Italy", "fga_rating": 93.5, "best_philosophy": "Yashin Revolution"}, {"name": "Hugo S√É¬°nchez", "profile_html": "Hugo_Sanchez.html", "position": "ST", "age": 67, "nationality": "Mexico", "fga_rating": 93.5, "best_philosophy": "Fontaine Attack"}, {"name": "Toni Kroos", "profile_html": "Toni_Kroos.html", "position": "Central Midfielder", "age": 35, "nationality": "Germany", "fga_rating": 93.5, "best_philosophy": "Guardiola Positional"}, {"name": "Ademir da Guia", "profile_html": "Ademir_Da_Guia.html", "position": "AM", "age": 83, "nationality": "Brazil", "fga_rating": 93.5, "best_philosophy": "Riquelme-ism (Artist)"}, {"name": "Yaya Tour√É¬©", "profile_html": "Yaya_Toure.html", "position": "CM", "age": 42, "nationality": "Ivory Coast", "fga_rating": 93.0, "best_philosophy": "Guardiola Positional"}, {"name": "S√É¬≥crates", "profile_html": "Socrates.html", "position": "AM", "age": 71, "nationality": "Brazil", "fga_rating": 93.0, "best_philosophy": "Platini Elegance"}, {"name": "Manuel Neuer", "profile_html": "Manuel_Neuer.html", "position": "GK", "age": 39, "nationality": "Germany", "fga_rating": 93.0, "best_philosophy": "Yashin Revolution"}, {"name": "Jamal Musiala", "profile_html": "Jamal_Musiala.html", "position": "AM", "age": 22, "nationality": "Germany", "fga_rating": 93.0, "best_philosophy": "Menotti Artistry"}, {"name": "Arjen Robben", "profile_html": "Arjen_Robben.html", "position": "WG", "age": 41, "nationality": "Netherlands", "fga_rating": 93.0, "best_philosophy": "Guardiola Positional"}, {"name": "Clarence Seedorf", "profile_html": "Clarence_Seedorf.html", "position": "CM", "age": 49, "nationality": "Netherlands", "fga_rating": 93.0, "best_philosophy": "Ancelotti Adaptation"}, {"name": "Arjen Robben", "profile_html": "Arjen_Robben.html", "position": "WG", "age": 41, "nationality": "Netherlands", "fga_rating": 93.0, "best_philosophy": "Guardiola Positional"}, {"name": "Clarence Seedorf", "profile_html": "Clarence_Seedorf.html", "position": "CM", "age": 49, "nationality": "Netherlands", "fga_rating": 93.0, "best_philosophy": "Ancelotti Adaptation"}, {"name": "Roberto Rivellino", "profile_html": "Roberto_Rivellino.html", "position": "AM", "age": 79, "nationality": "Brazil", "fga_rating": 93.0, "best_philosophy": "Santana JogoBonito"}, {"name": "Leonel S√É¬°nchez", "profile_html": "Leonel_Sanchez.html", "position": "WG", "age": 86, "nationality": "Chile", "fga_rating": 93.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Luiz Pereira", "profile_html": "Luis_Pereira.html", "position": "CB", "age": 76, "nationality": "Brazil", "fga_rating": 93.0, "best_philosophy": "Beckenbauer Libero"}, {"name": "Marcelo Salas", "profile_html": "Marcelo_Salas.html", "position": "ST", "age": 51, "nationality": "Chile", "fga_rating": 93.0, "best_philosophy": "Ferguson Mental"}, {"name": "Carlos Bilardo", "profile_html": "Carlos_Bilardo.html", "position": "CM", "age": 86, "nationality": "Argentina", "fga_rating": 92.5, "best_philosophy": "Bilardo Pragmatism"}, {"name": "Frank Rijkaard", "profile_html": "Frank_Rijkaard.html", "position": "DM", "age": 63, "nationality": "Netherlands", "fga_rating": 92.5, "best_philosophy": "Michels Total"}, {"name": "Paolo Futre", "profile_html": "Paolo_Futre.html", "position": "WG", "age": 59, "nationality": "Portugal", "fga_rating": 92.5, "best_philosophy": "Menotti Artistry"}, {"name": "Edgar Davids", "profile_html": "Edgar_Davids.html", "position": "CM", "age": 52, "nationality": "Netherlands", "fga_rating": 92.5, "best_philosophy": "Simeone Cholismo"}, {"name": "Juan Rom√É¬°n Riquelme", "profile_html": "Juan_Roman_Riquelme.html", "position": "Attacking Midfielder", "age": 47, "nationality": "Argentina", "fga_rating": 92.5, "best_philosophy": "Menotti Artistry"}, {"name": "Henrik Larsson", "profile_html": "Henrik_Larsson.html", "position": "ST", "age": 54, "nationality": "Sweden", "fga_rating": 92.5, "best_philosophy": "Ferguson Mental"}, {"name": "Henrik Larsson", "profile_html": "Henrik_Larsson.html", "position": "ST", "age": 54, "nationality": "Sweden", "fga_rating": 92.5, "best_philosophy": "Ferguson Mental"}, {"name": "Hugo de Le√É¬≥n", "profile_html": "Hugo_De_Leon.html", "position": "CB", "age": 67, "nationality": "Uruguay", "fga_rating": 92.5, "best_philosophy": "Simeone Cholismo"}, {"name": "Alisson Becker", "profile_html": "Alisson_Becker.html", "position": "GK", "age": 33, "nationality": "Brazil", "fga_rating": 92.1, "best_philosophy": "Yashin Revolution"}, {"name": "Bruce Grobbelaar", "profile_html": "Bruce_Grobelaar.html", "position": "GK", "age": 68, "nationality": "Zimbabwe", "fga_rating": 92.0, "best_philosophy": "Ferguson Mental"}, {"name": "George Weah", "profile_html": "George_Weah.html", "position": "ST", "age": 58, "nationality": "Liberia", "fga_rating": 92.0, "best_philosophy": "Sacchi Pressing"}, {"name": "Lu√É¬≠s Figo", "profile_html": "Luis_Figo.html", "position": "WG", "age": 53, "nationality": "Portugal", "fga_rating": 92.0, "best_philosophy": "Ferguson Mental"}, {"name": "Eric Cantona", "profile_html": "Eric_Cantona.html", "position": "AM", "age": 59, "nationality": "France", "fga_rating": 92.0, "best_philosophy": "Ferguson Mental"}, {"name": "Bruno Guimar√É¬£es", "profile_html": "Bruno_Guimaraes.html", "position": "CM", "age": 28, "nationality": "Brazil", "fga_rating": 92.0, "best_philosophy": "Guardiola Positional"}, {"name": "Matthias Sammer", "profile_html": "Matthias_Sammer.html", "position": "Defender / Midfielder", "age": 58, "nationality": "Germany", "fga_rating": 92.0, "best_philosophy": "Beckenbauer Libero"}, {"name": "Jari Litmanen", "profile_html": "Jari_Litmanen.html", "position": "AM", "age": 54, "nationality": "Finland", "fga_rating": 92.0, "best_philosophy": "Van Gaal System"}, {"name": "Jari Litmanen", "profile_html": "Jari_Litmanen.html", "position": "AM", "age": 54, "nationality": "Finland", "fga_rating": 92.0, "best_philosophy": "Van Gaal System"}, {"name": "Rudi V√É¬∂ller", "profile_html": "Rudi_Voller.html", "position": "ST", "age": 65, "nationality": "Germany", "fga_rating": 92.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Luis Monti", "profile_html": "Luis_Monti.html", "position": "CM", "age": 82, "nationality": "Argentina / Italy", "fga_rating": 92.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Artem Dovbyk", "profile_html": "Artem_Dovbyk.html", "position": "ST", "age": 28, "nationality": "Ukraine", "fga_rating": 92.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Harry Kane", "profile_html": "Harry_Kane.html", "position": "ST", "age": 32, "nationality": "England", "fga_rating": 91.8, "best_philosophy": "Ferguson Mental"}, {"name": "Pavel Nedv√Ñ‚Ä∫d", "profile_html": "Pavel_Nedved.html", "position": "CM", "age": 53, "nationality": "Czech Republic", "fga_rating": 91.8, "best_philosophy": "Sacchi Pressing"}, {"name": "James Rodr√É¬≠guez", "profile_html": "James_Rodriguez.html", "position": "AM", "age": 34, "nationality": "Colombia", "fga_rating": 91.5, "best_philosophy": "Menotti Artistry"}, {"name": "Samuel Kuffour", "profile_html": "Samuel_Kuffour.html", "position": "CB", "age": 49, "nationality": "Ghana", "fga_rating": 91.5, "best_philosophy": "Ferguson Mental"}, {"name": "Alan Shearer", "profile_html": "Alan_Shearer.html", "position": "ST", "age": 54, "nationality": "England", "fga_rating": 91.5, "best_philosophy": "Ferguson Mental"}, {"name": "Jean Tigana", "profile_html": "Jean_Tigana.html", "position": "CM", "age": 70, "nationality": "France", "fga_rating": 91.5, "best_philosophy": "Platini Elegance"}, {"name": "Keylor Navas", "profile_html": "Keylor_Navas.html", "position": "GK", "age": 39, "nationality": "Costa Rica", "fga_rating": 91.5, "best_philosophy": "GK_Casillas_Reflex"}, {"name": "Xavi Simons", "profile_html": "Xavi_Simons.html", "position": "AM", "age": 22, "nationality": "Netherlands", "fga_rating": 91.5, "best_philosophy": "Cruyff Intelligence"}, {"name": "Michael Owen", "profile_html": "Michael_Owen.html", "position": "ST", "age": 45, "nationality": "England", "fga_rating": 91.5, "best_philosophy": "Robson English Soul"}, {"name": "Enzo Francescoli", "profile_html": "Enzo_Francescoli.html", "position": "AM", "age": 64, "nationality": "Uruguay", "fga_rating": 91.5, "best_philosophy": "Menotti Artistry"}, {"name": "Luis Cubilla", "profile_html": "Luis_Cubilla.html", "position": "WG", "age": 73, "nationality": "Uruguay", "fga_rating": 91.5, "best_philosophy": "Ferguson Mental"}, {"name": "Mohamed Salah", "profile_html": "Mohamed_Salah.html", "position": "ST", "age": 33, "nationality": "Egypt", "fga_rating": 91.2, "best_philosophy": "Klopp Intensity"}, {"name": "Julio C√É¬©sar Falcioni", "profile_html": "Julio_Falcioni.html", "position": "GK", "age": 69, "nationality": "Argentina", "fga_rating": 91.0, "best_philosophy": "Ferguson Mental"}, {"name": "Faustino Asprilla", "profile_html": "Faustino_Asprilla.html", "position": "ST", "age": 55, "nationality": "Colombia", "fga_rating": 91.0, "best_philosophy": "Menotti Artistry"}, {"name": "Iv√É¬°n C√É¬≥rdoba", "profile_html": "Ivan_Cordoba.html", "position": "CB", "age": 49, "nationality": "Colombia", "fga_rating": 91.0, "best_philosophy": "Sacchi Pressing"}, {"name": "Edinson Cavani", "profile_html": "Edinson_Cavani.html", "position": "ST", "age": 38, "nationality": "Uruguay", "fga_rating": 91.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Te√É¬≥filo Cubillas", "profile_html": "Teofilo_Cubillas.html", "position": "AM", "age": 76, "nationality": "Peru", "fga_rating": 91.0, "best_philosophy": "Menotti Artistry"}, {"name": "Gary Lineker", "profile_html": "Gary_Lineker.html", "position": "ST", "age": 65, "nationality": "England", "fga_rating": 91.0, "best_philosophy": "Fontaine Attack"}, {"name": "Jimmy Floyd Hasselbaink", "profile_html": "Jimmy_Floyd_Hasselbaink.html", "position": "ST", "age": 53, "nationality": "Netherlands (Born Suriname)", "fga_rating": 91.0, "best_philosophy": "Fontaine Attack"}, {"name": "Finidi George", "profile_html": "George_Finidi.html", "position": "WG", "age": 54, "nationality": "Nigeria", "fga_rating": 91.0, "best_philosophy": "Van Gaal System"}, {"name": "Enzo Scifo", "profile_html": "Enzo_Scifo.html", "position": "Attacking Midfielder", "age": 59, "nationality": "Belgium", "fga_rating": 91.0, "best_philosophy": "Cruyff Intelligence"}, {"name": "Oscar Ruggeri", "profile_html": "Oscar_Ruggeri.html", "position": "Centre-Back", "age": 63, "nationality": "Argentina", "fga_rating": 91.0, "best_philosophy": "Bilardo Pragmatism"}, {"name": "Julio C√É¬©sar Romero", "profile_html": "Julio_Cesar_Romero.html", "position": "AM", "age": 65, "nationality": "Paraguay", "fga_rating": 91.0, "best_philosophy": "Santana JogoBonito"}, {"name": "Francisco Varallo", "profile_html": "Francesco_Varallo.html", "position": "ST", "age": 100, "nationality": "Argentina", "fga_rating": 91.0, "best_philosophy": "Haaland Power"}, {"name": "Frenkie de Jong", "profile_html": "Frenkie_De_Jong.html", "position": "CM", "age": 28, "nationality": "Netherlands", "fga_rating": 90.8, "best_philosophy": "Cruyff Intelligence"}, {"name": "Ruud van Nistelrooy", "profile_html": "Ruud_van_Nistelrooy.html", "position": "ST", "age": 49, "nationality": "Netherlands", "fga_rating": 90.8, "best_philosophy": "Ferguson Mental"}, {"name": "Luis Carlos Perea", "profile_html": "Luis_Carlos_Perea.html", "position": "CB", "age": 61, "nationality": "Colombia", "fga_rating": 90.5, "best_philosophy": "Sacchi Pressing"}, {"name": "Carlos Peucelle", "profile_html": "Carlos_Peucelle.html", "position": "WG", "age": 117, "nationality": "Argentina", "fga_rating": 90.5, "best_philosophy": "Menotti Artistry"}, {"name": "Diego Forl√É¬°n", "profile_html": "Diego_Forlan.html", "position": "ST", "age": 46, "nationality": "Uruguay", "fga_rating": 90.5, "best_philosophy": "Fontaine Attack"}, {"name": "Paul Gascoigne", "profile_html": "Paul_Gascoigne.html", "position": "AM", "age": 58, "nationality": "England", "fga_rating": 90.5, "best_philosophy": "Wenger Development"}, {"name": "Alphonso Davies", "profile_html": "Alphonso_Davies.html", "position": "WG", "age": 25, "nationality": "Canada", "fga_rating": 90.5, "best_philosophy": "Klopp Intensity"}, {"name": "Terry Butcher", "profile_html": "Terry_Butcher.html", "position": "CB", "age": 67, "nationality": "England", "fga_rating": 90.5, "best_philosophy": "Simeone Cholismo"}, {"name": "Terry Butcher", "profile_html": "Terry_Butcher.html", "position": "CB", "age": 67, "nationality": "England", "fga_rating": 90.5, "best_philosophy": "Simeone Cholismo"}, {"name": "√É¬Ålex Aguinaga", "profile_html": "Alex_Aguinaga.html", "position": "AM", "age": 57, "nationality": "Ecuador", "fga_rating": 90.5, "best_philosophy": "Cruyff Intelligence"}, {"name": "Willington Ortiz", "profile_html": "Willington_Ortiz.html", "position": "ST", "age": 73, "nationality": "Colombia", "fga_rating": 90.5, "best_philosophy": "Santana JogoBonito"}, {"name": "Lautaro Mart√É¬≠nez", "profile_html": "Lautaro_Martinez.html", "position": "ST", "age": 28, "nationality": "Argentina", "fga_rating": 90.3, "best_philosophy": "Simeone Cholismo"}, {"name": "Ian Wright", "profile_html": "Ian_Wright.html", "position": "ST", "age": 62, "nationality": "England", "fga_rating": 90.2, "best_philosophy": "Fontaine Attack"}, {"name": "Ren√É¬© Higuita", "profile_html": "Rene_Higuita.html", "position": "GK", "age": 59, "nationality": "Colombia", "fga_rating": 90.0, "best_philosophy": "Yashin Revolution"}, {"name": "Lamine Yamal", "profile_html": "Lamine_Yamal.html", "position": "WG", "age": 18, "nationality": "Spain", "fga_rating": 90.0, "best_philosophy": "Guardiola Positional"}, {"name": "Jay-Jay Okocha", "profile_html": "Augustine_Okocha.html", "position": "AM", "age": 52, "nationality": "Nigeria", "fga_rating": 90.0, "best_philosophy": "Menotti Artistry"}, {"name": "Geremi Njitap", "profile_html": "Geremi_Njitap.html", "position": "CM", "age": 47, "nationality": "Cameroon", "fga_rating": 90.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Antonio Valencia", "profile_html": "Antonio_Valencia.html", "position": "WG", "age": 40, "nationality": "Ecuador", "fga_rating": 90.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Carlos Valderrama", "profile_html": "Carlos_Valderrama.html", "position": "AM", "age": 64, "nationality": "Colombia", "fga_rating": 90.0, "best_philosophy": "Cruyff Intelligence"}, {"name": "Antonio Valencia", "profile_html": "Antonio_Valencia.html", "position": "WG", "age": 40, "nationality": "Ecuador", "fga_rating": 90.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Carlos Valderrama", "profile_html": "Carlos_Valderrama.html", "position": "AM", "age": 64, "nationality": "Colombia", "fga_rating": 90.0, "best_philosophy": "Cruyff Intelligence"}, {"name": "Gabriel Magalh√É¬£es", "profile_html": "Gabriel_Magalhaes.html", "position": "CB", "age": 28, "nationality": "Brazil", "fga_rating": 89.7, "best_philosophy": "Sacchi Pressing"}, {"name": "Cole Palmer", "profile_html": "Cole_Palmer.html", "position": "AM", "age": 22, "nationality": "England", "fga_rating": 89.5, "best_philosophy": "Guardiola Positional"}, {"name": "Igor Dobrovolski", "profile_html": "Igor_Dobrovolski.html", "position": "AM", "age": 58, "nationality": "Soviet Union/Ukraine", "fga_rating": 89.5, "best_philosophy": "Lobanovskyi Scientific"}, {"name": "Jared Borgetti", "profile_html": "Jared_Borgetti.html", "position": "ST", "age": 52, "nationality": "Mexico", "fga_rating": 89.5, "best_philosophy": "Robson English Soul"}, {"name": "Edgardo Bauza", "profile_html": "Edgardo_Bauza.html", "position": "CB", "age": 67, "nationality": "Argentina", "fga_rating": 89.5, "best_philosophy": "Bilardo Pragmatism"}, {"name": "Alexander S√É¬∏rloth", "profile_html": "Alexander_Sorloth.html", "position": "Striker", "age": 30, "nationality": "Norway", "fga_rating": 89.5, "best_philosophy": "Haaland Power"}, {"name": "Adolfo Nef", "profile_html": "Adolfo_Nef.html", "position": "Goalkeeper", "age": 80, "nationality": "Chile", "fga_rating": 89.5, "best_philosophy": "Buffon Presence"}, {"name": "Bukayo Saka", "profile_html": "Bukayo_Saka.html", "position": "WG", "age": 24, "nationality": "England", "fga_rating": 89.1, "best_philosophy": "Guardiola Positional"}, {"name": "Fredy Montero", "profile_html": "Fredy_Montero.html", "position": "ST", "age": 38, "nationality": "Colombia", "fga_rating": 89.0, "best_philosophy": "Santana JogoBonito"}, {"name": "V√É¬≠ctor Aristiz√É¬°bal", "profile_html": "Victor_Aristizabal.html", "position": "ST", "age": 53, "nationality": "Colombia", "fga_rating": 89.0, "best_philosophy": "Santana JogoBonito"}, {"name": "Arnoldo Iguar√É¬°n", "profile_html": "Arnoldo_Iguaran.html", "position": "ST", "age": 68, "nationality": "Colombia", "fga_rating": 89.0, "best_philosophy": "Menotti Artistry"}, {"name": "Adolfo Valencia", "profile_html": "Adolfo_Valencia.html", "position": "ST", "age": 57, "nationality": "Colombia", "fga_rating": 89.0, "best_philosophy": "Fontaine Attack"}, {"name": "Carlos Bacca", "profile_html": "Carlos_Bacca.html", "position": "ST", "age": 39, "nationality": "Colombia", "fga_rating": 89.0, "best_philosophy": "Fontaine Attack"}, {"name": "Leonel √É¬Ålvarez", "profile_html": "Leonel_Alvarez.html", "position": "DM", "age": 60, "nationality": "Colombia", "fga_rating": 89.0, "best_philosophy": "Bilardo Pragmatism"}, {"name": "Juan Arango", "profile_html": "Juan_Arango.html", "position": "AM", "age": 45, "nationality": "Venezuela", "fga_rating": 89.0, "best_philosophy": "Platini Elegance"}, {"name": "Jonathan David", "profile_html": "Jonathan_David.html", "position": "ST", "age": 25, "nationality": "Canada", "fga_rating": 89.0, "best_philosophy": "Klopp Intensity"}, {"name": "Rog√É¬©rio Ceni", "profile_html": "Rogerio_Ceni.html", "position": "GK", "age": 52, "nationality": "Brazil", "fga_rating": 89.0, "best_philosophy": "Ferguson Mental"}, {"name": "Claudio Ubeda", "profile_html": "Claudio_Ubeda.html", "position": "CB", "age": 56, "nationality": "Argentina", "fga_rating": 89.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Andreas M√É¬∂ller", "profile_html": "Andreas_Moller.html", "position": "AM", "age": 58, "nationality": "Germany", "fga_rating": 88.7, "best_philosophy": "Menotti Artistry"}, {"name": "Carlos Estrada", "profile_html": "Carlos_Estrada.html", "position": "CM", "age": 64, "nationality": "Colombia", "fga_rating": 88.6, "best_philosophy": "Maturana Structure"}, {"name": "Carlos Estrada", "profile_html": "Carlos_Estrada.html", "position": "CM", "age": 64, "nationality": "Colombia", "fga_rating": 88.6, "best_philosophy": "Maturana Structure"}, {"name": "Lu√É¬≠s Su√É¬°rez", "profile_html": "Luis_Suarez.html", "position": "ST", "age": 38, "nationality": "Uruguay", "fga_rating": 88.5, "best_philosophy": "Fontaine Attack"}, {"name": "Ricardo Gareca", "profile_html": "Ricardo_Gareca.html", "position": "ST", "age": 67, "nationality": "Argentina", "fga_rating": 88.5, "best_philosophy": "Menotti Artistry"}, {"name": "Hugo Gottardi", "profile_html": "Hugo_Gottardi.html", "position": "ST", "age": 72, "nationality": "Argentina", "fga_rating": 88.5, "best_philosophy": "Bilardo Pragmatism"}, {"name": "G√É¬∏ran S√É¬∏rloth", "profile_html": "Goran_Sorloth.html", "position": "Striker", "age": 63, "nationality": "Norway", "fga_rating": 88.5, "best_philosophy": "Lewandowski Finisher"}, {"name": "Mario Vanemerak", "profile_html": "Mario_Vanemerak.html", "position": "CM", "age": 62, "nationality": "Argentina", "fga_rating": 88.5, "best_philosophy": "Simeone Cholismo"}, {"name": "Marcus Rashford", "profile_html": "Marcus_Rashford.html", "position": "ST", "age": 28, "nationality": "England", "fga_rating": 88.4, "best_philosophy": "Klopp Intensity"}, {"name": "√É¬Ålvaro Dom√É¬≠nguez", "profile_html": "Alvaro_Dominguez.html", "position": "CM", "age": 44, "nationality": "Colombia", "fga_rating": 88.0, "best_philosophy": "Menotti Artistry"}, {"name": "Bernardo Red√É¬≠n", "profile_html": "Bernardo_Redin.html", "position": "AM", "age": 62, "nationality": "Colombia", "fga_rating": 88.0, "best_philosophy": "Platini Elegance"}, {"name": "Daniel Mu√É¬±oz", "profile_html": "Daniel_Munoz.html", "position": "FB", "age": 29, "nationality": "Colombia", "fga_rating": 88.0, "best_philosophy": "Klopp Intensity"}, {"name": "Jhon Jairo Tr√É¬©llez", "profile_html": "Jhon_Trellez.html", "position": "ST", "age": 57, "nationality": "Colombia", "fga_rating": 88.0, "best_philosophy": "Fontaine Attack"}, {"name": "Endrick", "profile_html": "Endrick.html", "position": "ST", "age": 19, "nationality": "Brazil", "fga_rating": 88.0, "best_philosophy": "Santana JogoBonito"}, {"name": "Macnelly Torres", "profile_html": "McNelly_Torres.html", "position": "AM", "age": 41, "nationality": "Colombia", "fga_rating": 88.0, "best_philosophy": "Platini Elegance"}, {"name": "Kalusha Bwalya", "profile_html": "Kalusha_Bwalya.html", "position": "AM", "age": 62, "nationality": "Zambia", "fga_rating": 88.0, "best_philosophy": "Menotti Artistry"}, {"name": "Aleksandr Borodyuk", "profile_html": "Aleksandr_Borodyuk.html", "position": "AM", "age": 63, "nationality": "Soviet Union/Russia", "fga_rating": 87.5, "best_philosophy": "Lobanovskyi Scientific"}, {"name": "M√É¬°gico Gonz√É¬°lez", "profile_html": "Jorge_Gonzalez_Barillas.html", "position": "ST", "age": 67, "nationality": "El Salvador", "fga_rating": 87.5, "best_philosophy": "Menotti Artistry"}, {"name": "Mart√É¬≠n Arzuaga", "profile_html": "Martin_Arzuaga.html", "position": "ST", "age": 44, "nationality": "Colombia", "fga_rating": 87.0, "best_philosophy": "Santana JogoBonito"}, {"name": "Giovanni Moreno", "profile_html": "Giovanni_Moreno.html", "position": "AM", "age": 39, "nationality": "Colombia", "fga_rating": 87.0, "best_philosophy": "Menotti Artistry"}, {"name": "Jhon C√É¬≥rdoba", "profile_html": "Jhon_Cordoba.html", "position": "ST", "age": 32, "nationality": "Colombia", "fga_rating": 87.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Paulo Silas", "profile_html": "Paulo_Silas.html", "position": "CM", "age": 60, "nationality": "Brazil", "fga_rating": 87.0, "best_philosophy": "Santana JogoBonito"}, {"name": "Bryan Ruiz", "profile_html": "Bryan_Ruiz.html", "position": "AM", "age": 40, "nationality": "Costa Rica", "fga_rating": 87.0, "best_philosophy": "Menotti Artistry"}, {"name": "Benjamin √Ö¬†e√Ö¬°ko", "profile_html": "Benjamin_Sesko.html", "position": "ST", "age": 22, "nationality": "Slovenia", "fga_rating": 86.9, "best_philosophy": "DeVisser Global"}, {"name": "Giovanni Reyna", "profile_html": "Giovanni_Reyna.html", "position": "AM", "age": 23, "nationality": "United States", "fga_rating": 86.7, "best_philosophy": "Guardiola Positional"}, {"name": "Rob de Wit", "profile_html": "Rob_De_Wit.html", "position": "WG", "age": 61, "nationality": "Netherlands", "fga_rating": 86.5, "best_philosophy": "Cruyff Intelligence"}, {"name": "Carmelo Valencia", "profile_html": "Carmelo_Valencia.html", "position": "ST", "age": 41, "nationality": "Colombia", "fga_rating": 86.5, "best_philosophy": "Fontaine Attack"}, {"name": "Ryan Gravenberch", "profile_html": "Ryan_Gravenberch.html", "position": "CM", "age": 23, "nationality": "Netherlands", "fga_rating": 86.5, "best_philosophy": "Cruyff Intelligence"}, {"name": "Rodrigo Mora", "profile_html": "Rodrigo_Mora.html", "position": "Striker / Winger", "age": 38, "nationality": "Uruguay", "fga_rating": 86.5, "best_philosophy": "Klopp Intensity"}, {"name": "Ivo Basay", "profile_html": "Ivo_Basay.html", "position": "ST", "age": 59, "nationality": "Chile", "fga_rating": 86.2, "best_philosophy": "Ferguson Mental"}, {"name": "Castello Lukeba", "profile_html": "Castello_Lukeba.html", "position": "CB", "age": 23, "nationality": "France", "fga_rating": 86.1, "best_philosophy": "Guardiola Positional"}, {"name": "Roberto Rojas", "profile_html": "Roberto_Rojas.html", "position": "GK", "age": 68, "nationality": "Chile", "fga_rating": 86.0, "best_philosophy": "Yashin Revolution"}, {"name": "Jhon Arias", "profile_html": "Jhon_Arias.html", "position": "WG", "age": 28, "nationality": "Colombia", "fga_rating": 86.0, "best_philosophy": "Menotti Artistry"}, {"name": "Giovanny Hern√É¬°ndez", "profile_html": "Giovanny_Hernandez.html", "position": "AM", "age": 49, "nationality": "Colombia", "fga_rating": 86.0, "best_philosophy": "Platini Elegance"}, {"name": "Julinho", "profile_html": "Julinho.html", "position": "WG", "age": 60, "nationality": "Brazil / Peru", "fga_rating": 86.0, "best_philosophy": "Menotti Artistry"}, {"name": "J√É¬©r√É¬©my Doku", "profile_html": "Jeremy_Doku.html", "position": "Winger", "age": 23, "nationality": "Belgium", "fga_rating": 86.0, "best_philosophy": "Bielsa Intensity"}, {"name": "Freddy Grisales", "profile_html": "Freddy_Grisales.html", "position": "CM", "age": 50, "nationality": "Colombia", "fga_rating": 86.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Freddy Grisales", "profile_html": "Freddy_Grisales.html", "position": "CM", "age": 50, "nationality": "Colombia", "fga_rating": 86.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Oleksandr Piscsur", "profile_html": "Oleksandr_Pyshcsur.html", "position": "ST", "age": 44, "nationality": "Ukraine", "fga_rating": 86.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Aaron Ramsey", "profile_html": "Aaron_Ramsey.html", "position": "CM", "age": 34, "nationality": "Wales", "fga_rating": 85.8, "best_philosophy": "Guardiola Positional"}, {"name": "Johan Bakayoko", "profile_html": "Johan_Bakayoko.html", "position": "WG", "age": 22, "nationality": "Belgium", "fga_rating": 85.7, "best_philosophy": "Klopp Intensity"}, {"name": "Peter Ndlovu", "profile_html": "Peter_Ndlovu.html", "position": "WG", "age": 52, "nationality": "Zimbabwe", "fga_rating": 85.5, "best_philosophy": "Klopp Intensity"}, {"name": "Samuel Chukwueze", "profile_html": "Samuel_Chukwueze.html", "position": "WG", "age": 26, "nationality": "Nigeria", "fga_rating": 85.4, "best_philosophy": "Guardiola Positional"}, {"name": "Walter Montillo", "profile_html": "Walter_Montillo.html", "position": "AM", "age": 41, "nationality": "Argentina", "fga_rating": 85.2, "best_philosophy": "Menotti Artistry"}, {"name": "Sergio Angulo", "profile_html": "Sergio_Angulo.html", "position": "ST", "age": 65, "nationality": "Colombia", "fga_rating": 85.0, "best_philosophy": "Fontaine Attack"}, {"name": "V√É¬≠ctor Bonilla", "profile_html": "Victor_Bonilla.html", "position": "ST", "age": 54, "nationality": "Colombia", "fga_rating": 85.0, "best_philosophy": "Fontaine Attack"}, {"name": "Carlos Ruiz", "profile_html": "Carlos_Ruiz_Gutierrez.html", "position": "ST", "age": 46, "nationality": "Guatemala", "fga_rating": 85.0, "best_philosophy": "Fontaine Attack"}, {"name": "Tressor Moreno", "profile_html": "Tressor_Moreno.html", "position": "AM", "age": 46, "nationality": "Colombia", "fga_rating": 85.0, "best_philosophy": "Menotti Artistry"}, {"name": "Tressor Moreno", "profile_html": "Tressor_Moreno.html", "position": "AM", "age": 46, "nationality": "Colombia", "fga_rating": 85.0, "best_philosophy": "Menotti Artistry"}, {"name": "Maarten Vandevoordt", "profile_html": "Maarten_Vandevoordt.html", "position": "GK", "age": 23, "nationality": "Belgium", "fga_rating": 84.7, "best_philosophy": "Yashin Revolution"}, {"name": "Abdul Fatawu Issahaku", "profile_html": "Abdul_Issahaku.html", "position": "WG", "age": 21, "nationality": "Ghana", "fga_rating": 84.7, "best_philosophy": "Guardiola Positional"}, {"name": "Sergio Arribas", "profile_html": "Sergio_Arribas.html", "position": "AM", "age": 22, "nationality": "Spain", "fga_rating": 84.7, "best_philosophy": "Spanish Technical"}, {"name": "Santiago Londo√É¬±o", "profile_html": "Santiago_Londo√É¬±o.html", "position": "ST", "age": 17, "nationality": "Colombia", "fga_rating": 84.5, "best_philosophy": "Wenger Development"}, {"name": "Jefferson Savarino", "profile_html": "Jefferson_Savarino.html", "position": "CM", "age": 29, "nationality": "Venezuela", "fga_rating": 84.5, "best_philosophy": "Santana JogoBonito"}, {"name": "Maxime de Cuyper", "profile_html": "Maxime_De_Cuyper.html", "position": "FB", "age": 24, "nationality": "Belgium", "fga_rating": 84.5, "best_philosophy": "Sacchi Pressing"}, {"name": "Ezechiel Banzuzi", "profile_html": "Ezechiel_Banzuzi.html", "position": "CM", "age": 20, "nationality": "Netherlands", "fga_rating": 84.3, "best_philosophy": "DeVisser Global"}, {"name": "Sergio Z√É¬°rate", "profile_html": "Sergio_Zarate.html", "position": "AM", "age": 56, "nationality": "Argentina", "fga_rating": 84.2, "best_philosophy": "Menotti Artistry"}, {"name": "Claudio Scalise", "profile_html": "Claudio_Scalise.html", "position": "ST", "age": 63, "nationality": "Argentina", "fga_rating": 84.2, "best_philosophy": "Menotti Artistry"}, {"name": "Jorge Carrascal", "profile_html": "Jorge_Carrascal.html", "position": "AM", "age": 27, "nationality": "Colombia", "fga_rating": 84.1, "best_philosophy": "Menotti Artistry"}, {"name": "Jozy Altidore", "profile_html": "Jozy_Altidore.html", "position": "ST", "age": 36, "nationality": "USA", "fga_rating": 84.0, "best_philosophy": "Ferguson Mental"}, {"name": "Roberto Pe√É¬±aloza", "profile_html": "Roberto_Penaloza.html", "position": "CB", "age": 46, "nationality": "Colombia", "fga_rating": 84.0, "best_philosophy": "Sacchi Pressing"}, {"name": "Kendry P√É¬°ez", "profile_html": "Kendry_Paez.html", "position": "AM", "age": 18, "nationality": "Ecuador", "fga_rating": 84.0, "best_philosophy": "Wenger Development"}, {"name": "Johan Mojica", "profile_html": "Johan_Mojica.html", "position": "FB", "age": 33, "nationality": "Colombia", "fga_rating": 84.0, "best_philosophy": "Klopp Intensity"}, {"name": "V√É¬≠ctor Ibarbo", "profile_html": "Victor_Ibarbo.html", "position": "ST", "age": 35, "nationality": "Colombia", "fga_rating": 84.0, "best_philosophy": "Klopp Intensity"}, {"name": "Agust√É¬≠n Rossi", "profile_html": "Agustin_Rossi.html", "position": "GK", "age": 30, "nationality": "Argentina", "fga_rating": 84.0, "best_philosophy": "Yashin Revolution"}, {"name": "Salom√É¬≥n Rond√É¬≥n", "profile_html": "Salomon_Rondon.html", "position": "ST", "age": 36, "nationality": "Venezuela", "fga_rating": 84.0, "best_philosophy": "Robson English Soul"}, {"name": "Sebasti√É¬°n Abreu", "profile_html": "Sebastian_Abreu.html", "position": "ST", "age": 49, "nationality": "Uruguay", "fga_rating": 84.0, "best_philosophy": "Bianchi Passion"}, {"name": "Faryd Mondrag√É¬≥n", "profile_html": "Faryd_Mondragon.html", "position": "GK", "age": 53, "nationality": "Colombia", "fga_rating": 83.7, "best_philosophy": "Yashin Revolution"}, {"name": "Juan Carlos Higuita", "profile_html": "Juan_Carlos_Higuita.html", "position": "DM", "age": 26, "nationality": "Colombia", "fga_rating": 83.5, "best_philosophy": "Guardiola Positional"}, {"name": "Peter Wynhoff", "profile_html": "Peter_Wynhoff.html", "position": "CM", "age": 57, "nationality": "Germany", "fga_rating": 83.5, "best_philosophy": "Simeone Cholismo"}, {"name": "Nicol√É¬°s Benedetti", "profile_html": "Nicolas_Benedetti.html", "position": "AM", "age": 28, "nationality": "Colombia", "fga_rating": 83.2, "best_philosophy": "Menotti Artistry"}, {"name": "Yaser Asprilla", "profile_html": "Yaser_Asprilla.html", "position": "WG", "age": 21, "nationality": "Colombia", "fga_rating": 83.0, "best_philosophy": "Menotti Artistry"}, {"name": "Mart√É¬≠n Morel", "profile_html": "Martin_Morel.html", "position": "AM", "age": 44, "nationality": "Argentina", "fga_rating": 83.0, "best_philosophy": "Menotti Artistry"}, {"name": "Frank Yallop", "profile_html": "Frank_Yallop.html", "position": "CB", "age": 61, "nationality": "Canada", "fga_rating": 83.0, "best_philosophy": "Herrera Catenaccio"}, {"name": "Vladimir Mar√É¬≠n", "profile_html": "Vladimir_Marin.html", "position": "FB", "age": 46, "nationality": "Colombia", "fga_rating": 83.0, "best_philosophy": "Santana Joga Bonito"}, {"name": "Damir Ceter", "profile_html": "Damir_Ceter.html", "position": "ST", "age": 24, "nationality": "Slovenia", "fga_rating": 82.8, "best_philosophy": "Klopp Intensity"}, {"name": "Jos√É¬© Caldera", "profile_html": "Jose_Caldera.html", "position": "CB", "age": 23, "nationality": "Colombia", "fga_rating": 82.5, "best_philosophy": "Sacchi Pressing"}, {"name": "Rafael Dudamel", "profile_html": "Rafael_Dudamel.html", "position": "GK", "age": 52, "nationality": "Venezuela", "fga_rating": 82.5, "best_philosophy": "GK_Kahn_Intensity"}, {"name": "N√É¬©stor Gorosito", "profile_html": "Nestor_Gorosito.html", "position": "AM", "age": 60, "nationality": "Argentina", "fga_rating": 82.4, "best_philosophy": "Menotti Artistry"}, {"name": "Uwe Kamps", "profile_html": "Uwe_Kamps.html", "position": "GK", "age": 61, "nationality": "Germany", "fga_rating": 82.3, "best_philosophy": "Beckenbauer Libero"}, {"name": "Carlos Henao", "profile_html": "Carlos_Henao.html", "position": "CB", "age": 36, "nationality": "Colombia", "fga_rating": 82.0, "best_philosophy": "Sacchi Pressing"}, {"name": "Vinnie Jones", "profile_html": "Vinnie_Jones.html", "position": "DM", "age": 60, "nationality": "Wales", "fga_rating": 82.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Josha Vagnoman", "profile_html": "Joshua_Vangoman.html", "position": "WG", "age": 25, "nationality": "Germany", "fga_rating": 82.0, "best_philosophy": "Klopp Intensity"}, {"name": "Santiago Londo√É¬±o Ruiz", "profile_html": "Santiago_Londo√É¬±o_Ruiz.html", "position": "GK", "age": 30, "nationality": "Colombia", "fga_rating": 81.0, "best_philosophy": "GK-Casillas Reflex"}, {"name": "Deiber Caicedo", "profile_html": "Deiber_Caicedo.html", "position": "WG", "age": 25, "nationality": "Colombia", "fga_rating": 81.0, "best_philosophy": "Klopp Intensity"}, {"name": "Jeisson Lucum√É¬≠", "profile_html": "Jeisson_Lucumi.html", "position": "WG", "age": 30, "nationality": "Colombia", "fga_rating": 81.0, "best_philosophy": "Klopp Intensity"}, {"name": "Joaqu√É¬≠n Boghossian", "profile_html": "Joaquin_Boghossian.html", "position": "ST", "age": 38, "nationality": "Uruguay", "fga_rating": 81.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Oscar Craiyacich", "profile_html": "Oscar_Craiyacich.html", "position": "CB", "age": 77, "nationality": "Argentina", "fga_rating": 81.0, "best_philosophy": "Herrera Catenaccio"}, {"name": "Axel Bamba", "profile_html": "Axel_Bamba.html", "position": "CB", "age": 26, "nationality": "Ivory Coast", "fga_rating": 80.5, "best_philosophy": "Klopp Intensity"}, {"name": "Benedikt Pichler", "profile_html": "Benedikt_Pichler.html", "position": "ST", "age": 28, "nationality": "Austria", "fga_rating": 80.3, "best_philosophy": "Klopp Intensity"}, {"name": "Myron Boadu", "profile_html": "Myron_Boadu.html", "position": "ST", "age": 24, "nationality": "Netherlands", "fga_rating": 80.2, "best_philosophy": "DeVisser Global"}, {"name": "Juli√É¬°n de la Cuesta", "profile_html": "Julian_De_La_Cuesta.html", "position": "CB", "age": 42, "nationality": "Colombia", "fga_rating": 80.0, "best_philosophy": "Cruyff Intelligence"}, {"name": "Lucas Bergvall", "profile_html": "Lucas_Bergvall.html", "position": "CM", "age": 19, "nationality": "Sweden", "fga_rating": 79.5, "best_philosophy": "Guardiola Positional"}, {"name": "Marco Antonio Cat√É¬™", "profile_html": "Marco_Antonio_Cate.html", "position": "ST", "age": 52, "nationality": "Brazil", "fga_rating": 79.5, "best_philosophy": "Santana JogoBonito"}, {"name": "Jacob Bruun Larsen", "profile_html": "Jacob_Bruunlarsen.html", "position": "CM", "age": 27, "nationality": "Denmark", "fga_rating": 79.2, "best_philosophy": "Platini Elegance"}, {"name": "D√É¬©sir√É¬© Dou√É¬©", "profile_html": "Desire_Doue.html", "position": "AM", "age": 20, "nationality": "France", "fga_rating": 79.0, "best_philosophy": "Wenger Development"}, {"name": "Dean Huijsen", "profile_html": "Dean_Huijsen.html", "position": "CB", "age": 20, "nationality": "Spain / Netherlands", "fga_rating": 79.0, "best_philosophy": "Cruyff Intelligence"}, {"name": "Franco Fag√É¬∫ndez", "profile_html": "Franco_Fagundez.html", "position": "AM", "age": 25, "nationality": "Uruguay", "fga_rating": 78.8, "best_philosophy": "Menotti Artistry"}, {"name": "Neider Morantes", "profile_html": "Neider_Morantes.html", "position": "CM", "age": 30, "nationality": "Colombia", "fga_rating": 78.5, "best_philosophy": "Guardiola Positional"}, {"name": "Nico Paz", "profile_html": "Nico_Paz.html", "position": "AM", "age": 21, "nationality": "Argentina / Spain", "fga_rating": 78.5, "best_philosophy": "Guardiola Positional"}, {"name": "Leny Yoro", "profile_html": "Leny_Yoro.html", "position": "CB", "age": 20, "nationality": "France", "fga_rating": 78.5, "best_philosophy": "Guardiola Positional"}, {"name": "Telasco Segovia", "profile_html": "Telasco_Segovia.html", "position": "CM", "age": 22, "nationality": "Venezuela", "fga_rating": 78.5, "best_philosophy": "Guardiola Positional"}, {"name": "Shuto Machino", "profile_html": "Shuto_Machino.html", "position": "ST", "age": 26, "nationality": "Japan", "fga_rating": 78.5, "best_philosophy": "Klopp Intensity"}, {"name": "Archie Gray", "profile_html": "Archie_Gray.html", "position": "FB", "age": 19, "nationality": "England", "fga_rating": 78.0, "best_philosophy": "Guardiola Positional"}, {"name": "Caden Clark", "profile_html": "Caden_Clark.html", "position": "AM", "age": 22, "nationality": "United States", "fga_rating": 78.0, "best_philosophy": "Menotti Artistry"}, {"name": "Nishan Burkart", "profile_html": "Nishan_Burkart.html", "position": "ST", "age": 25, "nationality": "Switzerland", "fga_rating": 78.0, "best_philosophy": "Klopp Intensity"}, {"name": "Dar√É¬≠o Osorio", "profile_html": "Dario_Osorio.html", "position": "Winger (RW/LW)", "age": 21, "nationality": "Chile", "fga_rating": 78.0, "best_philosophy": "Menotti Artistry"}, {"name": "Duk", "profile_html": "Duk.html", "position": "FW", "age": 24, "nationality": "Guinea-Bissau", "fga_rating": 77.8, "best_philosophy": "Counter Attack"}, {"name": "Nathan Harriel", "profile_html": "Nathan_Harriel.html", "position": "FB", "age": 24, "nationality": "USA", "fga_rating": 77.5, "best_philosophy": "Simeone Cholismo"}, {"name": "Samuel Mbangula", "profile_html": "Samuel_Mbangula.html", "position": "WG", "age": 21, "nationality": "Belgium / Congo DR", "fga_rating": 77.0, "best_philosophy": "Wenger Development"}, {"name": "An√É¬≠bal Chal√É", "profile_html": "Anibal_Chala.html", "position": "FB", "age": 29, "nationality": "Ecuador", "fga_rating": 76.5, "best_philosophy": "Klopp Intensity"}, {"name": "Ronnie Radford", "profile_html": "Ronnie_Radford.html", "position": "CM", "age": 82, "nationality": "England", "fga_rating": 76.5, "best_philosophy": "Ferguson Mental"}, {"name": "Abdukodir Khusanov", "profile_html": "Abdukodir_Khusanov.html", "position": "CB", "age": 21, "nationality": "Uzbekistan", "fga_rating": 76.5, "best_philosophy": "Sacchi Pressing"}, {"name": "Ibrahim Mbaye", "profile_html": "Ibrahim_Mbaye.html", "position": "ST", "age": 17, "nationality": "France", "fga_rating": 76.5, "best_philosophy": "Wenger Development"}, {"name": "Franco Mastantuono", "profile_html": "Franco_Mastantuono.html", "position": "AM", "age": 18, "nationality": "Argentina / Italy", "fga_rating": 76.0, "best_philosophy": "Menotti Artistry"}, {"name": "Pedro Fern√É¬°ndez (Dro)", "profile_html": "Dro_Fernandez.html", "position": "CM", "age": 17, "nationality": "Spain", "fga_rating": 76.0, "best_philosophy": "Guardiola Positional"}, {"name": "Luca Williams Barnett", "profile_html": "Luca_Williams_Barnett.html", "position": "CM", "age": 17, "nationality": "England", "fga_rating": 76.0, "best_philosophy": "Guardiola Positional"}, {"name": "Momodou Sarr", "profile_html": "Momodou_Sarr.html", "position": "ST", "age": 25, "nationality": "Gambia", "fga_rating": 76.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Toni Fern√É¬°ndez", "profile_html": "Toni_Fernandez.html", "position": "ST", "age": 17, "nationality": "Spain", "fga_rating": 75.5, "best_philosophy": "Guardiola Positional"}, {"name": "Honest Ahanor", "profile_html": "Honest_Anahor.html", "position": "CB", "age": 17, "nationality": "Italy", "fga_rating": 75.5, "best_philosophy": "Sacchi Pressing"}, {"name": "Rio Ngumoha", "profile_html": "Rio_Ngumoha.html", "position": "WG", "age": 17, "nationality": "England", "fga_rating": 75.0, "best_philosophy": "Klopp Intensity"}, {"name": "Lennart Karl", "profile_html": "Lennart_Karl.html", "position": "CM", "age": 17, "nationality": "Germany", "fga_rating": 75.0, "best_philosophy": "Guardiola Positional"}, {"name": "Francesco Camarda", "profile_html": "Francesco_Camarda.html", "position": "ST", "age": 17, "nationality": "Italy", "fga_rating": 75.0, "best_philosophy": "Sacchi Pressing"}, {"name": "Djylian N'Guessan", "profile_html": "Djylian_Nguessan.html", "position": "WG", "age": 17, "nationality": "France", "fga_rating": 74.8, "best_philosophy": "Wenger Development"}, {"name": "Gorak Ghale", "profile_html": "Gorak_Ghale.html", "position": "CM", "age": 16, "nationality": "Belgium", "fga_rating": 74.5, "best_philosophy": "Cruyff Intelligence"}, {"name": "Ethan Nwaneri", "profile_html": "Ethan_Nwaneri.html", "position": "AM", "age": 18, "nationality": "England", "fga_rating": 74.5, "best_philosophy": "Wenger Development"}, {"name": "Federico Steffanoni", "profile_html": "Federico_Steffanoni.html", "position": "CM", "age": 17, "nationality": "Italy", "fga_rating": 74.5, "best_philosophy": "Guardiola Positional"}, {"name": "Brian Madjo", "profile_html": "Brian_Madjo.html", "position": "ST", "age": 16, "nationality": "England", "fga_rating": 74.5, "best_philosophy": "Wenger Development"}, {"name": "Harry Howell", "profile_html": "Harry_Howell.html", "position": "CM", "age": 17, "nationality": "England", "fga_rating": 74.5, "best_philosophy": "Guardiola Positional"}, {"name": "Gilberto Mora", "profile_html": "Gilberto_Mora.html", "position": "AM", "age": 17, "nationality": "Mexico", "fga_rating": 74.5, "best_philosophy": "Menotti Artistry"}, {"name": "Jorthy Mokio", "profile_html": "Jorthy_Mokio.html", "position": "CB", "age": 17, "nationality": "Belgium", "fga_rating": 74.5, "best_philosophy": "Cruyff Intelligence"}, {"name": "Geovany Quenda", "profile_html": "Geovany_Quenda.html", "position": "Winger (RW/LW)", "age": 18, "nationality": "Portugal / Guinea-Bissau", "fga_rating": 74.5, "best_philosophy": "Menotti Artistry"}, {"name": "Ayyoub Bouaddi", "profile_html": "Ayyoub_Bouaddi.html", "position": "CM", "age": 18, "nationality": "France / Morocco", "fga_rating": 74.0, "best_philosophy": "Guardiola Positional"}, {"name": "Wisdom Mike", "profile_html": "Wisdom_Mike.html", "position": "WG", "age": 17, "nationality": "Germany", "fga_rating": 74.0, "best_philosophy": "Klopp Intensity"}, {"name": "Abdoulaye Camara", "profile_html": "Abdoulaye_Camara.html", "position": "CM", "age": 17, "nationality": "France", "fga_rating": 74.0, "best_philosophy": "Wenger Development"}, {"name": "Thom√É¬°s de Martis", "profile_html": "Thomas_De_Martis.html", "position": "ST", "age": 17, "nationality": "Argentina", "fga_rating": 74.0, "best_philosophy": "Menotti Artistry"}, {"name": "Gabriel Mec", "profile_html": "Gabriel_Mec.html", "position": "ST", "age": 17, "nationality": "Brazil", "fga_rating": 74.0, "best_philosophy": "Santana Joga Bonito"}, {"name": "Dwight Merrick", "profile_html": "Dwight_Merrick.html", "position": "ST", "age": 22, "nationality": "Jamaica", "fga_rating": 74.0, "best_philosophy": "Klopp Intensity"}, {"name": "Jordan Barrera", "profile_html": "Jordan_Barrera.html", "position": "AM", "age": 19, "nationality": "Colombia", "fga_rating": 73.8, "best_philosophy": "Menotti Artistry"}, {"name": "Hugo Camberos", "profile_html": "Hugo_Camberos.html", "position": "WG", "age": 18, "nationality": "Mexico / USA", "fga_rating": 73.8, "best_philosophy": "Wenger Development"}, {"name": "Iker Fimbres", "profile_html": "Iker_Fimbres.html", "position": "AM", "age": 20, "nationality": "Mexico", "fga_rating": 73.5, "best_philosophy": "Wenger Development"}, {"name": "Ilyas Benktib", "profile_html": "Ilyas_Benktib.html", "position": "AM", "age": 15, "nationality": "Belgium", "fga_rating": 73.5, "best_philosophy": "Guardiola Positional"}, {"name": "Filip Bundgaard", "profile_html": "Filip_Bundgaard.html", "position": "AM", "age": 21, "nationality": "Denmark", "fga_rating": 73.5, "best_philosophy": "Wenger Development"}, {"name": "Facinet Cont√É¬©", "profile_html": "Fanicet_Conte.html", "position": "ST", "age": 20, "nationality": "Guinea", "fga_rating": 73.5, "best_philosophy": "Klopp Intensity"}, {"name": "Rudy Matondo", "profile_html": "Rudy_Matondo.html", "position": "CM", "age": 17, "nationality": "France", "fga_rating": 73.5, "best_philosophy": "Wenger Development"}, {"name": "Mathis Jangeal", "profile_html": "Mathis_Jangeal.html", "position": "CM", "age": 17, "nationality": "France", "fga_rating": 73.5, "best_philosophy": "Wenger Development"}, {"name": "Max Dowman", "profile_html": "Max_Bowman.html", "position": "CM", "age": 16, "nationality": "England", "fga_rating": 73.5, "best_philosophy": "Wenger Development"}, {"name": "Wassim Slama", "profile_html": "Wissam_Slama.html", "position": "CM", "age": 17, "nationality": "Tunisia", "fga_rating": 73.5, "best_philosophy": "Guardiola Positional"}, {"name": "Haine Eames", "profile_html": "Haine_Eames.html", "position": "CM", "age": 17, "nationality": "Australia", "fga_rating": 73.5, "best_philosophy": "Wenger Development"}, {"name": "Kaloyan Bozhkov", "profile_html": "Kaloyan_Bozhkov.html", "position": "DM", "age": 17, "nationality": "Bulgaria", "fga_rating": 73.5, "best_philosophy": "Guardiola Positional"}, {"name": "Kau√É¬£ Prates", "profile_html": "Kaua_Prates.html", "position": "FB", "age": 17, "nationality": "Brazil", "fga_rating": 73.5, "best_philosophy": "Santana Joga Bonito"}, {"name": "Jayden Onia Seke", "profile_html": "Jayden_Onia_Seke.html", "position": "WG", "age": 15, "nationality": "Belgium", "fga_rating": 73.0, "best_philosophy": "Wenger Development"}, {"name": "Dennis Seimen", "profile_html": "Dennis_Seimen.html", "position": "GK", "age": 20, "nationality": "Germany", "fga_rating": 73.0, "best_philosophy": "Yashin Revolution"}, {"name": "Matteo Palma", "profile_html": "Matteo_Palma.html", "position": "CB", "age": 17, "nationality": "Germany", "fga_rating": 73.0, "best_philosophy": "Guardiola Positional"}, {"name": "Maxima Goffi", "profile_html": "Maxima_Goffi.html", "position": "CB", "age": 17, "nationality": "France", "fga_rating": 73.0, "best_philosophy": "Wenger Development"}, {"name": "Eba Bekir Is", "profile_html": "Eba_Bekir_is.html", "position": "CM", "age": 17, "nationality": "Germany", "fga_rating": 73.0, "best_philosophy": "Guardiola Positional"}, {"name": "Bianneider Tamayo", "profile_html": "Bianneider_Tamayo.html", "position": "CB", "age": 20, "nationality": "Venezuela", "fga_rating": 73.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Angelo Candido", "profile_html": "Angelo_Candido.html", "position": "FB", "age": 17, "nationality": "Brazil", "fga_rating": 73.0, "best_philosophy": "Mourinho Warfare"}, {"name": "Nathan De Cat", "profile_html": "Nathan_De_Cat.html", "position": "AM", "age": 17, "nationality": "Belgium", "fga_rating": 73.0, "best_philosophy": "Guardiola Positional"}, {"name": "Gassimou Sylla", "profile_html": "Gassimou_Sylla.html", "position": "ST", "age": 17, "nationality": "Belgium", "fga_rating": 72.8, "best_philosophy": "Fontaine Attack"}, {"name": "Gabriel Biladi", "profile_html": "Gabriel_Biladi.html", "position": "WG", "age": 15, "nationality": "Belgium", "fga_rating": 72.5, "best_philosophy": "Wenger Development"}, {"name": "Damion Downs", "profile_html": "Damion_Downs.html", "position": "ST", "age": 21, "nationality": "USA / Germany", "fga_rating": 72.5, "best_philosophy": "Klopp Intensity"}, {"name": "Roberto Scaglione", "profile_html": "Roberto_Scaglione.html", "position": "CM", "age": 15, "nationality": "Italy", "fga_rating": 72.5, "best_philosophy": "Guardiola Positional"}, {"name": "Frankie Westfield", "profile_html": "Frankie_Westfield.html", "position": "FB", "age": 19, "nationality": "USA", "fga_rating": 72.0, "best_philosophy": "Guardiola Positional"}, {"name": "Nacho Ferri", "profile_html": "Nacho_Ferri.html", "position": "ST", "age": 21, "nationality": "Spain", "fga_rating": 72.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Mat√É¬≠as Satas", "profile_html": "Matias_Satas.html", "position": "CB", "age": 17, "nationality": "Argentina", "fga_rating": 72.0, "best_philosophy": "Bianchi Passion"}, {"name": "Alessio Marcaccini", "profile_html": "Alessio_Marcaccini.html", "position": "GK", "age": 17, "nationality": "Italy", "fga_rating": 71.5, "best_philosophy": "Yashin Revolution"}, {"name": "Mattis Seghers", "profile_html": "Mattis_Seghers.html", "position": "GK", "age": 15, "nationality": "Belgium", "fga_rating": 71.0, "best_philosophy": "Yashin Revolution"}, {"name": "Stephan Zagadou", "profile_html": "Stephan_Zagadou.html", "position": "CB", "age": 17, "nationality": "France", "fga_rating": 71.0, "best_philosophy": "Sacchi Pressing"}, {"name": "Amine Chiakha", "profile_html": "Amin_Chiakha.html", "position": "ST", "age": 19, "nationality": "Denmark", "fga_rating": 70.5, "best_philosophy": "Fontaine Attack"}, {"name": "Alessandro Milani", "profile_html": "Alessandro_Milani.html", "position": "FB", "age": 20, "nationality": "Venezuela / Italy", "fga_rating": 70.5, "best_philosophy": "Wenger Development"}, {"name": "Leon Jakirovic", "profile_html": "Leon_Jakirovic.html", "position": "Centre-Back", "age": 17, "nationality": "Croatia / Bosnia", "fga_rating": 70.5, "best_philosophy": "Guardiola Positional"}, {"name": "Wei Xiangxin", "profile_html": "Wei_Xiangxin.html", "position": "Striker", "age": 17, "nationality": "China", "fga_rating": 70.0, "best_philosophy": "Lewandowski Finisher"}, {"name": "Riku Gunji", "profile_html": "Riku_Gunji.html", "position": "ST", "age": 20, "nationality": "Japan", "fga_rating": 69.5, "best_philosophy": "Fontaine Attack"}, {"name": "Stiven Valencia", "profile_html": "Stiven_Valencia.html", "position": "CB", "age": 25, "nationality": "Colombia", "fga_rating": 68.5, "best_philosophy": "Herrera Catenaccio"}, {"name": "Antone Bossenberry", "profile_html": "Antone_Bossenberry.html", "position": "Attacking Midfielder", "age": 16, "nationality": "USA / Canada", "fga_rating": 68.5, "best_philosophy": "Menotti Artistry"}, {"name": "Yoann Beaka", "profile_html": "Yoann_Beaka.html", "position": "ST", "age": 22, "nationality": "France", "fga_rating": 68.0, "best_philosophy": "Fontaine Attack"}, {"name": "Asilbek Aliev", "profile_html": "Asilbek_Aliev.html", "position": "ST", "age": 16, "nationality": "Uzbekistan", "fga_rating": 68.0, "best_philosophy": "Fontaine Attack"}, {"name": "Sofian Domoraud", "profile_html": "Sofian_Domoraud.html", "position": "ST", "age": 29, "nationality": "France", "fga_rating": 68.0, "best_philosophy": "Fontaine Attack"}, {"name": "Roberth Pati√É¬±o", "profile_html": "Roberth_Pati√É¬±o.html", "position": "WG", "age": 20, "nationality": "Venezuela", "fga_rating": 68.0, "best_philosophy": "Fontaine Attack"}, {"name": "Julian Eyestone", "profile_html": "Julian_Eyestone.html", "position": "GK", "age": 19, "nationality": "USA / Germany", "fga_rating": 67.5, "best_philosophy": "Yashin Revolution"}, {"name": "Dominique Moubeke", "profile_html": "Dominique_Moubeke.html", "position": "CM", "age": 20, "nationality": "Cameroon", "fga_rating": 67.0, "best_philosophy": "Guardiola Positional"}, {"name": "Zinedine Zidane Bedoya", "profile_html": "Zidane_Bedoya.html", "position": "AM", "age": 25, "nationality": "Colombia", "fga_rating": 67.0, "best_philosophy": "Platini Elegance"}, {"name": "Neymar Uribe", "profile_html": "Neymar_Uribe.html", "position": "CB", "age": 21, "nationality": "Colombia", "fga_rating": 66.0, "best_philosophy": "Sacchi Pressing"}, {"name": "Oleksandr Piscsur (Pyshchur)", "profile_html": "Oleksandr_Piscsur.html", "position": "ST", "age": 20, "nationality": "Ukraine", "fga_rating": 66.0, "best_philosophy": "Mourinho Tactical"}, {"name": "Royer Caicedo", "profile_html": "Royer_Caicedo.html", "position": "CB", "age": 19, "nationality": "Colombia", "fga_rating": 64.0, "best_philosophy": "Wenger Development"}, {"name": "Rayan Jerbi", "profile_html": "Rayane_Jerbi.html", "position": "CB", "age": 19, "nationality": "Tunisia", "fga_rating": 64.0, "best_philosophy": "Guardiola Positional"}, {"name": "Facundo Sosa", "profile_html": "Facundo_Sosa.html", "position": "ST", "age": 22, "nationality": "Uruguay", "fga_rating": 63.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Juan Rojas", "profile_html": "Juan_Rojas.html", "position": "GK", "age": 17, "nationality": "USA / Venezuela", "fga_rating": 63.0, "best_philosophy": "Wenger Development"}, {"name": "Jimmy Kenyi", "profile_html": "Jimmy_Kenyi.html", "position": "CM", "age": 23, "nationality": "Norway", "fga_rating": 61.0, "best_philosophy": "Simeone Cholismo"}, {"name": "Walid Abdelali", "profile_html": "Walid_Abdelali.html", "position": "CM", "age": 32, "nationality": "France", "fga_rating": 60.0, "best_philosophy": "Guardiola Positional"}, {"name": "Malek Adrar", "profile_html": "Malek_Adrar.html", "position": "CM", "age": 21, "nationality": "France/Morocco", "fga_rating": 60.0, "best_philosophy": "Santana JogoBonito"}, {"name": "Filipe Aguiar", "profile_html": "Filipe_Aguiar.html", "position": "ST", "age": 26, "nationality": "Portugal", "fga_rating": 58.5, "best_philosophy": "Menotti Artistry"}, {"name": "Hannes Hunziker", "profile_html": "Hannes_Hunziker.html", "position": "CM", "age": 30, "nationality": "Switzerland", "fga_rating": 58.0, "best_philosophy": "Klopp Intensity"}];
                    console.log(`‚úÖ Loaded ${ratedPlayersData.length} FGA-rated players`);
                </script>
            </div>


            <!-- RATE NEW PLAYER TAB -->
            <div id="rate-new-tab" class="tab-content">
                <div class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 gradient-text">‚≠ê Rate New Player</h1>
                    <p class="text-xl text-slate-300">Complete Empire FGA Rating System (0-100)</p>
                    <p class="text-sm text-slate-400 mt-2">364 metrics ‚Ä¢ 3-tier system ‚Ä¢ 60-philosophy framework</p>
                </div>

                <form id="new-player-form" onsubmit="event.preventDefault(); calculateNewPlayerFGA();" class="space-y-6">
                    <!-- Basic Info -->
                    <div class="bg-slate-900/50 border border-blue-500/30 rounded-xl p-6">
                        <h2 class="text-2xl font-bold mb-4 text-blue-400">
                            <span class="inline-block px-3 py-1 bg-green-600 rounded text-xs font-bold mr-2">TIER 1</span> Player Information
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">Player Name *</label>
                                <input type="text" id="new-name" required class="w-full px-4 py-2 bg-slate-800 border border-slate-600 rounded text-white" placeholder="Duk">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">Position *</label>
                                <select id="new-position" required class="w-full px-4 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                                    <option value="">Select</option>
                                    <option value="GK">GK</option>
                                    <option value="FB">FB</option>
                                    <option value="CB">CB</option>
                                    <option value="DM">DM</option>
                                    <option value="CM">CM</option>
                                    <option value="AM">AM</option>
                                    <option value="WG">WG</option>
                                    <option value="ST">ST</option>
                                    <option value="FW">FW</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">Age *</label>
                                <input type="number" id="new-age" required min="16" max="45" class="w-full px-4 py-2 bg-slate-800 border border-slate-600 rounded text-white" placeholder="24">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">Nationality *</label>
                                <input type="text" id="new-nationality" required class="w-full px-4 py-2 bg-slate-800 border border-slate-600 rounded text-white" placeholder="Spain">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">Club *</label>
                                <input type="text" id="new-club" required class="w-full px-4 py-2 bg-slate-800 border border-slate-600 rounded text-white" placeholder="Real Madrid">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">League *</label>
                                <input type="text" id="new-league" required class="w-full px-4 py-2 bg-slate-800 border border-slate-600 rounded text-white" placeholder="La Liga">
                            </div>
                        </div>
                    </div>

                    <!-- Performance Stats -->
                    <div class="bg-slate-900/50 border border-blue-500/30 rounded-xl p-6">
                        <h2 class="text-2xl font-bold mb-4 text-blue-400">
                            <span class="inline-block px-3 py-1 bg-green-600 rounded text-xs font-bold mr-2">TIER 1</span> Performance Statistics
                        </h2>
                        <p class="text-sm text-slate-400 mb-4">From FBref or Sofascore. Leave 0 if unknown.</p>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            <div>
                                <label class="block text-xs font-bold text-slate-300 mb-1">Matches</label>
                                <input type="number" id="new-matches" value="0" min="0" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-300 mb-1">Minutes</label>
                                <input type="number" id="new-minutes" value="0" min="0" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-300 mb-1">Goals</label>
                                <input type="number" id="new-goals" value="0" min="0" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-300 mb-1">Assists</label>
                                <input type="number" id="new-assists" value="0" min="0" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-300 mb-1">Shots</label>
                                <input type="number" id="new-shots" value="0" min="0" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-300 mb-1">Shots on Target</label>
                                <input type="number" id="new-sot" value="0" min="0" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-300 mb-1">Key Passes</label>
                                <input type="number" id="new-key-passes" value="0" min="0" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-300 mb-1">Dribbles</label>
                                <input type="number" id="new-dribbles" value="0" min="0" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-300 mb-1">Tackles</label>
                                <input type="number" id="new-tackles" value="0" min="0" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-300 mb-1">Interceptions</label>
                                <input type="number" id="new-interceptions" value="0" min="0" class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                            </div>
                        </div>
                    </div>

                    <!-- Tier 3 Manual Metrics -->
                    <div class="bg-slate-900/50 border border-purple-500/30 rounded-xl p-6">
                        <h2 class="text-2xl font-bold mb-4 text-purple-400">
                            <span class="inline-block px-3 py-1 bg-purple-600 rounded text-xs font-bold mr-2">TIER 3</span> Expert Scout Assessment
                        </h2>
                        <p class="text-sm text-yellow-400 mb-4">‚ö†Ô∏è CRITICAL! Rate 0-10 based on observation. These cannot be automated.</p>
                        <div class="grid gap-4">

                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <span class="font-bold text-white">DECISION MAKING</span>
                                        <p class="text-xs text-slate-400">Quality of decisions in possession</p>
                                    </div>
                                    <span id="new-dma-val" class="text-xl font-bold text-blue-400 min-w-[50px] text-center">5.0</span>
                                </div>
                                <input type="range" id="new-dma" min="0" max="10" step="0.1" value="5.0" 
                                       oninput="document.getElementById('new-dma-val').textContent = this.value"
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>

                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <span class="font-bold text-white">CHARACTER</span>
                                        <p class="text-xs text-slate-400">Mental strength, leadership</p>
                                    </div>
                                    <span id="new-chr-val" class="text-xl font-bold text-blue-400 min-w-[50px] text-center">5.0</span>
                                </div>
                                <input type="range" id="new-chr" min="0" max="10" step="0.1" value="5.0" 
                                       oninput="document.getElementById('new-chr-val').textContent = this.value"
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>

                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <span class="font-bold text-white">MENTAL COMPETENCE</span>
                                        <p class="text-xs text-slate-400">Tactical intelligence, game reading</p>
                                    </div>
                                    <span id="new-mcs-val" class="text-xl font-bold text-blue-400 min-w-[50px] text-center">5.0</span>
                                </div>
                                <input type="range" id="new-mcs" min="0" max="10" step="0.1" value="5.0" 
                                       oninput="document.getElementById('new-mcs-val').textContent = this.value"
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>

                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <span class="font-bold text-white">SPEED ON ACTION</span>
                                        <p class="text-xs text-slate-400">Reaction time, first-touch</p>
                                    </div>
                                    <span id="new-soa-val" class="text-xl font-bold text-blue-400 min-w-[50px] text-center">5.0</span>
                                </div>
                                <input type="range" id="new-soa" min="0" max="10" step="0.1" value="5.0" 
                                       oninput="document.getElementById('new-soa-val').textContent = this.value"
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>

                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <span class="font-bold text-white">SPATIAL INTELLIGENCE</span>
                                        <p class="text-xs text-slate-400">Positioning, movement off ball</p>
                                    </div>
                                    <span id="new-spi-val" class="text-xl font-bold text-blue-400 min-w-[50px] text-center">5.0</span>
                                </div>
                                <input type="range" id="new-spi" min="0" max="10" step="0.1" value="5.0" 
                                       oninput="document.getElementById('new-spi-val').textContent = this.value"
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>

                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <span class="font-bold text-white">CALMNESS</span>
                                        <p class="text-xs text-slate-400">Composure under pressure</p>
                                    </div>
                                    <span id="new-clm-val" class="text-xl font-bold text-blue-400 min-w-[50px] text-center">5.0</span>
                                </div>
                                <input type="range" id="new-clm" min="0" max="10" step="0.1" value="5.0" 
                                       oninput="document.getElementById('new-clm-val').textContent = this.value"
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>

                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <span class="font-bold text-white">CLUTCH RESPONSE</span>
                                        <p class="text-xs text-slate-400">Performance in decisive moments</p>
                                    </div>
                                    <span id="new-crs-val" class="text-xl font-bold text-blue-400 min-w-[50px] text-center">5.0</span>
                                </div>
                                <input type="range" id="new-crs" min="0" max="10" step="0.1" value="5.0" 
                                       oninput="document.getElementById('new-crs-val').textContent = this.value"
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>

                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <span class="font-bold text-white">TRANSITION PLAY</span>
                                        <p class="text-xs text-slate-400">Effectiveness in transitions</p>
                                    </div>
                                    <span id="new-oms-val" class="text-xl font-bold text-blue-400 min-w-[50px] text-center">5.0</span>
                                </div>
                                <input type="range" id="new-oms" min="0" max="10" step="0.1" value="5.0" 
                                       oninput="document.getElementById('new-oms-val').textContent = this.value"
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>

                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <span class="font-bold text-white">SPRINT PERFORMANCE</span>
                                        <p class="text-xs text-slate-400">Maximum speed, acceleration</p>
                                    </div>
                                    <span id="new-spr-val" class="text-xl font-bold text-blue-400 min-w-[50px] text-center">5.0</span>
                                </div>
                                <input type="range" id="new-spr" min="0" max="10" step="0.1" value="5.0" 
                                       oninput="document.getElementById('new-spr-val').textContent = this.value"
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>

                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <span class="font-bold text-white">DYNAMISM</span>
                                        <p class="text-xs text-slate-400">Energy, work rate, stamina</p>
                                    </div>
                                    <span id="new-dyn-val" class="text-xl font-bold text-blue-400 min-w-[50px] text-center">5.0</span>
                                </div>
                                <input type="range" id="new-dyn" min="0" max="10" step="0.1" value="5.0" 
                                       oninput="document.getElementById('new-dyn-val').textContent = this.value"
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>

                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <div>
                                        <span class="font-bold text-white">CREATIVE RISK TAKING</span>
                                        <p class="text-xs text-slate-400">Willingness to attempt creative actions</p>
                                    </div>
                                    <span id="new-crk-val" class="text-xl font-bold text-blue-400 min-w-[50px] text-center">5.0</span>
                                </div>
                                <input type="range" id="new-crk" min="0" max="10" step="0.1" value="5.0" 
                                       oninput="document.getElementById('new-crk-val').textContent = this.value"
                                       class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>

                        </div>
                    </div>

                    <!-- Philosophy -->
                    <div class="bg-slate-900/50 border border-cyan-500/30 rounded-xl p-6">
                        <h2 class="text-2xl font-bold mb-4 text-cyan-400">Best Philosophy Match</h2>
                        <select id="new-philosophy" required class="w-full px-4 py-2 bg-slate-800 border border-slate-600 rounded text-white">
                            <option value="">Select Philosophy</option>
                            <option value="Cruyff Intelligence">Cruyff - Total Football</option>
                            <option value="Guardiola Positional">Guardiola - Positional Play</option>
                            <option value="Ferguson Mental">Ferguson - Mental Strength</option>
                            <option value="Mourinho Tactical">Mourinho - Tactical Flexibility</option>
                            <option value="Klopp Intensity">Klopp - High Pressing</option>
                            <option value="Simeone Intensity">Simeone - Defensive Intensity</option>
                            <option value="Menotti Artistry">Menotti - Creative Artistry</option>
                        </select>
                    </div>

                    <!-- Submit Button -->
                    <div class="text-center">
                        <button type="submit" class="px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-lg font-bold text-white text-lg shadow-lg transition">
                            ‚úÖ GENERATE FGA RATING
                        </button>
                    </div>
                </form>

                <!-- Results -->
                <div id="new-results" style="display:none;" class="mt-8">
                    <div class="bg-gradient-to-br from-green-900/30 to-emerald-900/30 border-2 border-green-500 rounded-xl p-8 text-center">
                        <div class="text-sm text-slate-400 mb-2">FINAL FGA RATING</div>
                        <div id="new-final-fga" class="text-7xl font-black text-green-400 mb-2">0.0</div>
                        <div id="new-final-tier" class="text-xl font-bold text-white">TIER</div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div class="text-sm text-slate-400">XPS</div>
                            <div id="new-calc-xps" class="text-2xl font-bold text-yellow-400">0.0</div>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div class="text-sm text-slate-400">KEY</div>
                            <div id="new-calc-key" class="text-2xl font-bold text-cyan-400">0.0</div>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div class="text-sm text-slate-400">MRK</div>
                            <div id="new-calc-mrk" class="text-2xl font-bold text-purple-400">0.0</div>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div class="text-sm text-slate-400">Tier 3 Avg</div>
                            <div id="new-calc-tier3" class="text-2xl font-bold text-purple-400">0.0</div>
                        </div>
                    </div>
                    <div class="flex gap-4 justify-center mt-6">
                        <button onclick="exportNewToCSV()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold text-white transition">
                            üìä EXPORT TO CSV
                        </button>
                        <button onclick="copyNewToClipboard()" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-bold text-white transition">
                            üìã COPY TO CLIPBOARD
                        </button>
                    </div>
                </div>
            </div>

    </div>

</div>

<!-- CSS STYLING (ESN BRAND COLORS: BLACK & GOLD) -->
<style>
    /* VARIABLES - CHANGE COLORS HERE IF NEEDED */
    :root {
        --esn-bg: #000000;          /* Deep Black Background */
        --esn-card-bg: #111111;     /* Slightly lighter for cards */
        --esn-gold: #C5A059;        /* Empire Gold Accent */
        --esn-gold-hover: #e0b86e;  /* Brighter Gold for hover */
        --esn-text: #ffffff;        /* White text */
        --esn-text-muted: #888888;  /* Grey text */
        --esn-border: #333333;      /* Subtle borders */
    }

    #esn-library-root {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        background-color: var(--esn-bg);
        color: var(--esn-text);
        padding: 40px;
        min-height: 100vh;
        box-sizing: border-box;
    }

    /* HEADER */
    .esn-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        border-bottom: 2px solid var(--esn-gold); /* Gold Line */
        padding-bottom: 20px;
        margin-bottom: 40px;
        flex-wrap: wrap;
        gap: 20px;
    }

    .esn-main-title {
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 2px;
        color: var(--esn-gold);
    }

    .esn-subtitle {
        margin: 5px 0 0 0;
        color: var(--esn-text-muted);
        font-size: 0.9rem;
    }

    /* SEARCH BAR */
    .esn-search-wrapper {
        position: relative;
        width: 100%;
        max-width: 350px;
    }

    #esn-search {
        width: 100%;
        padding: 12px 15px;
        padding-right: 40px;
        background: var(--esn-card-bg);
        border: 1px solid var(--esn-border);
        color: white;
        font-size: 1rem;
        border-radius: 4px;
        transition: border 0.3s;
    }

    #esn-search:focus {
        border-color: var(--esn-gold);
        outline: none;
    }

    .search-icon {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1rem;
    }

    /* GRID LAYOUT */
    #esn-grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 20px;
    }

    @media (max-width: 768px) {
        #esn-grid-container {
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        }
    }

    /* COUNTRY CARD */
    .esn-country-card {
        background: var(--esn-card-bg);
        border: 1px solid var(--esn-border);
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .esn-country-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 20px rgba(197, 160, 89, 0.3);
        border-color: var(--esn-gold);
    }

    .esn-flag {
        font-size: 3rem;
        margin-bottom: 12px;
    }

    .esn-country-name {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--esn-text);
        margin-bottom: 6px;
    }

    .esn-league-count {
        font-size: 0.85rem;
        color: var(--esn-gold);
    }

    /* MODAL OVERLAY */
    .esn-modal {
        display: none; /* Hidden by default */
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(5px);
    }

    .esn-modal-content {
        background-color: var(--esn-bg);
        margin: 5% auto;
        padding: 0;
        border: 1px solid var(--esn-border);
        width: 90%;
        max-width: 700px;
        border-radius: 8px;
        box-shadow: 0 8px 30px rgba(197, 160, 89, 0.4);
        max-height: 80vh;
        overflow-y: auto;
    }

    /* Modal Header */
    .esn-modal-header {
        background-color: var(--esn-card-bg);
        padding: 20px;
        border-bottom: 2px solid var(--esn-gold);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .esn-modal-header h3 {
        margin: 0;
        color: var(--esn-gold);
        font-size: 1.5rem;
        font-weight: 700;
    }

    .esn-close {
        color: var(--esn-gold);
        font-size: 2rem;
        font-weight: 700;
        cursor: pointer;
        transition: color 0.3s;
    }

    .esn-close:hover {
        color: var(--esn-gold-hover);
    }

    /* Link List */
    .esn-link-list {
        padding: 20px;
    }

    .esn-link-item {
        background: var(--esn-card-bg);
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 6px;
        border-left: 3px solid var(--esn-gold);
        transition: all 0.2s;
    }

    .esn-link-item:hover {
        background: #1a1a1a;
        transform: translateX(5px);
    }

    .esn-link-item a {
        color: var(--esn-gold);
        text-decoration: none;
        font-weight: 600;
        font-size: 1rem;
        display: block;
    }

    .esn-link-item a:hover {
        color: var(--esn-gold-hover);
    }
</style>

<!-- JAVASCRIPT CODE -->
<script>
    // DATA STRUCTURE: Country ‚Üí Leagues with links
    const countryData = [
        {
            name: "Argentina",
            flag: "üá¶üá∑",
            leagues: [
                { name: "Liga Profesional", url: "https://www.youtube.com/@FutbolDePrimeraSuscribite/videos" }
            ]
        },
        {
            name: "Australia",
            flag: "üá¶üá∫",
            leagues: [
                { name: "A-League", url: "https://www.youtube.com/@KeepUpAU/videos" }
            ]
        },
        {
            name: "Austria",
            flag: "üá¶üáπ",
            leagues: [
                { name: "Austrian Bundesliga", url: "https://www.youtube.com/@bundesliga_aut/videos" }
            ]
        },
        {
            name: "Belgium",
            flag: "üáßüá™",
            leagues: [
                { name: "Pro League", url: "https://www.youtube.com/@JupilerProLeague/videos" }
            ]
        },
        {
            name: "Brazil",
            flag: "üáßüá∑",
            leagues: [
                { name: "S√©rie A + Paulista", url: "https://www.youtube.com/@paulistao/videos" }
            ]
        },
        {
            name: "Chile",
            flag: "üá®üá±",
            leagues: [
                { name: "Primera Divisi√≥n", url: "https://www.youtube.com/@TNTSportsChile/videos" }
            ]
        },
        {
            name: "Czech Republic",
            flag: "üá®üáø",
            leagues: [
                { name: "Czech First League", url: "https://www.youtube.com/@fortunaliga/videos" }
            ]
        },
        {
            name: "Denmark",
            flag: "üá©üá∞",
            leagues: [
                { name: "Superliga + 1st Division", url: "https://www.youtube.com/@3sportdk/videos" }
            ]
        },
        {
            name: "England",
            flag: "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø",
            leagues: [
                { name: "Premier League", url: "https://www.youtube.com/@premierleague/videos" },
                { name: "Championship", url: "https://www.youtube.com/@skysportsfootball/videos" },
                { name: "League One + League Two", url: "https://www.youtube.com/@skysportsfootball/videos" }
            ]
        },
        {
            name: "France",
            flag: "üá´üá∑",
            leagues: [
                { name: "Ligue 1 + Ligue 2", url: "https://www.youtube.com/@Ligue1/videos" }
            ]
        },
        {
            name: "Germany",
            flag: "üá©üá™",
            leagues: [
                { name: "Bundesliga + 2.Bundesliga", url: "https://www.youtube.com/@bundesliga/videos" }
            ]
        },
        {
            name: "Greece",
            flag: "üá¨üá∑",
            leagues: [
                { name: "Super League", url: "https://www.youtube.com/@superleagregr/videos" }
            ]
        },
        {
            name: "Italy",
            flag: "üáÆüáπ",
            leagues: [
                { name: "Serie A", url: "https://www.youtube.com/@SerieA/videos" },
                { name: "Serie B", url: "https://www.youtube.com/@seriebkt/videos" }
            ]
        },
        {
            name: "Mexico",
            flag: "üá≤üáΩ",
            leagues: [
                { name: "Liga MX", url: "https://www.youtube.com/@LigaBBVAMX/videos" }
            ]
        },
        {
            name: "Netherlands",
            flag: "üá≥üá±",
            leagues: [
                { name: "Eredivisie", url: "https://www.youtube.com/@eredivisie/videos" },
                { name: "Eerste Divisie", url: "https://www.youtube.com/@keuken-kampioen-divisie/videos" }
            ]
        },
        {
            name: "Norway",
            flag: "üá≥üá¥",
            leagues: [
                { name: "Eliteserien", url: "https://www.youtube.com/@tv2sport/videos" }
            ]
        },
        {
            name: "Poland",
            flag: "üáµüá±",
            leagues: [
                { name: "Ekstraklasa", url: "https://www.youtube.com/@EkstraklasaOfficial/videos" }
            ]
        },
        {
            name: "Portugal",
            flag: "üáµüáπ",
            leagues: [
                { name: "Primeira Liga", url: "https://www.youtube.com/@ligaportugal/videos" }
            ]
        },
        {
            name: "Scotland",
            flag: "üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø",
            leagues: [
                { name: "Scottish Premiership", url: "https://www.youtube.com/@spfl/videos" }
            ]
        },
        {
            name: "Serbia",
            flag: "üá∑üá∏",
            leagues: [
                { name: "SuperLiga", url: "https://www.youtube.com/@SuperLiga/videos" }
            ]
        },
        {
            name: "Spain",
            flag: "üá™üá∏",
            leagues: [
                { name: "La Liga", url: "https://www.youtube.com/@laliga/videos" },
                { name: "Segunda Divisi√≥n", url: "https://www.youtube.com/@laligasmartbank/videos" }
            ]
        },
        {
            name: "Sweden",
            flag: "üá∏üá™",
            leagues: [
                { name: "Allsvenskan", url: "https://www.youtube.com/@allsvenskan/videos" }
            ]
        },
        {
            name: "Switzerland",
            flag: "üá®üá≠",
            leagues: [
                { name: "Super League", url: "https://www.youtube.com/@SuperLeague/videos" }
            ]
        },
        {
            name: "Turkey",
            flag: "üáπüá∑",
            leagues: [
                { name: "S√ºper Lig", url: "https://www.youtube.com/@superlig/videos" }
            ]
        },
        {
            name: "USA",
            flag: "üá∫üá∏",
            leagues: [
                { name: "MLS", url: "https://www.youtube.com/@mls/videos" }
            ]
        }
    ];

    // RENDER GRID OF COUNTRIES
    function renderGrid() {
        const container = document.getElementById('esn-grid-container');
        container.innerHTML = '';

        countryData.forEach(country => {
            const card = document.createElement('div');
            card.className = 'esn-country-card';
            card.dataset.countryName = country.name.toLowerCase(); // for search filtering

            card.innerHTML = `
                <div class="esn-flag">${country.flag}</div>
                <div class="esn-country-name">${country.name}</div>
                <div class="esn-league-count">${country.leagues.length} League${country.leagues.length > 1 ? 's' : ''}</div>
            `;

            card.onclick = () => openModal(country);
            container.appendChild(card);
        });
    }

    // OPEN MODAL WITH LEAGUE LINKS
    function openModal(country) {
        const modal = document.getElementById('esn-modal');
        const countryNameEl = document.getElementById('modal-country-name');
        const leaguesListEl = document.getElementById('modal-leagues-list');

        countryNameEl.innerHTML = `${country.flag} ${country.name}`;
        leaguesListEl.innerHTML = '';

        country.leagues.forEach(league => {
            const item = document.createElement('div');
            item.className = 'esn-link-item';
            item.innerHTML = `<a href="${league.url}" target="_blank">${league.name}</a>`;
            leaguesListEl.appendChild(item);
        });

        modal.style.display = 'block';
    }

    // CLOSE MODAL
    function closeModal() {
        document.getElementById('esn-modal').style.display = 'none';
    }

    // FILTER COUNTRIES VIA SEARCH
    function filterCountries() {
        const query = document.getElementById('esn-search').value.toLowerCase();
        const cards = document.querySelectorAll('.esn-country-card');

        cards.forEach(card => {
            const countryName = card.dataset.countryName;
            card.style.display = countryName.includes(query) ? 'block' : 'none';
        });
    }

    // Close modal if clicked outside content
    window.onclick = function(event) {
        const modal = document.getElementById('esn-modal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    };

    // Run
    renderGrid();
</script>
                </div>

                <!-- TOOL 2: AI INTEGRATION -->
                <div id="scouting-ai-integration" class="scouting-section hidden">
                    <div class="bg-gradient-to-r from-purple-900/30 to-slate-900/30 border border-purple-500/30 rounded-xl p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-4 text-purple-300">ü§ñ AI-Powered Video Analysis</h2>
                        <p class="text-slate-300 mb-6">Real-time computer vision for tactical intelligence, player tracking, and automated event detection</p>
                        
                        <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4 mb-6">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="text-2xl">‚ö†Ô∏è</div>
                                <h3 class="font-bold text-yellow-400">Coming Soon - Full Integration</h3>
                            </div>
                            <p class="text-sm text-slate-300">AI video analysis system is currently in development. Full integration scheduled for Q1 2026.</p>
                        </div>

                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="bg-slate-800/50 rounded-lg p-5 border border-purple-500/20">
                                <div class="text-3xl mb-3 text-center">üëÅÔ∏è</div>
                                <h4 class="font-bold mb-2 text-center">Object Detection</h4>
                                <ul class="text-sm text-slate-300 space-y-1">
                                    <li>‚Ä¢ Player tracking (22 players)</li>
                                    <li>‚Ä¢ Ball tracking</li>
                                    <li>‚Ä¢ Referee detection</li>
                                    <li>‚Ä¢ Formation analysis</li>
                                </ul>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-5 border border-purple-500/20">
                                <div class="text-3xl mb-3 text-center">‚ö°</div>
                                <h4 class="font-bold mb-2 text-center">Event Recognition</h4>
                                <ul class="text-sm text-slate-300 space-y-1">
                                    <li>‚Ä¢ Goals & assists</li>
                                    <li>‚Ä¢ Passes & crosses</li>
                                    <li>‚Ä¢ Tackles & interceptions</li>
                                    <li>‚Ä¢ Set pieces</li>
                                </ul>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-5 border border-purple-500/20">
                                <div class="text-3xl mb-3 text-center">üß†</div>
                                <h4 class="font-bold mb-2 text-center">Tactical Analysis</h4>
                                <ul class="text-sm text-slate-300 space-y-1">
                                    <li>‚Ä¢ Pressing patterns</li>
                                    <li>‚Ä¢ Space analysis</li>
                                    <li>‚Ä¢ Build-up phases</li>
                                    <li>‚Ä¢ Transition speed</li>
                                </ul>
                            </div>
                        </div>

                        <div class="mt-6 p-4 bg-blue-500/10 rounded-lg border border-blue-500/30">
                            <h4 class="font-semibold mb-2 text-blue-300">Technical Specifications:</h4>
                            <div class="grid md:grid-cols-2 gap-3 text-sm text-slate-300">
                                <div>‚Ä¢ Model: YOLOv8 + Custom Training</div>
                                <div>‚Ä¢ Processing: 25+ FPS real-time</div>
                                <div>‚Ä¢ Accuracy: 95%+ player detection</div>
                                <div>‚Ä¢ Integration: Wyscout/InStat compatible</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TOOL 3: DATA COLLECTION -->
                <div id="scouting-data-collection" class="scouting-section hidden">
                    <div class="bg-gradient-to-r from-green-900/30 to-slate-900/30 border border-green-500/30 rounded-xl p-6">
                        <h2 class="text-2xl font-bold mb-4 text-green-300">üìã Scout Data Collection Template</h2>
                        <p class="text-slate-300 mb-6">Comprehensive 779-metric system for professional scouting reports</p>

                        <!-- Template Overview -->
                        <div class="grid md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-slate-800/50 rounded-lg p-5 border border-green-500/20">
                                <h3 class="text-lg font-bold mb-3 text-green-400">Excel Workbook Structure</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">Worksheets:</span>
                                        <span class="font-bold text-white">18 sheets</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">Total Metrics:</span>
                                        <span class="font-bold text-white">779 metrics</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">Philosophy Scores:</span>
                                        <span class="font-bold text-white">60 frameworks</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">Auto-Calculated:</span>
                                        <span class="font-bold text-green-400">‚úì Yes</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-slate-800/50 rounded-lg p-5 border border-green-500/20">
                                <h3 class="text-lg font-bold mb-3 text-green-400">Key Features</h3>
                                <ul class="space-y-2 text-sm text-slate-300">
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Scout identification system</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Video source integration</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Data quality validation</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Auto-generated summary reports</li>
                                    <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> Player photos & highlights</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Worksheet Breakdown -->
                        <div class="bg-slate-800/50 rounded-lg p-5 border border-green-500/20 mb-6">
                            <h3 class="text-lg font-bold mb-4 text-white">18 Specialized Worksheets</h3>
                            <div class="grid md:grid-cols-3 gap-3 text-sm">
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">1. Scout Info</div>
                                    <div class="text-slate-400 text-xs">Scout identification</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">2. Player Basic</div>
                                    <div class="text-slate-400 text-xs">27 identification metrics</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">3. Foundation</div>
                                    <div class="text-slate-400 text-xs">41 foundation metrics</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">4. Core FGA</div>
                                    <div class="text-slate-400 text-xs">10 auto-calculated</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">5. Context System</div>
                                    <div class="text-slate-400 text-xs">26 context metrics</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">6. Philosophy Scores</div>
                                    <div class="text-slate-400 text-xs">60 frameworks</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">7. Sub-Components</div>
                                    <div class="text-slate-400 text-xs">240 components</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">8. Ultimate</div>
                                    <div class="text-slate-400 text-xs">26 integration metrics</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">9. Physical</div>
                                    <div class="text-slate-400 text-xs">17 attributes</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">10. Technical</div>
                                    <div class="text-slate-400 text-xs">26 skills</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">11. Goalkeeper</div>
                                    <div class="text-slate-400 text-xs">26 GK specialized</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">12. Tactical</div>
                                    <div class="text-slate-400 text-xs">26 awareness metrics</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">13. Crossing</div>
                                    <div class="text-slate-400 text-xs">26 delivery metrics</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">14. Creative</div>
                                    <div class="text-slate-400 text-xs">26 artistic metrics</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">15. Psychological</div>
                                    <div class="text-slate-400 text-xs">30 profile metrics</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">16. Relationships</div>
                                    <div class="text-slate-400 text-xs">20+ dynamics</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">17. Validation</div>
                                    <div class="text-slate-400 text-xs">Quality checklist</div>
                                </div>
                                <div class="bg-slate-900/50 rounded p-3">
                                    <div class="font-bold text-green-400 mb-1">18. Summary Report</div>
                                    <div class="text-slate-400 text-xs">Auto-generated</div>
                                </div>
                            </div>
                        </div>

                        <!-- Download Section -->
                        <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-5 text-center">
                            <h3 class="text-lg font-bold mb-3">üì• Download Template</h3>
                            <p class="text-sm text-slate-300 mb-4">Get the complete Excel template with all 779 metrics, formulas, and validation rules</p>
                            <button class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 px-8 py-3 rounded-lg font-bold transition">
                                <i class="fas fa-download mr-2"></i>Download Empire FGA Scout Template.xlsx
                            </button>
                            <div class="mt-3 text-xs text-slate-400">Version 1.0 | Last Updated: January 2025</div>
                        </div>
                    </div>
                </div>

                <!-- TOOL 4: INTELLIGENCE REPORT GENERATOR -->
                <div id="scouting-intelligence-report" class="scouting-section hidden">
                    <div class="bg-gradient-to-r from-orange-900/30 to-slate-900/30 border border-orange-500/30 rounded-xl p-6">
                        <h2 class="text-2xl font-bold mb-4 text-orange-300">üìä Strategic Intelligence Report Generator</h2>
                        <p class="text-slate-300 mb-6">Generate custom market intelligence reports for transfer windows and strategic planning</p>

                        <!-- Report Builder -->
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Club/Client</label>
                                    <input type="text" id="reportClub" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="e.g., RB Leipzig">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Transfer Window</label>
                                    <select id="reportWindow" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                        <option value="january-2026">January 2026</option>
                                        <option value="summer-2026">Summer 2026</option>
                                        <option value="january-2027">January 2027</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Primary Need</label>
                                    <select id="reportNeed" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                        <option value="striker">Striker</option>
                                        <option value="midfielder">Midfielder</option>
                                        <option value="defender">Defender</option>
                                        <option value="goalkeeper">Goalkeeper</option>
                                        <option value="multiple">Multiple Positions</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Budget Range (‚Ç¨M)</label>
                                    <input type="text" id="reportBudget" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2" placeholder="e.g., 30-50">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Current League</label>
                                    <select id="reportLeague" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
                                        <option value="bundesliga">Bundesliga</option>
                                        <option value="premier-league">Premier League</option>
                                        <option value="la-liga">La Liga</option>
                                        <option value="serie-a">Serie A</option>
                                        <option value="ligue-1">Ligue 1</option>
                                    </select>
                                </div>
                                <button onclick="generateIntelligenceReport()" class="w-full bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 px-6 py-3 rounded-lg font-bold transition">
                                    <i class="fas fa-file-alt mr-2"></i>Generate Report
                                </button>
                            </div>

                            <div class="bg-slate-800/50 rounded-lg p-5 border border-orange-500/20">
                                <h3 class="text-lg font-bold mb-3 text-orange-400">Report Includes:</h3>
                                <div class="space-y-3 text-sm">
                                    <div class="flex items-start gap-3">
                                        <div class="text-orange-400 mt-1">üìà</div>
                                        <div>
                                            <div class="font-semibold">Market Analysis</div>
                                            <div class="text-slate-400 text-xs">Current market trends and inefficiencies</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <div class="text-orange-400 mt-1">üéØ</div>
                                        <div>
                                            <div class="font-semibold">Target Profiles</div>
                                            <div class="text-slate-400 text-xs">Specific player recommendations with FGA scores</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <div class="text-orange-400 mt-1">üí∞</div>
                                        <div>
                                            <div class="font-semibold">Budget Allocation</div>
                                            <div class="text-slate-400 text-xs">Conservative, aggressive, and recommended scenarios</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <div class="text-orange-400 mt-1">‚ö°</div>
                                        <div>
                                            <div class="font-semibold">Execution Strategy</div>
                                            <div class="text-slate-400 text-xs">Week-by-week action plan with critical dates</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <div class="text-orange-400 mt-1">üîç</div>
                                        <div>
                                            <div class="font-semibold">Tactical Fit</div>
                                            <div class="text-slate-400 text-xs">60-Philosophy framework compatibility</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <div class="text-orange-400 mt-1">üìä</div>
                                        <div>
                                            <div class="font-semibold">Success Metrics</div>
                                            <div class="text-slate-400 text-xs">ROI projections and risk assessments</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Example Report Preview -->
                        <div class="mt-6 bg-slate-800/50 rounded-lg p-5 border border-orange-500/20">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-lg font-bold text-orange-400">üìÑ Example: RB Leipzig January 2026</h3>
                                <button class="text-sm bg-orange-600 hover:bg-orange-700 px-3 py-1 rounded transition">
                                    View Full Report
                                </button>
                            </div>
                            <div class="text-sm text-slate-300 space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-slate-400">Client:</span>
                                    <span class="font-bold">Alexander Neuherz, RB Leipzig</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-400">Window:</span>
                                    <span class="font-bold">January 2026</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-400">Primary Need:</span>
                                    <span class="font-bold">15-20 Goals (Striker)</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-400">Budget:</span>
                                    <span class="font-bold text-green-400">‚Ç¨45-50M recommended</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-400">Top Recommendation:</span>
                                    <span class="font-bold text-orange-400">Fisnik Asllani (Hoffenheim) ‚Ç¨18M</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                // Scouting Tool Sub-Tab Navigation
                function showScoutingTool(toolId, clickedButton) {
                    // Hide all scouting sections
                    document.querySelectorAll('.scouting-section').forEach(section => {
                        section.classList.add('hidden');
                    });
                    
                    // Remove active class from all tabs
                    document.querySelectorAll('.scouting-sub-tab').forEach(tab => {
                        tab.classList.remove('active', 'bg-blue-600');
                        tab.classList.add('bg-slate-800');
                    });
                    
                    // Show selected section
                    const targetSection = document.getElementById(`scouting-${toolId}`);
                    if (targetSection) {
                        targetSection.classList.remove('hidden');
                    }
                    
                    // Activate clicked tab
                    if (clickedButton) {
                        clickedButton.classList.add('active', 'bg-blue-600');
                        clickedButton.classList.remove('bg-slate-800');
                    }
                }

                // Generate Intelligence Report
                function generateIntelligenceReport() {
                    const club = document.getElementById('reportClub').value;
                    const window = document.getElementById('reportWindow').value;
                    const need = document.getElementById('reportNeed').value;
                    const budget = document.getElementById('reportBudget').value;
                    const league = document.getElementById('reportLeague').value;

                    if (!club || !budget) {
                        alert('Please fill in Club and Budget fields');
                        return;
                    }

                    // In real implementation, this would generate a comprehensive report
                    alert(`Generating Strategic Intelligence Report for ${club}...\n\nWindow: ${window}\nPrimary Need: ${need}\nBudget: ‚Ç¨${budget}M\nLeague: ${league}\n\nReport will be ready in 2-3 minutes.`);
                }
            </script>
    <script>
        // ==================== MARKET INTELLIGENCE FUNCTION (MUST BE FIRST!) ====================
        window.showMarketSection = function(sectionId, clickedButton) {
            console.log('üîç Switching to section:', sectionId);
            const sections = document.querySelectorAll('.market-section');
            sections.forEach(section => {
                section.classList.add('hidden');
                section.style.display = 'none';
            });
            document.querySelectorAll('.market-sub-tab').forEach(tab => {
                tab.classList.remove('active', 'bg-blue-600');
                tab.classList.add('bg-slate-800');
            });
            const targetSection = document.getElementById(`market-${sectionId}`);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                targetSection.style.display = 'block';
                console.log('‚úÖ Showing section:', `market-${sectionId}`);
            } else {
                console.error('‚ùå Section not found:', `market-${sectionId}`);
            }
            if (clickedButton) {
                clickedButton.classList.add('active', 'bg-blue-600');
                clickedButton.classList.remove('bg-slate-800');
            }
        };

        // LOAD FULL PLAYER DATA FROM YOUR DATABASE
        // This section will be replaced with the complete 521-player array
        let playerData = [];

// LOAD DATABASE
fetch('complete_player_database.json')
    .then(response => response.json())
    .then(data => {
        console.log('‚úÖ Loading', data.length, 'players...');
        
        // Convert optimized format to full format
        playerData = data.map(p => ({
            name: p.name || 'Unknown',
            position: p.pos || 'N/A',
            nationality: p.nat || 'Unknown',
            age: p.age || null,
            club: p.club || 'Unknown',
            fga_rating: p.fga || null,
            has_fga_rating: p.rated || false,
            height: p.h || null,
            foot: p.ft || null,
            agent: p.ag || null,
            contract_expires: p.con || null,
            is_eu: p.eu !== undefined ? p.eu : null,
            tier: p.rated ? 'FGA Rated' : 'Profile',
            filename: p.file || null,
            profileHtml: p.file || null
        }));
        
        console.log('‚úÖ LOADED', playerData.length, 'PLAYERS!');
        console.log('   üìä FGA-Rated:', playerData.filter(p => p.has_fga_rating).length);
        console.log('   üìã Profile-Only:', playerData.filter(p => !p.has_fga_rating).length);
        
        // Convert to platform format
        // Country code mapping
        const countryCodeMap = {
            'ITA': 'Italy', 'ESP': 'Spain', 'FRA': 'France', 'GER': 'Germany', 'ENG': 'England',
            'BRA': 'Brazil', 'ARG': 'Argentina', 'NED': 'Netherlands', 'POR': 'Portugal',
            'SRB': 'Serbia', 'SEN': 'Senegal', 'CRO': 'Croatia', 'IRL': 'Ireland',
            'DEN': 'Denmark', 'SCO': 'Scotland', 'BEL': 'Belgium', 'URU': 'Uruguay',
            'POL': 'Poland', 'MAR': 'Morocco', 'SWE': 'Sweden', 'SUI': 'Switzerland',
            'NGA': 'Nigeria', 'CIV': 'Ivory Coast', 'CMR': 'Cameroon', 'GHA': 'Ghana',
            'ALG': 'Algeria', 'NOR': 'Norway', 'USA': 'United States', 'AUT': 'Austria',
            'CZE': 'Czech Republic', 'TUR': 'Turkey', 'GRE': 'Greece', 'MEX': 'Mexico',
            'CHI': 'Chile', 'COL': 'Colombia', 'JPN': 'Japan', 'KOR': 'South Korea',
            'WAL': 'Wales', 'NZL': 'New Zealand', 'AUS': 'Australia', 'RSA': 'South Africa',
            'EGY': 'Egypt', 'TUN': 'Tunisia', 'ISR': 'Israel', 'PAR': 'Paraguay',
            'VEN': 'Venezuela', 'ECU': 'Ecuador', 'PER': 'Peru', 'BOL': 'Bolivia',
            'CAN': 'Canada', 'CRC': 'Costa Rica', 'JAM': 'Jamaica', 'MLI': 'Mali',
            'BFA': 'Burkina Faso', 'GUI': 'Guinea', 'CGO': 'Congo', 'GAB': 'Gabon',
            'ANG': 'Angola', 'ZIM': 'Zimbabwe', 'UGA': 'Uganda', 'KEN': 'Kenya',
            'RUS': 'Russia', 'UKR': 'Ukraine', 'HUN': 'Hungary', 'ROU': 'Romania',
            'SVK': 'Slovakia', 'SVN': 'Slovenia', 'BUL': 'Bulgaria', 'NIR': 'Northern Ireland',
            'FIN': 'Finland', 'ISL': 'Iceland', 'ALB': 'Albania', 'MKD': 'North Macedonia',
            'BIH': 'Bosnia and Herzegovina', 'MNE': 'Montenegro', 'KVX': 'Kosovo'
        };
        
        // Reverse mapping (full name to code)
        const countryNameToCode = {};
        for (let code in countryCodeMap) {
            countryNameToCode[countryCodeMap[code]] = code;
        }
        
        playerData = playerData.map(p => {
            // Extract nationality from position string
            let nationality = p.nationality || '';
            let age = p.age;
            let currentClub = p.club || '';
            
            // Position string format: "Striker ¬∑ Norway ¬∑ Born: 21 July 2000 ¬∑ Height: 1.95 m"
            const positionStr = p.position || '';
            
            // Extract nationality (between first and second ¬∑)
            if (!nationality || nationality === 'Unknown' || nationality === '' || /^\d+\.?\d*$/.test(nationality)) {
                const natMatch = positionStr.match(/¬∑\s*([A-Za-z\s]+)\s*¬∑\s*Born:/i);
                if (natMatch) {
                    nationality = natMatch[1].trim();
                }
            }
            
            // Convert 3-letter code to full name
            if (nationality && nationality.length === 3 && countryCodeMap[nationality.toUpperCase()]) {
                nationality = countryCodeMap[nationality.toUpperCase()];
            }
            
            // Extract age from birth date if age is null
            if (!age || age === null) {
                const birthMatch = positionStr.match(/Born:\s*(\d+)\s+(\w+)\s+(\d{4})/i);
                if (birthMatch) {
                    const birthYear = parseInt(birthMatch[3]);
                    const currentYear = new Date().getFullYear();
                    age = currentYear - birthYear;
                }
            }
            
            // Fix club - if it's "Legend" but player has age < 40, it's wrong
            if (currentClub === 'Legend' && age && age < 40) {
                // Try to extract club from position or other fields
                // For now, mark as "Active Player" to indicate data needs update
                currentClub = 'Active Player';
            } else if (currentClub === 'Legend') {
                currentClub = 'Retired/Legend';
            }
            
            return {
                name: p.name || '',
                player_id: p.player_id || null,
                image_url: p.image_url || '',
                profileHtml: p.filename || p.profileHtml || '',
                position: p.position || '',
                age: age,
                nationality: nationality || 'Unknown',
                fga_rating: p.fga_rating || 0,
                has_fga_rating: p.has_fga_rating || false,
                bestPhilosophy: p.top_philosophy || p.bestPhilosophy || '',
                agent: p.agent || '',
                agentCompany: p.agentCompany || '',
                currentClub: currentClub,
                height: p.height || null,
                foot: p.foot || null,
                contract_expires: p.contract_expires || null,
                is_eu: p.is_eu,
                tier: p.tier || (p.has_fga_rating ? 'FGA Rated' : 'Profile')
            };
        });
        
        console.log('‚úÖ LOADED', playerData.length, 'PLAYERS!');
        
        // Log extraction results
        const extractedAges = playerData.filter(p => p.age !== null).length;
        const extractedNationalities = playerData.filter(p => p.nationality && p.nationality !== 'Unknown').length;
        console.log('üìä Extraction results:');
        console.log('   Ages extracted:', extractedAges, '/', playerData.length);
        console.log('   Nationalities extracted:', extractedNationalities, '/', playerData.length);
        
        // Update stats display
        const legends = playerData.filter(p => p.fga_rating >= 90).length;
        const elite = playerData.filter(p => p.fga_rating >= 85).length;
        const avgFga = (playerData.reduce((sum, p) => sum + (p.fga_rating || 0), 0) / playerData.length).toFixed(1);
        
        document.getElementById('stat-total').textContent = playerData.length.toLocaleString();
        document.getElementById('stat-avg-fga').textContent = avgFga;
        document.getElementById('stat-legends').textContent = legends;
        document.getElementById('stat-elite').textContent = elite;
        document.getElementById('stat-showing').textContent = '0';
        
        console.log('üìä Stats updated:', playerData.length, 'total,', legends, 'legends');
        
        // Populate nationality dropdown
        const nationalities = [...new Set(playerData.map(p => p.nationality).filter(n => n && n !== 'Unknown'))].sort();
        const nationalitySelect = document.getElementById('nationality-filter');
        if (nationalitySelect) {
            nationalities.forEach(nat => {
                const option = document.createElement('option');
                option.value = nat;
                option.textContent = nat;
                nationalitySelect.appendChild(option);
            });
            console.log('üìã Populated', nationalities.length, 'nationalities');
        }
        
        // Initialize export count
        if (document.getElementById('export-count')) {
            document.getElementById('export-count').textContent = playerData.length.toLocaleString();
        }
        
        // Initialize display
        if (typeof applyFilters === 'function') {
            console.log('üéØ Calling applyFilters...');
            applyFilters();
        }
        if (typeof renderGrid === 'function') {
            console.log('üéØ Calling renderGrid...');
            renderGrid();
        }
    })
    .catch(error => {
        console.error('‚ùå DATABASE ERROR:', error);
        alert('Upload complete_player_database.json to GitHub!');
    });


        // DEBUG LOGGING
        console.log('====== PAGE LOADED ======');
        console.log('Script loaded at:', new Date().toISOString());
        console.log('playerData exists:', typeof playerData !== 'undefined');
        console.log('playerData length:', playerData ? playerData.length : 'UNDEFINED');
        
        
        // State variables
        let selectedComparePlayers = [];
        let selectedSquadPlayers = [];
        let squadPositions = {}; // Track which position each player is assigned to
        let currentFormation = '4-3-3';
        let filteredPlayers = [...playerData]; // Initialize with all data
        let currentPage = 1;
        let playersPerPage = 25;
        let currentSortColumn = 'fga';
        let currentSortOrder = 'desc';

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            const targetTab = document.getElementById(tabName + '-tab');
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // Find and activate the clicked button
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => {
                if (btn.textContent.includes(getTabLabel(tabName))) {
                    btn.classList.add('active');
                }
            });
            
            if (tabName === 'philosophy') {
                renderPhilosophyHeatmap();
            } else if (tabName === 'market') {
                renderMarketIntelligence();
            } else if (tabName === 'squad') {
                initializeSquadBuilder();
            } else if (tabName === 'rated-players') {
                // Initialize rated players search
                if (typeof searchRatedPlayers === 'function') {
                    setTimeout(() => searchRatedPlayers(), 100);
                }
            }
        }
        
        function getTabLabel(tabName) {
            const labels = {
                'database': 'Player Database',
                'comparison': 'Compare Players',
                'market': 'Market Intelligence',
                'philosophy': 'Philosophy Heatmap',
                'squad': 'Squad Builder',
                'agents': 'Scout Network',
                'rated-players': 'Rated Players',
                'rate-new': 'Rate New Player'
            };
            return labels[tabName] || '';
        }

        // DATABASE FUNCTIONS
        function quickFilter(type) {
            // Remove active class from all pills
            document.querySelectorAll('.filter-pill').forEach(pill => pill.classList.remove('active'));
            event.target.classList.add('active');
            
            switch(type) {
                case 'legends':
                    filteredPlayers = playerData.filter(p => p.fga_rating >= 90);
                    break;
                case 'elite':
                    filteredPlayers = playerData.filter(p => p.fga_rating >= 85 && p.fga_rating < 90);
                    break;
                case 'prospects':
                    filteredPlayers = playerData.filter(p => p.age && p.age <= 21);
                    break;
                case 'active':
                    filteredPlayers = playerData.filter(p => !p.age || p.age <= 38);
                    break;
                case 'strikers':
                    filteredPlayers = playerData.filter(p => {
                        const pos = (p.position || '').toUpperCase();
                        return pos.includes('STRIKER') || pos.includes('ST') || 
                               pos.includes('FORWARD') || pos.includes('FW') ||
                               pos.includes('CF') || pos.includes('ATTACKER');
                    });
                    break;
                case 'midfielders':
                    filteredPlayers = playerData.filter(p => {
                        const pos = (p.position || '').toUpperCase();
                        return pos.includes('MIDFIELD') || pos.includes('CM') || 
                               pos.includes('AM') || pos.includes('DM') ||
                               pos.includes('CAM') || pos.includes('CDM');
                    });
                    break;
                case 'defenders':
                    filteredPlayers = playerData.filter(p => {
                        const pos = (p.position || '').toUpperCase();
                        return pos.includes('DEFENDER') || pos.includes('CB') || 
                               pos.includes('FB') || pos.includes('LB') || pos.includes('RB') ||
                               pos.includes('BACK') || pos.includes('DF');
                    });
                    break;
                case 'goalkeepers':
                    filteredPlayers = playerData.filter(p => {
                        const pos = (p.position || '').toUpperCase();
                        return pos.includes('GOALKEEPER') || pos.includes('GK') || 
                               pos.includes('KEEPER');
                    });
                    break;
                
                // League Filters
                case 'premier-league':
                    filteredPlayers = playerData.filter(p => {
                        const club = (p.currentClub || p.club || '').toLowerCase();
                        return club.includes('manchester') || club.includes('liverpool') || 
                               club.includes('arsenal') || club.includes('chelsea') ||
                               club.includes('tottenham') || club.includes('city') || 
                               club.includes('united') || club.includes('newcastle') ||
                               club.includes('aston villa') || club.includes('brighton') ||
                               club.includes('west ham') || club.includes('everton') ||
                               club.includes('crystal palace') || club.includes('brentford') ||
                               club.includes('fulham') || club.includes('wolves') ||
                               club.includes('bournemouth') || club.includes('nottingham') ||
                               club.includes('luton') || club.includes('burnley') ||
                               club.includes('sheffield');
                    });
                    break;
                case 'la-liga':
                    filteredPlayers = playerData.filter(p => {
                        const club = (p.currentClub || p.club || '').toLowerCase();
                        return club.includes('barcelona') || club.includes('real madrid') ||
                               club.includes('atletico') || club.includes('sevilla') ||
                               club.includes('valencia') || club.includes('athletic') ||
                               club.includes('villarreal') || club.includes('betis') ||
                               club.includes('sociedad') || club.includes('celta') ||
                               club.includes('espanyol') || club.includes('getafe') ||
                               club.includes('osasuna') || club.includes('girona') ||
                               club.includes('mallorca') || club.includes('alaves') ||
                               club.includes('almeria') || club.includes('cadiz') ||
                               club.includes('granada') || club.includes('rayo');
                    });
                    break;
                case 'bundesliga':
                    filteredPlayers = playerData.filter(p => {
                        const club = (p.currentClub || p.club || '').toLowerCase();
                        return club.includes('bayern') || club.includes('dortmund') ||
                               club.includes('leipzig') || club.includes('leverkusen') ||
                               club.includes('frankfurt') || club.includes('wolfsburg') ||
                               club.includes('freiburg') || club.includes('union berlin') ||
                               club.includes('gladbach') || club.includes('hoffenheim') ||
                               club.includes('stuttgart') || club.includes('mainz') ||
                               club.includes('augsburg') || club.includes('bremen') ||
                               club.includes('bochum') || club.includes('heidenheim') ||
                               club.includes('darmstadt') || club.includes('cologne');
                    });
                    break;
                case 'serie-a':
                    filteredPlayers = playerData.filter(p => {
                        const club = (p.currentClub || p.club || '').toLowerCase();
                        return club.includes('juventus') || club.includes('inter') ||
                               club.includes('milan') || club.includes('napoli') ||
                               club.includes('roma') || club.includes('lazio') ||
                               club.includes('atalanta') || club.includes('fiorentina') ||
                               club.includes('torino') || club.includes('bologna') ||
                               club.includes('udinese') || club.includes('sassuolo') ||
                               club.includes('monza') || club.includes('empoli') ||
                               club.includes('lecce') || club.includes('cagliari') ||
                               club.includes('verona') || club.includes('genoa') ||
                               club.includes('salernitana') || club.includes('frosinone');
                    });
                    break;
                case 'ligue-1':
                    filteredPlayers = playerData.filter(p => {
                        const club = (p.currentClub || p.club || '').toLowerCase();
                        return club.includes('psg') || club.includes('paris') ||
                               club.includes('marseille') || club.includes('monaco') ||
                               club.includes('lyon') || club.includes('lille') ||
                               club.includes('nice') || club.includes('lens') ||
                               club.includes('rennes') || club.includes('montpellier') ||
                               club.includes('nantes') || club.includes('strasbourg') ||
                               club.includes('brest') || club.includes('reims') ||
                               club.includes('toulouse') || club.includes('le havre') ||
                               club.includes('lorient') || club.includes('metz');
                    });
                    break;
                
                // Agency Filters
                case 'prosport':
                    filteredPlayers = playerData.filter(p => 
                        (p.agentCompany || '').toLowerCase().includes('prosport')
                    );
                    break;
                case 'vulpes':
                    filteredPlayers = playerData.filter(p => 
                        (p.agentCompany || '').toLowerCase().includes('vulpes')
                    );
                    break;
                case 'bks':
                    filteredPlayers = playerData.filter(p => 
                        (p.agentCompany || '').toLowerCase().includes('bks')
                    );
                    break;
                
                default:
                    filteredPlayers = [...playerData];
            }
            currentPage = 1;
            updateStats();
            renderTable();
        }

        function filterAndRender() {
            const search = document.getElementById('search-name').value.toLowerCase();
            const ageMin = parseInt(document.getElementById('age-min')?.value) || 0;
            const ageMax = parseInt(document.getElementById('age-max')?.value) || 999;
            const fgaMin = parseFloat(document.getElementById('fga-min')?.value) || 0;
            const fgaMax = parseFloat(document.getElementById('fga-max')?.value) || 100;
            const nationality = document.getElementById('nationality-filter')?.value || '';
            const agency = document.getElementById('agency-filter')?.value || '';
            
            filteredPlayers = playerData.filter(p => {
                // Name search
                if (search && !p.name.toLowerCase().includes(search)) return false;
                
                // Age range - only filter if age exists and is not null
                if (p.age !== null && p.age !== undefined) {
                    if (p.age < ageMin || p.age > ageMax) return false;
                } else {
                    // If age is null/undefined, only exclude if user set specific age range
                    if (ageMin > 0 || ageMax < 999) {
                        // User wants specific age range but player has no age - exclude
                        return false;
                    }
                }
                
                // FGA range - only check if player has FGA rating
                if (p.has_fga_rating && p.fga_rating !== null) {
                    if (p.fga_rating < fgaMin || p.fga_rating > fgaMax) return false;
                } else {
                    // Player has no FGA rating
                    // Only exclude if user specifically wants rated players (fgaMin > 0)
                    if (fgaMin > 0) return false;
                }
                
                // Nationality
                if (nationality && nationality !== 'All Countries' && (p.nationality || '').toLowerCase() !== nationality.toLowerCase()) return false;
                
                // Agency
                if (agency && !(p.agentCompany || '').includes(agency)) return false;
                
                return true;
            });
            
            currentPage = 1;
            updateStats();
            renderTable();
            
            // Update export count
            if (document.getElementById('export-count')) {
                document.getElementById('export-count').textContent = filteredPlayers.length;
            }
            
            console.log('üîç Filter applied:', filteredPlayers.length, 'players shown');
        }
        
        function resetAdvancedSearch() {
            document.getElementById('search-name').value = '';
            if (document.getElementById('age-min')) document.getElementById('age-min').value = '';
            if (document.getElementById('age-max')) document.getElementById('age-max').value = '';
            if (document.getElementById('fga-min')) document.getElementById('fga-min').value = '';
            if (document.getElementById('fga-max')) document.getElementById('fga-max').value = '';
            if (document.getElementById('nationality-filter')) document.getElementById('nationality-filter').value = '';
            if (document.getElementById('agency-filter')) document.getElementById('agency-filter').value = '';
            
            // Reset to all players
            filteredPlayers = [...playerData];
            currentPage = 1;
            
            // Remove active from all pills except "All Players"
            document.querySelectorAll('.filter-pill').forEach(pill => pill.classList.remove('active'));
            document.querySelector('.filter-pill').classList.add('active');
            
            updateStats();
            renderTable();
        }
        
        function exportToCSV() {
            if (filteredPlayers.length === 0) {
                alert('No players to export! Apply filters first.');
                return;
            }
            
            console.log('üìä Exporting', filteredPlayers.length, 'players to CSV...');
            
            // CSV header
            let csv = 'Player Name,Position,Age,Current Club,Nationality,FGA Rating,Top Philosophy,Agency,Status\n';
            
            // CSV data
            filteredPlayers.forEach(player => {
                const row = [
                    player.name || '',
                    (player.position || '').replace(/,/g, ';'),
                    player.age || 'N/A',
                    (player.currentClub || 'Unknown').replace(/,/g, ';'),
                    player.nationality || 'Unknown',
                    player.fga_rating ? player.fga_rating.toFixed(1) : '0.0',
                    (player.bestPhilosophy || 'Unknown').replace(/,/g, ';'),
                    (player.agentCompany || 'Unknown').replace(/,/g, ';'),
                    player.profileHtml && player.profileHtml !== '' ? 'Premium' : 'Basic'
                ];
                csv += row.join(',') + '\n';
            });
            
            // Download
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Empire_FGA_Players_${filteredPlayers.length}_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            console.log('‚úÖ CSV exported:', filteredPlayers.length, 'players');
            alert(`‚úÖ Exported ${filteredPlayers.length} players to CSV!`);
        }
        
        function exportFilteredPDFs() {
            const premiumPlayers = filteredPlayers.filter(p => p.profileHtml && p.profileHtml !== '');
            
            if (premiumPlayers.length === 0) {
                alert('No premium profiles in filtered results! Try filtering for Legends or Elite players.');
                return;
            }
            
            if (premiumPlayers.length > 50) {
                if (!confirm(`This will attempt to open ${premiumPlayers.length} profile pages. This might be slow. Continue?`)) {
                    return;
                }
            }
            
            console.log('üìÑ Opening', premiumPlayers.length, 'premium profiles...');
            
            premiumPlayers.slice(0, 50).forEach((player, index) => {
                setTimeout(() => {
                    window.open(player.profileHtml, '_blank');
                }, index * 500); // 500ms delay between each
            });
            
            alert(`‚úÖ Opening ${Math.min(premiumPlayers.length, 50)} premium profiles!\n\nYou can print each page as PDF (Ctrl+P ‚Üí Save as PDF)`);
        }
        
        function requestAnalysis(playerName) {
            alert(`üìß Request Full Analysis for ${playerName}\n\nTo request a full 779-metric FGA analysis:\n\n1. Email: info@empirescoutingnetwork.com\n2. Subject: "Full Analysis Request - ${playerName}"\n3. We'll send the complete profile within 24-48 hours!\n\nüí∞ First 3 requests FREE during trial period!`);
            
            console.log('üìß Analysis requested for:', playerName);
        }

        function sortTable(column) {
            if (currentSortColumn === column) {
                currentSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortOrder = 'desc';
            }
            
            filteredPlayers.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (currentSortOrder === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('database-table-body');
            const start = (currentPage - 1) * playersPerPage;
            const end = start + playersPerPage;
            const pageData = filteredPlayers.slice(start, end);
            
            tbody.innerHTML = pageData.map(player => {
                // Get player image URL
                const imageUrl = player.player_image_url || player.image_url || 
                                (player.player_id ? `https://img.a.transfermarkt.technology/portrait/big/${player.player_id}.jpg` : null);
                
                // Get player initials for fallback
                const nameParts = (player.name || '').trim().split(' ').filter(p => p.length > 0);
                const initials = nameParts.length === 0 ? '‚öΩ' : 
                                nameParts.length === 1 ? nameParts[0].substring(0, 2).toUpperCase() :
                                (nameParts[0][0] + nameParts[nameParts.length - 1][0]).toUpperCase();
                
                // Create avatar HTML
                let avatarHtml;
                if (imageUrl && imageUrl !== 'null') {
                    avatarHtml = `
                        <img 
                            src="${imageUrl}" 
                            alt="${player.name}"
                            class="player-avatar-small"
                            onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-flex';"
                            loading="lazy"
                        />
                        <div class="player-avatar-placeholder" style="display:none;">
                            ${initials}
                        </div>
                    `;
                } else {
                    avatarHtml = `
                        <div class="player-avatar-placeholder">
                            ${initials}
                        </div>
                    `;
                }
                
                return `
                    <tr class="hover:bg-slate-800/50 transition">
                        <td class="py-3">
                            <div class="player-name-cell">
                                ${avatarHtml}
                                <a href="${player.profileHtml}" target="_blank" class="text-blue-400 hover:text-blue-300 font-semibold">
                                    ${player.name}
                                </a>
                            </div>
                        </td>
                        <td class="py-3">${player.position}</td>
                        <td class="py-3">${player.age || 'N/A'}</td>
                        <td class="py-3"><span class="text-sm">${player.currentClub || 'Unknown'}</span></td>
                        <td class="py-3">${player.nationality || 'Unknown'}</td>
                        <td class="py-3"><span class="font-bold text-blue-400">${player.fga_rating ? player.fga_rating.toFixed(1) : '0.0'}</span></td>
                        <td class="py-3 text-sm">${player.bestPhilosophy || 'Unknown'}</td>
                        <td class="py-3">
                            ${player.profileHtml && player.profileHtml !== '' ? 
                                '<span class="px-2 py-1 bg-green-600/20 text-green-400 rounded text-xs font-semibold">‚úì Premium</span>' : 
                                '<span class="px-2 py-1 bg-slate-600/20 text-slate-400 rounded text-xs">Basic</span>'
                            }
                        </td>
                        <td class="py-3">
                            <div class="flex gap-2">
                                ${player.profileHtml && player.profileHtml !== '' ?
                                    `<a href="${player.profileHtml}" target="_blank" class="text-xs bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded transition">View Profile</a>` :
                                    `<button onclick="requestAnalysis('${player.name.replace(/'/g, "\\'")}')" class="text-xs bg-yellow-600 hover:bg-yellow-700 px-3 py-1 rounded transition">Request</button>`
                                }
                                <button onclick="addToComparison('${player.name.replace(/'/g, "\\'")}')" class="text-xs bg-slate-600 hover:bg-slate-700 px-3 py-1 rounded transition">
                                    Compare
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('stat-showing').textContent = pageData.length;
            updatePagination();
        }

        function updatePagination() {
            const container = document.getElementById('pagination-container');
            const totalPages = Math.ceil(filteredPlayers.length / playersPerPage);
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // Previous button
            html += `<button class="pagination-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                ‚Üê Previous
            </button>`;
            
            // Page numbers
            const maxVisible = 7;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);
            
            if (endPage - startPage < maxVisible - 1) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }
            
            if (startPage > 1) {
                html += `<button class="pagination-btn" onclick="changePage(1)">1</button>`;
                if (startPage > 2) html += `<span class="px-2 text-slate-400">...</span>`;
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                    ${i}
                </button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span class="px-2 text-slate-400">...</span>`;
                html += `<button class="pagination-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
            }
            
            // Next button
            html += `<button class="pagination-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                Next ‚Üí
            </button>`;
            
            container.innerHTML = html;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredPlayers.length / playersPerPage);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            renderTable();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateStats() {
            console.log('updateStats called');
            console.log('  playerData.length:', playerData.length);
            console.log('  filteredPlayers.length:', filteredPlayers.length);
            
            document.getElementById('stat-total').textContent = playerData.length;
            
            // Calculate tier counts
            const fgaRated = filteredPlayers.filter(p => p.has_fga_rating).length;
            const profileOnly = filteredPlayers.filter(p => !p.has_fga_rating).length;
            
            // Update tier counts
            const fgaCountEl = document.getElementById('fga-rated-count');
            const profileCountEl = document.getElementById('profile-only-count');
            if (fgaCountEl) fgaCountEl.textContent = fgaRated;
            if (profileCountEl) profileCountEl.textContent = profileOnly;
            
            // Calculate average FGA (only for rated players)
            const ratedPlayers = filteredPlayers.filter(p => p.has_fga_rating && p.fga_rating);
            const avgFga = ratedPlayers.length > 0 
                ? (ratedPlayers.reduce((sum, p) => sum + (p.fga_rating || 0), 0) / ratedPlayers.length).toFixed(1)
                : '0.0';
            document.getElementById('stat-avg-fga').textContent = avgFga;
            
            const legends = ratedPlayers.filter(p => p.fga_rating >= 90).length;
            document.getElementById('stat-legends').textContent = legends;
            
            const elite = ratedPlayers.filter(p => p.fga_rating >= 85 && p.fga_rating < 90).length;
            document.getElementById('stat-elite').textContent = elite;
        }

        // COMPARISON FUNCTIONS
        function searchForComparison(query) {
            const results = document.getElementById('comparison-search-results');
            if (!query) {
                results.innerHTML = '<p class="text-slate-400 text-sm">Start typing to search players...</p>';
                return;
            }
            
            const matches = playerData.filter(p => 
                p.name.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 10);
            
            results.innerHTML = matches.map(player => `
                <div class="player-card" onclick="addToComparison('${player.name.replace(/'/g, "\\'")}')">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-bold">${player.name}</div>
                            <div class="text-sm text-slate-400">${player.position} | ${player.nationality} | FGA: ${player.fga_rating.toFixed(1)}</div>
                        </div>
                        <button class="bg-blue-600 px-3 py-1 rounded text-sm">Add</button>
                    </div>
                </div>
            `).join('');
        }

        function addToComparison(playerName) {
            if (selectedComparePlayers.length >= 4) {
                alert('Maximum 4 players can be compared');
                return;
            }
            
            const player = playerData.find(p => p.name === playerName);
            if (!player || selectedComparePlayers.find(p => p.name === playerName)) return;
            
            selectedComparePlayers.push(player);
            updateSelectedPlayers();
        }

        function removeFromComparison(playerName) {
            selectedComparePlayers = selectedComparePlayers.filter(p => p.name !== playerName);
            updateSelectedPlayers();
        }

        function updateSelectedPlayers() {
            const container = document.getElementById('selected-players');
            document.getElementById('selected-count').textContent = selectedComparePlayers.length;
            
            if (selectedComparePlayers.length === 0) {
                container.innerHTML = '<p class="text-slate-400 text-sm">Select players from the search results to compare</p>';
                return;
            }
            
            container.innerHTML = selectedComparePlayers.map(player => `
                <div class="player-card selected">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-bold">${player.name}</div>
                            <div class="text-sm text-slate-400">${player.position} | FGA: ${player.fga_rating.toFixed(1)}</div>
                        </div>
                        <button onclick="removeFromComparison('${player.name.replace(/'/g, "\\'")}')" class="bg-red-600 px-3 py-1 rounded text-sm">Remove</button>
                    </div>
                </div>
            `).join('');
        }

        // ==================== ENHANCED COMPARISON TOOL - PHASE 1 ====================
        // ENHANCED COMPARISON TOOL - PHASE 1 IMPROVEMENTS
        // This replaces the generateComparison() function and adds helper functions
        
        // ============ COMPONENT SCORE ESTIMATION ============
        // ============ EMPIRE FGA CORE METRICS CALCULATION ============
        function calculateFGACoreMetrics(player) {
            const fga = player.fga_rating;
            const pos = player.position;
            const age = player.age;
            const philosophy = player.bestPhilosophy;
            
            // Base FGA to 0-10 scale (FGA is already 0-100, divide by 10)
            const baseScore = fga / 10;
            
            // TIER 1: Core Attacking Metrics (0-10 scale)
            let xps = baseScore * 0.92; // Enhanced XPS Rating (Shooting)
            let stk = baseScore * 0.88; // STK (Steekpas)
            let rds = baseScore * 0.90; // RDS (Renard des Surfaces)
            let key = baseScore * 0.87; // KEY (Key Passes)
            
            // TIER 1: Core Passing Metrics
            let lgp = baseScore * 0.85; // LGP (Long Pass)
            let vrp = baseScore * 0.89; // VRP (Vertical Pass)
            let hzp = baseScore * 0.86; // HZP (Horizontal Pass)
            let unp = baseScore * 0.84; // UNP (Unpredictability)
            let dgp = baseScore * 0.88; // DGP (Dangerous Pass)
            
            // TIER 1: Core Defensive Metrics
            let mrk = baseScore * 0.82; // MRK (Marking)
            let tac = baseScore * 0.85; // TAC (Tackling)
            let int = baseScore * 0.87; // INT (Interceptions)
            let cle = baseScore * 0.84; // CLE (Clearances)
            let blo = baseScore * 0.83; // BLO (Blocks)
            
            // TIER 1: Core Possession Metrics
            let car = baseScore * 0.90; // CAR (Carrying)
            let drb = baseScore * 0.91; // DRB (Dribbling)
            
            // TIER 2: Composite Metrics
            let poi = baseScore * 0.93; // POI (Position Intelligence)
            let cpx = baseScore * 0.89; // CPX (Composure)
            let mob = baseScore * 0.86; // MOB (Mobility)
            
            // Position-specific adjustments
            if (pos === 'ST' || pos === 'WG') {
                xps *= 1.20; stk *= 1.25; rds *= 1.15;
                mrk *= 0.65; tac *= 0.60; int *= 0.70;
                drb *= 1.15; car *= 1.10;
            } else if (pos === 'AM') {
                xps *= 1.10; key *= 1.20; unp *= 1.15;
                vrp *= 1.10; dgp *= 1.15;
                mrk *= 0.75; tac *= 0.70;
                drb *= 1.10; poi *= 1.10;
            } else if (pos === 'CM') {
                lgp *= 1.10; vrp *= 1.05; hzp *= 1.10;
                key *= 1.05; poi *= 1.15;
                mrk *= 0.95; tac *= 0.95; int *= 1.05;
            } else if (pos === 'DM') {
                mrk *= 1.20; tac *= 1.25; int *= 1.20;
                lgp *= 1.05; poi *= 1.15;
                xps *= 0.75; stk *= 0.70;
            } else if (pos === 'CB') {
                mrk *= 1.25; tac *= 1.20; int *= 1.15;
                cle *= 1.25; blo *= 1.20;
                xps *= 0.60; stk *= 0.55; drb *= 0.70;
                poi *= 1.10;
            } else if (pos === 'FB') {
                mrk *= 1.10; tac *= 1.15; int *= 1.10;
                car *= 1.10; mob *= 1.15;
                xps *= 0.75; stk *= 0.70;
            } else if (pos === 'GK') {
                xps *= 0.50; stk *= 0.45;
                mrk *= 0.90; tac *= 0.85;
                poi *= 1.20; cpx *= 1.15;
            }
            
            // Age-based adjustments
            if (age <= 23) {
                mob *= 1.05; car *= 1.03;
                poi *= 0.95; cpx *= 0.93;
            } else if (age >= 24 && age <= 27) {
                mob *= 1.08; car *= 1.05; // Peak years
            } else if (age >= 28 && age <= 31) {
                poi *= 1.05; cpx *= 1.08; // Experience peak
                mob *= 0.98;
            } else if (age >= 32) {
                poi *= 1.10; cpx *= 1.12; // Veterans
                mob *= 0.88; car *= 0.90;
            }
            
            // Philosophy-based adjustments
            if (philosophy.includes('Ferguson') || philosophy.includes('Mental')) {
                cpx *= 1.12; poi *= 1.08;
            } else if (philosophy.includes('Guardiola') || philosophy.includes('Positional')) {
                poi *= 1.15; lgp *= 1.08; vrp *= 1.08;
            } else if (philosophy.includes('Cruyff') || philosophy.includes('Intelligence')) {
                poi *= 1.12; unp *= 1.10; drb *= 1.08;
            } else if (philosophy.includes('Simeone') || philosophy.includes('Cholismo')) {
                mrk *= 1.15; tac *= 1.12; cpx *= 1.10;
            } else if (philosophy.includes('Klopp') || philosophy.includes('Intensity')) {
                int *= 1.12; car *= 1.10; mob *= 1.12;
            }
            
            // Cap all values at 10.0
            const cap = (val) => Math.min(10.0, Math.max(0, val));
            
            return {
                // Tier 1 - Attacking
                xps: cap(xps),
                stk: cap(stk),
                rds: cap(rds),
                key: cap(key),
                
                // Tier 1 - Passing
                lgp: cap(lgp),
                vrp: cap(vrp),
                hzp: cap(hzp),
                unp: cap(unp),
                dgp: cap(dgp),
                
                // Tier 1 - Defensive
                mrk: cap(mrk),
                tac: cap(tac),
                int: cap(int),
                cle: cap(cle),
                blo: cap(blo),
                
                // Tier 1 - Possession
                car: cap(car),
                drb: cap(drb),
                
                // Tier 2 - Composite
                poi: cap(poi),
                cpx: cap(cpx),
                mob: cap(mob)
            };
        }
        
        // Helper function for component scores (for radar chart)
        function estimateComponentScores(player) {
            const metrics = calculateFGACoreMetrics(player);
            
            return {
                attacking: ((metrics.xps + metrics.stk + metrics.rds) / 3) * 10,
                passing: ((metrics.lgp + metrics.vrp + metrics.hzp + metrics.dgp) / 4) * 10,
                defending: ((metrics.mrk + metrics.tac + metrics.int) / 3) * 10,
                possession: ((metrics.car + metrics.drb) / 2) * 10,
                intelligence: ((metrics.poi + metrics.cpx) / 2) * 10,
                physicality: ((metrics.mob + metrics.car) / 2) * 10
            };
        }
        
        // ============ DERIVED METRICS CALCULATION ============
        function calculateDerivedMetrics(player) {
            // Value Efficiency Score: FGA quality per ‚Ç¨1M
            const valueEfficiency = player.marketValue > 0 
                ? ((player.fga_rating - 75) / (player.marketValue / 1000000)).toFixed(3)
                : null;
            
            // Age-Adjusted Rating (Peak Performance Index)
            let ageMultiplier = 1.0;
            if (player.age <= 20) ageMultiplier = 0.90;
            else if (player.age <= 23) ageMultiplier = 0.95;
            else if (player.age >= 24 && player.age <= 28) ageMultiplier = 1.00; // peak
            else if (player.age >= 29 && player.age <= 32) ageMultiplier = 0.96;
            else if (player.age >= 33 && player.age <= 36) ageMultiplier = 0.88;
            else ageMultiplier = 0.75;
            
            const ageAdjustedRating = (player.fga_rating * ageMultiplier).toFixed(1);
            
            // Longevity Score: Expected elite years remaining
            const yearsToDecline = Math.max(0, 33 - player.age);
            const longevityScore = (yearsToDecline * (player.fga_rating / 100)).toFixed(1);
            
            // Age Category
            let ageCategory, ageBadge;
            if (player.age <= 23) {
                ageCategory = 'Developing';
                ageBadge = 'üìà';
            } else if (player.age >= 24 && player.age <= 29) {
                ageCategory = 'Peak Years';
                ageBadge = 'üåü';
            } else if (player.age >= 30 && player.age <= 33) {
                ageCategory = 'Experienced';
                ageBadge = 'üëë';
            } else {
                ageCategory = 'Veteran';
                ageBadge = 'üìâ';
            }
            
            return {
                valueEfficiency,
                ageAdjustedRating,
                longevityScore,
                ageCategory,
                ageBadge
            };
        }
        
        // ============ STRENGTH/WEAKNESS ANALYSIS ============
        function analyzeStrengthsWeaknesses(player) {
            const components = estimateComponentScores(player);
            const derived = calculateDerivedMetrics(player);
            
            const strengths = [];
            const weaknesses = [];
            
            // Analyze components
            if (components.attacking >= 90) strengths.push('Elite attacking threat');
            if (components.passing >= 90) strengths.push('Exceptional passing ability');
            if (components.defending >= 90) strengths.push('World-class defensive skills');
            if (components.technical >= 95) strengths.push('Outstanding technical ability');
            if (components.mental >= 92) strengths.push('Elite mentality and decision-making');
            
            // Age-based strengths/weaknesses
            if (player.age >= 24 && player.age <= 29) {
                strengths.push('In prime performance years');
            } else if (player.age <= 23) {
                strengths.push('High resale value potential');
            } else if (player.age >= 33) {
                weaknesses.push('Limited career longevity remaining');
            }
            
            // Value-based
            if (derived.valueEfficiency && parseFloat(derived.valueEfficiency) > 0.3) {
                strengths.push('Exceptional value for money');
            } else if (derived.valueEfficiency && parseFloat(derived.valueEfficiency) < 0.1) {
                weaknesses.push('Premium price relative to quality');
            }
            
            // Component weaknesses
            if (components.attacking < 75 && !['CB', 'DM', 'GK'].includes(player.position)) {
                weaknesses.push('Limited offensive contribution');
            }
            if (components.defending < 75 && ['CB', 'FB', 'DM'].includes(player.position)) {
                weaknesses.push('Defensive vulnerabilities');
            }
            if (components.physical < 75 && player.age <= 30) {
                weaknesses.push('Physical limitations');
            }
            
            // Ensure we have at least 2-3 strengths and 1-2 weaknesses
            if (strengths.length === 0) {
                strengths.push('Solid all-around capabilities');
                strengths.push('Reliable performer');
            }
            if (weaknesses.length === 0) {
                weaknesses.push('Few obvious weaknesses');
            }
            
            return {
                strengths: strengths.slice(0, 3),
                weaknesses: weaknesses.slice(0, 2)
            };
        }
        
        // ============ TACTICAL RECOMMENDATIONS ============
        function generateTacticalRecommendations(players) {
            const recommendations = [];
            
            // Analyze for high-pressing systems
            const pressingPlayers = players.filter(p => 
                p.bestPhilosophy.includes('Ferguson') || 
                p.bestPhilosophy.includes('Klopp') || 
                p.bestPhilosophy.includes('Simeone') ||
                p.bestPhilosophy.includes('Cholismo')
            );
            
            if (pressingPlayers.length > 0) {
                const best = pressingPlayers.sort((a, b) => {
                    const aComponents = estimateComponentScores(a);
                    const bComponents = estimateComponentScores(b);
                    return (bComponents.physical + bComponents.mental) - (aComponents.physical + aComponents.mental);
                })[0];
                
                recommendations.push({
                    icon: '‚ö°',
                    system: 'High-Pressing Systems',
                    recommended: best.name,
                    reason: `${best.name}'s ${best.bestPhilosophy} philosophy and strong physical/mental attributes make them ideal for intense, counter-pressing football.`
                });
            }
            
            // Analyze for possession systems
            const possessionPlayers = players.filter(p =>
                p.bestPhilosophy.includes('Guardiola') ||
                p.bestPhilosophy.includes('Cruyff') ||
                p.bestPhilosophy.includes('Xavi') ||
                p.bestPhilosophy.includes('Positional')
            );
            
            if (possessionPlayers.length > 0) {
                const best = possessionPlayers.sort((a, b) => {
                    const aComponents = estimateComponentScores(a);
                    const bComponents = estimateComponentScores(b);
                    return (bComponents.passing + bComponents.technical) - (aComponents.passing + aComponents.technical);
                })[0];
                
                recommendations.push({
                    icon: 'üéØ',
                    system: 'Possession Football',
                    recommended: best.name,
                    reason: `${best.name} thrives in patient, build-up oriented systems with their exceptional passing and technical ability aligned with ${best.bestPhilosophy}.`
                });
            }
            
            // Analyze for counter-attacking systems
            const counterPlayers = players.filter(p =>
                p.bestPhilosophy.includes('Mourinho') ||
                p.bestPhilosophy.includes('Simeone') ||
                p.position === 'ST' || p.position === 'WG'
            );
            
            if (counterPlayers.length > 0) {
                const best = counterPlayers.sort((a, b) => {
                    const aComponents = estimateComponentScores(a);
                    const bComponents = estimateComponentScores(b);
                    return (bComponents.attacking + bComponents.physical) - (aComponents.attacking + aComponents.physical);
                })[0];
                
                recommendations.push({
                    icon: '‚öîÔ∏è',
                    system: 'Counter-Attacking',
                    recommended: best.name,
                    reason: `${best.name}'s pace, directness, and attacking threat make them perfect for exploiting space on the break.`
                });
            }
            
            // Value recommendation
            const activePlayersWithValue = players.filter(p => p.marketValue > 0);
            if (activePlayersWithValue.length > 1) {
                const valuePlayers = activePlayersWithValue.map(p => ({
                    ...p,
                    efficiency: (p.fga_rating - 75) / (p.marketValue / 1000000)
                })).sort((a, b) => b.efficiency - a.efficiency);
                
                const bestValue = valuePlayers[0];
                recommendations.push({
                    icon: 'üí∞',
                    system: 'Budget Optimization',
                    recommended: bestValue.name,
                    reason: `${bestValue.name} offers exceptional value at ‚Ç¨${(bestValue.marketValue / 1000000).toFixed(1)}M for FGA ${bestValue.fga.toFixed(1)} quality (${bestValue.efficiency.toFixed(3)} FGA/‚Ç¨M).`
                });
            }
            
            return recommendations;
        }
        
        // ============ POSITION ICON HELPER ============
        function getPositionIcon(position) {
            const icons = {
                'ST': '‚öΩ', 'WG': '‚ö°', 'AM': 'üéØ', 'CM': 'üé®',
                'DM': 'üõ°Ô∏è', 'FB': 'üèÉ', 'CB': 'üß±', 'GK': 'üß§'
            };
            return icons[position] || '‚öΩ';
        }
        
        // ============ FIND BEST IN CATEGORY ============
        function findBestInCategory(players, category) {
            if (category === 'fga') {
                const best = Math.max(...players.map(p => p.fga_rating));
                return players.filter(p => p.fga_rating === best).map(p => p.name);
            } else if (category === 'value' && players.every(p => p.marketValue > 0)) {
                const efficiencies = players.map(p => ({
                    name: p.name,
                    eff: (p.fga_rating - 75) / (p.marketValue / 1000000)
                }));
                const best = Math.max(...efficiencies.map(e => e.eff));
                return efficiencies.filter(e => e.eff === best).map(e => e.name);
            } else if (category === 'longevity') {
                const scores = players.map(p => ({
                    name: p.name,
                    score: Math.max(0, (33 - p.age) * (p.fga_rating / 100))
                }));
                const best = Math.max(...scores.map(s => s.score));
                return scores.filter(s => s.score === best).map(s => s.name);
            }
            return [];
        }
        
        
        // ============ PHILOSOPHY COMPATIBILITY SCORING ============
        function calculatePhilosophyScores(player) {
            const fga = player.fga_rating;
            const pos = player.position;
            const philosophy = player.bestPhilosophy;
            const age = player.age;
            
            // Base score from FGA (scaled to 0-10)
            const baseScore = fga / 10;
            
            // Complete 60-Philosophy Framework with Schools
            const philosophies = {
                // ========================================
                // DUTCH SCHOOL (6 Philosophies)
                // ========================================
                'Cruyff Intelligence': {
                    weight: 1.38, school: 'Dutch',
                    positionFit: { AM: 1.0, ST: 1.0, CM: 0.95, WG: 0.95, FB: 0.85, DM: 0.85, CB: 0.80, GK: 0.65, LW: 1.0, RW: 1.0, LB: 0.85, RB: 0.85 },
                    keywords: ['Cruyff', 'Intelligence'],
                    description: 'Total football, creativity, spatial awareness'
                },
                'Michels Total Football': {
                    weight: 1.35, school: 'Dutch',
                    positionFit: { CM: 1.0, FB: 1.0, AM: 0.95, DM: 0.95, CB: 0.90, ST: 0.90, WG: 0.90, GK: 0.75, LW: 0.90, RW: 0.90, LB: 1.0, RB: 1.0 },
                    keywords: ['Michels', 'Total'],
                    description: 'Total football, positional fluidity, versatility'
                },
                'Van Gaal Discipline': {
                    weight: 1.32, school: 'Dutch',
                    positionFit: { CB: 1.0, DM: 1.0, CM: 0.95, FB: 0.90, AM: 0.85, ST: 0.80, WG: 0.75, GK: 0.85, LB: 0.90, RB: 0.90, LW: 0.75, RW: 0.75 },
                    keywords: ['Van Gaal', 'Discipline'],
                    description: 'Disciplined possession, tactical strictness, organization'
                },
                'Kov√°cs Methodical': {
                    weight: 1.28, school: 'Dutch',
                    positionFit: { DM: 1.0, CM: 0.95, CB: 0.95, FB: 0.90, AM: 0.85, ST: 0.80, WG: 0.75, GK: 0.80, LB: 0.90, RB: 0.90, LW: 0.75, RW: 0.75 },
                    keywords: ['Kov√°cs', 'Kovacs', 'Method'],
                    description: 'Methodical approach, systematic play'
                },
                'Hiddink Pragmatic': {
                    weight: 1.24, school: 'Dutch',
                    positionFit: { CM: 0.95, DM: 0.95, CB: 0.95, FB: 0.90, AM: 0.85, ST: 0.85, WG: 0.80, GK: 0.80, LB: 0.90, RB: 0.90, LW: 0.80, RW: 0.80 },
                    keywords: ['Hiddink', 'Pragmatic'],
                    description: 'Pragmatic tactics, adaptability'
                },
                'Beenhakker European': {
                    weight: 1.22, school: 'Dutch',
                    positionFit: { CM: 0.90, CB: 0.90, DM: 0.90, FB: 0.85, AM: 0.85, ST: 0.85, WG: 0.80, GK: 0.75, LB: 0.85, RB: 0.85, LW: 0.80, RW: 0.80 },
                    keywords: ['Beenhakker', 'European'],
                    description: 'European tactical fusion, professionalism'
                },

                // ========================================
                // SPANISH SCHOOL (7 Philosophies)
                // ========================================
                'Guardiola Positional': {
                    weight: 1.40, school: 'Spanish',
                    positionFit: { CM: 1.0, DM: 1.0, AM: 0.95, FB: 0.90, CB: 0.90, ST: 0.80, WG: 0.75, GK: 0.70, LW: 0.75, RW: 0.75, LB: 0.90, RB: 0.90 },
                    keywords: ['Guardiola', 'Positional', 'Possession'],
                    description: 'Positional play, passing precision, intelligence'
                },
                'Aragon√©s Pride': {
                    weight: 1.30, school: 'Spanish',
                    positionFit: { CM: 0.95, AM: 0.95, CB: 0.90, DM: 0.90, FB: 0.85, ST: 0.85, WG: 0.85, GK: 0.75, LW: 0.85, RW: 0.85, LB: 0.85, RB: 0.85 },
                    keywords: ['Aragon√©s', 'Aragones', 'Pride'],
                    description: 'Spanish pride, technical excellence'
                },
                'Carniglia Practical': {
                    weight: 1.28, school: 'Spanish',
                    positionFit: { ST: 0.95, CB: 0.95, DM: 0.90, CM: 0.90, FB: 0.85, AM: 0.85, WG: 0.80, GK: 0.80, LW: 0.80, RW: 0.80, LB: 0.85, RB: 0.85 },
                    keywords: ['Carniglia', 'Practical'],
                    description: 'Practical effectiveness, counter-attacking'
                },
                'Emery Intensity': {
                    weight: 1.26, school: 'Spanish',
                    positionFit: { CM: 0.95, DM: 0.95, FB: 0.90, CB: 0.90, WG: 0.85, ST: 0.85, AM: 0.85, GK: 0.75, LW: 0.85, RW: 0.85, LB: 0.90, RB: 0.90 },
                    keywords: ['Emery', 'Intensity'],
                    description: 'High intensity pressing, detailed preparation'
                },
                'Mu√±oz Physical': {
                    weight: 1.26, school: 'Spanish',
                    positionFit: { CB: 0.95, DM: 0.95, ST: 0.90, FB: 0.85, CM: 0.85, AM: 0.80, WG: 0.75, GK: 0.80, LW: 0.75, RW: 0.75, LB: 0.85, RB: 0.85 },
                    keywords: ['Mu√±oz', 'Munoz', 'Physical'],
                    description: 'Physical dominance, aerial strength'
                },
                'Pellegrini Balance': {
                    weight: 1.24, school: 'Spanish',
                    positionFit: { CM: 0.90, AM: 0.90, CB: 0.85, DM: 0.85, FB: 0.85, ST: 0.85, WG: 0.85, GK: 0.75, LW: 0.85, RW: 0.85, LB: 0.85, RB: 0.85 },
                    keywords: ['Pellegrini', 'Balance'],
                    description: 'Balanced approach, attacking fluidity'
                },
                'Villalonga Tactical': {
                    weight: 1.24, school: 'Spanish',
                    positionFit: { CB: 0.90, DM: 0.90, CM: 0.85, FB: 0.85, AM: 0.80, ST: 0.80, WG: 0.75, GK: 0.80, LW: 0.75, RW: 0.75, LB: 0.85, RB: 0.85 },
                    keywords: ['Villalonga', 'Tactical'],
                    description: 'Tactical discipline, defensive organization'
                },

                // ========================================
                // ITALIAN SCHOOL (8 Philosophies)
                // ========================================
                'Herrera Catenaccio': {
                    weight: 1.35, school: 'Italian',
                    positionFit: { CB: 1.0, DM: 1.0, FB: 0.95, CM: 0.85, GK: 0.90, AM: 0.65, ST: 0.70, WG: 0.65, LB: 0.95, RB: 0.95, LW: 0.65, RW: 0.65 },
                    keywords: ['Herrera', 'Catenaccio'],
                    description: 'Defensive fortress, tactical cynicism'
                },
                'Rocco Defense': {
                    weight: 1.32, school: 'Italian',
                    positionFit: { CB: 1.0, DM: 0.95, FB: 0.90, GK: 0.95, CM: 0.80, AM: 0.60, ST: 0.65, WG: 0.60, LB: 0.90, RB: 0.90, LW: 0.60, RW: 0.60 },
                    keywords: ['Rocco', 'Defense'],
                    description: 'Ultra-defensive, zone marking'
                },
                'Lippi Leadership': {
                    weight: 1.32, school: 'Italian',
                    positionFit: { CB: 0.95, DM: 0.95, CM: 0.90, FB: 0.90, AM: 0.80, ST: 0.85, WG: 0.75, GK: 0.85, LB: 0.90, RB: 0.90, LW: 0.75, RW: 0.75 },
                    keywords: ['Lippi', 'Leadership'],
                    description: 'Leadership, tactical flexibility'
                },
                'Trapattoni Organization': {
                    weight: 1.30, school: 'Italian',
                    positionFit: { CB: 0.95, DM: 0.95, CM: 0.90, FB: 0.85, AM: 0.75, ST: 0.80, WG: 0.70, GK: 0.85, LB: 0.85, RB: 0.85, LW: 0.70, RW: 0.70 },
                    keywords: ['Trapattoni', 'Organization'],
                    description: 'Meticulous organization, defensive solidity'
                },
                'Bearzot Pragmatic': {
                    weight: 1.28, school: 'Italian',
                    positionFit: { CB: 0.90, DM: 0.90, CM: 0.85, FB: 0.85, ST: 0.85, AM: 0.80, WG: 0.75, GK: 0.80, LB: 0.85, RB: 0.85, LW: 0.75, RW: 0.75 },
                    keywords: ['Bearzot', 'Pragmatic'],
                    description: 'Pragmatic tactics, team unity'
                },
                'Sacchi Pressing': {
                    weight: 1.28, school: 'Italian',
                    positionFit: { CB: 1.0, DM: 1.0, CM: 0.95, FB: 0.95, AM: 0.80, ST: 0.75, WG: 0.75, GK: 0.80, LB: 0.95, RB: 0.95, LW: 0.75, RW: 0.75 },
                    keywords: ['Sacchi', 'Pressing', 'Maldini'],
                    description: 'Organized pressing, defensive compactness'
                },
                'Carcano Method': {
                    weight: 1.22, school: 'Italian',
                    positionFit: { CB: 0.85, DM: 0.85, CM: 0.80, FB: 0.80, AM: 0.75, ST: 0.80, WG: 0.70, GK: 0.75, LB: 0.80, RB: 0.80, LW: 0.70, RW: 0.70 },
                    keywords: ['Carcano', 'Method'],
                    description: 'Systematic approach, tactical discipline'
                },
                'Cesarini Heroes': {
                    weight: 1.20, school: 'Italian',
                    positionFit: { ST: 0.90, AM: 0.85, CM: 0.80, CB: 0.80, DM: 0.80, FB: 0.75, WG: 0.85, GK: 0.70, LW: 0.85, RW: 0.85, LB: 0.75, RB: 0.75 },
                    keywords: ['Cesarini', 'Heroes'],
                    description: 'Late heroics, mental resilience'
                },

                // ========================================
                // ENGLISH SCHOOL (8 Philosophies)
                // ========================================
                'Ferguson Mental': {
                    weight: 1.45, school: 'English',
                    positionFit: { ST: 1.0, WG: 1.0, AM: 0.95, CM: 0.95, DM: 0.90, FB: 0.85, CB: 0.85, GK: 0.80, LW: 1.0, RW: 1.0, LB: 0.85, RB: 0.85 },
                    keywords: ['Ferguson', 'Mental'],
                    description: 'Mental strength, winning mentality'
                },
                'Clough Genius': {
                    weight: 1.38, school: 'English',
                    positionFit: { ST: 0.95, AM: 0.95, CM: 0.90, WG: 0.90, CB: 0.85, DM: 0.85, FB: 0.85, GK: 0.75, LW: 0.90, RW: 0.90, LB: 0.85, RB: 0.85 },
                    keywords: ['Clough', 'Genius'],
                    description: 'Tactical genius, attacking flair'
                },
                'Busby Babes': {
                    weight: 1.35, school: 'English',
                    positionFit: { ST: 0.95, AM: 0.95, WG: 0.95, CM: 0.90, FB: 0.85, DM: 0.80, CB: 0.80, GK: 0.75, LW: 0.95, RW: 0.95, LB: 0.85, RB: 0.85 },
                    keywords: ['Busby', 'Babes'],
                    description: 'Attacking football, youth development'
                },
                'Paisley Consistency': {
                    weight: 1.34, school: 'English',
                    positionFit: { CM: 0.95, CB: 0.95, DM: 0.90, FB: 0.90, AM: 0.85, ST: 0.85, WG: 0.85, GK: 0.85, LW: 0.85, RW: 0.85, LB: 0.90, RB: 0.90 },
                    keywords: ['Paisley', 'Consistency'],
                    description: 'Consistency, tactical simplicity'
                },
                'Shankly Spirit': {
                    weight: 1.32, school: 'English',
                    positionFit: { CM: 0.95, ST: 0.90, CB: 0.90, DM: 0.90, FB: 0.85, AM: 0.85, WG: 0.85, GK: 0.80, LW: 0.85, RW: 0.85, LB: 0.85, RB: 0.85 },
                    keywords: ['Shankly', 'Spirit'],
                    description: 'Fighting spirit, team unity, passion'
                },
                'Robson Passion': {
                    weight: 1.30, school: 'English',
                    positionFit: { CM: 0.90, ST: 0.90, AM: 0.90, CB: 0.85, DM: 0.85, FB: 0.85, WG: 0.85, GK: 0.75, LW: 0.85, RW: 0.85, LB: 0.85, RB: 0.85 },
                    keywords: ['Robson', 'Passion'],
                    description: 'Passion, box-to-box energy'
                },
                'Venables Intelligence': {
                    weight: 1.28, school: 'English',
                    positionFit: { AM: 0.95, CM: 0.90, ST: 0.85, CB: 0.85, DM: 0.85, FB: 0.85, WG: 0.85, GK: 0.75, LW: 0.85, RW: 0.85, LB: 0.85, RB: 0.85 },
                    keywords: ['Venables', 'Intelligence'],
                    description: 'Tactical intelligence, innovation'
                },
                'Winterbottom Method': {
                    weight: 1.24, school: 'English',
                    positionFit: { CB: 0.85, CM: 0.85, DM: 0.85, FB: 0.80, AM: 0.80, ST: 0.80, WG: 0.75, GK: 0.75, LW: 0.75, RW: 0.75, LB: 0.80, RB: 0.80 },
                    keywords: ['Winterbottom', 'Method'],
                    description: 'Methodical coaching, professionalism'
                },

                // ========================================
                // GERMAN SCHOOL (6 Philosophies)
                // ========================================
                'Beckenbauer Elegance': {
                    weight: 1.36, school: 'German',
                    positionFit: { CB: 1.0, DM: 1.0, CM: 0.95, FB: 0.90, AM: 0.85, ST: 0.80, WG: 0.75, GK: 0.80, LW: 0.75, RW: 0.75, LB: 0.90, RB: 0.90 },
                    keywords: ['Beckenbauer', 'Elegance'],
                    description: 'Elegant sweeper play, ball-playing defenders'
                },
                'Heynckes Precision': {
                    weight: 1.34, school: 'German',
                    positionFit: { CM: 0.95, CB: 0.95, DM: 0.95, FB: 0.90, AM: 0.85, ST: 0.85, WG: 0.80, GK: 0.85, LW: 0.80, RW: 0.80, LB: 0.90, RB: 0.90 },
                    keywords: ['Heynckes', 'Precision'],
                    description: 'Tactical precision, high pressing'
                },
                'Hitzfeld Success': {
                    weight: 1.32, school: 'German',
                    positionFit: { CM: 0.90, CB: 0.90, DM: 0.90, FB: 0.85, ST: 0.85, AM: 0.85, WG: 0.80, GK: 0.80, LW: 0.80, RW: 0.80, LB: 0.85, RB: 0.85 },
                    keywords: ['Hitzfeld', 'Success'],
                    description: 'Winning mentality, tactical adaptability'
                },
                'Happel Innovation': {
                    weight: 1.30, school: 'German',
                    positionFit: { CM: 0.90, AM: 0.90, ST: 0.85, CB: 0.85, DM: 0.85, FB: 0.85, WG: 0.85, GK: 0.75, LW: 0.85, RW: 0.85, LB: 0.85, RB: 0.85 },
                    keywords: ['Happel', 'Innovation'],
                    description: 'Tactical innovation, attacking philosophy'
                },
                'Cramer Method': {
                    weight: 1.28, school: 'German',
                    positionFit: { CB: 0.90, DM: 0.90, CM: 0.85, FB: 0.85, AM: 0.80, ST: 0.80, WG: 0.75, GK: 0.80, LW: 0.75, RW: 0.75, LB: 0.85, RB: 0.85 },
                    keywords: ['Cramer', 'Method'],
                    description: 'Methodical preparation, systematic training'
                },
                'Herberger Discipline': {
                    weight: 1.28, school: 'German',
                    positionFit: { CB: 0.90, DM: 0.90, CM: 0.85, FB: 0.85, AM: 0.75, ST: 0.80, WG: 0.70, GK: 0.85, LW: 0.70, RW: 0.70, LB: 0.85, RB: 0.85 },
                    keywords: ['Herberger', 'Discipline'],
                    description: 'German discipline, organization'
                },

                // ========================================
                // FRENCH SCHOOL (5 Philosophies)
                // ========================================
                'Wenger Development': {
                    weight: 1.32, school: 'French',
                    positionFit: { AM: 1.0, CM: 0.95, ST: 0.90, WG: 0.90, FB: 0.85, DM: 0.85, CB: 0.80, GK: 0.70, LW: 0.90, RW: 0.90, LB: 0.85, RB: 0.85 },
                    keywords: ['Wenger', 'Development'],
                    description: 'Youth development, technical football'
                },
                'Deschamps Pragmatic': {
                    weight: 1.30, school: 'French',
                    positionFit: { DM: 0.95, CM: 0.95, CB: 0.90, FB: 0.85, AM: 0.80, ST: 0.80, WG: 0.75, GK: 0.85, LW: 0.75, RW: 0.75, LB: 0.85, RB: 0.85 },
                    keywords: ['Deschamps', 'Pragmatic'],
                    description: 'Pragmatic tactics, defensive organization'
                },
                'Platini Elegance': {
                    weight: 1.28, school: 'French',
                    positionFit: { AM: 1.0, CM: 0.95, WG: 0.90, ST: 0.85, FB: 0.75, DM: 0.70, CB: 0.65, GK: 0.60, LW: 0.90, RW: 0.90, LB: 0.75, RB: 0.75 },
                    keywords: ['Platini', 'Elegance'],
                    description: 'Elegant play, technical excellence'
                },
                'Suaudeau Method': {
                    weight: 1.26, school: 'French',
                    positionFit: { CM: 0.90, AM: 0.85, CB: 0.85, DM: 0.85, FB: 0.80, ST: 0.80, WG: 0.80, GK: 0.75, LW: 0.80, RW: 0.80, LB: 0.80, RB: 0.80 },
                    keywords: ['Suaudeau', 'Method'],
                    description: 'Systematic youth development'
                },
                'Fontaine Attack': {
                    weight: 1.24, school: 'French',
                    positionFit: { ST: 1.0, WG: 0.95, AM: 0.90, CM: 0.75, FB: 0.65, DM: 0.60, CB: 0.55, GK: 0.50, LW: 0.95, RW: 0.95, LB: 0.65, RB: 0.65 },
                    keywords: ['Fontaine', 'Attack'],
                    description: 'Pure attacking football, goal-scoring'
                },

                // ========================================
                // SOUTH AMERICAN SCHOOL (7 Philosophies)
                // ========================================
                'Bielsa Verticalidad': {
                    weight: 1.34, school: 'South American',
                    positionFit: { CM: 1.0, FB: 0.95, WG: 0.95, AM: 0.90, ST: 0.90, DM: 0.85, CB: 0.80, GK: 0.70, LW: 0.95, RW: 0.95, LB: 0.95, RB: 0.95 },
                    keywords: ['Bielsa', 'Vertical'],
                    description: 'Vertical football, high intensity'
                },
                'Simeone Cholismo': {
                    weight: 1.35, school: 'South American',
                    positionFit: { CB: 1.0, DM: 1.0, FB: 0.95, CM: 0.90, AM: 0.70, ST: 0.70, WG: 0.70, GK: 0.85, LB: 0.95, RB: 0.95, LW: 0.70, RW: 0.70 },
                    keywords: ['Simeone', 'Cholismo'],
                    description: 'Defensive intensity, warrior mentality'
                },
                'Bilardo Combative': {
                    weight: 1.32, school: 'South American',
                    positionFit: { DM: 1.0, CB: 0.95, CM: 0.90, FB: 0.90, AM: 0.75, ST: 0.80, WG: 0.70, GK: 0.85, LB: 0.90, RB: 0.90, LW: 0.70, RW: 0.70 },
                    keywords: ['Bilardo', 'Combative'],
                    description: 'Combative play, tactical shrewdness'
                },
                'Menotti Artistry': {
                    weight: 1.28, school: 'South American',
                    positionFit: { AM: 1.0, WG: 1.0, ST: 0.95, CM: 0.80, FB: 0.70, DM: 0.60, CB: 0.50, GK: 0.40, LW: 1.0, RW: 1.0, LB: 0.70, RB: 0.70 },
                    keywords: ['Menotti', 'Artistry'],
                    description: 'Individual artistry, creative freedom'
                },
                'Zagallo Tactical': {
                    weight: 1.22, school: 'South American',
                    positionFit: { CM: 0.90, DM: 0.90, CB: 0.85, FB: 0.85, AM: 0.80, ST: 0.80, WG: 0.80, GK: 0.75, LW: 0.80, RW: 0.80, LB: 0.85, RB: 0.85 },
                    keywords: ['Zagallo', 'Tactical'],
                    description: 'Tactical intelligence, systematic approach'
                },
                'Santana Joga Bonito': {
                    weight: 1.18, school: 'South American',
                    positionFit: { AM: 0.95, ST: 0.95, WG: 0.95, CM: 0.85, FB: 0.75, DM: 0.70, CB: 0.65, GK: 0.60, LW: 0.95, RW: 0.95, LB: 0.75, RB: 0.75 },
                    keywords: ['Santana', 'Joga Bonito'],
                    description: 'Beautiful football, artistic expression'
                },
                'Feola System': {
                    weight: 1.16, school: 'South American',
                    positionFit: { CM: 0.85, CB: 0.85, DM: 0.85, FB: 0.80, AM: 0.80, ST: 0.80, WG: 0.75, GK: 0.75, LW: 0.75, RW: 0.75, LB: 0.80, RB: 0.80 },
                    keywords: ['Feola', 'System'],
                    description: 'Systematic organization, methodical'
                },

                // ========================================
                // EASTERN EUROPEAN SCHOOL (4 Philosophies)
                // ========================================
                'Lobanovskyi Scientific': {
                    weight: 1.36, school: 'Eastern European',
                    positionFit: { CM: 1.0, CB: 0.95, DM: 0.95, FB: 0.90, AM: 0.90, ST: 0.85, WG: 0.85, GK: 0.80, LW: 0.85, RW: 0.85, LB: 0.90, RB: 0.90 },
                    keywords: ['Lobanovskyi', 'Scientific'],
                    description: 'Scientific methods, data analysis'
                },
                'Guttmann Innovation': {
                    weight: 1.32, school: 'Eastern European',
                    positionFit: { AM: 0.95, ST: 0.95, CM: 0.90, WG: 0.90, CB: 0.80, DM: 0.80, FB: 0.80, GK: 0.70, LW: 0.90, RW: 0.90, LB: 0.80, RB: 0.80 },
                    keywords: ['Guttmann', 'Innovation'],
                    description: 'Tactical innovation, attacking football'
                },
                'Sebes Method': {
                    weight: 1.30, school: 'Eastern European',
                    positionFit: { CM: 0.95, AM: 0.90, CB: 0.85, DM: 0.85, FB: 0.85, ST: 0.85, WG: 0.85, GK: 0.75, LW: 0.85, RW: 0.85, LB: 0.85, RB: 0.85 },
                    keywords: ['Sebes', 'Method'],
                    description: 'Revolutionary tactics, fluid positions'
                },
                'Gorski Discipline': {
                    weight: 1.26, school: 'Eastern European',
                    positionFit: { CB: 0.90, DM: 0.90, CM: 0.85, FB: 0.85, AM: 0.75, ST: 0.75, WG: 0.70, GK: 0.80, LW: 0.70, RW: 0.70, LB: 0.85, RB: 0.85 },
                    keywords: ['Gorski', 'Discipline'],
                    description: 'Tactical discipline, defensive organization'
                },

                // ========================================
                // MODERN MASTERS (9 Philosophies)
                // ========================================
                'Klopp Intensity': {
                    weight: 1.32, school: 'Modern',
                    positionFit: { CM: 1.0, FB: 1.0, WG: 0.95, ST: 0.95, AM: 0.90, DM: 0.90, CB: 0.85, GK: 0.70, LW: 0.95, RW: 0.95, LB: 1.0, RB: 1.0 },
                    keywords: ['Klopp', 'Intensity'],
                    description: 'High pressing, counter-pressing, heavy metal football'
                },
                'Nagelsmann Innovation': {
                    weight: 1.32, school: 'Modern',
                    positionFit: { CM: 0.95, CB: 0.90, AM: 0.90, FB: 0.90, DM: 0.90, ST: 0.85, WG: 0.85, GK: 0.80, LW: 0.85, RW: 0.85, LB: 0.90, RB: 0.90 },
                    keywords: ['Nagelsmann', 'Innovation'],
                    description: 'Tactical innovation, data-driven'
                },
                'Ancelotti Flexible': {
                    weight: 1.30, school: 'Modern',
                    positionFit: { CM: 0.95, AM: 0.90, CB: 0.90, DM: 0.90, FB: 0.85, ST: 0.85, WG: 0.85, GK: 0.80, LW: 0.85, RW: 0.85, LB: 0.85, RB: 0.85 },
                    keywords: ['Ancelotti', 'Flexible'],
                    description: 'Tactical flexibility, man-management'
                },
                'Mourinho Tactical': {
                    weight: 1.30, school: 'Modern',
                    positionFit: { CB: 1.0, DM: 1.0, FB: 0.95, CM: 0.90, AM: 0.80, ST: 0.80, WG: 0.75, GK: 0.85, LB: 0.95, RB: 0.95, LW: 0.75, RW: 0.75 },
                    keywords: ['Mourinho', 'Tactical'],
                    description: 'Tactical discipline, defensive structure'
                },
                'Flick Combination': {
                    weight: 1.30, school: 'Modern',
                    positionFit: { CM: 0.95, CB: 0.90, FB: 0.90, AM: 0.90, ST: 0.85, DM: 0.85, WG: 0.85, GK: 0.75, LW: 0.85, RW: 0.85, LB: 0.90, RB: 0.90 },
                    keywords: ['Flick', 'Combination'],
                    description: 'Combination play, high pressing'
                },
                'Conte Intensity': {
                    weight: 1.28, school: 'Modern',
                    positionFit: { CB: 0.95, CM: 0.90, DM: 0.90, FB: 0.95, ST: 0.85, AM: 0.80, WG: 0.75, GK: 0.80, LW: 0.75, RW: 0.75, LB: 0.95, RB: 0.95 },
                    keywords: ['Conte', 'Intensity'],
                    description: 'High intensity, 3-5-2 mastery'
                },
                'Tuchel Systematic': {
                    weight: 1.28, school: 'Modern',
                    positionFit: { CB: 0.95, CM: 0.90, DM: 0.90, FB: 0.90, AM: 0.85, ST: 0.80, WG: 0.80, GK: 0.80, LW: 0.80, RW: 0.80, LB: 0.90, RB: 0.90 },
                    keywords: ['Tuchel', 'Systematic'],
                    description: 'Systematic approach, defensive solidity'
                },
                'Pochettino Pressing': {
                    weight: 1.26, school: 'Modern',
                    positionFit: { CM: 0.95, FB: 0.90, WG: 0.90, AM: 0.85, CB: 0.85, DM: 0.85, ST: 0.85, GK: 0.75, LW: 0.90, RW: 0.90, LB: 0.90, RB: 0.90 },
                    keywords: ['Pochettino', 'Pressing'],
                    description: 'High pressing, fitness culture'
                },
                'DeVisser Science': {
                    weight: 1.38, school: 'Modern',
                    positionFit: { CM: 0.95, AM: 0.95, CB: 0.90, DM: 0.90, FB: 0.85, ST: 0.85, WG: 0.85, GK: 0.75, LW: 0.85, RW: 0.85, LB: 0.85, RB: 0.85 },
                    keywords: ['DeVisser', 'Science'],
                    description: 'Scientific scouting, talent identification'
                }
            };
            
            // Calculate score for each philosophy
            const scores = {};
            Object.keys(philosophies).forEach(philName => {
                const phil = philosophies[philName];
                
                // ============================================
                // IMPROVED FORMULA V2.0 - Realistic Scoring
                // ============================================
                
                // STEP 1: Start with adjusted baseline (not just FGA/10)
                // This creates a lower starting point so modifiers matter more
                let score = (fga - 50) / 5; // 50 FGA = 0, 75 FGA = 5.0, 100 FGA = 10.0
                score = Math.max(0, score); // Ensure non-negative
                
                // STEP 2: Apply STRONG position fit multiplier
                // Range: 0.40 to 1.20 (much wider than before!)
                const posFit = phil.positionFit[pos] || 0.70;
                score *= posFit;
                
                // STEP 3: Philosophy-specific role penalties/bonuses
                // Attackers in defensive philosophies = major penalty
                const isAttacker = ['ST', 'WG', 'AM', 'LW', 'RW'].includes(pos);
                const isDefender = ['CB', 'DM', 'GK'].includes(pos);
                const isMidfield = ['CM', 'FB', 'LB', 'RB'].includes(pos);
                
                const defensivePhilosophies = [
                    'Herrera Catenaccio', 'Rocco Defense', 'Simeone Cholismo', 
                    'Mourinho Tactical', 'Sacchi Pressing', 'Trapattoni Organization',
                    'Bilardo Combative', 'Gorski Discipline'
                ];
                
                const attackingPhilosophies = [
                    'Menotti Artistry', 'Cruyff Intelligence', 'Busby Babes',
                    'Fontaine Attack', 'Santana Joga Bonito', 'Guttmann Innovation',
                    'Clough Genius', 'Platini Elegance'
                ];
                
                const tacticalPhilosophies = [
                    'Guardiola Positional', 'Van Gaal Discipline', 'Lobanovskyi Scientific',
                    'Sacchi Pressing', 'Nagelsmann Innovation', 'Heynckes Precision'
                ];
                
                const intensityPhilosophies = [
                    'Klopp Intensity', 'Bielsa Verticalidad', 'Emery Intensity',
                    'Pochettino Pressing', 'Conte Intensity'
                ];
                
                // Apply philosophy-role mismatch penalties
                if (defensivePhilosophies.includes(philName)) {
                    if (isAttacker) score *= 0.60; // Major penalty for attackers in defensive systems
                    if (isDefender) score *= 1.15; // Bonus for defenders
                }
                
                if (attackingPhilosophies.includes(philName)) {
                    if (isDefender) score *= 0.55; // Major penalty for defenders in attacking systems
                    if (isAttacker) score *= 1.20; // Bonus for attackers
                }
                
                if (tacticalPhilosophies.includes(philName)) {
                    if (isMidfield) score *= 1.10; // Midfielders excel in tactical systems
                }
                
                if (intensityPhilosophies.includes(philName)) {
                    if (isMidfield || pos === 'FB' || pos === 'LB' || pos === 'RB') {
                        score *= 1.15; // High-energy positions excel
                    }
                }
                
                // STEP 4: Age-based tactical understanding
                if (age <= 22) {
                    // Very young players: Lower tactical IQ, higher intensity
                    if (tacticalPhilosophies.includes(philName)) score *= 0.85;
                    if (intensityPhilosophies.includes(philName)) score *= 1.10;
                } else if (age <= 26) {
                    // Young but developing: Slight penalty for complex tactics
                    if (tacticalPhilosophies.includes(philName)) score *= 0.92;
                } else if (age >= 33) {
                    // Veterans: Higher tactical IQ, lower intensity
                    if (tacticalPhilosophies.includes(philName)) score *= 1.12;
                    if (intensityPhilosophies.includes(philName)) score *= 0.88;
                } else if (age >= 30) {
                    // Prime veterans: Balanced with slight tactical bonus
                    if (tacticalPhilosophies.includes(philName)) score *= 1.05;
                }
                
                // STEP 5: MAJOR boost if this is player's best philosophy (+30%)
                const isMatch = phil.keywords.some(keyword => philosophy.includes(keyword));
                if (isMatch) {
                    score *= 1.30; // Increased from 1.15 to 1.30
                }
                
                // STEP 6: Additional mismatch penalties for extreme cases
                if (!isMatch) {
                    // Pure attackers in ultra-defensive systems
                    if ((pos === 'ST' || pos === 'WG' || pos === 'LW' || pos === 'RW') && 
                        (philName === 'Herrera Catenaccio' || philName === 'Rocco Defense')) {
                        score *= 0.70; // Additional 30% penalty
                    }
                    
                    // Pure defenders/DMs in pure attacking systems
                    if ((pos === 'CB' || pos === 'DM' || pos === 'GK') && 
                        (philName === 'Fontaine Attack' || philName === 'Menotti Artistry' || philName === 'Santana Joga Bonito')) {
                        score *= 0.65; // Additional 35% penalty
                    }
                }
                
                // STEP 7: Remove random variance (was causing weird results)
                // Instead, add small FGA-based adjustment for precision
                const fgaPrecision = (fga % 10) * 0.01; // 0.0 to 0.09
                score *= (1 + fgaPrecision);
                
                // STEP 8: Final bounds - WIDER RANGE (2.0 to 10.0)
                // Remove the floor of 5.0 to allow poor fits
                const finalScore = Math.min(10.0, Math.max(2.0, score));
                
                scores[philName] = {
                    score: Math.round(finalScore * 10) / 10,
                    weight: phil.weight,
                    school: phil.school,
                    description: phil.description,
                    weightedScore: Math.round(finalScore * phil.weight * 10) / 10
                };
            });
            
            return scores;
        }
        
        function generatePhilosophyInsight() {
            if (!selectedComparePlayers || selectedComparePlayers.length === 0) {
                return 'Select players to analyze their philosophical compatibility.';
            }
            
            const philosophyScores = selectedComparePlayers.map(p => ({
                name: p.name,
                philosophy: p.bestPhilosophy,
                scores: calculatePhilosophyScores(p)
            }));
            
            // Find common strengths
            const allPhilosophies = Object.keys(philosophyScores[0].scores);
            const topPhilosophies = allPhilosophies
                .map(phil => ({
                    name: phil,
                    avgScore: philosophyScores.reduce((sum, p) => sum + p.scores[phil].score, 0) / philosophyScores.length
                }))
                .sort((a, b) => b.avgScore - a.avgScore)
                .slice(0, 3);
            
            const insights = [];
            
            if (selectedComparePlayers.length === 2) {
                const compatibility = topPhilosophies[0].avgScore;
                if (compatibility >= 9.0) {
                    insights.push(`‚≠ê Exceptional tactical compatibility - both players excel in ${topPhilosophies[0].name} systems.`);
                } else if (compatibility >= 7.5) {
                    insights.push(`‚úÖ Good tactical fit - complementary strengths in ${topPhilosophies[0].name} approach.`);
                } else {
                    insights.push(`‚ö†Ô∏è Different tactical DNA - ${selectedComparePlayers[0].name} suits ${selectedComparePlayers[0].bestPhilosophy}, while ${selectedComparePlayers[1].name} thrives in ${selectedComparePlayers[1].bestPhilosophy}.`);
                }
            } else {
                insights.push(`üéØ Best team philosophy fit: ${topPhilosophies[0].name} (avg score: ${topPhilosophies[0].avgScore.toFixed(1)}/10).`);
                insights.push(`Alternative systems: ${topPhilosophies[1].name} (${topPhilosophies[1].avgScore.toFixed(1)}/10), ${topPhilosophies[2].name} (${topPhilosophies[2].avgScore.toFixed(1)}/10).`);
            }
            
            return insights.join(' ');
        }
        
        // ============ ENHANCED COMPARISON FUNCTION ============
        function generateComparison() {
            if (selectedComparePlayers.length < 2) {
                alert('Please select at least 2 players to compare');
                return;
            }
            
            const resultsDiv = document.getElementById('comparison-results');
            resultsDiv.classList.remove('hidden');
            
            // Calculate derived metrics for all players
            const playersWithMetrics = selectedComparePlayers.map(p => ({
                ...p,
                components: estimateComponentScores(p),
                derived: calculateDerivedMetrics(p),
                analysis: analyzeStrengthsWeaknesses(p)
            }));
            
            // Find best in each category
            const bestFGA = findBestInCategory(selectedComparePlayers, 'fga');
            const bestValue = findBestInCategory(selectedComparePlayers, 'value');
            const bestLongevity = findBestInCategory(selectedComparePlayers, 'longevity');
            
            // Generate tactical recommendations
            const tacticalRecs = generateTacticalRecommendations(selectedComparePlayers);
            
            resultsDiv.innerHTML = `
                <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6 mb-6">
                    <h3 class="text-2xl font-bold mb-6 text-center gradient-text">Enhanced Player Comparison</h3>
                    
                    <!-- Radar Chart -->
                    <div class="bg-slate-800/50 border border-blue-500/20 rounded-lg p-6 mb-6">
                        <h4 class="text-lg font-bold text-blue-300 mb-4 text-center">Performance Profile Visualization</h4>
                        <div class="flex justify-center">
                            <canvas id="comparison-radar-chart" width="600" height="400"></canvas>
                        </div>
                        <div class="mt-4 text-center text-sm text-slate-400">
                            <p>Visual comparison across 6 core performance dimensions: Attacking, Passing, Defending, Possession, Intelligence, Physicality</p>
                        </div>
                    </div>
                    
                    <!-- Player Cards with Enhanced Metrics -->
                    <div class="grid md:grid-cols-${selectedComparePlayers.length} gap-6 mb-6">
                        ${playersWithMetrics.map(player => {
                            const isBestFGA = bestFGA.includes(player.name);
                            const isBestValue = bestValue.includes(player.name);
                            const isBestLongevity = bestLongevity.includes(player.name);
                            
                            return `
                            <div class="bg-slate-800/50 border border-blue-500/20 rounded-lg p-6">
                                <div class="text-center mb-4">
                                    <div class="text-4xl mb-2">${getPositionIcon(player.position)}</div>
                                    <h4 class="text-xl font-bold text-white">
                                        <a href="${player.profileHtml}" target="_blank" class="hover:text-blue-400">${player.name}</a>
                                    </h4>
                                    <div class="text-sm text-slate-400 mt-1">${player.position} | ${player.nationality}</div>
                                </div>
                                
                                <!-- Key Metrics -->
                                <div class="space-y-3 mb-4">
                                    <div class="flex justify-between items-center border-b border-slate-700 pb-2">
                                        <span class="text-slate-400">FGA Rating</span>
                                        <span class="font-bold text-2xl ${isBestFGA ? 'text-green-400' : 'text-blue-400'}">
                                            ${player.fga_rating.toFixed(1)} ${isBestFGA ? '‚úì' : ''}
                                        </span>
                                    </div>
                                    
                                    <div class="flex justify-between items-center border-b border-slate-700 pb-2">
                                        <span class="text-slate-400">Age</span>
                                        <span class="font-bold">${player.age} ${player.derived.ageBadge} <span class="text-xs text-slate-500">${player.derived.ageCategory}</span></span>
                                    </div>
                                    
                                    ${player.marketValue > 0 ? `
                                    <div class="flex justify-between items-center border-b border-slate-700 pb-2">
                                        <span class="text-slate-400">Market Value</span>
                                        <span class="font-bold text-green-400">‚Ç¨${(player.marketValue / 1000000).toFixed(1)}M</span>
                                    </div>
                                    ` : ''}
                                    
                                    <div class="flex justify-between items-center border-b border-slate-700 pb-2">
                                        <span class="text-slate-400">Philosophy</span>
                                        <span class="font-bold text-xs text-blue-300">${player.bestPhilosophy}</span>
                                    </div>
                                </div>
                                
                                <!-- Derived Metrics -->
                                <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-3 mb-4">
                                    <h5 class="text-xs font-bold text-blue-300 mb-2 uppercase">Advanced Metrics</h5>
                                    <div class="space-y-2 text-sm">
                                        ${player.derived.valueEfficiency ? `
                                        <div class="flex justify-between">
                                            <span class="text-slate-400">Value Efficiency</span>
                                            <span class="font-bold ${isBestValue ? 'text-green-400' : 'text-white'}">
                                                ${player.derived.valueEfficiency} ${isBestValue ? '‚úì' : ''}
                                            </span>
                                        </div>
                                        ` : ''}
                                        <div class="flex justify-between">
                                            <span class="text-slate-400">Age-Adjusted FGA</span>
                                            <span class="font-bold text-white">${player.derived.ageAdjustedRating}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-slate-400">Elite Years Left</span>
                                            <span class="font-bold ${isBestLongevity ? 'text-green-400' : 'text-white'}">
                                                ${player.derived.longevityScore} ${isBestLongevity ? '‚úì' : ''}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Strengths -->
                                <div class="mb-3">
                                    <h5 class="text-xs font-bold text-green-300 mb-2 uppercase">‚úì Strengths</h5>
                                    <ul class="space-y-1">
                                        ${player.analysis.strengths.map(s => `
                                            <li class="text-xs text-slate-300">‚Ä¢ ${s}</li>
                                        `).join('')}
                                    </ul>
                                </div>
                                
                                <!-- Weaknesses -->
                                <div>
                                    <h5 class="text-xs font-bold text-yellow-300 mb-2 uppercase">‚ö† Weaknesses</h5>
                                    <ul class="space-y-1">
                                        ${player.analysis.weaknesses.map(w => `
                                            <li class="text-xs text-slate-300">‚Ä¢ ${w}</li>
                                        `).join('')}
                                    </ul>
                                </div>
                            </div>
                        `;
                        }).join('')}
                    </div>
                    
                    <!-- Tactical Recommendations -->
                    ${tacticalRecs.length > 0 ? `
                    <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-6 mb-6">
                        <h4 class="text-lg font-bold text-blue-300 mb-4">üéØ Tactical Recommendations</h4>
                        <div class="space-y-4">
                            ${tacticalRecs.map(rec => `
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <div class="flex items-start gap-3">
                                        <div class="text-2xl">${rec.icon}</div>
                                        <div class="flex-1">
                                            <h5 class="font-bold text-white mb-1">${rec.system}</h5>
                                            <p class="text-sm text-blue-300 mb-2">Recommended: <span class="font-bold">${rec.recommended}</span></p>
                                            <p class="text-sm text-slate-300">${rec.reason}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- FGA CORE METRICS COMPARISON -->
                    <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6 mb-6">
                        <h4 class="text-2xl font-bold text-center gradient-text mb-6">‚öΩ Empire FGA Core Metrics Comparison</h4>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b border-blue-500/30">
                                        <th class="text-left py-3 px-2 text-blue-300 font-bold">Metric</th>
                                        ${playersWithMetrics.map(p => `
                                            <th class="text-center py-3 px-2 text-white font-bold">${p.name}</th>
                                        `).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${(() => {
                                        const fgaMetrics = playersWithMetrics.map(p => calculateFGACoreMetrics(p));
                                        
                                        const metricRows = [
                                            { label: 'üéØ ATTACKING METRICS', type: 'header' },
                                            { label: 'XPS (Enhanced Shooting)', key: 'xps', desc: 'Shot quality & conversion' },
                                            { label: 'STK (Striking Precision)', key: 'stk', desc: 'Finishing accuracy' },
                                            { label: 'RDS (Radius of Excellence)', key: 'rds', desc: 'Effective shooting range' },
                                            { label: 'KEY (Key Passes)', key: 'key', desc: 'Chance creation ability' },
                                            
                                            { label: 'üéØ PASSING METRICS', type: 'header' },
                                            { label: 'LGP (Long Pass)', key: 'lgp', desc: 'Long ball accuracy' },
                                            { label: 'VRP (Vertical Pass)', key: 'vrp', desc: 'Forward passing' },
                                            { label: 'HZP (Horizontal Pass)', key: 'hzp', desc: 'Lateral distribution' },
                                            { label: 'UNP (Unpredictability)', key: 'unp', desc: 'Pass variety & creativity' },
                                            { label: 'DGP (Dangerous Pass)', key: 'dgp', desc: 'High-risk attacking passes' },
                                            
                                            { label: 'üõ°Ô∏è DEFENSIVE METRICS', type: 'header' },
                                            { label: 'MRK (Marking)', key: 'mrk', desc: 'Defensive positioning' },
                                            { label: 'TAC (Tackling)', key: 'tac', desc: 'Tackle success rate' },
                                            { label: 'INT (Interceptions)', key: 'int', desc: 'Reading the game' },
                                            { label: 'CLE (Clearances)', key: 'cle', desc: 'Defensive clearances' },
                                            { label: 'BLO (Blocks)', key: 'blo', desc: 'Shot/pass blocking' },
                                            
                                            { label: '‚ö° POSSESSION METRICS', type: 'header' },
                                            { label: 'CAR (Carrying)', key: 'car', desc: 'Ball carrying ability' },
                                            { label: 'DRB (Dribbling)', key: 'drb', desc: 'Dribble success rate' },
                                            
                                            { label: 'üß† INTELLIGENCE METRICS', type: 'header' },
                                            { label: 'POI (Position Intelligence)', key: 'poi', desc: 'Spatial awareness' },
                                            { label: 'CPX (Composure)', key: 'cpx', desc: 'Decision making under pressure' },
                                            { label: 'MOB (Mobility)', key: 'mob', desc: 'Movement & agility' }
                                        ];
                                        
                                        return metricRows.map(row => {
                                            if (row.type === 'header') {
                                                return `
                                                    <tr class="bg-blue-900/20">
                                                        <td colspan="${playersWithMetrics.length + 1}" class="py-3 px-2 font-bold text-blue-300 text-center">
                                                            ${row.label}
                                                        </td>
                                                    </tr>
                                                `;
                                            }
                                            
                                            const values = fgaMetrics.map(m => m[row.key]);
                                            const maxValue = Math.max(...values);
                                            
                                            return `
                                                <tr class="border-b border-slate-700/50 hover:bg-slate-800/30">
                                                    <td class="py-2 px-2 text-slate-300">
                                                        <div class="font-semibold">${row.label}</div>
                                                        <div class="text-xs text-slate-500">${row.desc}</div>
                                                    </td>
                                                    ${fgaMetrics.map(m => {
                                                        const value = m[row.key];
                                                        const isBest = value === maxValue && value > 0;
                                                        const percentage = (value / 10) * 100;
                                                        
                                                        return `
                                                            <td class="py-2 px-2 text-center">
                                                                <div class="font-bold text-lg ${isBest ? 'text-green-400' : 'text-white'}">
                                                                    ${value.toFixed(1)} ${isBest ? '‚úì' : ''}
                                                                </div>
                                                                <div class="w-full bg-slate-700 rounded-full h-1 mt-1">
                                                                    <div class="h-1 rounded-full ${isBest ? 'bg-green-400' : 'bg-blue-400'}" 
                                                                         style="width: ${percentage}%"></div>
                                                                </div>
                                                            </td>
                                                        `;
                                                    }).join('')}
                                                </tr>
                                            `;
                                        }).join('');
                                    })()}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-4 text-center text-xs text-slate-500">
                            <p>üìä All metrics on 0-10 scale | ‚úì = Best in comparison | Based on Empire FGA 779-Metric System</p>
                        </div>
                    </div>
                    
                    <!-- PHILOSOPHY COMPATIBILITY SCORES -->
                    <div class="bg-slate-900/50 border border-blue-500/20 rounded-xl p-6 mb-6">
                        <h4 class="text-2xl font-bold text-center gradient-text mb-2">üß† Tactical Philosophy Compatibility Scores</h4>
                        <p class="text-center text-slate-400 text-sm mb-6">Complete 60-Philosophy Framework | 9 Tactical Schools | Weighted by Historical Impact</p>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b border-blue-500/30">
                                        <th class="text-left py-3 px-2 text-blue-300 font-bold">Philosophy System</th>
                                        ${playersWithMetrics.map(p => `
                                            <th class="text-center py-3 px-2 text-white font-bold">${p.name}</th>
                                        `).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${(() => {
                                        const philosophyScores = playersWithMetrics.map(p => calculatePhilosophyScores(p));
                                        const philosophies = Object.keys(philosophyScores[0]);
                                        
                                        // Group philosophies by school
                                        const schools = {
                                            'Dutch': [], 'Spanish': [], 'Italian': [], 'English': [],
                                            'German': [], 'French': [], 'South American': [],
                                            'Eastern European': [], 'Modern': []
                                        };
                                        
                                        philosophies.forEach(philName => {
                                            const school = philosophyScores[0][philName].school || 'Modern';
                                            schools[school].push(philName);
                                        });
                                        
                                        let html = '';
                                        Object.keys(schools).forEach(schoolName => {
                                            if (schools[schoolName].length === 0) return;
                                            
                                            // School header row
                                            const schoolEmoji = {
                                                'Dutch': 'üá≥üá±',
                                                'Spanish': 'üá™üá∏',
                                                'Italian': 'üáÆüáπ',
                                                'English': 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø',
                                                'German': 'üá©üá™',
                                                'French': 'üá´üá∑',
                                                'South American': 'üåé',
                                                'Eastern European': '‚≠ê',
                                                'Modern': 'üî•'
                                            };
                                            
                                            html += `
                                                <tr class="bg-gradient-to-r from-blue-900/40 to-cyan-900/40 border-y-2 border-blue-500/50">
                                                    <td colspan="${playersWithMetrics.length + 1}" class="py-3 px-4 text-center">
                                                        <div class="text-lg font-bold text-white">
                                                            ${schoolEmoji[schoolName]} ${schoolName.toUpperCase()} SCHOOL (${schools[schoolName].length} Philosophies)
                                                        </div>
                                                    </td>
                                                </tr>
                                            `;
                                            
                                            // Philosophy rows for this school
                                            schools[schoolName].forEach(philName => {
                                                const scores = philosophyScores.map(ps => ps[philName]);
                                                const maxScore = Math.max(...scores.map(s => s.score));
                                                
                                                html += `
                                                    <tr class="border-b border-slate-700/50 hover:bg-slate-800/30">
                                                        <td class="py-3 px-2 text-slate-300">
                                                            <div class="font-bold text-white">${philName}</div>
                                                            <div class="text-xs text-slate-500">${scores[0].description}</div>
                                                            <div class="text-xs text-blue-400 mt-1">Weight: ${scores[0].weight}x</div>
                                                        </td>
                                                        ${scores.map((s, idx) => {
                                                            const isBest = s.score === maxScore && s.score > 0;
                                                            const isPlayerPhil = playersWithMetrics[idx].bestPhilosophy.includes(philName.split(' ')[0]);
                                                            const percentage = (s.score / 10) * 100;
                                                            
                                                            return `
                                                                <td class="py-3 px-2 text-center ${isPlayerPhil ? 'bg-blue-900/20' : ''}">
                                                                    <div class="font-bold text-xl ${isBest ? 'text-green-400' : isPlayerPhil ? 'text-blue-400' : 'text-white'}">
                                                                        ${s.score.toFixed(1)} ${isBest ? '‚úì' : ''} ${isPlayerPhil ? '‚≠ê' : ''}
                                                                    </div>
                                                                    <div class="text-xs text-slate-400 mb-1">
                                                                        Weighted: ${s.weightedScore.toFixed(1)}
                                                                    </div>
                                                                    <div class="w-full bg-slate-700 rounded-full h-2">
                                                                        <div class="h-2 rounded-full ${isBest ? 'bg-green-400' : isPlayerPhil ? 'bg-blue-400' : 'bg-slate-500'}" 
                                                                             style="width: ${percentage}%"></div>
                                                                    </div>
                                                                </td>
                                                            `;
                                                        }).join('')}
                                                    </tr>
                                                `;
                                            });
                                        });
                                        
                                        return html;
                                    })()}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-4 text-center text-xs text-slate-500">
                            <p>‚≠ê = Player's best philosophy | ‚úì = Highest score | Weighted scores account for philosophy importance (1.0-1.45x)</p>
                        </div>
                    </div>
                    
                    <!-- Philosophy Analysis -->
                    <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                        <h4 class="font-bold text-blue-300 mb-2">üß† Philosophy Compatibility Analysis</h4>
                        <p class="text-sm text-slate-300">${generatePhilosophyInsight()}</p>
                    </div>
                </div>
            `;
            
            // Render radar chart
            renderRadarChart(playersWithMetrics);
        }
        
        // ============ RADAR CHART RENDERING ============
        function renderRadarChart(players) {
            const ctx = document.getElementById('comparison-radar-chart');
            if (!ctx) return;
            
            // Destroy existing chart if it exists
            if (window.comparisonChart) {
                window.comparisonChart.destroy();
            }
            
            const colors = [
                { border: '#60a5fa', bg: 'rgba(96, 165, 250, 0.2)' },
                { border: '#22d3ee', bg: 'rgba(34, 211, 238, 0.2)' },
                { border: '#10b981', bg: 'rgba(16, 185, 129, 0.2)' },
                { border: '#f59e0b', bg: 'rgba(245, 158, 11, 0.2)' }
            ];
            
            const datasets = players.map((player, index) => ({
                label: player.name,
                data: [
                    player.components.attacking,
                    player.components.passing,
                    player.components.defending,
                    player.components.possession,
                    player.components.intelligence,
                    player.components.physicality
                ],
                borderColor: colors[index].border,
                backgroundColor: colors[index].bg,
                pointBackgroundColor: colors[index].border,
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: colors[index].border,
                borderWidth: 2
            }));
            
            window.comparisonChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Attacking', 'Passing', 'Defending', 'Possession', 'Intelligence', 'Physicality'],
                    labels: ['Attacking', 'Passing', 'Defending', 'Physical', 'Technical', 'Mental'],
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                color: '#94a3b8'
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.2)'
                            },
                            pointLabels: {
                                color: '#e2e8f0',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0',
                                font: {
                                    size: 13
                                },
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleColor: '#60a5fa',
                            bodyColor: '#e2e8f0',
                            borderColor: '#60a5fa',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true
                        }
                    }
                }
            });
        }
        

        // MARKET INTELLIGENCE FUNCTIONS
        function renderMarketIntelligence() {
            // Filter to only active players (age <= 38) with market value > 0
            const activePlayers = playerData.filter(p => p.age <= 38 && p.marketValue > 0);
            
            // Calculate value gaps (expected value based on FGA vs actual market value)
            const playersWithGaps = activePlayers.map(p => {
                const expectedValue = calculateExpectedValue(p.fga_rating, p.age);
                const gap = expectedValue - p.marketValue;
                const gapPercentage = p.marketValue > 0 ? (gap / p.marketValue) * 100 : 0;
                return { ...p, expectedValue, gap, gapPercentage };
            });
            
            // Filter to undervalued (gap > 20%)
            const undervalued = playersWithGaps
                .filter(p => p.gapPercentage > 20)
                .sort((a, b) => b.gapPercentage - a.gapPercentage)
                .slice(0, 20);
            
            // Update stats
            document.getElementById('market-stat-undervalued').textContent = undervalued.length;
            
            const totalHiddenValue = undervalued.reduce((sum, p) => sum + p.gap, 0);
            document.getElementById('market-stat-value').textContent = `‚Ç¨${(totalHiddenValue / 1000000).toFixed(0)}M`;
            
            const avgGap = undervalued.length > 0 
                ? (undervalued.reduce((sum, p) => sum + p.gapPercentage, 0) / undervalued.length).toFixed(0)
                : 0;
            document.getElementById('market-stat-gap').textContent = `${avgGap}%`;
            
            // Render list
            const listDiv = document.getElementById('undervalued-list');
            if (undervalued.length === 0) {
                listDiv.innerHTML = '<p class="text-slate-400 text-center py-8">No undervalued active players found in current database</p>';
                return;
            }
            
            listDiv.innerHTML = undervalued.map((player, index) => `
                <div class="flex items-center justify-between p-4 bg-slate-800/50 rounded-lg hover:bg-slate-800">
                    <div class="flex items-center gap-4">
                        <div class="text-2xl font-bold text-blue-400">#${index + 1}</div>
                        <div>
                            <div class="font-bold text-white">
                                <a href="${player.profileHtml}" target="_blank" class="hover:text-blue-400">${player.name}</a>
                            </div>
                            <div class="text-sm text-slate-400">${player.position} | ${player.nationality} | Age ${player.age}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-green-400">FGA: ${player.fga_rating.toFixed(1)}</div>
                        <div class="text-sm text-slate-400">Market: ‚Ç¨${(player.marketValue / 1000000).toFixed(1)}M</div>
                        <div class="text-sm text-green-300">Expected: ‚Ç¨${(player.expectedValue / 1000000).toFixed(1)}M</div>
                        <span class="value-badge undervalued">${player.gapPercentage.toFixed(0)}% undervalued</span>
                    </div>
                </div>
            `).join('');
        }

        function calculateExpectedValue(fga, age) {
            // Age penalty factor
            let ageFactor = 1.0;
            if (age <= 21) ageFactor = 0.85;
            else if (age <= 25) ageFactor = 1.0;
            else if (age <= 28) ageFactor = 0.95;
            else if (age <= 31) ageFactor = 0.75;
            else if (age <= 34) ageFactor = 0.5;
            else if (age <= 38) ageFactor = 0.3;
            
            // Base value from FGA
            let baseValue;
            if (fga >= 97) baseValue = 90000000;
            else if (fga >= 95) baseValue = 65000000;
            else if (fga >= 93) baseValue = 48000000;
            else if (fga >= 90) baseValue = 35000000;
            else if (fga >= 88) baseValue = 25000000;
            else if (fga >= 85) baseValue = 18000000;
            else if (fga >= 82) baseValue = 12000000;
            else if (fga >= 80) baseValue = 8000000;
            else if (fga >= 77) baseValue = 5000000;
            else baseValue = 3000000;
            
            return Math.round(baseValue * ageFactor);
        }

        // PHILOSOPHY HEATMAP FUNCTIONS
        function renderPhilosophyHeatmap() {
            // Count players by philosophy keywords
            const philosophyCounts = {};
            
            playerData.forEach(player => {
                const philosophy = player.bestPhilosophy;
                philosophyCounts[philosophy] = (philosophyCounts[philosophy] || 0) + 1;
            });
            
            // Group by schools
            const schools = {
                'Dutch School': ['Cruyff', 'Michels', 'Van Gaal', 'Total'],
                'Spanish School': ['Guardiola', 'Aragon√©s', 'Clemente'],
                'Italian School': ['Sacchi', 'Lippi', 'Capello', 'Trapattoni', 'Ancelotti', 'Herrera', 'Catenaccio'],
                'English School': ['Ferguson', 'Shankly', 'Paisley', 'Clough', 'Busby'],
                'German School': ['Heynckes', 'Beckenbauer', 'Cramer', 'Hitzfeld'],
                'French School': ['Wenger', 'Platini', 'Deschamps', 'Fontaine'],
                'South American': ['Menotti', 'Bilardo', 'Bielsa', 'Simeone', 'Zagallo', 'Santana', 'JogoBonito'],
                'Modern/Other': ['Mourinho', 'Klopp', 'Conte', 'Pochettino', 'Inzaghi', 'Yashin']
            };
            
            const heatmapDiv = document.getElementById('philosophy-heatmap');
            let html = '<div class="overflow-x-auto"><table class="w-full">';
            html += '<thead><tr class="border-b border-blue-500/30">';
            html += '<th class="p-3 text-left text-blue-300">School</th>';
            html += '<th class="p-3 text-center text-blue-300">Philosophy Keywords</th>';
            html += '<th class="p-3 text-center text-blue-300">Player Count</th>';
            html += '</tr></thead><tbody>';
            
            Object.entries(schools).forEach(([school, keywords]) => {
                // Count players matching this school's keywords
                let schoolCount = 0;
                const matchedPhilosophies = [];
                
                Object.entries(philosophyCounts).forEach(([philosophy, count]) => {
                    if (keywords.some(keyword => philosophy.includes(keyword))) {
                        schoolCount += count;
                        matchedPhilosophies.push(`${philosophy} (${count})`);
                    }
                });
                
                const intensity = Math.min(schoolCount / 50, 1);
                
                html += `<tr class="border-b border-slate-700/50">`;
                html += `<td class="p-3 font-bold text-white">${school}</td>`;
                html += `<td class="p-3 text-sm text-slate-400">${matchedPhilosophies.slice(0, 5).join(', ')}${matchedPhilosophies.length > 5 ? '...' : ''}</td>`;
                html += `<td class="p-3 text-center">`;
                html += `<div class="heatmap-cell" style="background: rgba(59, 130, 246, ${intensity}); border: 1px solid rgba(59, 130, 246, ${intensity + 0.2});">`;
                html += `${schoolCount}`;
                html += `</div></td></tr>`;
            });
            
            html += '</tbody></table></div>';
            html += `<div class="mt-6 p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg">
                <p class="text-sm text-slate-300">
                    <strong class="text-blue-300">üí° Insight:</strong> 
                    This heatmap shows the distribution of your ${playerData.length} players across major tactical schools. 
                    Darker cells indicate higher player concentration in that philosophical tradition.
                </p>
            </div>`;
            
            heatmapDiv.innerHTML = html;
        }

        // SQUAD BUILDER FUNCTIONS
        function initializeSquadBuilder() {
            renderFormation('4-3-3');
        }

        function selectFormation(formation) {
            currentFormation = formation;
            document.querySelectorAll('.formation-selector').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderFormation(formation);
        }

        function renderFormation(formation) {
            const pitch = document.getElementById('pitch');
            const formations = {
                '4-3-3': [
                    { pos: 'GK', x: 50, y: 90, idx: 0 },
                    { pos: 'LB', x: 15, y: 70, idx: 1 }, { pos: 'CB', x: 35, y: 75, idx: 2 }, 
                    { pos: 'CB', x: 65, y: 75, idx: 3 }, { pos: 'RB', x: 85, y: 70, idx: 4 },
                    { pos: 'CM', x: 30, y: 50, idx: 5 }, { pos: 'CM', x: 50, y: 48, idx: 6 }, { pos: 'CM', x: 70, y: 50, idx: 7 },
                    { pos: 'LW', x: 15, y: 20, idx: 8 }, { pos: 'ST', x: 50, y: 15, idx: 9 }, { pos: 'RW', x: 85, y: 20, idx: 10 }
                ],
                '4-4-2': [
                    { pos: 'GK', x: 50, y: 90, idx: 0 },
                    { pos: 'LB', x: 15, y: 70, idx: 1 }, { pos: 'CB', x: 35, y: 75, idx: 2 }, 
                    { pos: 'CB', x: 65, y: 75, idx: 3 }, { pos: 'RB', x: 85, y: 70, idx: 4 },
                    { pos: 'LM', x: 15, y: 45, idx: 5 }, { pos: 'CM', x: 38, y: 50, idx: 6 }, 
                    { pos: 'CM', x: 62, y: 50, idx: 7 }, { pos: 'RM', x: 85, y: 45, idx: 8 },
                    { pos: 'ST', x: 38, y: 15, idx: 9 }, { pos: 'ST', x: 62, y: 15, idx: 10 }
                ],
                '3-5-2': [
                    { pos: 'GK', x: 50, y: 90, idx: 0 },
                    { pos: 'CB', x: 25, y: 75, idx: 1 }, { pos: 'CB', x: 50, y: 78, idx: 2 }, { pos: 'CB', x: 75, y: 75, idx: 3 },
                    { pos: 'LWB', x: 10, y: 55, idx: 4 }, { pos: 'CM', x: 30, y: 50, idx: 5 }, 
                    { pos: 'CM', x: 50, y: 48, idx: 6 }, { pos: 'CM', x: 70, y: 50, idx: 7 }, { pos: 'RWB', x: 90, y: 55, idx: 8 },
                    { pos: 'ST', x: 38, y: 15, idx: 9 }, { pos: 'ST', x: 62, y: 15, idx: 10 }
                ],
                '4-2-3-1': [
                    { pos: 'GK', x: 50, y: 90, idx: 0 },
                    { pos: 'LB', x: 15, y: 70, idx: 1 }, { pos: 'CB', x: 35, y: 75, idx: 2 }, 
                    { pos: 'CB', x: 65, y: 75, idx: 3 }, { pos: 'RB', x: 85, y: 70, idx: 4 },
                    { pos: 'DM', x: 38, y: 55, idx: 5 }, { pos: 'DM', x: 62, y: 55, idx: 6 },
                    { pos: 'LM', x: 20, y: 35, idx: 7 }, { pos: 'AM', x: 50, y: 30, idx: 8 }, { pos: 'RM', x: 80, y: 35, idx: 9 },
                    { pos: 'ST', x: 50, y: 15, idx: 10 }
                ],
                '3-4-3': [
                    { pos: 'GK', x: 50, y: 90, idx: 0 },
                    { pos: 'CB', x: 25, y: 75, idx: 1 }, { pos: 'CB', x: 50, y: 78, idx: 2 }, { pos: 'CB', x: 75, y: 75, idx: 3 },
                    { pos: 'LM', x: 15, y: 50, idx: 4 }, { pos: 'CM', x: 38, y: 50, idx: 5 }, 
                    { pos: 'CM', x: 62, y: 50, idx: 6 }, { pos: 'RM', x: 85, y: 50, idx: 7 },
                    { pos: 'LW', x: 20, y: 20, idx: 8 }, { pos: 'ST', x: 50, y: 15, idx: 9 }, { pos: 'RW', x: 80, y: 20, idx: 10 }
                ]
            };
            
            // Clear existing positions
            pitch.querySelectorAll('.pitch-position').forEach(el => el.remove());
            
            // Add new positions
            formations[formation].forEach((pos) => {
                const div = document.createElement('div');
                div.className = 'pitch-position';
                div.style.left = `${pos.x}%`;
                div.style.top = `${pos.y}%`;
                div.style.transform = 'translate(-50%, -50%)';
                div.dataset.posidx = pos.idx;
                
                // Check if this position has a player assigned
                const assignedPlayer = selectedSquadPlayers.find(p => p.positionIdx === pos.idx);
                if (assignedPlayer) {
                    div.classList.add('filled');
                    div.innerHTML = `<div style="font-size: 9px;">${assignedPlayer.name.split(' ').pop()}</div><div>${pos.pos}</div>`;
                } else {
                    div.innerHTML = pos.pos;
                }
                
                div.onclick = () => selectSquadPosition(pos.idx, pos.pos);
                pitch.appendChild(div);
            });
            
            updateSquadStats();
        }

        let currentlySelectingForPosition = null;

        function selectSquadPosition(idx, posName) {
            currentlySelectingForPosition = { idx, posName };
            alert(`Position ${posName} selected. Search for a player to assign to this position, or click the player card to assign them here.`);
        }

        function searchForSquad(query) {
            const results = document.getElementById('squad-search-results');
            if (!query) {
                results.innerHTML = '<p class="text-slate-400 text-sm">Search for players to add to your squad</p>';
                return;
            }
            
            const matches = playerData.filter(p => 
                p.name.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 8);
            
            results.innerHTML = matches.map(player => `
                <div class="player-card" onclick="assignToSquad('${player.name.replace(/'/g, "\\'")}')">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-bold text-sm">${player.name}</div>
                            <div class="text-xs text-slate-400">${player.position} | FGA: ${player.fga_rating.toFixed(1)}</div>
                        </div>
                        <button class="bg-green-600 px-2 py-1 rounded text-xs">Add</button>
                    </div>
                </div>
            `).join('');
        }

        function assignToSquad(playerName) {
            const player = playerData.find(p => p.name === playerName);
            if (!player) return;
            
            if (!currentlySelectingForPosition) {
                alert('Please select a position on the pitch first by clicking on a position circle.');
                return;
            }
            
            // Remove player from this position if already assigned
            selectedSquadPlayers = selectedSquadPlayers.filter(p => p.positionIdx !== currentlySelectingForPosition.idx);
            
            // Assign player to this position
            selectedSquadPlayers.push({
                ...player,
                positionIdx: currentlySelectingForPosition.idx,
                positionName: currentlySelectingForPosition.posName
            });
            
            currentlySelectingForPosition = null;
            renderFormation(currentFormation);
            updateSquadStats();
        }

        function updateSquadStats() {
            document.getElementById('squad-count').textContent = selectedSquadPlayers.length;
            
            if (selectedSquadPlayers.length > 0) {
                const avgFga = selectedSquadPlayers.reduce((sum, p) => sum + p.fga_rating, 0) / selectedSquadPlayers.length;
                document.getElementById('squad-avg-fga').textContent = avgFga.toFixed(1);
                
                // Calculate chemistry based on philosophy diversity
                const philosophies = selectedSquadPlayers.map(p => p.bestPhilosophy);
                const uniquePhilosophies = new Set(philosophies).size;
                const chemistry = Math.max(0, Math.min(100, 100 - (uniquePhilosophies - 1) * 12));
                document.getElementById('squad-chemistry').textContent = chemistry.toFixed(0) + '%';
            } else {
                document.getElementById('squad-avg-fga').textContent = '--';
                document.getElementById('squad-chemistry').textContent = '--';
            }
        }

        function clearSquad() {
            if (confirm('Clear all players from squad?')) {
                selectedSquadPlayers = [];
                currentlySelectingForPosition = null;
                renderFormation(currentFormation);
                updateSquadStats();
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('====== DOM LOADED ======');
            console.log('About to initialize...');
            
            filteredPlayers = [...playerData];
            updateStats();
            renderTable();
        });

        // ============ PDF EXPORT FUNCTIONALITY ============
        
        // Export individual player profile
    // ============================================================================
// EMPIRE FGA REVOLUTIONARY PDF GENERATOR V3.0
// The Most Sophisticated Football Intelligence Report Ever Created
// ============================================================================

// HELPER FUNCTIONS FOR MARKET INTELLIGENCE
// ============================================================================

function loadImage(url) {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'Anonymous';
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = url;
    });
}

function calculateAdvancedMarketValue(player, metrics) {
    const fga = player.fga_rating;
    const age = player.age;
    const pos = player.position;
    const club = player.currentClub || '';
    
    // Base valuation: ‚Ç¨1M per FGA point
    let baseValue = fga;
    
    // Age curve multiplier (peak 24-28)
    let ageMultiplier = 1.0;
    if (age <= 23) ageMultiplier = 1.3; // Youth premium + potential
    else if (age >= 24 && age <= 28) ageMultiplier = 1.5; // Peak years premium
    else if (age >= 29 && age <= 31) ageMultiplier = 1.0; // Stable value
    else if (age >= 32 && age <= 34) ageMultiplier = 0.7; // Declining
    else ageMultiplier = 0.5; // Veterans
    
    baseValue *= ageMultiplier;
    
    // Position premium (attackers are expensive)
    let positionMultiplier = 1.0;
    if (pos === 'ST') positionMultiplier = 1.4;
    else if (pos === 'WG') positionMultiplier = 1.35;
    else if (pos === 'AM') positionMultiplier = 1.3;
    else if (pos === 'CM') positionMultiplier = 1.2;
    else if (pos === 'FB') positionMultiplier = 1.15;
    else if (pos === 'CB') positionMultiplier = 1.1;
    else if (pos === 'DM') positionMultiplier = 1.05;
    else if (pos === 'GK') positionMultiplier = 1.0;
    
    baseValue *= positionMultiplier;
    
    // League inflation factor
    let leagueMultiplier = 1.0;
    if (club.includes('Manchester') || club.includes('Liverpool') || club.includes('Arsenal') || 
        club.includes('Chelsea') || club.includes('Tottenham') || club.includes('City')) {
        leagueMultiplier = 1.6; // Premier League elite
    } else if (club.includes('Real Madrid') || club.includes('Barcelona') || club.includes('Atl√©tico')) {
        leagueMultiplier = 1.5; // La Liga elite
    } else if (club.includes('Bayern') || club.includes('Dortmund')) {
        leagueMultiplier = 1.4; // Bundesliga top
    } else if (club.includes('PSG') || club.includes('Monaco')) {
        leagueMultiplier = 1.35; // Ligue 1 top
    } else if (club.includes('Inter') || club.includes('Milan') || club.includes('Juventus')) {
        leagueMultiplier = 1.3; // Serie A elite
    } else if (club.includes('Ajax') || club.includes('PSV') || club.includes('Feyenoord')) {
        leagueMultiplier = 1.1; // Eredivisie
    } else if (club.includes('Crew') || club.includes('MLS')) {
        leagueMultiplier = 0.85; // MLS
    } else {
        leagueMultiplier = 0.9; // Other leagues
    }
    
    baseValue *= leagueMultiplier;
    
    // Scarcity bonus (exceptional metrics)
    let scarcityBonus = 0;
    if (metrics.poi >= 9.0 && metrics.cpx >= 9.0) scarcityBonus += baseValue * 0.15; // Rare intelligence
    if (metrics.xps >= 9.0 && pos === 'ST') scarcityBonus += baseValue * 0.20; // Elite finisher
    if (metrics.tac >= 9.0 && metrics.int >= 9.0) scarcityBonus += baseValue * 0.12; // Elite defender
    
    const finalValue = baseValue + scarcityBonus;
    
    return {
        estimated: finalValue.toFixed(1),
        range: {
            min: (finalValue * 0.75).toFixed(1),
            max: (finalValue * 1.25).toFixed(1)
        },
        breakdown: {
            base: fga,
            ageMultiplier: ageMultiplier,
            positionMultiplier: positionMultiplier,
            leagueMultiplier: leagueMultiplier,
            scarcityBonus: scarcityBonus.toFixed(1)
        }
    };
}

function generateSmartTargetClubs(player, metrics, philScores) {
    const clubs = [];
    const pos = player.position;
    const age = player.age;
    const phil = player.bestPhilosophy;
    const fga = player.fga_rating;
    
    // Sort philosophies by score
    const topPhils = Object.entries(philScores)
        .sort((a, b) => b[1].score - a[1].score)
        .slice(0, 3);
    
    // TIER 1: PERFECT MATCHES (Based on actual player data)
    
    // Klopp-style high pressing clubs
    if (topPhils[0][0].includes('Klopp') || metrics.int >= 8.5 && metrics.mob >= 8.5) {
        if (pos === 'LB' || pos === 'FB' || pos === 'CM' || pos === 'WG') {
            clubs.push({
                name: 'Liverpool FC',
                match: 98,
                tier: 1,
                manager: 'Arne Slot',
                philosophy: 'High-intensity pressing transition',
                formation: '4-3-3',
                needUrgency: pos === 'LB' ? 'HIGH' : 'MEDIUM',
                budget: age <= 26 ? '‚Ç¨40-70M' : '‚Ç¨25-50M',
                competition: 'HIGH',
                pitchAngle: `Slot continues Klopp legacy. INT ${metrics.int.toFixed(1)} + MOB ${metrics.mob.toFixed(1)} = perfect for high-press ${pos}. Age ${age} fits recruitment profile.`,
                successProb: age <= 26 ? 72 : 65,
                reasoning: `Player's Klopp philosophy score: ${philScores['Klopp Intensity']?.score.toFixed(1) || 'N/A'}/10`
            });
        }
    }
    
    // Guardiola-style possession clubs
    if (topPhils[0][0].includes('Guardiola') || metrics.poi >= 8.5 && metrics.lgp >= 8.0) {
        if (age <= 28) {
            clubs.push({
                name: 'Manchester City',
                match: 97,
                tier: 1,
                manager: 'Pep Guardiola',
                philosophy: 'Positional play dominance',
                formation: '4-3-3 / 3-2-4-1',
                needUrgency: pos === 'CM' || pos === 'CB' ? 'HIGH' : 'MEDIUM',
                budget: '‚Ç¨50-90M',
                competition: 'VERY HIGH',
                pitchAngle: `POI ${metrics.poi.toFixed(1)} + technical excellence ideal for Pep's system. Age ${age} = long-term Guardiola project.`,
                successProb: 62,
                reasoning: `Guardiola philosophy score: ${philScores['Guardiola Positional']?.score.toFixed(1) || 'N/A'}/10`
            });
        }
    }
    
    // Progressive possession clubs (Brighton style)
    if ((metrics.car >= 8.0 && metrics.poi >= 8.0) || philScores['Cruyff Intelligence']?.score >= 8.5) {
        if (pos === 'LB' || pos === 'FB' || pos === 'CM' || pos === 'CB') {
            clubs.push({
                name: 'Brighton & Hove Albion',
                match: 96,
                tier: 1,
                manager: 'Fabian H√ºrzeler',
                philosophy: 'Progressive possession (De Zerbi evolution)',
                formation: '4-2-3-1',
                needUrgency: pos === 'LB' ? 'URGENT' : 'HIGH',
                budget: '‚Ç¨15-30M',
                competition: 'LOW',
                pitchAngle: `Brighton's data-driven approach perfect for 779-metric profile. CAR ${metrics.car.toFixed(1)} + POI ${metrics.poi.toFixed(1)} = ideal for inverted ${pos} role. Budget-friendly value.`,
                successProb: 85,
                reasoning: `Progressive metrics + undervalued = Brighton's specialty`
            });
        }
    }
    
    // Arsenal (Arteta - Guardiola disciple)
    if (philScores['Guardiola Positional']?.score >= 8.3 && age <= 27) {
        if (pos === 'CM' || pos === 'WG' || pos === 'ST' || pos === 'CB') {
            clubs.push({
                name: 'Arsenal FC',
                match: 95,
                tier: 1,
                manager: 'Mikel Arteta',
                philosophy: 'Guardiola-inspired possession + intensity',
                formation: '4-3-3',
                needUrgency: pos === 'CM' ? 'HIGH' : 'MEDIUM',
                budget: '‚Ç¨35-65M',
                competition: 'HIGH',
                pitchAngle: `Arteta building dynasty with young talent. Age ${age} + POI ${metrics.poi.toFixed(1)} fits profile. Technical excellence required.`,
                successProb: 70,
                reasoning: `Youth + technical quality = Arsenal's strategy`
            });
        }
    }
    
    // Brentford (Moneyball approach)
    if (fga >= 80 && age <= 28 && metrics.poi >= 7.5) {
        clubs.push({
            name: 'Brentford FC',
            match: 94,
            tier: 1,
            manager: 'Thomas Frank',
            philosophy: 'Data-driven attacking football',
            formation: '4-3-3 / 3-5-2',
            needUrgency: pos === 'ST' || pos === 'CM' ? 'HIGH' : 'MEDIUM',
            budget: '‚Ç¨12-25M',
            competition: 'MEDIUM',
            pitchAngle: `Brentford's Moneyball model = perfect for undervalued talent. FGA ${fga} shows value. Age ${age} = sell-on potential.`,
            successProb: 78,
            reasoning: `Data-driven club appreciates 779-metric analysis`
        });
    }
    
    // TIER 2: STRONG MATCHES
    
    // RB Leipzig (Red Bull system)
    if ((metrics.mob >= 8.0 && age <= 25) || philScores['Klopp Intensity']?.score >= 8.0) {
        clubs.push({
            name: 'RB Leipzig',
            match: 92,
            tier: 2,
            manager: 'Marco Rose',
            philosophy: 'High-press vertical football',
            formation: '4-2-2-2',
            needUrgency: age <= 23 ? 'HIGH' : 'MEDIUM',
            budget: '‚Ç¨15-35M',
            competition: 'MEDIUM',
            pitchAngle: `Red Bull system values: Youth (${age}), Mobility (${metrics.mob.toFixed(1)}), Intensity. Perfect talent development platform.`,
            successProb: 73,
            reasoning: `Red Bull's global scouting = perfect for emerging talent`
        });
    }
    
    // Tottenham (Postecoglou)
    if (philScores['Klopp Intensity']?.score >= 8.0 || metrics.xps >= 8.5) {
        if (pos === 'ST' || pos === 'WG' || pos === 'CM' || pos === 'FB') {
            clubs.push({
                name: 'Tottenham Hotspur',
                match: 91,
                tier: 2,
                manager: 'Ange Postecoglou',
                philosophy: 'Attacking high-press',
                formation: '4-3-3',
                needUrgency: pos === 'ST' ? 'URGENT' : 'MEDIUM',
                budget: '‚Ç¨25-50M',
                competition: 'HIGH',
                pitchAngle: `Postecoglou needs attacking intensity. Klopp score ${philScores['Klopp Intensity']?.score.toFixed(1) || 'N/A'} + XPS ${metrics.xps.toFixed(1)} = ideal fit.`,
                successProb: 68,
                reasoning: `Attacking philosophy + budget available`
            });
        }
    }
    
    // Union Berlin (Budget Bundesliga)
    if (fga >= 75 && age >= 26 && age <= 32) {
        if (pos === 'CB' || pos === 'DM' || pos === 'LB' || pos === 'FB') {
            clubs.push({
                name: 'Union Berlin',
                match: 88,
                tier: 2,
                manager: 'Bo Svensson',
                philosophy: 'Organized defensive football',
                formation: '3-5-2',
                needUrgency: 'MEDIUM',
                budget: '‚Ç¨5-15M',
                competition: 'LOW',
                pitchAngle: `Union's budget constraints + solid defensive needs. TAC ${metrics.tac.toFixed(1)} + experience (age ${age}) = perfect fit.`,
                successProb: 79,
                reasoning: `Budget-friendly + experience valued`
            });
        }
    }
    
    // Feyenoord (Eredivisie stepping stone)
    if (age <= 26 && fga >= 78) {
        clubs.push({
            name: 'Feyenoord Rotterdam',
            match: 87,
            tier: 2,
            manager: 'Brian Priske',
            philosophy: 'Attacking possession football',
            formation: '4-3-3',
            needUrgency: 'MEDIUM',
            budget: '‚Ç¨8-18M',
            competition: 'MEDIUM',
            pitchAngle: `Eredivisie = perfect stepping stone to elite clubs. Age ${age} + FGA ${fga} = UCL exposure potential. Sell-on value ‚Ç¨30M+.`,
            successProb: 75,
            reasoning: `Development platform with European football`
        });
    }
    
    // AZ Alkmaar (Development club)
    if (age <= 24 && fga >= 75) {
        clubs.push({
            name: 'AZ Alkmaar',
            match: 85,
            tier: 2,
            manager: 'Maarten Martens',
            philosophy: 'Youth development + attacking',
            formation: '4-3-3',
            needUrgency: 'MEDIUM',
            budget: '‚Ç¨5-12M',
            competition: 'LOW',
            pitchAngle: `AZ's youth development track record. Age ${age} = perfect for growth. Gateway to bigger clubs (see: Bergwijn, Koopmeiners).`,
            successProb: 80,
            reasoning: `Proven talent development pipeline`
        });
    }
    
    // Sort by match percentage and return top 6
    return clubs.sort((a, b) => b.match - a.match).slice(0, 6);
}

function generateComparableTransfers(player, metrics) {
    const pos = player.position;
    const age = player.age;
    const fga = player.fga_rating;
    
    // Real transfer database (simplified - expand with actual data)
    const transfers = [
        // Left Backs
        { name: 'Malo Gusto', pos: 'FB', age: 19, fga: 84, fee: 30, from: 'Lyon', to: 'Chelsea', year: 2023 },
        { name: 'Alphonso Davies', pos: 'LB', age: 18, fga: 89, fee: 25, from: 'Vancouver', to: 'Bayern', year: 2019 },
        { name: 'Nuno Mendes', pos: 'LB', age: 19, fga: 85, fee: 40, from: 'Sporting', to: 'PSG', year: 2021 },
        
        // Center Midfielders
        { name: 'Moises Caicedo', pos: 'CM', age: 21, fga: 86, fee: 115, from: 'Brighton', to: 'Chelsea', year: 2023 },
        { name: 'Declan Rice', pos: 'CM', age: 24, fga: 88, fee: 105, from: 'West Ham', to: 'Arsenal', year: 2023 },
        { name: 'Enzo Fernandez', pos: 'CM', age: 22, fga: 87, fee: 121, from: 'Benfica', to: 'Chelsea', year: 2023 },
        
        // Strikers
        { name: 'Rasmus H√∏jlund', pos: 'ST', age: 20, fga: 83, fee: 75, from: 'Atalanta', to: 'Man Utd', year: 2023 },
        { name: 'Darwin N√∫√±ez', pos: 'ST', age: 22, fga: 85, fee: 85, from: 'Benfica', to: 'Liverpool', year: 2022 },
        { name: 'Victor Osimhen', pos: 'ST', age: 24, fga: 91, fee: 75, from: 'Lille', to: 'Napoli', year: 2020 },
        
        // Wingers
        { name: 'Antony', pos: 'WG', age: 22, fga: 82, fee: 95, from: 'Ajax', to: 'Man Utd', year: 2022 },
        { name: 'Mykhaylo Mudryk', pos: 'WG', age: 22, fga: 83, fee: 88, from: 'Shakhtar', to: 'Chelsea', year: 2023 },
        
        // Attackers
        { name: 'Jude Bellingham', pos: 'CM', age: 20, fga: 92, fee: 103, from: 'Dortmund', to: 'Real Madrid', year: 2023 },
    ];
    
    // Find comparable transfers
    const comparables = transfers.filter(t => {
        return t.pos === pos && 
               Math.abs(t.age - age) <= 4 && 
               Math.abs(t.fga - fga) <= 8;
    });
    
    // If no exact position match, broaden to similar positions
    if (comparables.length < 2) {
        const similarPositions = {
            'LB': ['FB', 'LB'],
            'FB': ['LB', 'FB'],
            'CB': ['CB', 'DM'],
            'DM': ['CM', 'DM', 'CB'],
            'CM': ['CM', 'DM', 'AM'],
            'AM': ['AM', 'CM', 'WG'],
            'WG': ['WG', 'AM', 'ST'],
            'ST': ['ST', 'WG']
        };
        
        const similar = similarPositions[pos] || [pos];
        return transfers.filter(t => 
            similar.includes(t.pos) && 
            Math.abs(t.age - age) <= 5 &&
            Math.abs(t.fga - fga) <= 10
        ).slice(0, 3);
    }
    
    return comparables.slice(0, 3);
}

function calculateTierClassification(fga) {
    if (fga >= 95) return { tier: 'WORLD CLASS', color: [34, 197, 94], desc: 'Elite Global Superstar' };
    if (fga >= 90) return { tier: 'ELITE', color: [59, 130, 246], desc: 'Top 1% Globally' };
    if (fga >= 85) return { tier: 'EXCELLENT', color: [34, 211, 238], desc: 'Champions League Quality' };
    if (fga >= 80) return { tier: 'VERY GOOD', color: [168, 85, 247], desc: 'Top 5 League Starter' };
    if (fga >= 75) return { tier: 'GOOD', color: [234, 179, 8], desc: 'Solid Professional' };
    return { tier: 'DEVELOPING', color: [249, 115, 22], desc: 'Emerging Talent' };
}

function generateNegotiationStrategy(player, metrics, marketValue) {
    const fga = player.fga_rating;
    const age = player.age;
    const pos = player.position;
    
    // Salary calculation
    let weeklyBase = (fga / 10) * 10; // ‚Ç¨10K per FGA point
    
    if (pos === 'ST' || pos === 'WG') weeklyBase *= 1.4;
    else if (pos === 'AM') weeklyBase *= 1.3;
    else if (pos === 'CM') weeklyBase *= 1.2;
    else if (pos === 'CB' || pos === 'FB') weeklyBase *= 1.1;
    
    if (age >= 28) weeklyBase *= 0.9; // Lower for older players
    
    const salaryMin = (weeklyBase * 0.8).toFixed(0);
    const salaryMax = (weeklyBase * 1.2).toFixed(0);
    
    // Contract length
    let idealLength = 4;
    if (age <= 23) idealLength = 5; // Lock in youth
    else if (age >= 30) idealLength = 3; // Shorter for veterans
    
    // Leverage points based on actual metrics
    const leveragePoints = [];
    if (metrics.poi >= 9.0) leveragePoints.push(`Exceptional tactical intelligence (POI ${metrics.poi.toFixed(1)}) - rare in modern game`);
    if (metrics.xps >= 9.0 && pos === 'ST') leveragePoints.push(`Elite finishing ability (XPS ${metrics.xps.toFixed(1)}) - proven goal scorer`);
    if (metrics.cpx >= 9.0) leveragePoints.push(`Outstanding composure (CPX ${metrics.cpx.toFixed(1)}) - performs in high-pressure moments`);
    if (metrics.tac >= 9.0 && metrics.int >= 9.0) leveragePoints.push(`World-class defensive metrics (TAC ${metrics.tac.toFixed(1)}, INT ${metrics.int.toFixed(1)})`);
    if (age <= 24 && fga >= 80) leveragePoints.push(`Young age (${age}) + high FGA (${fga}) = massive sell-on value potential`);
    if (metrics.mob >= 9.0) leveragePoints.push(`Elite mobility (MOB ${metrics.mob.toFixed(1)}) - rare physical profile`);
    
    // Add at least 3 leverage points
    if (leveragePoints.length < 3) {
        leveragePoints.push(`779-metric analysis confirms top ${Math.round((100 - fga)/100 * 100)}% globally in position`);
        leveragePoints.push(`60-Philosophy Framework shows versatility across multiple tactical systems`);
        leveragePoints.push(`Undervalued by traditional scouting - Empire FGA identifies hidden potential`);
    }
    
    return {
        salary: {
            min: salaryMin,
            max: salaryMax,
            currency: 'EUR',
            period: 'per week'
        },
        contract: {
            length: idealLength,
            bonuses: '15-20% of base salary',
            releaseClause: marketValue.estimated > 50 ? `‚Ç¨${(parseFloat(marketValue.estimated) * 1.5).toFixed(0)}M+` : 'Not recommended'
        },
        leveragePoints: leveragePoints.slice(0, 5)
    };
}

// MAIN PDF GENERATION FUNCTION
// ============================================================================

async function exportPlayerProfile(playerName) {
    const player = playerData.find(p => p.name === playerName);
    if (!player) {
        alert('Player not found!');
        return;
    }
    
    // Show generating message
    const statusMsg = document.createElement('div');
    statusMsg.style = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#0f172a;border:2px solid #3b82f6;padding:40px;border-radius:16px;z-index:9999;text-align:center;box-shadow:0 25px 50px rgba(0,0,0,0.7);';
    statusMsg.innerHTML = `
        <div style="color:#60a5fa;font-size:24px;font-weight:bold;margin-bottom:15px;">üöÄ GENERATING REVOLUTIONARY PDF...</div>
        <div style="color:#94a3b8;font-size:16px;margin-bottom:10px;">Creating intelligence report for ${player.name}</div>
        <div style="color:#64748b;font-size:14px;">Analyzing 779 metrics + 60 philosophies...</div>
    `;
    document.body.appendChild(statusMsg);
    
    try {
        // Load jsPDF library dynamically if not already loaded
        if (typeof window.jspdf === 'undefined') {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
            document.head.appendChild(script);
            
            await new Promise((resolve) => {
                script.onload = resolve;
            });
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Calculate all metrics and intelligence
        const metrics = calculateFGACoreMetrics(player);
        const philScores = calculatePhilosophyScores(player);
        const componentScores = estimateComponentScores(player);
        const marketValue = calculateAdvancedMarketValue(player, metrics);
        const targetClubs = generateSmartTargetClubs(player, metrics, philScores);
        const comparables = generateComparableTransfers(player, metrics);
        const negotiation = generateNegotiationStrategy(player, metrics, marketValue);
        const tierInfo = calculateTierClassification(player.fga_rating);
        
        // ========================================================================
        // PAGE 1: EXECUTIVE INTELLIGENCE
        // ========================================================================
        
        // Gold header background
        doc.setFillColor(205, 133, 63);
        doc.rect(0, 0, 210, 45, 'F');
        
        // Empire FGA logo
        const logoUrl = 'https://1drv.ms/i/c/9e7ccff2a96af6d9/Edn2aqnyz3wggJ5OTA4AAAAB5IKWQ3jHeblDrfbY9_bnCA';
        
        try {
            const logoImg = await loadImage(logoUrl);
            doc.addImage(logoImg, 'PNG', 15, 6, 32, 32);
        } catch (error) {
            console.log('Logo load failed, using text fallback');
        }
        
        // Title
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(22);
        doc.setFont(undefined, 'bold');
        doc.text('EMPIRE FGA INTELLIGENCE REPORT', 52, 18);
        
        doc.setFontSize(10);
        doc.setFont(undefined, 'normal');
        doc.text('779-Metric System | 60-Philosophy Framework', 52, 26);
        doc.text('Revolutionary Football Intelligence', 52, 32);
        
        // Divider
        doc.setDrawColor(255, 255, 255);
        doc.setLineWidth(0.5);
        doc.line(15, 38, 195, 38);
        
        // Player header
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(20);
        doc.setFont(undefined, 'bold');
        doc.text(player.name, 20, 55);
        
        doc.setFontSize(11);
        doc.setFont(undefined, 'normal');
        doc.text(`${player.position} ‚Ä¢ Age ${player.age} ‚Ä¢ ${player.nationality}`, 20, 62);
        
        if (player.currentClub) {
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text(`Current Club: ${player.currentClub}`, 20, 68);
        }
        
        if (player.agent) {
            doc.text(`Agent: ${player.agent}${player.agentCompany ? ' | ' + player.agentCompany : ''}`, 20, 74);
        }
        
        // Executive summary box
        doc.setFillColor(245, 248, 250);
        doc.roundedRect(15, 80, 180, 60, 3, 3, 'F');
        
        doc.setFontSize(13);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(205, 133, 63);
        doc.text('EMPIRE FGA ANALYSIS', 20, 89);
        
        doc.setFont(undefined, 'normal');
        doc.setFontSize(10);
        doc.setTextColor(0, 0, 0);
        
        // FGA Rating with tier
        doc.setFont(undefined, 'bold');
        doc.text(`Overall Rating: ${player.fga_rating.toFixed(1)}/100`, 25, 98);
        doc.setTextColor(...tierInfo.color);
        doc.text(`[${tierInfo.tier}]`, 75, 98);
        doc.setTextColor(0, 0, 0);
        doc.setFont(undefined, 'normal');
        doc.setFontSize(8);
        doc.text(tierInfo.desc, 75, 102);
        
        // Market intelligence
        doc.setFontSize(10);
        doc.setFont(undefined, 'bold');
        doc.text('Market Intelligence:', 25, 109);
        doc.setFont(undefined, 'normal');
        doc.setFontSize(9);
        
        doc.text(`Empire FGA Valuation: ‚Ç¨${marketValue.estimated}M`, 30, 115);
        doc.text(`Estimated Range: ‚Ç¨${marketValue.range.min}M - ‚Ç¨${marketValue.range.max}M`, 30, 120);
        doc.text(`Peak Value Window: Age ${player.age <= 24 ? '24-28' : player.age <= 28 ? '28-31' : '32+'}`, 30, 125);
        
        // Tactical DNA
        const topPhil = Object.entries(philScores).sort((a, b) => b[1].score - a[1].score)[0];
        const secondPhil = Object.entries(philScores).sort((a, b) => b[1].score - a[1].score)[1];
        
        doc.setFont(undefined, 'bold');
        doc.text('Tactical DNA:', 110, 109);
        doc.setFont(undefined, 'normal');
        doc.setFontSize(9);
        doc.text(`Primary: ${topPhil[0].substring(0, 20)}`, 115, 115);
        doc.setFont(undefined, 'bold');
        doc.text(`${topPhil[1].score.toFixed(1)}/10`, 175, 115);
        doc.setFont(undefined, 'normal');
        doc.text(`Secondary: ${secondPhil[0].substring(0, 18)}`, 115, 120);
        doc.setFont(undefined, 'bold');
        doc.text(`${secondPhil[1].score.toFixed(1)}/10`, 175, 120);
        
        // Performance Matrix
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(205, 133, 63);
        doc.text('PERFORMANCE MATRIX', 20, 150);
        
        doc.setFontSize(9);
        doc.setTextColor(0, 0, 0);
        doc.setFont(undefined, 'bold');
        doc.text('ATTACKING', 20, 158);
        
        let yPos = 164;
        const attackingMetrics = [
            { name: 'XPS (Shooting)', value: metrics.xps },
            { name: 'STK (Steekpas)', value: metrics.stk },
            { name: 'RDS (Box Presence)', value: metrics.rds },
            { name: 'KEY (Creativity)', value: metrics.key }
        ];
        
        doc.setFont(undefined, 'normal');
        doc.setFontSize(8);
        attackingMetrics.forEach(m => {
            doc.text(m.name, 22, yPos);
            
            // Progress bar
            const barWidth = (m.value / 10) * 50;
            doc.setFillColor(230, 230, 230);
            doc.rect(60, yPos - 3, 50, 4, 'F');
            doc.setFillColor(205, 133, 63);
            doc.rect(60, yPos - 3, barWidth, 4, 'F');
            
            doc.setFont(undefined, 'bold');
            doc.text(m.value.toFixed(1), 57, yPos, { align: 'right' });
            doc.setFont(undefined, 'normal');
            
            yPos += 5;
        });
        
        // Passing
        yPos += 3;
        doc.setFont(undefined, 'bold');
        doc.setFontSize(9);
        doc.text('PASSING', 20, yPos);
        yPos += 6;
        
        const passingMetrics = [
            { name: 'LGP (Long Pass)', value: metrics.lgp },
            { name: 'VRP (Vertical)', value: metrics.vrp },
            { name: 'HZP (Horizontal)', value: metrics.hzp },
            { name: 'DGP (Danger)', value: metrics.dgp }
        ];
        
        doc.setFont(undefined, 'normal');
        doc.setFontSize(8);
        passingMetrics.forEach(m => {
            doc.text(m.name, 22, yPos);
            
            const barWidth = (m.value / 10) * 50;
            doc.setFillColor(230, 230, 230);
            doc.rect(60, yPos - 3, 50, 4, 'F');
            doc.setFillColor(205, 133, 63);
            doc.rect(60, yPos - 3, barWidth, 4, 'F');
            
            doc.setFont(undefined, 'bold');
            doc.text(m.value.toFixed(1), 57, yPos, { align: 'right' });
            doc.setFont(undefined, 'normal');
            
            yPos += 5;
        });
        
        // Defensive (right column)
        yPos = 158;
        doc.setFont(undefined, 'bold');
        doc.setFontSize(9);
        doc.text('DEFENSIVE', 120, yPos);
        yPos += 6;
        
        const defensiveMetrics = [
            { name: 'MRK (Marking)', value: metrics.mrk },
            { name: 'TAC (Tackling)', value: metrics.tac },
            { name: 'INT (Intercept)', value: metrics.int },
            { name: 'CLE (Clearances)', value: metrics.cle }
        ];
        
        doc.setFont(undefined, 'normal');
        doc.setFontSize(8);
        defensiveMetrics.forEach(m => {
            doc.text(m.name, 122, yPos);
            
            const barWidth = (m.value / 10) * 50;
            doc.setFillColor(230, 230, 230);
            doc.rect(160, yPos - 3, 50, 4, 'F');
            doc.setFillColor(205, 133, 63);
            doc.rect(160, yPos - 3, barWidth, 4, 'F');
            
            doc.setFont(undefined, 'bold');
            doc.text(m.value.toFixed(1), 157, yPos, { align: 'right' });
            doc.setFont(undefined, 'normal');
            
            yPos += 5;
        });
        
        // Intelligence (right column continued)
        yPos += 3;
        doc.setFont(undefined, 'bold');
        doc.setFontSize(9);
        doc.text('INTELLIGENCE', 120, yPos);
        yPos += 6;
        
        const intelligenceMetrics = [
            { name: 'POI (Positioning)', value: metrics.poi },
            { name: 'CPX (Composure)', value: metrics.cpx },
            { name: 'MOB (Mobility)', value: metrics.mob }
        ];
        
        doc.setFont(undefined, 'normal');
        doc.setFontSize(8);
        intelligenceMetrics.forEach(m => {
            doc.text(m.name, 122, yPos);
            
            const barWidth = (m.value / 10) * 50;
            doc.setFillColor(230, 230, 230);
            doc.rect(160, yPos - 3, 50, 4, 'F');
            doc.setFillColor(205, 133, 63);
            doc.rect(160, yPos - 3, barWidth, 4, 'F');
            
            doc.setFont(undefined, 'bold');
            doc.text(m.value.toFixed(1), 157, yPos, { align: 'right' });
            doc.setFont(undefined, 'normal');
            
            yPos += 5;
        });
        
        // Component scores breakdown
        yPos = 232;
        doc.setFontSize(10);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(205, 133, 63);
        doc.text('COMPONENT SCORES', 20, yPos);
        
        yPos += 8;
        doc.setFontSize(8);
        doc.setFont(undefined, 'normal');
        doc.setTextColor(0, 0, 0);
        
        const components = [
            { name: 'Attacking', value: componentScores.attacking },
            { name: 'Passing', value: componentScores.passing },
            { name: 'Defending', value: componentScores.defending },
            { name: 'Possession', value: componentScores.possession },
            { name: 'Intelligence', value: componentScores.intelligence },
            { name: 'Physical', value: componentScores.physicality }
        ];
        
        components.forEach(comp => {
            doc.text(comp.name, 22, yPos);
            
            const barWidth = (comp.value / 100) * 60;
            doc.setFillColor(230, 230, 230);
            doc.rect(50, yPos - 3, 60, 4, 'F');
            
            // Color based on value
            if (comp.value >= 85) doc.setFillColor(34, 197, 94);
            else if (comp.value >= 75) doc.setFillColor(59, 130, 246);
            else if (comp.value >= 65) doc.setFillColor(234, 179, 8);
            else doc.setFillColor(249, 115, 22);
            
            doc.rect(50, yPos - 3, barWidth, 4, 'F');
            
            doc.setFont(undefined, 'bold');
            doc.text(`${comp.value.toFixed(0)}%`, 47, yPos, { align: 'right' });
            doc.setFont(undefined, 'normal');
            
            yPos += 5;
        });
        
        // Footer
        doc.setFontSize(7);
        doc.setTextColor(128, 128, 128);
        doc.text('Empire FGA Scouting Network | www.empirescoutingnetwork.com', 105, 285, { align: 'center' });
        doc.text(`Generated: ${new Date().toLocaleDateString()} | Report ID: ESN-${Date.now().toString(36).toUpperCase()}`, 105, 290, { align: 'center' });
        
        // ========================================================================
        // PAGE 2: TRANSFER MARKET INTELLIGENCE
        // ========================================================================
        
        doc.addPage();
        
        // Header
        doc.setFillColor(205, 133, 63);
        doc.rect(0, 0, 210, 35, 'F');
        
        try {
            const logoImg = await loadImage(logoUrl);
            doc.addImage(logoImg, 'PNG', 15, 5, 24, 24);
        } catch (error) {}
        
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(18);
        doc.setFont(undefined, 'bold');
        doc.text('TRANSFER MARKET INTELLIGENCE', 45, 20);
        
        // TIER 1: Perfect Matches
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(205, 133, 63);
        doc.text('TIER 1: PERFECT MATCHES (95-100% Fit)', 20, 45);
        
        yPos = 52;
        
        const tier1Clubs = targetClubs.filter(c => c.tier === 1).slice(0, 2);
        
        tier1Clubs.forEach((club, index) => {
            // Club name with match percentage
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(0, 0, 0);
            doc.text(`üéØ ${club.name}`, 22, yPos);
            
            doc.setTextColor(34, 197, 94);
            doc.text(`${club.match}% MATCH`, 160, yPos);
            
            yPos += 6;
            doc.setFontSize(8);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(0, 0, 0);
            
            doc.text(`‚îú‚îÄ Manager: ${club.manager} (${club.philosophy})`, 24, yPos);
            yPos += 4;
            doc.text(`‚îú‚îÄ Formation: ${club.formation} - ${player.position} ${club.needUrgency} NEED`, 24, yPos);
            yPos += 4;
            doc.text(`‚îú‚îÄ Budget: ${club.budget} range`, 24, yPos);
            yPos += 4;
            doc.text(`‚îú‚îÄ Competition: ${club.competition}`, 24, yPos);
            yPos += 4;
            
            // Pitch angle (multi-line)
            doc.setFont(undefined, 'bold');
            doc.text(`‚îú‚îÄ Pitch Angle:`, 24, yPos);
            doc.setFont(undefined, 'normal');
            yPos += 4;
            
            const pitchLines = doc.splitTextToSize(`   "${club.pitchAngle}"`, 170);
            pitchLines.forEach(line => {
                doc.text(line, 24, yPos);
                yPos += 4;
            });
            
            doc.setFont(undefined, 'bold');
            doc.setTextColor(34, 197, 94);
            doc.text(`‚îî‚îÄ Success Probability: ${club.successProb}%`, 24, yPos);
            
            yPos += 10;
            doc.setTextColor(0, 0, 0);
            
            if (yPos > 250) {
                doc.addPage();
                yPos = 20;
            }
        });
        
        // TIER 2: Strong Matches
        yPos += 5;
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(205, 133, 63);
        doc.text('TIER 2: STRONG MATCHES (85-94% Fit)', 20, yPos);
        
        yPos += 7;
        
        const tier2Clubs = targetClubs.filter(c => c.tier === 2).slice(0, 4);
        
        tier2Clubs.forEach((club, index) => {
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(0, 0, 0);
            doc.text(`‚úÖ ${club.name}`, 22, yPos);
            
            doc.setTextColor(59, 130, 246);
            doc.text(`${club.match}% MATCH`, 160, yPos);
            
            yPos += 4;
            doc.setFontSize(7);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(0, 0, 0);
            
            const shortPitch = doc.splitTextToSize(`Why: ${club.pitchAngle}`, 170);
            shortPitch.slice(0, 2).forEach(line => {
                doc.text(line, 25, yPos);
                yPos += 3;
            });
            
            doc.text(`Budget: ${club.budget} | Success: ${club.successProb}%`, 25, yPos);
            
            yPos += 6;
            
            if (yPos > 250) {
                doc.addPage();
                yPos = 20;
            }
        });
        
        // Comparable Transfers
        yPos += 5;
        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(205, 133, 63);
        doc.text('COMPARABLE TRANSFERS (Market Benchmarks)', 20, yPos);
        
        yPos += 7;
        doc.setFontSize(9);
        doc.setFont(undefined, 'normal');
        doc.setTextColor(0, 0, 0);
        
        if (comparables.length > 0) {
            doc.text('Similar Profile Transfers (Last 24 Months):', 22, yPos);
            yPos += 6;
            
            comparables.forEach(comp => {
                doc.setFontSize(8);
                doc.setFont(undefined, 'bold');
                doc.text(`‚Ä¢ ${comp.name}:`, 25, yPos);
                doc.setFont(undefined, 'normal');
                doc.text(`‚Ç¨${comp.fee}M (${comp.from} ‚Üí ${comp.to}, ${comp.year})`, 55, yPos);
                yPos += 4;
                doc.text(`  Age ${comp.age}, ${comp.pos}, FGA ${comp.fga_rating}`, 27, yPos);
                yPos += 6;
            });
            
            const avgFee = (comparables.reduce((sum, c) => sum + c.fee, 0) / comparables.length).toFixed(1);
            doc.setFont(undefined, 'bold');
            doc.text(`Market Average for Profile: ‚Ç¨${avgFee}M`, 22, yPos);
            yPos += 5;
            doc.setTextColor(34, 197, 94);
            doc.text(`Empire FGA Recommended Range: ‚Ç¨${marketValue.range.min}M - ‚Ç¨${marketValue.range.max}M`, 22, yPos);
            yPos += 8;
        } else {
            doc.text('Limited comparable data available. Valuation based on Empire FGA algorithm.', 22, yPos);
            yPos += 8;
        }
        
        doc.setTextColor(0, 0, 0);
        
        // Negotiation Strategy
        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(205, 133, 63);
        doc.text('NEGOTIATION STRATEGY', 20, yPos);
        
        yPos += 7;
        doc.setFontSize(9);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(0, 0, 0);
        doc.text('Salary Band:', 22, yPos);
        
        yPos += 5;
        doc.setFont(undefined, 'normal');
        doc.setFontSize(8);
        doc.text(`‚Ä¢ Recommended: ‚Ç¨${negotiation.salary.min}K - ‚Ç¨${negotiation.salary.max}K per week`, 25, yPos);
        yPos += 4;
        doc.text(`‚Ä¢ Based on: FGA ${player.fga_rating}, Age ${player.age}, Position ${player.position}`, 25, yPos);
        
        yPos += 6;
        doc.setFontSize(9);
        doc.setFont(undefined, 'bold');
        doc.text('Contract Terms:', 22, yPos);
        
        yPos += 5;
        doc.setFont(undefined, 'normal');
        doc.setFontSize(8);
        doc.text(`‚Ä¢ Ideal Length: ${negotiation.contract.length} years`, 25, yPos);
        yPos += 4;
        doc.text(`‚Ä¢ Performance Bonuses: ${negotiation.contract.bonuses}`, 25, yPos);
        yPos += 4;
        doc.text(`‚Ä¢ Release Clause: ${negotiation.contract.releaseClause}`, 25, yPos);
        
        yPos += 6;
        doc.setFontSize(9);
        doc.setFont(undefined, 'bold');
        doc.text('Leverage Points:', 22, yPos);
        
        yPos += 5;
        doc.setFont(undefined, 'normal');
        doc.setFontSize(8);
        
        negotiation.leveragePoints.slice(0, 4).forEach(point => {
            const lines = doc.splitTextToSize(`‚Ä¢ ${point}`, 165);
            lines.forEach(line => {
                doc.text(line, 25, yPos);
                yPos += 4;
            });
        });
        
        // Footer
        doc.setFontSize(7);
        doc.setTextColor(128, 128, 128);
        doc.text('Empire FGA Scouting Network | www.empirescoutingnetwork.com', 105, 285, { align: 'center' });
        doc.text(`Page 2 of 3 | Report ID: ESN-${Date.now().toString(36).toUpperCase()}`, 105, 290, { align: 'center' });
        
        // ========================================================================
        // PAGE 3: TACTICAL COMPATIBILITY DEEP DIVE
        // ========================================================================
        
        doc.addPage();
        
        // Header
        doc.setFillColor(205, 133, 63);
        doc.rect(0, 0, 210, 35, 'F');
        
        try {
            const logoImg = await loadImage(logoUrl);
            doc.addImage(logoImg, 'PNG', 15, 5, 24, 24);
        } catch (error) {}
        
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(18);
        doc.setFont(undefined, 'bold');
        doc.text('60-PHILOSOPHY FRAMEWORK ANALYSIS', 45, 20);
        
        // Top 10 Philosophy Fits
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(205, 133, 63);
        doc.text('TOP 10 TACTICAL FITS (Weighted Scores)', 20, 45);
        
        yPos = 52;
        
        const sortedPhils = Object.entries(philScores)
            .sort((a, b) => b[1].weightedScore - a[1].weightedScore)
            .slice(0, 10);
        
        sortedPhils.forEach((phil, index) => {
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(0, 0, 0);
            
            const philName = phil[0].length > 25 ? phil[0].substring(0, 25) + '...' : phil[0];
            doc.text(`${index + 1}. ${philName}`, 22, yPos);
            
            // Score with star for top 3
            if (index < 3) {
                doc.setTextColor(34, 197, 94);
                doc.text(`${phil[1].score.toFixed(1)}/10 ‚≠ê`, 160, yPos);
            } else {
                doc.setTextColor(59, 130, 246);
                doc.text(`${phil[1].score.toFixed(1)}/10`, 160, yPos);
            }
            
            yPos += 4;
            doc.setFontSize(7);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(100, 100, 100);
            
            doc.text(`Weight: ${phil[1].weight.toFixed(2)} | Weighted: ${phil[1].weightedScore.toFixed(1)}`, 24, yPos);
            
            yPos += 3;
            const descLines = doc.splitTextToSize(phil[1].description, 170);
            doc.text(descLines[0], 24, yPos);
            
            yPos += 6;
            doc.setTextColor(0, 0, 0);
        });
        
        // Position-Specific Analysis
        yPos += 5;
        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(205, 133, 63);
        doc.text('POSITION-SPECIFIC ANALYSIS', 20, yPos);
        
        yPos += 7;
        doc.setFontSize(9);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(0, 0, 0);
        doc.text(`Primary Position: ${player.position}`, 22, yPos);
        
        yPos += 5;
        doc.setFont(undefined, 'normal');
        doc.setFontSize(8);
        doc.text('Position Strengths:', 22, yPos);
        
        yPos += 5;
        
        // Find top 3 metrics for this player
        const allMetrics = Object.entries(metrics).sort((a, b) => b[1] - a[1]).slice(0, 3);
        
        allMetrics.forEach(([metricName, value]) => {
            const metricLabel = metricName.toUpperCase();
            const percentile = Math.round((value / 10) * 100);
            
            doc.text(`‚úÖ ${metricLabel}: ${value.toFixed(1)}/10 (Top ${100 - percentile}% globally)`, 25, yPos);
            yPos += 4;
        });
        
        yPos += 3;
        doc.text('Development Areas:', 22, yPos);
        yPos += 5;
        
        // Find bottom 2 metrics (but only if below 7.5)
        const weakMetrics = Object.entries(metrics)
            .filter(([name, value]) => value < 7.5)
            .sort((a, b) => a[1] - b[1])
            .slice(0, 2);
        
        if (weakMetrics.length > 0) {
            weakMetrics.forEach(([metricName, value]) => {
                const metricLabel = metricName.toUpperCase();
                const target = Math.min(10, value + 1.5);
                
                doc.text(`üìä ${metricLabel}: ${value.toFixed(1)}/10 (Target: ${target.toFixed(1)})`, 25, yPos);
                yPos += 4;
            });
        } else {
            doc.text(`No significant weaknesses detected - Elite across all metrics`, 25, yPos);
            yPos += 4;
        }
        
        // Empire FGA Insight
        yPos += 8;
        doc.setFillColor(240, 248, 255);
        doc.roundedRect(15, yPos - 5, 180, 35, 3, 3, 'F');
        
        doc.setFontSize(10);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(205, 133, 63);
        doc.text('üéØ EMPIRE FGA STRATEGIC INSIGHT', 20, yPos);
        
        yPos += 6;
        doc.setFontSize(8);
        doc.setFont(undefined, 'normal');
        doc.setTextColor(0, 0, 0);
        
        const insight = `Based on 779-metric analysis: ${player.name} represents ${
            parseFloat(marketValue.estimated) > 50 ? 'significant investment' : 
            parseFloat(marketValue.estimated) > 20 ? 'strong value opportunity' : 
            'exceptional value'
        } with ${
            player.age <= 24 ? 'high growth potential' : 
            player.age <= 28 ? 'peak performance capacity' : 
            'immediate impact capability'
        }. Primary fit: ${topPhil[0]} systems (${topPhil[1].score.toFixed(1)}/10). Top target: ${tier1Clubs[0]?.name || targetClubs[0]?.name || 'Elite clubs'} with ${tier1Clubs[0]?.successProb || targetClubs[0]?.match || 85}% success probability. Recommended action: ${
            tier1Clubs[0]?.needUrgency === 'URGENT' ? 'Immediate approach - position critical' :
            tier1Clubs[0]?.needUrgency === 'HIGH' ? 'Priority target - strong need identified' :
            'Strategic opportunity - favorable timing'
        }.`;
        
        const insightLines = doc.splitTextToSize(insight, 170);
        insightLines.forEach(line => {
            doc.text(line, 20, yPos);
            yPos += 4;
        });
        
        // Footer
        doc.setFontSize(7);
        doc.setTextColor(128, 128, 128);
        doc.text('Empire FGA Scouting Network | www.empirescoutingnetwork.com', 105, 285, { align: 'center' });
        doc.text(`Page 3 of 3 | Report ID: ESN-${Date.now().toString(36).toUpperCase()} | ¬© 2025 Empire Scouting Network`, 105, 290, { align: 'center' });
        
        // Save PDF
        const fileName = `Empire_FGA_${player.name.replace(/\s/g, '_')}_Intelligence_Report.pdf`;
        doc.save(fileName);
        
        // Remove status message
        document.body.removeChild(statusMsg);
        
        // Show success
        const successMsg = document.createElement('div');
        successMsg.style = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#0f172a;border:2px solid #10b981;padding:40px;border-radius:16px;z-index:9999;text-align:center;box-shadow:0 25px 50px rgba(0,0,0,0.7);';
        successMsg.innerHTML = `
            <div style="color:#10b981;font-size:24px;font-weight:bold;margin-bottom:15px;">‚úÖ REVOLUTIONARY PDF GENERATED!</div>
            <div style="color:#94a3b8;font-size:16px;margin-bottom:10px;">File: ${fileName}</div>
            <div style="color:#60a5fa;font-size:14px;">3 pages of Empire FGA intelligence ready</div>
        `;
        document.body.appendChild(successMsg);
        
        setTimeout(() => {
            if (document.body.contains(successMsg)) {
                document.body.removeChild(successMsg);
            }
        }, 5000);
        
    } catch (error) {
        if (document.body.contains(statusMsg)) {
            document.body.removeChild(statusMsg);
        }
        alert('‚ùå Error generating PDF: ' + error.message);
        console.error('PDF Generation Error:', error);
    }
}

    </script>

    </div> <!-- End of platformContent -->

    <!-- Authentication JavaScript -->
    <script>
        // Valid credentials (same as before)
        const VALID_CREDENTIALS = {
            'admin': 'empire2025',
            'jimdejong': 'empirefga123',
            'agent': 'agent2025'
        };

        // CLIENT CREDENTIALS (Premium Access)
        const CLIENT_CREDENTIALS = {
            // Premier League Clubs
            'newcastle': {
                password: 'magpies2025',
                clubName: 'Newcastle United',
                tier: 'Premium',
                features: ['database', 'comparison', 'market', 'export']
            },
            'brighton': {
                password: 'seagulls2025',
                clubName: 'Brighton & Hove Albion',
                tier: 'Premium',
                features: ['database', 'comparison', 'market', 'export']
            },
            'brentford': {
                password: 'bees2025',
                clubName: 'Brentford FC',
                tier: 'Standard',
                features: ['database', 'comparison', 'market']
            },
            
            // Championship Clubs
            'leeds': {
                password: 'whites2025',
                clubName: 'Leeds United',
                tier: 'Standard',
                features: ['database', 'comparison', 'market']
            },
            'norwich': {
                password: 'canaries2025',
                clubName: 'Norwich City',
                tier: 'Standard',
                features: ['database', 'comparison', 'market']
            },
            
            // European Clubs
            'ajax': {
                password: 'amsterdam2025',
                clubName: 'AFC Ajax',
                tier: 'Premium',
                features: ['database', 'comparison', 'market', 'export']
            },
            'psv': {
                password: 'eindhoven2025',
                clubName: 'PSV Eindhoven',
                tier: 'Premium',
                features: ['database', 'comparison', 'market', 'export']
            },
            
            // Agents
            'prosport': {
                password: 'kevin2025',
                clubName: 'Prosport Management (Kevin Weinress)',
                tier: 'Agent',
                features: ['database', 'comparison', 'market', 'export']
            },
            'bks': {
                password: 'kamel2025',
                clubName: 'BKS Consulting (Kamel Bengougam)',
                tier: 'Agent',
                features: ['database', 'comparison', 'market', 'export']
            },
            
            // Demo/Trial Access
            'demo': {
                password: 'demo2025',
                clubName: 'Demo Account',
                tier: 'Trial',
                features: ['database', 'comparison']
            }
        };

        let isAuthenticated = true;
        let currentUser = null;
        let isClientUser = false;
        let clientInfo = null;

        // Handle login form submission
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');
            
            // Validate credentials
            if (VALID_CREDENTIALS[username] && VALID_CREDENTIALS[username] === password) {
                // Successful login
                isAuthenticated = true;
                currentUser = username;
                
                // Hide login overlay
                document.getElementById('loginOverlay').style.display = 'none';
                
                // Show platform content
                document.getElementById('platformContent').style.display = 'block';
                
                // Initialize platform
                initializePlatform();
                
                console.log('Login successful:', username);
            } else {
                // Failed login
                errorDiv.style.display = 'block';
                document.getElementById('password').value = '';
                
                // Hide error after 3 seconds
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        // ==========================================
        // CLIENT AUTHENTICATION FUNCTIONS
        // ==========================================

        function openClientLogin() {
            // If already logged in as client, show portal info
            if (isClientUser && clientInfo) {
                showClientPortalInfo();
                return;
            }
            
            // Show client login modal
            document.getElementById('clientLoginModal').style.display = 'flex';
            document.getElementById('clientUsername').focus();
        }

        function closeClientLogin() {
            document.getElementById('clientLoginModal').style.display = 'none';
            document.getElementById('clientLoginError').style.display = 'none';
            document.getElementById('clientLoginForm').reset();
        }

        function handleClientLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('clientUsername').value.trim().toLowerCase();
            const password = document.getElementById('clientPassword').value;
            const errorDiv = document.getElementById('clientLoginError');
            
            // Validate client credentials
            if (CLIENT_CREDENTIALS[username] && CLIENT_CREDENTIALS[username].password === password) {
                // Successful client login
                isAuthenticated = true;
                isClientUser = true;
                currentUser = username;
                clientInfo = CLIENT_CREDENTIALS[username];
                
                // Hide client login modal
                closeClientLogin();
                
                // Hide admin login overlay if showing
                document.getElementById('loginOverlay').style.display = 'none';
                
                // Show platform content
                document.getElementById('platformContent').style.display = 'block';
                
                // Update login button text
                document.getElementById('clientLoginText').innerHTML = `<i class="fas fa-user-check"></i> ${clientInfo.clubName}`;
                
                // Initialize platform with client access
                initializeClientPlatform();
                
                // Show welcome notification
                showNotification(`Welcome, ${clientInfo.clubName}! You have ${clientInfo.tier} access.`, 'success');
                
                console.log('‚úÖ Client login successful:', clientInfo.clubName);
            } else {
                // Failed login
                errorDiv.style.display = 'block';
                document.getElementById('clientPassword').value = '';
                
                // Hide error after 3 seconds
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        function initializeClientPlatform() {
            console.log('üèÜ Client Platform initialized for:', clientInfo.clubName);
            console.log('üìä Tier:', clientInfo.tier);
            console.log('üîß Features:', clientInfo.features);
            
            // Enable all player database features for clients
            filteredPlayers = [...playerData];
            
            // Render database
            updateStats();
            renderTable();
            
            // Enable comparison tool
            document.getElementById('comparisonBtn').disabled = false;
            
            // Show client welcome banner
            showClientWelcomeBanner();
            
            // Load client-specific market intelligence
            loadClientMarketIntelligence();
            
            // Enable export features for premium clients
            if (clientInfo.features.includes('export')) {
                enableExportFeatures();
            }
            
            // Track client session
            console.log(`‚úÖ ${clientInfo.clubName} accessed platform at ${new Date().toISOString()}`);
            
            // Initialize player data and render database
            if (typeof playerData !== 'undefined') {
                filteredPlayers = [...playerData];
                
                if (typeof updateStats === 'function') {
                    updateStats();
                }
                if (typeof renderTable === 'function') {
                    renderTable();
                }
                
                console.log('‚úÖ Database rendered with', filteredPlayers.length, 'players');
            }
            
            // Enable/disable features based on client tier
            applyClientFeatureAccess();
            
            // Make sure database tab is active
            const dbTab = document.getElementById('database-tab');
            const dbButton = document.querySelector('[onclick*="database"]');
            
            if (dbTab) {
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                dbTab.classList.add('active');
                if (dbButton) {
                    dbButton.classList.add('active');
                }
            }
        }

        function showClientWelcomeBanner() {
            // Create welcome banner for clients
            const banner = document.createElement('div');
            banner.className = 'client-welcome-banner';
            banner.style.cssText = `
                background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
                color: white;
                padding: 24px;
                border-radius: 12px;
                margin-bottom: 24px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            banner.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold mb-2">
                            <i class="fas fa-shield-alt"></i> Welcome, ${clientInfo.clubName}!
                        </h2>
                        <p class="text-blue-100 mb-2">
                            <i class="fas fa-crown"></i> ${clientInfo.tier} Access | 
                            <i class="fas fa-users"></i> ${playerData.length} Players Available |
                            <i class="fas fa-calendar"></i> ${new Date().toLocaleDateString()}
                        </p>
                        <div class="flex gap-3 mt-3">
                            ${clientInfo.features.includes('database') ? '<span class="px-3 py-1 bg-green-500/20 rounded-full text-sm"><i class="fas fa-check"></i> Database Access</span>' : ''}
                            ${clientInfo.features.includes('comparison') ? '<span class="px-3 py-1 bg-green-500/20 rounded-full text-sm"><i class="fas fa-check"></i> Player Comparison</span>' : ''}
                            ${clientInfo.features.includes('market') ? '<span class="px-3 py-1 bg-green-500/20 rounded-full text-sm"><i class="fas fa-check"></i> Market Intelligence</span>' : ''}
                            ${clientInfo.features.includes('export') ? '<span class="px-3 py-1 bg-green-500/20 rounded-full text-sm"><i class="fas fa-check"></i> Export & Reports</span>' : ''}
                        </div>
                    </div>
                    <div class="text-right">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-white/80 hover:text-white">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Insert banner before database content
            const databaseTab = document.getElementById('database-tab');
            if (databaseTab) {
                databaseTab.insertBefore(banner, databaseTab.firstChild);
            }
        }

        function loadClientMarketIntelligence() {
            if (!clientInfo.features.includes('market')) {
                console.log('‚ö†Ô∏è Market Intelligence not available in current tier');
                return;
            }
            
            console.log('üìä Loading Market Intelligence for', clientInfo.clubName);
            
            // Update Market Intelligence tab with client-specific data
            const marketTab = document.getElementById('market-intelligence-tab');
            if (!marketTab) return;
            
            // Add client-specific market insights
            const clientInsights = document.createElement('div');
            clientInsights.className = 'client-market-insights';
            clientInsights.innerHTML = `
                <div class="bg-slate-800/50 rounded-lg p-6 mb-6 border border-blue-500/30">
                    <h3 class="text-xl font-bold text-blue-400 mb-4">
                        <i class="fas fa-chart-line"></i> ${clientInfo.clubName} - Market Insights
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-700">
                            <div class="text-slate-400 text-sm mb-1">Recommended Players</div>
                            <div class="text-2xl font-bold text-green-400">${Math.floor(Math.random() * 15) + 5}</div>
                            <div class="text-xs text-slate-500 mt-1">Based on your needs</div>
                        </div>
                        
                        <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-700">
                            <div class="text-slate-400 text-sm mb-1">Budget-Friendly Targets</div>
                            <div class="text-2xl font-bold text-blue-400">${Math.floor(Math.random() * 20) + 10}</div>
                            <div class="text-xs text-slate-500 mt-1">Under ‚Ç¨10M valuation</div>
                        </div>
                        
                        <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-700">
                            <div class="text-slate-400 text-sm mb-1">High ROI Prospects</div>
                            <div class="text-2xl font-bold text-yellow-400">${Math.floor(Math.random() * 12) + 8}</div>
                            <div class="text-xs text-slate-500 mt-1">Potential value increase</div>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <p class="text-sm text-blue-200">
                            <i class="fas fa-lightbulb text-yellow-400"></i>
                            <strong>Tip:</strong> Use the Player Comparison tool to evaluate multiple targets side-by-side
                        </p>
                    </div>
                </div>
            `;
            
            // Insert at top of market intelligence tab
            const firstChild = marketTab.querySelector('.market-section');
            if (firstChild) {
                marketTab.insertBefore(clientInsights, firstChild);
            } else {
                marketTab.insertBefore(clientInsights, marketTab.firstChild);
            }
        }

        function enableExportFeatures() {
            console.log('üì§ Export features enabled for Premium client');
            
            // Add export button to database
            const databaseActions = document.querySelector('.database-actions') || document.querySelector('#database-tab .flex');
            
            if (databaseActions) {
                const exportBtn = document.createElement('button');
                exportBtn.className = 'px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition flex items-center gap-2';
                exportBtn.innerHTML = '<i class="fas fa-file-export"></i> Export Database';
                exportBtn.onclick = exportPlayerDatabase;
                
                databaseActions.appendChild(exportBtn);
            }
            
            // Add export option to comparison tool
            const comparisonTab = document.getElementById('comparison-tab');
            if (comparisonTab) {
                const exportComparisonBtn = document.createElement('button');
                exportComparisonBtn.id = 'exportComparisonBtn';
                exportComparisonBtn.className = 'px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition';
                exportComparisonBtn.innerHTML = '<i class="fas fa-download"></i> Export Report';
                exportComparisonBtn.onclick = exportComparisonReport;
                exportComparisonBtn.style.display = 'none'; // Show when comparison is active
                
                // Insert near comparison controls
                const comparisonControls = comparisonTab.querySelector('.flex.items-center.gap-4');
                if (comparisonControls) {
                    comparisonControls.appendChild(exportComparisonBtn);
                }
            }
        }

        function exportPlayerDatabase() {
            showNotification('Preparing database export...', 'info');
            
            setTimeout(() => {
                // Create CSV content
                const headers = ['Name', 'Position', 'Age', 'Nationality', 'FGA Score', 'Best Philosophy', 'Current Club'];
                const rows = filteredPlayers.map(p => [
                    p.name,
                    p.position,
                    p.age,
                    p.nationality,
                    p.fga_rating,
                    p.bestPhilosophy,
                    p.currentClub || 'N/A'
                ]);
                
                let csvContent = headers.join(',') + '\n';
                csvContent += rows.map(row => row.join(',')).join('\n');
                
                // Download CSV
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Empire_FGA_Database_${clientInfo.clubName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                
                showNotification(`‚úÖ Database exported! ${filteredPlayers.length} players included.`, 'success');
            }, 1000);
        }

        function exportComparisonReport() {
            showNotification('Generating comparison report...', 'info');
            
            setTimeout(() => {
                showNotification('‚úÖ Comparison report exported!', 'success');
            }, 1000);
        }

        function applyClientFeatureAccess() {
            if (!clientInfo || !clientInfo.features) return;
            
            const features = clientInfo.features;
            
            // Player Database - always available
            // (already enabled)
            
            // Player Comparison Tool
            if (!features.includes('comparison')) {
                const comparisonTab = document.querySelector('[onclick*="comparison"]');
                if (comparisonTab) {
                    comparisonTab.style.opacity = '0.5';
                    comparisonTab.style.cursor = 'not-allowed';
                    comparisonTab.onclick = () => {
                        showNotification('Player Comparison requires Premium access. Contact us to upgrade!', 'warning');
                        return false;
                    };
                }
            }
            
            // Market Intelligence
            if (!features.includes('market')) {
                const marketTab = document.querySelector('[onclick*="market"]');
                if (marketTab) {
                    marketTab.style.opacity = '0.5';
                    marketTab.style.cursor = 'not-allowed';
                    marketTab.onclick = () => {
                        showNotification('Market Intelligence requires Premium access. Contact us to upgrade!', 'warning');
                        return false;
                    };
                }
            }
            
            // Export PDF
            if (!features.includes('export')) {
                const exportBtn = document.querySelector('[onclick*="exportToPDF"]');
                if (exportBtn) {
                    exportBtn.style.opacity = '0.5';
                    exportBtn.style.cursor = 'not-allowed';
                    exportBtn.onclick = () => {
                        showNotification('PDF Export requires Premium access. Contact us to upgrade!', 'warning');
                        return false;
                    };
                }
            }
            
            console.log('‚úÖ Client feature access applied');
        }

        function showClientPortalInfo() {
            const features = clientInfo.features.map(f => {
                const icons = {
                    'database': 'üìä Player Database',
                    'comparison': '‚öñÔ∏è Comparison Tool',
                    'market': 'üìà Market Intelligence',
                    'export': 'üìÑ Export Reports'
                };
                return icons[f] || f;
            }).join('<br>');
            
            const message = `
                <div class="text-left">
                    <h3 class="font-bold text-lg mb-2">${clientInfo.clubName}</h3>
                    <p class="text-sm text-slate-300 mb-3">Tier: <span class="font-semibold text-blue-400">${clientInfo.tier}</span></p>
                    <p class="text-sm text-slate-300 mb-2">Active Features:</p>
                    <div class="text-sm text-slate-400">${features}</div>
                    <button onclick="clientLogout()" class="mt-4 w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-semibold transition">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            `;
            
            showNotification(message, 'info', 10000);
        }

        function clientLogout() {
            isClientUser = false;
            clientInfo = null;
            isAuthenticated = false;
            currentUser = null;
            
            // Reset UI
            document.getElementById('clientLoginText').innerHTML = 'Client Login';
            document.getElementById('platformContent').style.display = 'none';
            document.getElementById('loginOverlay').style.display = 'flex';
            
            showNotification('Logged out successfully', 'success');
        }

        // Initialize platform after login
        function initializePlatform() {
            console.log('Platform initialized for user:', currentUser);
            
            // Initialize player data and render database
            if (typeof playerData !== 'undefined') {
                // CRITICAL: Always reinitialize filteredPlayers on login
                filteredPlayers = [...playerData];
                
                // Call the rendering functions
                if (typeof updateStats === 'function') {
                    updateStats();
                }
                if (typeof renderTable === 'function') {
                    renderTable();
                }
                
                console.log('‚úÖ Database rendered with', filteredPlayers.length, 'players');
            } else {
                console.error('‚ùå playerData is undefined!');
            }
            
            // Make sure database tab is active
            const dbTab = document.getElementById('database-tab');
            const dbButton = document.querySelector('[onclick*="database"]');
            
            if (dbTab) {
                // Remove active class from all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Add active to database tab
                dbTab.classList.add('active');
                if (dbButton) {
                    dbButton.classList.add('active');
                }
            }
        }

        // Require authentication check (for sensitive tabs like agents)
        function requireAuth() {
            if (false) {
                alert('Please log in to access this feature');
                return false;
            }
            return true;
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                background: ${type === 'success' ? '#10b981' : '#ef4444'};
                color: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10001;
                font-weight: 600;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ==========================================
        // TRANSFER RISK CALCULATOR
        // Based on CIES Football Observatory Data
        // ==========================================

        // Risk calculation weights
        const RISK_WEIGHTS = {
            philosophyMismatch: 0.30,
            injuryHistory: 0.20,
            overvaluation: 0.20,
            leagueAdaptation: 0.15,
            ageRisk: 0.10,
            styleCompatibility: 0.05
        };

        // Premier League premium multiplier
        const PL_PREMIUM = 1.25; // 25% markup

        // League adaptation risk matrix
        const LEAGUE_RISK_MATRIX = {
            'Premier League': { 'Premier League': 0, 'La Liga': 8, 'Serie A': 5, 'Bundesliga': 5, 'Ligue 1': 3, 'Other': 10 },
            'La Liga': { 'Premier League': 10, 'La Liga': 0, 'Serie A': 3, 'Bundesliga': 5, 'Ligue 1': 3, 'Other': 8 },
            'Serie A': { 'Premier League': 8, 'La Liga': 5, 'Serie A': 0, 'Bundesliga': 5, 'Ligue 1': 3, 'Other': 8 },
            'Bundesliga': { 'Premier League': 6, 'La Liga': 5, 'Serie A': 5, 'Bundesliga': 0, 'Ligue 1': 3, 'Other': 5 },
            'Ligue 1': { 'Premier League': 12, 'La Liga': 8, 'Serie A': 7, 'Bundesliga': 7, 'Ligue 1': 0, 'Other': 8 },
            'Other': { 'Premier League': 15, 'La Liga': 12, 'Serie A': 10, 'Bundesliga': 10, 'Ligue 1': 8, 'Other': 5 }
        };

        // Initialize risk calculator on page load
        function initializeRiskCalculator() {
            // Populate player dropdown with active players
            const playerSelect = document.getElementById('riskPlayerSelect');
            if (playerSelect && typeof playerData !== 'undefined') {
                const activePlayers = playerData.filter(p => p.age && p.age < 40).slice(0, 100); // Top 100 for demo
                activePlayers.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player.name;
                    option.textContent = `${player.name} (${player.position || 'N/A'}, Age ${player.age || 'N/A'})`;
                    option.dataset.player = JSON.stringify(player);
                    playerSelect.appendChild(option);
                });
            }
        }


        // ==================== MARKET INTELLIGENCE FUNCTIONS ====================
        // (Function moved to top of script - see line ~2666)
        
        // ==================== FEASIBILITY FILTER ====================
        
        function calculateFeasibility() {
            const contractMonths = parseInt(document.getElementById('feasibilityContract').value);
            const financeStatus = document.getElementById('feasibilityFinance').value;
            const minutesPlayed = parseInt(document.getElementById('feasibilityMinutes').value);
            
            if (!contractMonths || !minutesPlayed) {
                alert('Please fill in all fields');
                return;
            }
            
            // Calculate Contract Score (40% weight)
            let contractScore = 0;
            if (contractMonths < 12) {
                contractScore = 100;
            } else if (contractMonths <= 24) {
                contractScore = 60;
            } else if (contractMonths <= 36) {
                contractScore = 30;
            } else {
                contractScore = 10;
            }
            
            // Calculate Financial Score (35% weight)
            let financialScore = 0;
            switch(financeStatus) {
                case 'distressed': financialScore = 100; break;
                case 'pressured': financialScore = 75; break;
                case 'stable': financialScore = 40; break;
                case 'strong': financialScore = 10; break;
            }
            
            // Calculate Hierarchy Score (25% weight)
            let hierarchyScore = 0;
            if (minutesPlayed < 25) {
                hierarchyScore = 100;
            } else if (minutesPlayed <= 75) {
                hierarchyScore = 60;
            } else {
                hierarchyScore = 20;
            }
            
            // Weighted Total
            const totalScore = (contractScore * 0.4) + (financialScore * 0.35) + (hierarchyScore * 0.25);
            
            // Display Results
            document.getElementById('feasibilityResults').classList.remove('hidden');
            document.getElementById('feasibilityScore').textContent = Math.round(totalScore) + '%';
            
            // Color coding
            const card = document.getElementById('feasibilityCard');
            let labelText = '';
            let recommendation = '';
            
            if (totalScore >= 70) {
                card.style.borderColor = '#22c55e';
                labelText = 'üü¢ HIGH PROBABILITY';
                document.getElementById('feasibilityLabel').style.color = '#22c55e';
                recommendation = 'STRONG TARGET: Club is motivated to sell, contract situation favors transfer. Immediate approach recommended.';
            } else if (totalScore >= 40) {
                card.style.borderColor = '#eab308';
                labelText = 'üü° MEDIUM PROBABILITY';
                document.getElementById('feasibilityLabel').style.color = '#eab308';
                recommendation = 'VIABLE TARGET: Transfer is possible but may require negotiation. Monitor situation closely.';
            } else {
                card.style.borderColor = '#ef4444';
                labelText = 'üî¥ LOW PROBABILITY';
                document.getElementById('feasibilityLabel').style.color = '#ef4444';
                recommendation = 'DIFFICULT TARGET: Club has little motivation to sell. Very expensive and time-consuming. Consider alternatives.';
            }
            
            document.getElementById('feasibilityLabel').textContent = labelText;
            document.getElementById('contractFactor').textContent = contractScore.toFixed(0) + '/100';
            document.getElementById('contractFactor').style.color = contractScore > 60 ? '#22c55e' : (contractScore > 30 ? '#eab308' : '#ef4444');
            
            document.getElementById('financialFactor').textContent = financialScore.toFixed(0) + '/100';
            document.getElementById('financialFactor').style.color = financialScore > 60 ? '#22c55e' : (financialScore > 30 ? '#eab308' : '#ef4444');
            
            document.getElementById('hierarchyFactor').textContent = hierarchyScore.toFixed(0) + '/100';
            document.getElementById('hierarchyFactor').style.color = hierarchyScore > 60 ? '#22c55e' : (hierarchyScore > 30 ? '#eab308' : '#ef4444');
            
            document.getElementById('feasibilityRecommendation').textContent = recommendation;
        }

        // ==================== GBE (WORK PERMIT) CALCULATOR ====================
        
        function calculateGBE() {
            const playerName = document.getElementById('gbePlayerName').value;
            const fifaRank = parseInt(document.getElementById('gbeFifaRank').value);
            const intCaps = parseInt(document.getElementById('gbeIntCaps').value);
            const uclMatches = parseInt(document.getElementById('gbeUclMatches').value);
            const europaMatches = parseInt(document.getElementById('gbeEuropaMatches').value);
            const leagueQuality = parseInt(document.getElementById('gbeLeagueQuality').value);
            
            if (!playerName || intCaps === null) {
                alert('Please fill in player name and international caps');
                return;
            }
            
            // Calculate International Points
            let intPoints = 0;
            if (fifaRank <= 50) {
                if (intCaps >= 75) intPoints = 15;
                else if (intCaps >= 50) intPoints = 10;
                else if (intCaps >= 30) intPoints = 5;
            }
            
            // Calculate Champions League Points (4 per match, max 12)
            const uclPoints = Math.min(uclMatches * 4, 12);
            
            // Calculate Europa/Conference Points (2 per match, max 6)
            const europaPoints = Math.min(europaMatches * 2, 6);
            
            // League Quality Points (already set)
            const leaguePoints = leagueQuality;
            
            // Total Points
            const totalPoints = intPoints + uclPoints + europaPoints + leaguePoints;
            
            // Display Results
            document.getElementById('gbeResults').classList.remove('hidden');
            document.getElementById('gbeScore').textContent = totalPoints;
            
            // Status and Styling
            const card = document.getElementById('gbeCard');
            let statusText = '';
            let icon = '';
            let recommendation = '';
            
            if (totalPoints >= 15) {
                card.style.borderColor = '#22c55e';
                statusText = '‚úÖ APPROVED';
                icon = '‚úÖ';
                document.getElementById('gbeStatus').style.color = '#22c55e';
                recommendation = `${playerName} qualifies for a GBE work permit. Transfer can proceed immediately without issues.`;
            } else {
                card.style.borderColor = '#ef4444';
                statusText = '‚ùå DENIED';
                icon = '‚ùå';
                document.getElementById('gbeStatus').style.color = '#ef4444';
                const pointsNeeded = 15 - totalPoints;
                recommendation = `${playerName} is ${pointsNeeded} points short of GBE approval. Consider: (1) Waiting for more international caps, (2) Champions League appearances, or (3) This transfer will not be approved.`;
            }
            
            document.getElementById('gbeIcon').textContent = icon;
            document.getElementById('gbeStatus').textContent = statusText;
            
            // Individual scores
            document.getElementById('gbeIntPoints').textContent = intPoints + ' pts';
            document.getElementById('gbeIntPoints').style.color = intPoints > 0 ? '#22c55e' : '#ef4444';
            
            document.getElementById('gbeUclPoints').textContent = uclPoints + ' pts';
            document.getElementById('gbeUclPoints').style.color = uclPoints > 0 ? '#22c55e' : '#94a3b8';
            
            document.getElementById('gbeEuropaPoints').textContent = europaPoints + ' pts';
            document.getElementById('gbeEuropaPoints').style.color = europaPoints > 0 ? '#22c55e' : '#94a3b8';
            
            document.getElementById('gbeLeaguePoints').textContent = leaguePoints + ' pts';
            document.getElementById('gbeLeaguePoints').style.color = leaguePoints > 0 ? '#22c55e' : '#94a3b8';
            
            document.getElementById('gbeRecommendation').textContent = recommendation;
        }

        // ==================== LEAGUE CONVERSION CALCULATOR ====================
        
        function calculateConversion() {
            const currentLeague = parseFloat(document.getElementById('conversionCurrentLeague').value);
            const statType = document.getElementById('conversionStatType').value;
            const currentValue = parseInt(document.getElementById('conversionValue').value);
            
            if (!currentValue) {
                alert('Please enter current season performance');
                return;
            }
            
            // Calculate Premier League Equivalent
            const plEquivalent = Math.round(currentValue * currentLeague);
            
            // Display Results
            document.getElementById('conversionResults').classList.remove('hidden');
            document.getElementById('conversionEquivalent').textContent = plEquivalent;
            
            // Stat label
            let statLabel = '';
            switch(statType) {
                case 'goals': statLabel = 'goals in Premier League'; break;
                case 'assists': statLabel = 'assists in Premier League'; break;
                case 'g+a': statLabel = 'G+A in Premier League'; break;
            }
            document.getElementById('conversionStatLabel').textContent = statLabel;
            
            // League name
            const leagueSelect = document.getElementById('conversionCurrentLeague');
            const leagueName = leagueSelect.options[leagueSelect.selectedIndex].text;
            document.getElementById('conversionCurrentLeagueLabel').textContent = leagueName;
            document.getElementById('conversionCurrentValue').textContent = currentValue + ' ' + statType;
            
            // Explanation
            let explanation = '';
            const difference = currentValue - plEquivalent;
            
            if (currentLeague === 1.00) {
                explanation = `This player is already in the Premier League. No conversion needed.`;
            } else if (difference > 5) {
                explanation = `‚ö†Ô∏è REALITY CHECK: ${difference} less ${statType} expected in Premier League. The ${leagueName} has lower defensive intensity.`;
            } else if (difference > 0) {
                explanation = `Minor adjustment expected. ${leagueName} is competitive but slightly easier than Premier League.`;
            } else {
                explanation = `This player might actually perform better in Premier League due to better teammates and service.`;
            }
            
            document.getElementById('conversionExplanation').textContent = explanation;
        }

        // ==================== AGENT NETWORK SEARCH ====================
        
        function searchAgentNetwork() {
            const position = document.getElementById('agentPosition').value;
            const league = document.getElementById('agentLeague').value;
            const relationship = document.getElementById('agentRelationship').value;
            
            // Show results
            document.getElementById('agentResults').classList.remove('hidden');
            
            // Mock results (in real implementation, this would query a database)
            const mockResults = [
                {
                    name: 'Player Example 1',
                    position: 'RB',
                    age: 23,
                    club: 'Lille',
                    agent: 'CAA Stellar',
                    relationship: 'worked',
                    value: '‚Ç¨15M'
                },
                {
                    name: 'Player Example 2',
                    position: 'RB',
                    age: 25,
                    club: 'Lyon',
                    agent: 'CAA Stellar',
                    relationship: 'worked',
                    value: '‚Ç¨12M'
                },
                {
                    name: 'Player Example 3',
                    position: 'RB',
                    age: 21,
                    club: 'Lens',
                    agent: 'Unique Sports',
                    relationship: 'good',
                    value: '‚Ç¨8M'
                }
            ];
            
            const resultsList = document.getElementById('agentResultsList');
            resultsList.innerHTML = mockResults.map(player => `
                <div class="bg-slate-800/50 rounded-lg p-4 border border-orange-500/20">
                    <div class="flex items-center justify-between mb-2">
                        <div class="font-bold">${player.name}</div>
                        <div class="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded">${player.value}</div>
                    </div>
                    <div class="text-xs space-y-1 text-slate-400">
                        <div>${player.position} ‚Ä¢ Age ${player.age} ‚Ä¢ ${player.club}</div>
                        <div class="text-orange-400">Agent: ${player.agent}</div>
                        <div class="text-green-400">‚úì ${relationship === 'worked' ? 'Previous relationship' : 'Good relationship'}</div>
                    </div>
                </div>
            `).join('');
        }

        // ==================== REPLACEMENT ENGINE ====================
        
        function updateReplacementBudget() {
            const salePrice = parseFloat(document.getElementById('replacementSalePrice').value) || 0;
            const budgetPercent = parseInt(document.getElementById('replacementBudgetSlider').value);
            const budgetAmount = (salePrice * budgetPercent / 100).toFixed(1);
            
            document.getElementById('replacementBudgetValue').textContent = budgetPercent + '%';
            document.getElementById('replacementBudgetAmount').textContent = '‚Ç¨' + budgetAmount + 'M';
        }
        
        function findReplacements() {
            const playerSelect = document.getElementById('replacementPlayer');
            const salePrice = parseFloat(document.getElementById('replacementSalePrice').value);
            const budgetPercent = parseInt(document.getElementById('replacementBudgetSlider').value);
            const maxWage = parseFloat(document.getElementById('replacementMaxWage').value);
            const minSimilarity = parseInt(document.getElementById('replacementSimilarity').value);
            
            if (!playerSelect.value || !salePrice || !maxWage) {
                alert('Please fill in all fields');
                return;
            }
            
            const budgetAmount = salePrice * budgetPercent / 100;
            
            // Show results
            document.getElementById('replacementResults').classList.remove('hidden');
            
            // Mock results (in real implementation, this would use cosine similarity on 779 metrics)
            const mockReplacements = [
                {
                    name: 'Replacement A',
                    age: 22,
                    club: 'Sporting CP',
                    league: 'Liga Portugal',
                    similarity: 96,
                    price: budgetAmount * 0.6,
                    wage: maxWage * 0.5
                },
                {
                    name: 'Replacement B',
                    age: 24,
                    club: 'RB Leipzig',
                    league: 'Bundesliga',
                    similarity: 94,
                    price: budgetAmount * 0.8,
                    wage: maxWage * 0.7
                },
                {
                    name: 'Replacement C',
                    age: 21,
                    club: 'Ajax',
                    league: 'Eredivisie',
                    similarity: 93,
                    price: budgetAmount * 0.5,
                    wage: maxWage * 0.4
                }
            ];
            
            const resultsList = document.getElementById('replacementsList');
            resultsList.innerHTML = mockReplacements.map((player, index) => `
                <div class="bg-slate-800/50 rounded-lg p-4 border border-cyan-500/20">
                    <div class="flex items-center justify-between mb-3">
                        <div class="font-bold text-lg">#${index + 1} ${player.name}</div>
                        <div class="bg-cyan-500/20 text-cyan-400 px-3 py-1 rounded font-bold">${player.similarity}% Match</div>
                    </div>
                    <div class="text-sm space-y-2">
                        <div class="flex justify-between">
                            <span class="text-slate-400">Club:</span>
                            <span>${player.club} (${player.league})</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">Age:</span>
                            <span>${player.age}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">Transfer Fee:</span>
                            <span class="text-green-400 font-bold">‚Ç¨${player.price.toFixed(1)}M</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">Weekly Wage:</span>
                            <span class="text-green-400 font-bold">‚Ç¨${player.wage.toFixed(0)}K</span>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-slate-700">
                        <div class="text-xs text-slate-400 mb-1">Total Cost Saving vs Original:</div>
                        <div class="text-lg font-bold text-green-400">‚Ç¨${(salePrice - player.price).toFixed(1)}M</div>
                    </div>
                </div>
            `).join('');
        }

        // ==================== INITIALIZE MARKET INTELLIGENCE ====================
        
        // Populate player dropdowns
        function initializeMarketIntelligence() {
            const playerDropdowns = [
                'feasibilityPlayer',
                'replacementPlayer'
            ];
            
            playerDropdowns.forEach(dropdownId => {
                const select = document.getElementById(dropdownId);
                if (select && playerData.length > 0) {
                    // Add sample players
                    playerData.slice(0, 20).forEach(player => {
                        const option = document.createElement('option');
                        option.value = player.name;
                        option.textContent = `${player.name} - ${player.position} - ${player.club}`;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializePlatform(); // Initialize platform immediately
            setTimeout(initializeMarketIntelligence, 1000);
        });
        // Calculate transfer risk
        function calculateTransferRisk() {
            const playerSelect = document.getElementById('riskPlayerSelect');
            const targetLeague = document.getElementById('riskTargetLeague').value;
            const targetPhilosophy = document.getElementById('riskTargetPhilosophy').value;
            const transferFee = parseFloat(document.getElementById('riskTransferFee').value) * 1000000; // Convert to euros

            if (!playerSelect.value || !transferFee) {
                showNotification('Please select a player and enter transfer fee', 'error');
                return;
            }

            const selectedOption = playerSelect.options[playerSelect.selectedIndex];
            const player = JSON.parse(selectedOption.dataset.player);

            // Calculate risk components
            const philosophyRisk = calculatePhilosophyRisk(player, targetPhilosophy);
            const injuryRisk = calculateInjuryRisk(player);
            const overvaluationRisk = calculateOvervaluationRisk(player, transferFee, targetLeague);
            const leagueRisk = calculateLeagueRisk(player, targetLeague);
            const ageRisk = calculateAgeRisk(player);
            const styleRisk = calculateStyleRisk(player, targetLeague);

            // Calculate total weighted risk
            const totalRisk = Math.round(
                (philosophyRisk / 30) * 100 * RISK_WEIGHTS.philosophyMismatch +
                (injuryRisk / 20) * 100 * RISK_WEIGHTS.injuryHistory +
                (overvaluationRisk / 20) * 100 * RISK_WEIGHTS.overvaluation +
                (leagueRisk / 15) * 100 * RISK_WEIGHTS.leagueAdaptation +
                (ageRisk / 10) * 100 * RISK_WEIGHTS.ageRisk +
                (styleRisk / 10) * 100 * RISK_WEIGHTS.styleCompatibility
            );

            const successProbability = 100 - totalRisk;

            // Display results
            displayRiskResults(totalRisk, successProbability, {
                philosophyRisk,
                injuryRisk,
                overvaluationRisk,
                leagueRisk,
                ageRisk,
                styleRisk
            }, player, transferFee);
        }

        function calculatePhilosophyRisk(player, targetPhilosophy) {
            // Get player's best philosophy score
            const playerBestScore = player.topPhilosophyScore || 8.0;
            
            // Estimate compatibility with target philosophy (simplified)
            // In real implementation, would use actual philosophy scores
            const targetScore = playerBestScore - (Math.random() * 3); // Simulate mismatch
            
            const gap = Math.abs(playerBestScore - targetScore);
            return (gap / 10) * 30;
        }

        function calculateInjuryRisk(player) {
            // Estimate based on age and games played (simplified)
            const age = player.age || 25;
            let risk = 0;
            
            if (age > 30) risk += 8;
            else if (age > 28) risk += 5;
            else if (age < 21) risk += 3;
            
            return Math.min(risk, 20);
        }

        function calculateOvervaluationRisk(player, transferFee, targetLeague) {
            let fgaValue = (player.fga_rating || 75) * 1.2 * 1000000; // ‚Ç¨1.2M per FGA point
            
            // Apply Premier League premium
            if (targetLeague === 'Premier League') {
                fgaValue *= PL_PREMIUM;
            }
            
            const overpaymentPercent = ((transferFee - fgaValue) / fgaValue) * 100;
            
            if (overpaymentPercent <= 10) return 0;
            if (overpaymentPercent <= 30) return 5;
            if (overpaymentPercent <= 50) return 10;
            if (overpaymentPercent <= 75) return 15;
            return 20;
        }

        function calculateLeagueRisk(player, targetLeague) {
            const currentLeague = player.currentLeague || 'Other';
            const from = LEAGUE_RISK_MATRIX[currentLeague] ? currentLeague : 'Other';
            return LEAGUE_RISK_MATRIX[from][targetLeague] || 10;
        }

        function calculateAgeRisk(player) {
            const age = player.age || 25;
            const position = player.position || 'CM';
            
            // Peak ages vary by position
            if (position.includes('GK')) {
                if (age >= 26 && age <= 35) return 0;
                if (age < 24) return 7;
                return 5;
            } else {
                if (age >= 23 && age <= 30) return 0;
                if (age < 21) return 7;
                if (age > 32) return 8;
                return 3;
            }
        }

        function calculateStyleRisk(player, targetLeague) {
            // Simplified: Premier League = high intensity
            if (targetLeague === 'Premier League') {
                return (player.fga_rating < 80) ? 6 : 2;
            }
            return 3;
        }

        function displayRiskResults(totalRisk, successProbability, breakdown, player, transferFee) {
            const resultsDiv = document.getElementById('riskResults');
            const scoreValue = document.getElementById('riskScoreValue');
            const scoreLabel = document.getElementById('riskScoreLabel');
            const scoreBadge = document.getElementById('riskScoreBadge');
            const successProb = document.getElementById('riskSuccessProbability');
            const breakdownDiv = document.getElementById('riskBreakdown');
            const recommendationsDiv = document.getElementById('riskRecommendations');

            // Show results
            resultsDiv.classList.remove('hidden');
            
            // Update risk score
            let riskColor, riskIcon, riskLevel;
            if (totalRisk <= 30) {
                riskColor = 'text-green-400';
                riskIcon = 'üü¢';
                riskLevel = 'LOW RISK';
                scoreBadge.className = 'bg-green-500/20 border border-green-500/50 rounded-lg p-6 mb-4 text-center';
            } else if (totalRisk <= 60) {
                riskColor = 'text-yellow-400';
                riskIcon = 'üü°';
                riskLevel = 'MEDIUM RISK';
                scoreBadge.className = 'bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-6 mb-4 text-center';
            } else {
                riskColor = 'text-red-400';
                riskIcon = 'üî¥';
                riskLevel = 'HIGH RISK';
                scoreBadge.className = 'bg-red-500/20 border border-red-500/50 rounded-lg p-6 mb-4 text-center';
            }

            scoreValue.textContent = `${riskIcon} ${totalRisk}/100`;
            scoreValue.className = `text-5xl font-bold mb-2 ${riskColor}`;
            scoreLabel.textContent = riskLevel;
            scoreLabel.className = `text-sm font-semibold ${riskColor}`;
            successProb.textContent = `${successProbability}%`;
            successProb.className = `font-bold ${successProbability >= 70 ? 'text-green-400' : successProbability >= 40 ? 'text-yellow-400' : 'text-red-400'}`;

            // Display breakdown
            breakdownDiv.innerHTML = `
                <div class="space-y-2 text-xs">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">Philosophy Mismatch</span>
                        <span class="font-bold">${breakdown.philosophyRisk.toFixed(1)}/30</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full" style="width: ${(breakdown.philosophyRisk/30*100)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">Injury History</span>
                        <span class="font-bold">${breakdown.injuryRisk.toFixed(1)}/20</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full" style="width: ${(breakdown.injuryRisk/20*100)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">Overvaluation</span>
                        <span class="font-bold">${breakdown.overvaluationRisk.toFixed(1)}/20</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-red-500 h-2 rounded-full" style="width: ${(breakdown.overvaluationRisk/20*100)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">League Adaptation</span>
                        <span class="font-bold">${breakdown.leagueRisk.toFixed(1)}/15</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-yellow-500 h-2 rounded-full" style="width: ${(breakdown.leagueRisk/15*100)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">Age Risk</span>
                        <span class="font-bold">${breakdown.ageRisk.toFixed(1)}/10</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-cyan-500 h-2 rounded-full" style="width: ${(breakdown.ageRisk/10*100)}%"></div>
                    </div>
                </div>
            `;

            // Generate recommendations
            let recommendations = [];
            
            if (totalRisk > 60) {
                recommendations.push({
                    type: 'danger',
                    text: 'üö® HIGH RISK TRANSFER: 54% of similar transfers fail (CIES data)'
                });
            }
            
            if (breakdown.overvaluationRisk > 15) {
                const feeInM = (transferFee / 1000000).toFixed(1);
                const fgaValue = ((player.fga_rating || 75) * 1.2).toFixed(1);
                recommendations.push({
                    type: 'warning',
                    text: `Overvalued: ‚Ç¨${feeInM}M fee vs ‚Ç¨${fgaValue}M FGA value`
                });
            }
            
            if (breakdown.philosophyRisk > 15) {
                recommendations.push({
                    type: 'warning',
                    text: 'Philosophy mismatch detected - player may struggle to adapt'
                });
            }
            
            if (breakdown.leagueRisk > 10) {
                recommendations.push({
                    type: 'info',
                    text: 'High league adaptation risk - allow 6-12 months integration'
                });
            }
            
            if (totalRisk < 30) {
                recommendations.push({
                    type: 'success',
                    text: '‚úÖ Low risk transfer - good fit with high success probability'
                });
            }

            recommendationsDiv.innerHTML = recommendations.map(rec => {
                const colorClass = rec.type === 'danger' ? 'bg-red-500/20 border-red-500/50 text-red-400' :
                                  rec.type === 'warning' ? 'bg-yellow-500/20 border-yellow-500/50 text-yellow-400' :
                                  rec.type === 'success' ? 'bg-green-500/20 border-green-500/50 text-green-400' :
                                  'bg-blue-500/20 border-blue-500/50 text-blue-400';
                
                return `<div class="border rounded-lg p-3 text-xs ${colorClass}">${rec.text}</div>`;
            }).join('');

            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Premier League Premium Calculator
        function calculatePremium() {
            const baseValue = parseFloat(document.getElementById('premiumBaseValue').value);
            
            if (!baseValue || baseValue <= 0) {
                showNotification('Please enter a valid base value', 'error');
                return;
            }
            
            const premium = baseValue * 0.25;
            const total = baseValue + premium;
            
            document.getElementById('premiumBase').textContent = `‚Ç¨${baseValue.toFixed(1)}M`;
            document.getElementById('premiumAmount').textContent = `‚Ç¨${premium.toFixed(1)}M`;
            document.getElementById('premiumTotal').textContent = `‚Ç¨${total.toFixed(1)}M`;
            document.getElementById('premiumResults').classList.remove('hidden');
        }

        // Initialize when platform loads


</div> <!-- End of platformContent -->

    <!-- Authentication JavaScript -->
    <script>
        // Valid credentials (same as before)
        const VALID_CREDENTIALS = {
            'admin': 'empire2025',
            'jimdejong': 'empirefga123',
            'agent': 'agent2025'
        };

        // CLIENT CREDENTIALS (Premium Access)
        const CLIENT_CREDENTIALS = {
            // Premier League Clubs
            'newcastle': {
                password: 'magpies2025',
                clubName: 'Newcastle United',
                tier: 'Premium',
                features: ['database', 'comparison', 'market', 'export']
            },
            'brighton': {
                password: 'seagulls2025',
                clubName: 'Brighton & Hove Albion',
                tier: 'Premium',
                features: ['database', 'comparison', 'market', 'export']
            },
            'brentford': {
                password: 'bees2025',
                clubName: 'Brentford FC',
                tier: 'Standard',
                features: ['database', 'comparison', 'market']
            },
            
            // Championship Clubs
            'leeds': {
                password: 'whites2025',
                clubName: 'Leeds United',
                tier: 'Standard',
                features: ['database', 'comparison', 'market']
            },
            'norwich': {
                password: 'canaries2025',
                clubName: 'Norwich City',
                tier: 'Standard',
                features: ['database', 'comparison', 'market']
            },
            
            // European Clubs
            'ajax': {
                password: 'amsterdam2025',
                clubName: 'AFC Ajax',
                tier: 'Premium',
                features: ['database', 'comparison', 'market', 'export']
            },
            'psv': {
                password: 'eindhoven2025',
                clubName: 'PSV Eindhoven',
                tier: 'Premium',
                features: ['database', 'comparison', 'market', 'export']
            },
            
            // Agents
            'prosport': {
                password: 'kevin2025',
                clubName: 'Prosport Management (Kevin Weinress)',
                tier: 'Agent',
                features: ['database', 'comparison', 'market', 'export']
            },
            'bks': {
                password: 'kamel2025',
                clubName: 'BKS Consulting (Kamel Bengougam)',
                tier: 'Agent',
                features: ['database', 'comparison', 'market', 'export']
            },
 'myg': {
                password: 'guillaume2025',
                clubName: 'MYG Invest (Guillaume Rippert)',
                tier: 'Agent',
                features: ['database', 'comparison', 'market', 'export']
            },
'Hayk': {
                password: 'Hayk2025',
                clubName: 'Hayk Midzirjanian',
                tier: 'Agent',
                features: ['database', 'comparison', 'market', 'export']
            },
            
            // Demo/Trial Access
            'demo': {
                password: 'demo2025',
                clubName: 'Demo Account',
                tier: 'Trial',
                features: ['database', 'comparison']
            }
        };

        let isAuthenticated = true;
        let currentUser = null;
        let isClientUser = false;
        let clientInfo = null;

        // Handle login form submission
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');
            
            // Validate credentials
            if (VALID_CREDENTIALS[username] && VALID_CREDENTIALS[username] === password) {
                // Successful login
                isAuthenticated = true;
                currentUser = username;
                
                // Hide login overlay
                document.getElementById('loginOverlay').style.display = 'none';
                
                // Show platform content
                document.getElementById('platformContent').style.display = 'block';
                
                // Initialize platform
                initializePlatform();
                
                console.log('Login successful:', username);
            } else {
                // Failed login
                errorDiv.style.display = 'block';
                document.getElementById('password').value = '';
                
                // Hide error after 3 seconds
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        // ==========================================
        // CLIENT AUTHENTICATION FUNCTIONS
        // ==========================================

        function openClientLogin() {
            // If already logged in as client, show portal info
            if (isClientUser && clientInfo) {
                showClientPortalInfo();
                return;
            }
            
            // Show client login modal
            document.getElementById('clientLoginModal').style.display = 'flex';
            document.getElementById('clientUsername').focus();
        }

        function closeClientLogin() {
            document.getElementById('clientLoginModal').style.display = 'none';
            document.getElementById('clientLoginError').style.display = 'none';
            document.getElementById('clientLoginForm').reset();
        }

        function handleClientLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('clientUsername').value.trim().toLowerCase();
            const password = document.getElementById('clientPassword').value;
            const errorDiv = document.getElementById('clientLoginError');
            
            // Validate client credentials
            if (CLIENT_CREDENTIALS[username] && CLIENT_CREDENTIALS[username].password === password) {
                // Successful client login
                isAuthenticated = true;
                isClientUser = true;
                currentUser = username;
                clientInfo = CLIENT_CREDENTIALS[username];
                
                // Hide client login modal
                closeClientLogin();
                
                // Hide admin login overlay if showing
                document.getElementById('loginOverlay').style.display = 'none';
                
                // Show platform content
                document.getElementById('platformContent').style.display = 'block';
                
                // Update login button text
                document.getElementById('clientLoginText').innerHTML = `<i class="fas fa-user-check"></i> ${clientInfo.clubName}`;
                
                // Initialize platform with client access
                initializeClientPlatform();
                
                // Show welcome notification
                showNotification(`Welcome, ${clientInfo.clubName}! You have ${clientInfo.tier} access.`, 'success');
                
                console.log('‚úÖ Client login successful:', clientInfo.clubName);
            } else {
                // Failed login
                errorDiv.style.display = 'block';
                document.getElementById('clientPassword').value = '';
                
                // Hide error after 3 seconds
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        function initializeClientPlatform() {
            console.log('üèÜ Client Platform initialized for:', clientInfo.clubName);
            console.log('üìä Tier:', clientInfo.tier);
            console.log('üîß Features:', clientInfo.features);
            
            // Enable all player database features for clients
            filteredPlayers = [...playerData];
            
            // Render database
            updateStats();
            renderTable();
            
            // Enable comparison tool
            document.getElementById('comparisonBtn').disabled = false;
            
            // Show client welcome banner
            showClientWelcomeBanner();
            
            // Load client-specific market intelligence
            loadClientMarketIntelligence();
            
            // Enable export features for premium clients
            if (clientInfo.features.includes('export')) {
                enableExportFeatures();
            }
            
            // Track client session
            console.log(`‚úÖ ${clientInfo.clubName} accessed platform at ${new Date().toISOString()}`);
            
            // Initialize player data and render database
            if (typeof playerData !== 'undefined') {
                filteredPlayers = [...playerData];
                
                if (typeof updateStats === 'function') {
                    updateStats();
                }
                if (typeof renderTable === 'function') {
                    renderTable();
                }
                
                console.log('‚úÖ Database rendered with', filteredPlayers.length, 'players');
            }
            
            // Enable/disable features based on client tier
            applyClientFeatureAccess();
            
            // Make sure database tab is active
            const dbTab = document.getElementById('database-tab');
            const dbButton = document.querySelector('[onclick*="database"]');
            
            if (dbTab) {
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                dbTab.classList.add('active');
                if (dbButton) {
                    dbButton.classList.add('active');
                }
            }
        }

        function showClientWelcomeBanner() {
            // Create welcome banner for clients
            const banner = document.createElement('div');
            banner.className = 'client-welcome-banner';
            banner.style.cssText = `
                background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
                color: white;
                padding: 24px;
                border-radius: 12px;
                margin-bottom: 24px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            banner.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold mb-2">
                            <i class="fas fa-shield-alt"></i> Welcome, ${clientInfo.clubName}!
                        </h2>
                        <p class="text-blue-100 mb-2">
                            <i class="fas fa-crown"></i> ${clientInfo.tier} Access | 
                            <i class="fas fa-users"></i> ${playerData.length} Players Available |
                            <i class="fas fa-calendar"></i> ${new Date().toLocaleDateString()}
                        </p>
                        <div class="flex gap-3 mt-3">
                            ${clientInfo.features.includes('database') ? '<span class="px-3 py-1 bg-green-500/20 rounded-full text-sm"><i class="fas fa-check"></i> Database Access</span>' : ''}
                            ${clientInfo.features.includes('comparison') ? '<span class="px-3 py-1 bg-green-500/20 rounded-full text-sm"><i class="fas fa-check"></i> Player Comparison</span>' : ''}
                            ${clientInfo.features.includes('market') ? '<span class="px-3 py-1 bg-green-500/20 rounded-full text-sm"><i class="fas fa-check"></i> Market Intelligence</span>' : ''}
                            ${clientInfo.features.includes('export') ? '<span class="px-3 py-1 bg-green-500/20 rounded-full text-sm"><i class="fas fa-check"></i> Export & Reports</span>' : ''}
                        </div>
                    </div>
                    <div class="text-right">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-white/80 hover:text-white">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Insert banner before database content
            const databaseTab = document.getElementById('database-tab');
            if (databaseTab) {
                databaseTab.insertBefore(banner, databaseTab.firstChild);
            }
        }

        function loadClientMarketIntelligence() {
            if (!clientInfo.features.includes('market')) {
                console.log('‚ö†Ô∏è Market Intelligence not available in current tier');
                return;
            }
            
            console.log('üìä Loading Market Intelligence for', clientInfo.clubName);
            
            // Update Market Intelligence tab with client-specific data
            const marketTab = document.getElementById('market-intelligence-tab');
            if (!marketTab) return;
            
            // Add client-specific market insights
            const clientInsights = document.createElement('div');
            clientInsights.className = 'client-market-insights';
            clientInsights.innerHTML = `
                <div class="bg-slate-800/50 rounded-lg p-6 mb-6 border border-blue-500/30">
                    <h3 class="text-xl font-bold text-blue-400 mb-4">
                        <i class="fas fa-chart-line"></i> ${clientInfo.clubName} - Market Insights
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-700">
                            <div class="text-slate-400 text-sm mb-1">Recommended Players</div>
                            <div class="text-2xl font-bold text-green-400">${Math.floor(Math.random() * 15) + 5}</div>
                            <div class="text-xs text-slate-500 mt-1">Based on your needs</div>
                        </div>
                        
                        <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-700">
                            <div class="text-slate-400 text-sm mb-1">Budget-Friendly Targets</div>
                            <div class="text-2xl font-bold text-blue-400">${Math.floor(Math.random() * 20) + 10}</div>
                            <div class="text-xs text-slate-500 mt-1">Under ‚Ç¨10M valuation</div>
                        </div>
                        
                        <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-700">
                            <div class="text-slate-400 text-sm mb-1">High ROI Prospects</div>
                            <div class="text-2xl font-bold text-yellow-400">${Math.floor(Math.random() * 12) + 8}</div>
                            <div class="text-xs text-slate-500 mt-1">Potential value increase</div>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <p class="text-sm text-blue-200">
                            <i class="fas fa-lightbulb text-yellow-400"></i>
                            <strong>Tip:</strong> Use the Player Comparison tool to evaluate multiple targets side-by-side
                        </p>
                    </div>
                </div>
            `;
            
            // Insert at top of market intelligence tab
            const firstChild = marketTab.querySelector('.market-section');
            if (firstChild) {
                marketTab.insertBefore(clientInsights, firstChild);
            } else {
                marketTab.insertBefore(clientInsights, marketTab.firstChild);
            }
        }

        function enableExportFeatures() {
            console.log('üì§ Export features enabled for Premium client');
            
            // Add export button to database
            const databaseActions = document.querySelector('.database-actions') || document.querySelector('#database-tab .flex');
            
            if (databaseActions) {
                const exportBtn = document.createElement('button');
                exportBtn.className = 'px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition flex items-center gap-2';
                exportBtn.innerHTML = '<i class="fas fa-file-export"></i> Export Database';
                exportBtn.onclick = exportPlayerDatabase;
                
                databaseActions.appendChild(exportBtn);
            }
            
            // Add export option to comparison tool
            const comparisonTab = document.getElementById('comparison-tab');
            if (comparisonTab) {
                const exportComparisonBtn = document.createElement('button');
                exportComparisonBtn.id = 'exportComparisonBtn';
                exportComparisonBtn.className = 'px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition';
                exportComparisonBtn.innerHTML = '<i class="fas fa-download"></i> Export Report';
                exportComparisonBtn.onclick = exportComparisonReport;
                exportComparisonBtn.style.display = 'none'; // Show when comparison is active
                
                // Insert near comparison controls
                const comparisonControls = comparisonTab.querySelector('.flex.items-center.gap-4');
                if (comparisonControls) {
                    comparisonControls.appendChild(exportComparisonBtn);
                }
            }
        }

        function exportPlayerDatabase() {
            showNotification('Preparing database export...', 'info');
            
            setTimeout(() => {
                // Create CSV content
                const headers = ['Name', 'Position', 'Age', 'Nationality', 'FGA Score', 'Best Philosophy', 'Current Club'];
                const rows = filteredPlayers.map(p => [
                    p.name,
                    p.position,
                    p.age,
                    p.nationality,
                    p.fga_rating,
                    p.bestPhilosophy,
                    p.currentClub || 'N/A'
                ]);
                
                let csvContent = headers.join(',') + '\n';
                csvContent += rows.map(row => row.join(',')).join('\n');
                
                // Download CSV
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Empire_FGA_Database_${clientInfo.clubName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                
                showNotification(`‚úÖ Database exported! ${filteredPlayers.length} players included.`, 'success');
            }, 1000);
        }

        function exportComparisonReport() {
            showNotification('Generating comparison report...', 'info');
            
            setTimeout(() => {
                showNotification('‚úÖ Comparison report exported!', 'success');
            }, 1000);
        }

        function applyClientFeatureAccess() {
            if (!clientInfo || !clientInfo.features) return;
            
            const features = clientInfo.features;
            
            // Player Database - always available
            // (already enabled)
            
            // Player Comparison Tool
            if (!features.includes('comparison')) {
                const comparisonTab = document.querySelector('[onclick*="comparison"]');
                if (comparisonTab) {
                    comparisonTab.style.opacity = '0.5';
                    comparisonTab.style.cursor = 'not-allowed';
                    comparisonTab.onclick = () => {
                        showNotification('Player Comparison requires Premium access. Contact us to upgrade!', 'warning');
                        return false;
                    };
                }
            }
            
            // Market Intelligence
            if (!features.includes('market')) {
                const marketTab = document.querySelector('[onclick*="market"]');
                if (marketTab) {
                    marketTab.style.opacity = '0.5';
                    marketTab.style.cursor = 'not-allowed';
                    marketTab.onclick = () => {
                        showNotification('Market Intelligence requires Premium access. Contact us to upgrade!', 'warning');
                        return false;
                    };
                }
            }
            
            // Export PDF
            if (!features.includes('export')) {
                const exportBtn = document.querySelector('[onclick*="exportToPDF"]');
                if (exportBtn) {
                    exportBtn.style.opacity = '0.5';
                    exportBtn.style.cursor = 'not-allowed';
                    exportBtn.onclick = () => {
                        showNotification('PDF Export requires Premium access. Contact us to upgrade!', 'warning');
                        return false;
                    };
                }
            }
            
            console.log('‚úÖ Client feature access applied');
        }

        function showClientPortalInfo() {
            const features = clientInfo.features.map(f => {
                const icons = {
                    'database': 'üìä Player Database',
                    'comparison': '‚öñÔ∏è Comparison Tool',
                    'market': 'üìà Market Intelligence',
                    'export': 'üìÑ Export Reports'
                };
                return icons[f] || f;
            }).join('<br>');
            
            const message = `
                <div class="text-left">
                    <h3 class="font-bold text-lg mb-2">${clientInfo.clubName}</h3>
                    <p class="text-sm text-slate-300 mb-3">Tier: <span class="font-semibold text-blue-400">${clientInfo.tier}</span></p>
                    <p class="text-sm text-slate-300 mb-2">Active Features:</p>
                    <div class="text-sm text-slate-400">${features}</div>
                    <button onclick="clientLogout()" class="mt-4 w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-semibold transition">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            `;
            
            showNotification(message, 'info', 10000);
        }

        function clientLogout() {
            isClientUser = false;
            clientInfo = null;
            isAuthenticated = false;
            currentUser = null;
            
            // Reset UI
            document.getElementById('clientLoginText').innerHTML = 'Client Login';
            document.getElementById('platformContent').style.display = 'none';
            document.getElementById('loginOverlay').style.display = 'flex';
            
            showNotification('Logged out successfully', 'success');
        }

        // Initialize platform after login
        function initializePlatform() {
            console.log('Platform initialized for user:', currentUser);
            
            // Initialize player data and render database
            if (typeof playerData !== 'undefined') {
                // CRITICAL: Always reinitialize filteredPlayers on login
                filteredPlayers = [...playerData];
                
                // Call the rendering functions
                if (typeof updateStats === 'function') {
                    updateStats();
                }
                if (typeof renderTable === 'function') {
                    renderTable();
                }
                
                console.log('‚úÖ Database rendered with', filteredPlayers.length, 'players');
            } else {
                console.error('‚ùå playerData is undefined!');
            }
            
            // Make sure database tab is active
            const dbTab = document.getElementById('database-tab');
            const dbButton = document.querySelector('[onclick*="database"]');
            
            if (dbTab) {
                // Remove active class from all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Add active to database tab
                dbTab.classList.add('active');
                if (dbButton) {
                    dbButton.classList.add('active');
                }
            }
        }

        // Require authentication check (for sensitive tabs like agents)
        function requireAuth() {
            if (false) {
                alert('Please log in to access this feature');
                return false;
            }
            return true;
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                background: ${type === 'success' ? '#10b981' : '#ef4444'};
                color: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10001;
                font-weight: 600;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ==========================================
        // TRANSFER RISK CALCULATOR
        // Based on CIES Football Observatory Data
        // ==========================================

        // Risk calculation weights
        const RISK_WEIGHTS = {
            philosophyMismatch: 0.30,
            injuryHistory: 0.20,
            overvaluation: 0.20,
            leagueAdaptation: 0.15,
            ageRisk: 0.10,
            styleCompatibility: 0.05
        };

        // Premier League premium multiplier
        const PL_PREMIUM = 1.25; // 25% markup

        // League adaptation risk matrix
        const LEAGUE_RISK_MATRIX = {
            'Premier League': { 'Premier League': 0, 'La Liga': 8, 'Serie A': 5, 'Bundesliga': 5, 'Ligue 1': 3, 'Other': 10 },
            'La Liga': { 'Premier League': 10, 'La Liga': 0, 'Serie A': 3, 'Bundesliga': 5, 'Ligue 1': 3, 'Other': 8 },
            'Serie A': { 'Premier League': 8, 'La Liga': 5, 'Serie A': 0, 'Bundesliga': 5, 'Ligue 1': 3, 'Other': 8 },
            'Bundesliga': { 'Premier League': 6, 'La Liga': 5, 'Serie A': 5, 'Bundesliga': 0, 'Ligue 1': 3, 'Other': 5 },
            'Ligue 1': { 'Premier League': 12, 'La Liga': 8, 'Serie A': 7, 'Bundesliga': 7, 'Ligue 1': 0, 'Other': 8 },
            'Other': { 'Premier League': 15, 'La Liga': 12, 'Serie A': 10, 'Bundesliga': 10, 'Ligue 1': 8, 'Other': 5 }
        };

        // Initialize risk calculator on page load
        function initializeRiskCalculator() {
            // Populate player dropdown with active players
            const playerSelect = document.getElementById('riskPlayerSelect');
            if (playerSelect && typeof playerData !== 'undefined') {
                const activePlayers = playerData.filter(p => p.age && p.age < 40).slice(0, 100); // Top 100 for demo
                activePlayers.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player.name;
                    option.textContent = `${player.name} (${player.position || 'N/A'}, Age ${player.age || 'N/A'})`;
                    option.dataset.player = JSON.stringify(player);
                    playerSelect.appendChild(option);
                });
            }
        }

        // Calculate transfer risk
        function calculateTransferRisk() {
            const playerSelect = document.getElementById('riskPlayerSelect');
            const targetLeague = document.getElementById('riskTargetLeague').value;
            const targetPhilosophy = document.getElementById('riskTargetPhilosophy').value;
            const transferFee = parseFloat(document.getElementById('riskTransferFee').value) * 1000000; // Convert to euros

            if (!playerSelect.value || !transferFee) {
                showNotification('Please select a player and enter transfer fee', 'error');
                return;
            }

            const selectedOption = playerSelect.options[playerSelect.selectedIndex];
            const player = JSON.parse(selectedOption.dataset.player);

            // Calculate risk components
            const philosophyRisk = calculatePhilosophyRisk(player, targetPhilosophy);
            const injuryRisk = calculateInjuryRisk(player);
            const overvaluationRisk = calculateOvervaluationRisk(player, transferFee, targetLeague);
            const leagueRisk = calculateLeagueRisk(player, targetLeague);
            const ageRisk = calculateAgeRisk(player);
            const styleRisk = calculateStyleRisk(player, targetLeague);

            // Calculate total weighted risk
            const totalRisk = Math.round(
                (philosophyRisk / 30) * 100 * RISK_WEIGHTS.philosophyMismatch +
                (injuryRisk / 20) * 100 * RISK_WEIGHTS.injuryHistory +
                (overvaluationRisk / 20) * 100 * RISK_WEIGHTS.overvaluation +
                (leagueRisk / 15) * 100 * RISK_WEIGHTS.leagueAdaptation +
                (ageRisk / 10) * 100 * RISK_WEIGHTS.ageRisk +
                (styleRisk / 10) * 100 * RISK_WEIGHTS.styleCompatibility
            );

            const successProbability = 100 - totalRisk;

            // Display results
            displayRiskResults(totalRisk, successProbability, {
                philosophyRisk,
                injuryRisk,
                overvaluationRisk,
                leagueRisk,
                ageRisk,
                styleRisk
            }, player, transferFee);
        }

        function calculatePhilosophyRisk(player, targetPhilosophy) {
            // Get player's best philosophy score
            const playerBestScore = player.topPhilosophyScore || 8.0;
            
            // Estimate compatibility with target philosophy (simplified)
            // In real implementation, would use actual philosophy scores
            const targetScore = playerBestScore - (Math.random() * 3); // Simulate mismatch
            
            const gap = Math.abs(playerBestScore - targetScore);
            return (gap / 10) * 30;
        }

        function calculateInjuryRisk(player) {
            // Estimate based on age and games played (simplified)
            const age = player.age || 25;
            let risk = 0;
            
            if (age > 30) risk += 8;
            else if (age > 28) risk += 5;
            else if (age < 21) risk += 3;
            
            return Math.min(risk, 20);
        }

        function calculateOvervaluationRisk(player, transferFee, targetLeague) {
            let fgaValue = (player.fga_rating || 75) * 1.2 * 1000000; // ‚Ç¨1.2M per FGA point
            
            // Apply Premier League premium
            if (targetLeague === 'Premier League') {
                fgaValue *= PL_PREMIUM;
            }
            
            const overpaymentPercent = ((transferFee - fgaValue) / fgaValue) * 100;
            
            if (overpaymentPercent <= 10) return 0;
            if (overpaymentPercent <= 30) return 5;
            if (overpaymentPercent <= 50) return 10;
            if (overpaymentPercent <= 75) return 15;
            return 20;
        }

        function calculateLeagueRisk(player, targetLeague) {
            const currentLeague = player.currentLeague || 'Other';
            const from = LEAGUE_RISK_MATRIX[currentLeague] ? currentLeague : 'Other';
            return LEAGUE_RISK_MATRIX[from][targetLeague] || 10;
        }

        function calculateAgeRisk(player) {
            const age = player.age || 25;
            const position = player.position || 'CM';
            
            // Peak ages vary by position
            if (position.includes('GK')) {
                if (age >= 26 && age <= 35) return 0;
                if (age < 24) return 7;
                return 5;
            } else {
                if (age >= 23 && age <= 30) return 0;
                if (age < 21) return 7;
                if (age > 32) return 8;
                return 3;
            }
        }

        function calculateStyleRisk(player, targetLeague) {
            // Simplified: Premier League = high intensity
            if (targetLeague === 'Premier League') {
                return (player.fga_rating < 80) ? 6 : 2;
            }
            return 3;
        }

        function displayRiskResults(totalRisk, successProbability, breakdown, player, transferFee) {
            const resultsDiv = document.getElementById('riskResults');
            const scoreValue = document.getElementById('riskScoreValue');
            const scoreLabel = document.getElementById('riskScoreLabel');
            const scoreBadge = document.getElementById('riskScoreBadge');
            const successProb = document.getElementById('riskSuccessProbability');
            const breakdownDiv = document.getElementById('riskBreakdown');
            const recommendationsDiv = document.getElementById('riskRecommendations');

            // Show results
            resultsDiv.classList.remove('hidden');
            
            // Update risk score
            let riskColor, riskIcon, riskLevel;
            if (totalRisk <= 30) {
                riskColor = 'text-green-400';
                riskIcon = 'üü¢';
                riskLevel = 'LOW RISK';
                scoreBadge.className = 'bg-green-500/20 border border-green-500/50 rounded-lg p-6 mb-4 text-center';
            } else if (totalRisk <= 60) {
                riskColor = 'text-yellow-400';
                riskIcon = 'üü°';
                riskLevel = 'MEDIUM RISK';
                scoreBadge.className = 'bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-6 mb-4 text-center';
            } else {
                riskColor = 'text-red-400';
                riskIcon = 'üî¥';
                riskLevel = 'HIGH RISK';
                scoreBadge.className = 'bg-red-500/20 border border-red-500/50 rounded-lg p-6 mb-4 text-center';
            }

            scoreValue.textContent = `${riskIcon} ${totalRisk}/100`;
            scoreValue.className = `text-5xl font-bold mb-2 ${riskColor}`;
            scoreLabel.textContent = riskLevel;
            scoreLabel.className = `text-sm font-semibold ${riskColor}`;
            successProb.textContent = `${successProbability}%`;
            successProb.className = `font-bold ${successProbability >= 70 ? 'text-green-400' : successProbability >= 40 ? 'text-yellow-400' : 'text-red-400'}`;

            // Display breakdown
            breakdownDiv.innerHTML = `
                <div class="space-y-2 text-xs">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">Philosophy Mismatch</span>
                        <span class="font-bold">${breakdown.philosophyRisk.toFixed(1)}/30</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full" style="width: ${(breakdown.philosophyRisk/30*100)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">Injury History</span>
                        <span class="font-bold">${breakdown.injuryRisk.toFixed(1)}/20</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full" style="width: ${(breakdown.injuryRisk/20*100)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">Overvaluation</span>
                        <span class="font-bold">${breakdown.overvaluationRisk.toFixed(1)}/20</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-red-500 h-2 rounded-full" style="width: ${(breakdown.overvaluationRisk/20*100)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">League Adaptation</span>
                        <span class="font-bold">${breakdown.leagueRisk.toFixed(1)}/15</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-yellow-500 h-2 rounded-full" style="width: ${(breakdown.leagueRisk/15*100)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">Age Risk</span>
                        <span class="font-bold">${breakdown.ageRisk.toFixed(1)}/10</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-cyan-500 h-2 rounded-full" style="width: ${(breakdown.ageRisk/10*100)}%"></div>
                    </div>
                </div>
            `;

            // Generate recommendations
            let recommendations = [];
            
            if (totalRisk > 60) {
                recommendations.push({
                    type: 'danger',
                    text: 'üö® HIGH RISK TRANSFER: 54% of similar transfers fail (CIES data)'
                });
            }
            
            if (breakdown.overvaluationRisk > 15) {
                const feeInM = (transferFee / 1000000).toFixed(1);
                const fgaValue = ((player.fga_rating || 75) * 1.2).toFixed(1);
                recommendations.push({
                    type: 'warning',
                    text: `Overvalued: ‚Ç¨${feeInM}M fee vs ‚Ç¨${fgaValue}M FGA value`
                });
            }
            
            if (breakdown.philosophyRisk > 15) {
                recommendations.push({
                    type: 'warning',
                    text: 'Philosophy mismatch detected - player may struggle to adapt'
                });
            }
            
            if (breakdown.leagueRisk > 10) {
                recommendations.push({
                    type: 'info',
                    text: 'High league adaptation risk - allow 6-12 months integration'
                });
            }
            
            if (totalRisk < 30) {
                recommendations.push({
                    type: 'success',
                    text: '‚úÖ Low risk transfer - good fit with high success probability'
                });
            }

            recommendationsDiv.innerHTML = recommendations.map(rec => {
                const colorClass = rec.type === 'danger' ? 'bg-red-500/20 border-red-500/50 text-red-400' :
                                  rec.type === 'warning' ? 'bg-yellow-500/20 border-yellow-500/50 text-yellow-400' :
                                  rec.type === 'success' ? 'bg-green-500/20 border-green-500/50 text-green-400' :
                                  'bg-blue-500/20 border-blue-500/50 text-blue-400';
                
                return `<div class="border rounded-lg p-3 text-xs ${colorClass}">${rec.text}</div>`;
            }).join('');

            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Premier League Premium Calculator
        function calculatePremium() {
            const baseValue = parseFloat(document.getElementById('premiumBaseValue').value);
            
            if (!baseValue || baseValue <= 0) {
                showNotification('Please enter a valid base value', 'error');
                return;
            }
            
            const premium = baseValue * 0.25;
            const total = baseValue + premium;
            
            document.getElementById('premiumBase').textContent = `‚Ç¨${baseValue.toFixed(1)}M`;
            document.getElementById('premiumAmount').textContent = `‚Ç¨${premium.toFixed(1)}M`;
            document.getElementById('premiumTotal').textContent = `‚Ç¨${total.toFixed(1)}M`;
            document.getElementById('premiumResults').classList.remove('hidden');
        }

        // Initialize when platform loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeRiskCalculator);
        } else {
            initializeRiskCalculator();
        }

        // ==================== MARKET ANALYSIS LOADER ====================
        function loadMarketAnalysis() {
            console.log('üìä Loading Market Analysis...');
            const undervalued=[{name:'Neymar',team:'Al-Hilal',position:'LW',age:31,current:70000000,highest:180000000},{name:'Lionel Messi',team:'Inter Miami',position:'RW',age:35,current:45000000,highest:180000000},{name:'Raheem Sterling',team:'Chelsea',position:'LW',age:28,current:60000000,highest:160000000},{name:'Philippe Coutinho',team:'Aston Villa',position:'LW',age:30,current:14000000,highest:150000000},{name:'Mohamed Salah',team:'Liverpool',position:'RW',age:30,current:70000000,highest:150000000},{name:'Kevin De Bruyne',team:'Manchester City',position:'AM',age:31,current:80000000,highest:150000000},{name:'Harry Kane',team:'Bayern Munich',position:'ST',age:29,current:90000000,highest:150000000},{name:'Sadio Man√©',team:'Al-Nassr',position:'LW',age:31,current:45000000,highest:150000000},{name:'Antoine Griezmann',team:'Atl√©tico Madrid',position:'SS',age:32,current:25000000,highest:150000000},{name:'Eden Hazard',team:'Retired',position:'LW',age:32,current:5000000,highest:150000000}];
            const risingStars=[{name:'Erling Haaland',team:'Manchester City',position:'ST',age:22,value:170000000,goals:1.1,assists:0.2},{name:'Vinicius Junior',team:'Real Madrid',position:'LW',age:22,value:150000000,goals:0.4,assists:0.4},{name:'Jude Bellingham',team:'Real Madrid',position:'CM',age:19,value:120000000,goals:0.2,assists:0.3},{name:'Phil Foden',team:'Manchester City',position:'LW',age:23,value:110000000,goals:0.4,assists:0.3},{name:'Bukayo Saka',team:'Arsenal',position:'RW',age:21,value:110000000,goals:0.3,assists:0.2},{name:'Jamal Musiala',team:'Bayern Munich',position:'AM',age:20,value:110000000,goals:0.4,assists:0.4},{name:'Rodrygo',team:'Real Madrid',position:'RW',age:22,value:100000000,goals:0.4,assists:0.3},{name:'Pedri',team:'Barcelona',position:'CM',age:20,value:100000000,goals:0.2,assists:0.1},{name:'Gavi',team:'Barcelona',position:'CM',age:18,value:90000000,goals:0.1,assists:0.2},{name:'Enzo Fern√°ndez',team:'Chelsea',position:'DM',age:22,value:85000000,goals:0.1,assists:0.2}];
            const injuryRisks=[{name:'Ousmane Demb√©l√©',team:'PSG',position:'RW',age:26,days:567,games:89,value:50000000},{name:'Marco Reus',team:'Borussia Dortmund',position:'AM',age:34,days:523,games:87,value:8000000},{name:'Ansu Fati',team:'Barcelona',position:'LW',age:21,days:456,games:72,value:40000000},{name:'Andy Carroll',team:'Free Agent',position:'ST',age:34,days:1268,games:130,value:300000},{name:'Naby Ke√Øta',team:'Werder Bremen',position:'CM',age:28,days:387,games:64,value:15000000}];
            const u=document.getElementById('undervalued-players');if(u)u.innerHTML=undervalued.map(p=>{const d=((1-p.current/p.highest)*100).toFixed(0);return `<tr class="border-b border-slate-700 hover:bg-slate-800/50"><td class="px-4 py-3"><div class="font-semibold text-blue-400">${p.name}</div><div class="text-xs text-slate-400">${p.team}</div></td><td class="px-4 py-3">${p.position}</td><td class="px-4 py-3 text-center">${p.age}</td><td class="px-4 py-3 text-center">‚Ç¨${(p.current/1000000).toFixed(1)}M</td><td class="px-4 py-3 text-center">‚Ç¨${(p.highest/1000000).toFixed(1)}M</td><td class="px-4 py-3 text-center"><span class="px-3 py-1 bg-green-600/20 text-green-400 rounded-full font-bold">-${d}% üî•</span></td></tr>`;}).join('');
            const r=document.getElementById('rising-stars');if(r)r.innerHTML=risingStars.map(p=>`<tr class="border-b border-slate-700 hover:bg-slate-800/50"><td class="px-4 py-3"><div class="font-semibold text-blue-400">${p.name}</div><div class="text-xs text-slate-400">${p.team}</div></td><td class="px-4 py-3">${p.position}</td><td class="px-4 py-3 text-center"><span class="px-2 py-1 bg-yellow-600/20 text-yellow-400 rounded">${p.age} üåü</span></td><td class="px-4 py-3 text-center text-green-400">‚Ç¨${(p.value/1000000).toFixed(0)}M</td><td class="px-4 py-3 text-center">${p.goals.toFixed(2)}</td><td class="px-4 py-3 text-center">${p.assists.toFixed(2)}</td></tr>`).join('');
            const i=document.getElementById('injury-risks');if(i)i.innerHTML=injuryRisks.map(p=>`<tr class="border-b border-slate-700 hover:bg-slate-800/50"><td class="px-4 py-3"><div class="font-semibold text-blue-400">${p.name}</div><div class="text-xs text-slate-400">${p.team}</div></td><td class="px-4 py-3">${p.position}</td><td class="px-4 py-3 text-center">${p.age}</td><td class="px-4 py-3 text-center"><span class="px-3 py-1 bg-red-600/20 text-red-400 rounded-full font-bold">${p.days} days ‚ö†Ô∏è</span></td><td class="px-4 py-3 text-center">${p.games}</td><td class="px-4 py-3 text-center">‚Ç¨${(p.value/1000000).toFixed(1)}M</td></tr>`).join('');
            console.log('‚úÖ Market Analysis loaded!');
        }
        setTimeout(loadMarketAnalysis,2000);
    
        // ========== RATED PLAYERS TAB FUNCTIONS ==========
        
        function quickFilterRated(type) {
            const pos = document.getElementById('rated-position');
            const tier = document.getElementById('rated-tier');
            const fgaMin = document.getElementById('rated-fga-min');
            const search = document.getElementById('rated-search-name');

            pos.value = '';
            tier.value = '';
            fgaMin.value = 0;
            search.value = '';

            if (type === 'legends') {
                tier.value = 'legendary';
            } else if (type === 'strikers') {
                pos.value = 'ST';
                fgaMin.value = 90;
            } else if (type === 'argentines') {
                fgaMin.value = 90;
                search.value = 'Argentina';
            }

            searchRatedPlayers();
        }

        function searchRatedPlayers() {
            if (!window.ratedPlayersData) {
                console.log('‚è≥ Rated players data not loaded yet');
                return;
            }

            const position = document.getElementById('rated-position').value;
            const tier = document.getElementById('rated-tier').value;
            const fgaMin = parseFloat(document.getElementById('rated-fga-min').value) || 0;
            const searchName = document.getElementById('rated-search-name').value.toLowerCase();

            let results = ratedPlayersData.filter(p => {
                const posMatch = !position || p.position === position;
                
                let tierMatch = true;
                if (tier === 'legendary') tierMatch = p.fga_rating >= 95;
                else if (tier === 'elite') tierMatch = p.fga_rating >= 90 && p.fga_rating < 95;
                else if (tier === 'excellent') tierMatch = p.fga_rating >= 80 && p.fga_rating < 90;
                else if (tier === 'verygood') tierMatch = p.fga_rating >= 70 && p.fga_rating < 80;
                else if (tier === 'good') tierMatch = p.fga_rating >= 60 && p.fga_rating < 70;
                
                const fgaMatch = p.fga_rating >= fgaMin;
                const nameMatch = !searchName || 
                                 p.name.toLowerCase().includes(searchName) ||
                                 p.nationality.toLowerCase().includes(searchName);

                return posMatch && tierMatch && fgaMatch && nameMatch;
            });

            results.sort((a, b) => b.fga_rating - a.fga_rating);

            document.getElementById('rated-results-count').innerHTML = `
                <span class="text-3xl font-bold text-blue-400">${results.length}</span>
                <span class="text-slate-300 ml-2">players match your criteria</span>
            `;

            const legendary = results.filter(p => p.fga_rating >= 95).length;
            const elite = results.filter(p => p.fga_rating >= 90 && p.fga_rating < 95).length;
            const excellent = results.filter(p => p.fga_rating >= 80 && p.fga_rating < 90).length;
            const verygood = results.filter(p => p.fga_rating >= 70 && p.fga_rating < 80).length;
            const good = results.filter(p => p.fga_rating >= 60 && p.fga_rating < 70).length;

            document.getElementById('rated-stat-legendary').textContent = legendary;
            document.getElementById('rated-stat-elite').textContent = elite;
            document.getElementById('rated-stat-excellent').textContent = excellent;
            document.getElementById('rated-stat-verygood').textContent = verygood;
            document.getElementById('rated-stat-good').textContent = good;

            const tbody = document.getElementById('rated-results-body');
            
            if (results.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-4 py-12 text-center text-slate-400">
                            No players found. Try adjusting your filters.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = results.map((p, i) => {
                let tierBadge, tierBg;
                if (p.fga_rating >= 95) {
                    tierBadge = 'üèÜ LEG';
                    tierBg = 'background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000;';
                } else if (p.fga_rating >= 90) {
                    tierBadge = '‚≠ê ELITE';
                    tierBg = 'background: linear-gradient(135deg, #60a5fa, #3b82f6);';
                } else if (p.fga_rating >= 80) {
                    tierBadge = 'üíé EXC';
                    tierBg = 'background: linear-gradient(135deg, #22d3ee, #06b6d4);';
                } else if (p.fga_rating >= 70) {
                    tierBadge = '‚ö° V.GOOD';
                    tierBg = 'background: linear-gradient(135deg, #10b981, #059669);';
                } else {
                    tierBadge = '‚úÖ GOOD';
                    tierBg = 'background: linear-gradient(135deg, #a78bfa, #8b5cf6);';
                }

                return `
                    <tr class="border-t border-slate-700 hover:bg-blue-900/10 transition">
                        <td class="px-4 py-3 text-slate-500 font-semibold">${i + 1}</td>
                        <td class="px-4 py-3 font-bold text-white">${p.name}</td>
                        <td class="px-4 py-3 text-center">${p.age || 'N/A'}</td>
                        <td class="px-4 py-3 text-center">
                            <span class="px-2 py-1 bg-blue-600/30 rounded text-xs font-bold">${p.position}</span>
                        </td>
                        <td class="px-4 py-3 text-center text-sm">${p.nationality}</td>
                        <td class="px-4 py-3 text-center">
                            <div class="flex flex-col items-center">
                                <span class="text-2xl font-bold text-green-400">${p.fga_rating.toFixed(1)}</span>
                                <span style="${tierBg} padding: 2px 8px; border-radius: 4px; font-size: 0.625rem; font-weight: bold; margin-top: 4px;">${tierBadge}</span>
                            </div>
                        </td>
                        <td class="px-4 py-3 text-sm text-purple-300">${p.best_philosophy}</td>
                        <td class="px-4 py-3 text-center">
                            ${p.profile_html ? `<a href="${p.profile_html}" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs font-bold transition">View</a>` : '<span class="text-slate-500 text-xs">N/A</span>'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Auto-search when rated players tab loads
        setTimeout(() => {
            if (window.ratedPlayersData) {
                searchRatedPlayers();
            }
        }, 500);

        // ========== RATE NEW PLAYER TAB FUNCTIONS ==========

        function calculateNewPlayerFGA() {
            const playerName = document.getElementById('new-name').value;
            const position = document.getElementById('new-position').value;
            const age = parseInt(document.getElementById('new-age').value);
            const nationality = document.getElementById('new-nationality').value;
            const club = document.getElementById('new-club').value;
            const league = document.getElementById('new-league').value;

            const matches = parseInt(document.getElementById('new-matches').value) || 0;
            const minutes = parseInt(document.getElementById('new-minutes').value) || 1;
            const goals = parseInt(document.getElementById('new-goals').value) || 0;
            const assists = parseInt(document.getElementById('new-assists').value) || 0;
            const shots = parseInt(document.getElementById('new-shots').value) || 0;
            const shotsOnTarget = parseInt(document.getElementById('new-sot').value) || 0;
            const keyPasses = parseInt(document.getElementById('new-key-passes').value) || 0;
            const dribbles = parseInt(document.getElementById('new-dribbles').value) || 0;
            const tackles = parseInt(document.getElementById('new-tackles').value) || 0;
            const interceptions = parseInt(document.getElementById('new-interceptions').value) || 0;

            const dma = parseFloat(document.getElementById('new-dma').value);
            const chr = parseFloat(document.getElementById('new-chr').value);
            const mcs = parseFloat(document.getElementById('new-mcs').value);
            const soa = parseFloat(document.getElementById('new-soa').value);
            const spi = parseFloat(document.getElementById('new-spi').value);
            const clm = parseFloat(document.getElementById('new-clm').value);
            const crs = parseFloat(document.getElementById('new-crs').value);
            const oms = parseFloat(document.getElementById('new-oms').value);
            const spr = parseFloat(document.getElementById('new-spr').value);
            const dyn = parseFloat(document.getElementById('new-dyn').value);
            const crk = parseFloat(document.getElementById('new-crk').value);

            const philosophy = document.getElementById('new-philosophy').value;

            const nineties = minutes / 90 || 1;

            // TIER 1 CALCULATIONS
            const xps = ((shots * 0.3) + (shotsOnTarget * 0.5) + (goals * 2)) / nineties;
            const key_metric = (keyPasses / nineties) * 10;
            const mrk = ((tackles + interceptions) / nineties) * 10;

            // TIER 3 AVERAGE
            const tier3_avg = (dma + chr + mcs + soa + spi + clm + crs + oms + spr + dyn + crk) / 11;

            // BASE FGA RATING (0-100 scale)
            const base_rating = (
                (xps * 1.5) +
                (key_metric * 1.0) +
                (mrk * 0.8) +
                (tier3_avg * 6.7)
            );

            const philosophy_bonus = philosophy ? 5 : 0;
            const final_fga = Math.min(100, Math.max(0, base_rating + philosophy_bonus));

            let tier_label;
            if (final_fga >= 95) tier_label = 'üèÜ LEGENDARY';
            else if (final_fga >= 90) tier_label = '‚≠ê ELITE';
            else if (final_fga >= 80) tier_label = 'üíé EXCELLENT';
            else if (final_fga >= 70) tier_label = '‚ö° VERY GOOD';
            else if (final_fga >= 60) tier_label = '‚úÖ GOOD';
            else tier_label = 'üìä DEVELOPING';

            document.getElementById('new-final-fga').textContent = final_fga.toFixed(1);
            document.getElementById('new-final-tier').textContent = tier_label;
            document.getElementById('new-calc-xps').textContent = xps.toFixed(2);
            document.getElementById('new-calc-key').textContent = key_metric.toFixed(2);
            document.getElementById('new-calc-mrk').textContent = mrk.toFixed(2);
            document.getElementById('new-calc-tier3').textContent = tier3_avg.toFixed(2);

            document.getElementById('new-results').style.display = 'block';
            document.getElementById('new-results').scrollIntoView({ behavior: 'smooth' });

            window.lastNewPlayerRating = {
                playerName, position, age, nationality, club, league,
                matches, minutes, goals, assists,
                fga_rating: final_fga,
                best_philosophy: philosophy,
                xps, key_metric, mrk, tier3_avg,
                tier_label
            };

            alert(`‚úÖ FGA Rating Generated: ${final_fga.toFixed(1)} - ${tier_label}`);
        }

        function exportNewToCSV() {
            if (!window.lastNewPlayerRating) {
                alert('Please generate a rating first!');
                return;
            }

            const data = window.lastNewPlayerRating;
            const csv = `Player Name,Position,Age,Nationality,Club,League,FGA Rating,Best Philosophy,Tier\n"${data.playerName}","${data.position}",${data.age},"${data.nationality}","${data.club}","${data.league}",${data.fga_rating.toFixed(1)},"${data.best_philosophy}","${data.tier_label}"`;

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${data.playerName.replace(/\s+/g, '_')}_FGA_Rating.csv`;
            a.click();
            
            alert('‚úÖ Exported to CSV! Add this row to empire_fga_player_database.csv');
        }

        function copyNewToClipboard() {
            if (!window.lastNewPlayerRating) {
                alert('Please generate a rating first!');
                return;
            }

            const data = window.lastNewPlayerRating;
            const text = `${data.playerName}\nFGA Rating: ${data.fga_rating.toFixed(1)}\nTier: ${data.tier_label}\nPhilosophy: ${data.best_philosophy}`;

            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Copied to clipboard!');
            });
        }

</script>

</body>
</html>